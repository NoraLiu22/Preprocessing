xkjmwmkmjqzkoogmooxkbmckvcrofoaeuslmdiva length 5 13598 page 13598 
<html>
<head>
<title>r96767 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r96767 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/96767" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./96766.html" title="Special:Code/MediaWiki/96766">r96766</a>‎ | <b>r96767</b> | <a href="./96768.html" title="Special:Code/MediaWiki/96768">r96768</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>02:20, 11 September 2011</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/bawolff" title="Special:Code/MediaWiki/author/bawolff">bawolff</a></td></tr>
<tr><td>Status:</td><td>resolved (<a href="#code-comments">Comments</a>)
</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">(<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=16755">bug 16755</a>) Add syntax to DEFAULTSORT - {{DEFAULTSORT:Foo|noerror}} and {{DEFAULTSORT:Bar|noreplace}}<br />
to in both cases prevent the &quot;A sortkey already was specified earlier in the page, yadda yadda&quot; message and in the second case, also do not replace the sortkey<br />
if one was already specified.</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/RELEASE-NOTES-1.19</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2FRELEASE-NOTES-1.19" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/parser/CoreParserFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2Fparser%2FCoreParserFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/96767&amp;action=purge" title="Special:Code/MediaWiki/96767">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/RELEASE-NOTES-1.19</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -57,6 +57,8 @@</span></td></tr>
<tr id="6"><td class="linenumbers">58</td><td class="linenumbers">58</td><td class="unchanged"><span> * (bug 30774) mediawiki.html: Add support for numbers and booleans in the</span></td></tr>
<tr id="7"><td class="linenumbers">59</td><td class="linenumbers">59</td><td class="unchanged"><span>   attribute values and element contents.</span></td></tr>
<tr id="8"><td class="linenumbers">60</td><td class="linenumbers">60</td><td class="unchanged"><span> * Conversion script between Tifinagh and Latin for the Tachelhit language</span></td></tr>
<tr id="9"><td class="linenumbers"> </td><td class="linenumbers">61</td><td class="ins"><ins>+* (bug 16755) Add options 'noreplace' and 'noerror' to {{DEFAULTSORT:...}}</ins></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">62</td><td class="ins"><ins>+  to stop it from replace an already existing default sort, and suppress error.</ins></td></tr>
<tr id="11"><td class="linenumbers">61</td><td class="linenumbers">63</td><td class="unchanged"><span> </span></td></tr>
<tr id="12"><td class="linenumbers">62</td><td class="linenumbers">64</td><td class="unchanged"><span> === Bug fixes in 1.19 ===</span></td></tr>
<tr id="13"><td class="linenumbers">63</td><td class="linenumbers">65</td><td class="unchanged"><span> * $wgUploadNavigationUrl should be used for file redlinks if</span></td></tr>
<tr id="14" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/parser/CoreParserFunctions.php</td></tr>



<tr id="18"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -677,23 +677,33 @@</span></td></tr>
<tr id="19"><td class="linenumbers">678</td><td class="linenumbers">678</td><td class="unchanged"><span> </span></td></tr>
<tr id="20"><td class="linenumbers">679</td><td class="linenumbers">679</td><td class="unchanged"><span> 	/**</span></td></tr>
<tr id="21"><td class="linenumbers">680</td><td class="linenumbers">680</td><td class="unchanged"><span> 	 * @param $parser Parser</span></td></tr>
<tr id="22"><td class="linenumbers">681</td><td class="linenumbers"> </td><td class="del"><del>-	 * @param  $text</del></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">681</td><td class="ins"><ins>+	 * @param $text String The sortkey to use</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">682</td><td class="ins"><ins>+	 * @param $arg String Either "noreplace" or "noerror"</ins></td></tr>
<tr id="25"><td class="linenumbers"> </td><td class="linenumbers">683</td><td class="ins"><ins>+	 *   both suppress errors, and noreplace does nothing if</ins></td></tr>
<tr id="26"><td class="linenumbers"> </td><td class="linenumbers">684</td><td class="ins"><ins>+	 *   a default sortkey already exists.</ins></td></tr>
<tr id="27"><td class="linenumbers">682</td><td class="linenumbers">685</td><td class="unchanged"><span> 	 * @return string</span></td></tr>
<tr id="28"><td class="linenumbers">683</td><td class="linenumbers">686</td><td class="unchanged"><span> 	 */</span></td></tr>
<tr id="29"><td class="linenumbers">684</td><td class="linenumbers"> </td><td class="del"><del>-	public static function defaultsort( $parser, $text ) {</del></td></tr>
<tr id="30"><td class="linenumbers"> </td><td class="linenumbers">687</td><td class="ins"><ins>+	public static function defaultsort( $parser, $text, $arg = '' ) {</ins></td></tr>
<tr id="31"><td class="linenumbers">685</td><td class="linenumbers">688</td><td class="unchanged"><span> 		$text = trim( $text );</span></td></tr>
<tr id="32"><td class="linenumbers"> </td><td class="linenumbers">689</td><td class="ins"><ins>+		$arg = trim( strtolower( $arg ) );</ins></td></tr>
<tr id="33"><td class="linenumbers">686</td><td class="linenumbers">690</td><td class="unchanged"><span> 		if( strlen( $text ) == 0 )</span></td></tr>
<tr id="34"><td class="linenumbers">687</td><td class="linenumbers">691</td><td class="unchanged"><span> 			return '';</span></td></tr>
<tr id="35"><td class="linenumbers">688</td><td class="linenumbers">692</td><td class="unchanged"><span> 		$old = $parser->getCustomDefaultSort();</span></td></tr>
<tr id="36"><td class="linenumbers">689</td><td class="linenumbers"> </td><td class="del"><del>-		$parser->setDefaultSort( $text );</del></td></tr>
<tr id="37"><td class="linenumbers">690</td><td class="linenumbers"> </td><td class="del"><del>-		if( $old === false || $old == $text )</del></td></tr>
<tr id="38"><td class="linenumbers"> </td><td class="linenumbers">693</td><td class="ins"><ins>+		if ( $old === false || $arg !== 'noreplace' ) {</ins></td></tr>
<tr id="39"><td class="linenumbers"> </td><td class="linenumbers">694</td><td class="ins"><ins>+			$parser->setDefaultSort( $text );</ins></td></tr>
<tr id="40"><td class="linenumbers"> </td><td class="linenumbers">695</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="41"><td class="linenumbers"> </td><td class="linenumbers">696</td><td class="ins"><ins>+</ins></td></tr>
<tr id="42"><td class="linenumbers"> </td><td class="linenumbers">697</td><td class="ins"><ins>+		if( $old === false || $old == $text || $arg === 'noreplace'</ins></td></tr>
<tr id="43"><td class="linenumbers"> </td><td class="linenumbers">698</td><td class="ins"><ins>+			|| $arg === 'noerror' )</ins></td></tr>
<tr id="44"><td class="linenumbers"> </td><td class="linenumbers">699</td><td class="ins"><ins>+		{</ins></td></tr>
<tr id="45"><td class="linenumbers">691</td><td class="linenumbers">700</td><td class="unchanged"><span> 			return '';</span></td></tr>
<tr id="46"><td class="linenumbers">692</td><td class="linenumbers"> </td><td class="del"><del>-		else</del></td></tr>
<tr id="47"><td class="linenumbers"> </td><td class="linenumbers">701</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="48"><td class="linenumbers">693</td><td class="linenumbers">702</td><td class="unchanged"><span> 			return( '&lt;span class="error">' .</span></td></tr>
<tr id="49"><td class="linenumbers">694</td><td class="linenumbers">703</td><td class="unchanged"><span> 				wfMsgForContent( 'duplicate-defaultsort',</span></td></tr>
<tr id="50"><td class="linenumbers">695</td><td class="linenumbers">704</td><td class="unchanged"><span> 						 htmlspecialchars( $old ),</span></td></tr>
<tr id="51"><td class="linenumbers">696</td><td class="linenumbers">705</td><td class="unchanged"><span> 						 htmlspecialchars( $text ) ) .</span></td></tr>
<tr id="52"><td class="linenumbers">697</td><td class="linenumbers">706</td><td class="unchanged"><span> 				'&lt;/span>' );</span></td></tr>
<tr id="53"><td class="linenumbers"> </td><td class="linenumbers">707</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="54"><td class="linenumbers">698</td><td class="linenumbers">708</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="55"><td class="linenumbers">699</td><td class="linenumbers">709</td><td class="unchanged"><span> </span></td></tr>
<tr id="56"><td class="linenumbers">700</td><td class="linenumbers">710</td><td class="unchanged"><span> 	// Usage {{filepath|300}}, {{filepath|nowiki}}, {{filepath|nowiki|300}} or {{filepath|300|nowiki}}</span></td></tr>
</table>
</div>
<h2 id='code-references'>Follow-up revisions</h2>
<table border='1' class='wikitable'><tr><th>Revision</th><th>Commit summary</th><th>Author</th><th>Date</th></tr><tr class='mw-codereview-status-ok'><td><a href="./96809.html" title="Special:Code/MediaWiki/96809">r96809</a></td><td>(follow-up <a href="./96767.html" title="Special:Code/MediaWiki/96767">r96767</a>) Make {{DEFAULTSORT:..|noerror}} and noreplace i18n-izable....</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/bawolff" title="Special:Code/MediaWiki/author/bawolff">bawolff</a></td><td>20:32, 11 September 2011</td></tr></table><h2 id='code-comments'>Comments</h2>
<div class='mw-codereview-comments'><div class="mw-codereview-comment" id="c22337" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./96767.html#c22337" title="Special:Code/MediaWiki/96767">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Nikerabbit" class="mw-userlink" title="User:Nikerabbit"><bdi>Nikerabbit</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Nikerabbit" class="mw-usertoollinks-talk" title="User talk:Nikerabbit">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Nikerabbit" class="mw-usertoollinks-contribs" title="Special:Contributions/Nikerabbit">contribs</a>)</span> &#160; 10:09, 11 September 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>shouldn't noreplace and noerror be i18ned?
</p></div></div>
<div class="mw-codereview-comment" id="c22354" style="margin-left: 48px"><div class="mw-codereview-comment-meta"><a href="./96767.html#c22354" title="Special:Code/MediaWiki/96767">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Bawolff" class="mw-userlink" title="User:Bawolff"><bdi>Bawolff</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Bawolff" class="mw-usertoollinks-talk" title="User talk:Bawolff">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Bawolff" class="mw-usertoollinks-contribs" title="Special:Contributions/Bawolff">contribs</a>)</span> &#160; 20:33, 11 September 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>yep it should. Done in <a href="./96809.html" title="Special:Code/MediaWiki/96809">r96809</a>
</p></div></div></div><h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>01:28, 4 November 2011&#160;<a href="https://www.mediawiki.org/wiki/User:Aaron_Schulz" class="mw-userlink" title="User:Aaron Schulz"><bdi>Aaron Schulz</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Aaron_Schulz" class="mw-usertoollinks-talk" title="User talk:Aaron Schulz">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Aaron_Schulz" class="mw-usertoollinks-contribs" title="Special:Contributions/Aaron Schulz">contribs</a>)</span>&#160;changed the <b>status</b> of r96767 <i>[<b>removed:</b> ok&#160;<b>added:</b> resolved]</i></li>
<li>01:28, 4 November 2011&#160;<a href="https://www.mediawiki.org/wiki/User:Aaron_Schulz" class="mw-userlink" title="User:Aaron Schulz"><bdi>Aaron Schulz</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Aaron_Schulz" class="mw-usertoollinks-talk" title="User talk:Aaron Schulz">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Aaron_Schulz" class="mw-usertoollinks-contribs" title="Special:Contributions/Aaron Schulz">contribs</a>)</span>&#160;changed the <b>status</b> of r96767 <i>[<b>removed:</b> new&#160;<b>added:</b> ok]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/96767.html responseCode 3 200 