lmlgpghoxidgooumcapkokpaigokzcpcficamabk length 6 116895 page 116895 <!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-clientpref-0 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Event Platform/EventStreams HTTP Service - Wikitech</title>
<script>(function(){var className="client-js vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-clientpref-0 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available";var cookie=document.cookie.match(/(?:^|; )labswikimwclientpreferences=([^;]+)/);if(cookie){cookie[1].split('%2C').forEach(function(pref){className=className.replace(new RegExp('(^| )'+pref.replace(/-clientpref-\w+$|[^\w-]+/g,'')+'-clientpref-\\w+( |$)'),'$1'+pref+'$2');});}document.documentElement.className=className;}());RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],
"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"71884293-ee47-4669-b63d-8e7d3e680019","wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Event_Platform/EventStreams_HTTP_Service","wgTitle":"Event Platform/EventStreams HTTP Service","wgCurRevisionId":2172043,"wgRevisionId":2172043,"wgArticleId":327375,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Services","Event Platform"],"wgPageViewLanguage":"en","wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Event_Platform/EventStreams_HTTP_Service","wgRelevantArticleId":327375,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRedirectedFrom":"EventStreams","wgMediaViewerOnClick":
true,"wgMediaViewerEnabledByDefault":true,"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr","pageVariantFallbacks":"en"},"wgMFDisplayWikibaseDescriptions":{"search":true,"watchlist":true,"tagline":false,"nearby":true},"wgWMESchemaEditAttemptStepOversample":false,"wgWMEPageLength":20000,"wgULSCurrentAutonym":"English","wgInternalRedirectTargetUrl":"/wiki/Event_Platform/EventStreams_HTTP_Service","wgEditSubmitButtonLabelPublish":true,"wgDiscussionToolsFeaturesEnabled":{"replytool":true,"newtopictool":true,"sourcemodetoolbar":true,"topicsubscription":false,"autotopicsub":false,"visualenhancements":false,"visualenhancements_reply":false,"visualenhancements_pageframe":false},"wgDiscussionToolsFallbackEditMode":"visual","wgULSPosition":"personal","wgULSisCompactLinksEnabled":false,"wgVector2022LanguageInHeader":true,"wgULSisLanguageSelectorEmpty":false,"wgCheckUserClientHintsHeadersJsApi":["architecture","bitness","brands","fullVersionList","mobile","model","platform",
"platformVersion"],"wgSiteNoticeId":"2.0"};RLSTATE={"skins.vector.user.styles":"ready","ext.gadget.enwp-boxes":"ready","site.styles":"ready","user.styles":"ready","skins.vector.user":"ready","user":"ready","user.options":"loading","ext.inputBox.styles":"ready","mediawiki.ui.input":"ready","mediawiki.ui.checkbox":"ready","mediawiki.ui.button":"ready","ext.pygments":"ready","ext.discussionTools.init.styles":"ready","oojs-ui-core.styles":"ready","oojs-ui.styles.indicators":"ready","mediawiki.widgets.styles":"ready","oojs-ui-core.icons":"ready","skins.vector.search.codex.styles":"ready","skins.vector.styles":"ready","skins.vector.icons":"ready","ext.wikimediamessages.styles":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready","ext.uls.pt":"ready","ext.dismissableSiteNotice.styles":"ready"};RLPAGEMODULES=["mediawiki.action.view.redirect","mediawiki.page.media","site","mediawiki.page.ready","mediawiki.toc","skins.vector.js","ext.gadget.site","mmv.head","mmv.bootstrap.autostart",
"ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader","ext.discussionTools.init","ext.eventLogging","ext.wikimediaEvents","ext.uls.interface","ext.checkUser.clientHints","ext.dismissableSiteNotice"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.impl(function(){return["user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
}];});});</script>
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=ext.discussionTools.init.styles%7Cext.dismissableSiteNotice.styles%7Cext.inputBox.styles%7Cext.pygments%7Cext.uls.pt%7Cext.visualEditor.desktopArticleTarget.noscript%7Cext.wikimediamessages.styles%7Cmediawiki.ui.button%2Ccheckbox%2Cinput%7Cmediawiki.widgets.styles%7Coojs-ui-core.icons%2Cstyles%7Coojs-ui.styles.indicators%7Cskins.vector.icons%2Cstyles%7Cskins.vector.search.codex.styles&amp;only=styles&amp;skin=vector-2022">
<script async="" src="/w/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector-2022"></script>
<meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=ext.gadget.enwp-boxes&amp;only=styles&amp;skin=vector-2022">
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector-2022">
<meta name="generator" content="MediaWiki 1.43.0-wmf.2">
<meta name="referrer" content="origin">
<meta name="referrer" content="origin-when-cross-origin">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1000">
<meta property="og:title" content="Event Platform/EventStreams HTTP Service - Wikitech">
<meta property="og:type" content="website">
<link rel="preconnect" href="//upload.wikimedia.org">
<link rel="icon" href="/static/favicon/wikitech.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikitech (en)">
<link rel="EditURI" type="application/rsd+xml" href="//wikitech.wikimedia.org/w/api.php?action=rsd">
<link rel="canonical" href="https://wikitech.wikimedia.org/wiki/Event_Platform/EventStreams_HTTP_Service">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="Wikitech Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="ext-discussiontools-replytool-enabled ext-discussiontools-newtopictool-enabled ext-discussiontools-sourcemodetoolbar-enabled skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Event_Platform_EventStreams_HTTP_Service rootpage-Event_Platform skin-vector-2022 action-view"><a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	<header class="vector-header mw-header">
		<div class="vector-header-start">
			<nav class="vector-main-menu-landmark" aria-label="Site" role="navigation">
				
<div id="vector-main-menu-dropdown" class="vector-dropdown vector-main-menu-dropdown vector-button-flush-left vector-button-flush-right"  >
	<input type="checkbox" id="vector-main-menu-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-main-menu-dropdown" class="vector-dropdown-checkbox "  aria-label="Main menu"  >
	<label id="vector-main-menu-dropdown-label" for="vector-main-menu-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"  ><span class="vector-icon mw-ui-icon-menu mw-ui-icon-wikimedia-menu"></span>

<span class="vector-dropdown-label-text">Main menu</span>
	</label>
	<div class="vector-dropdown-content">


				<div id="vector-main-menu-unpinned-container" class="vector-unpinned-container">
		
<div id="vector-main-menu" class="vector-main-menu vector-pinnable-element">
	<div
	class="vector-pinnable-header vector-main-menu-pinnable-header vector-pinnable-header-unpinned"
	data-feature-name="main-menu-pinned"
	data-pinnable-element-id="vector-main-menu"
	data-pinned-container-id="vector-main-menu-pinned-container"
	data-unpinned-container-id="vector-main-menu-unpinned-container"
>
	<div class="vector-pinnable-header-label">Main menu</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-main-menu.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-main-menu.unpin">hide</button>
</div>

	
<div id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation"  >
	<div class="vector-menu-heading">
		Navigation
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-mainpage-description" class="mw-list-item"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z"><span>Main page</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li><li id="n-Server-admin-log:-Prod" class="mw-list-item"><a href="/wiki/Server_Admin_Log"><span>Server admin log: Prod</span></a></li><li id="n-Admin-log:-RelEng" class="mw-list-item"><a href="/wiki/Release_Engineering/SAL"><span>Admin log: RelEng</span></a></li><li id="n-Incident-status" class="mw-list-item"><a href="/wiki/Incident_status"><span>Incident status</span></a></li><li id="n-Deployments" class="mw-list-item"><a href="/wiki/Deployments"><span>Deployments</span></a></li><li id="n-SRE-Team-Help" class="mw-list-item"><a href="/wiki/SRE/SRE_Team_requests"><span>SRE Team Help</span></a></li>
		</ul>
		
	</div>
</div>

	
	
<div id="p-Cloud_VPS_&amp;_Toolforge" class="vector-menu mw-portlet mw-portlet-Cloud_VPS_Toolforge"  >
	<div class="vector-menu-heading">
		Cloud VPS &amp; Toolforge
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-Cloud-VPS-portal" class="mw-list-item"><a href="/wiki/Portal:Cloud_VPS"><span>Cloud VPS portal</span></a></li><li id="n-Toolforge-portal" class="mw-list-item"><a href="/wiki/Portal:Toolforge"><span>Toolforge portal</span></a></li><li id="n-Request-VPS-project" class="mw-list-item"><a href="https://phabricator.wikimedia.org/project/view/2875/"><span>Request VPS project</span></a></li><li id="n-Admin-log:-Cloud-VPS" class="mw-list-item"><a href="/wiki/Cloud_VPS_Server_Admin_Log"><span>Admin log: Cloud VPS</span></a></li>
		</ul>
		
	</div>
</div>

</div>

				</div>

	</div>
</div>

		</nav>
			
<a href="/wiki/Main_Page" class="mw-logo">
	<img class="mw-logo-icon" src="/static/images/icons/wikitech.svg" alt="" aria-hidden="true" height="50" width="50">
	<span class="mw-logo-container">
		<img class="mw-logo-wordmark" alt="Wikitech" src="/static/images/mobile/copyright/wikitech-wordmark.svg" style="width: 8.75em; height: 1.6875em;">
	</span>
</a>

		</div>
		<div class="vector-header-end">
			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-collapses vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<a href="/wiki/Special:Search" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only search-toggle" id="" title="Search Wikitech [f]" accesskey="f"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
	</a>
	<div class="vector-typeahead-search-container">
		<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail cdx-typeahead-search--auto-expand-width">
			<form action="/w/index.php" id="searchform" class="cdx-search-input cdx-search-input--has-end-button">
				<div id="simpleSearch" class="cdx-search-input__input-wrapper"  data-search-loc="header-moved">
					<div class="cdx-text-input cdx-text-input--has-start-icon">
						<input
							class="cdx-text-input__input"
							 type="search" name="search" placeholder="Search Wikitech" aria-label="Search Wikitech" autocapitalize="sentences" title="Search Wikitech [f]" accesskey="f" id="searchInput"
							>
						<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
					</div>
					<input type="hidden" name="title" value="Special:Search">
				</div>
				<button class="cdx-button cdx-search-input__end-button">Search</button>
			</form>
		</div>
	</div>
</div>

			<nav class="vector-user-links vector-user-links-wide" aria-label="Personal tools" role="navigation" >
	<div class="vector-user-links-main">
	
<div id="p-vector-user-menu-preferences" class="vector-menu mw-portlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			<li id="ca-uls" class="mw-list-item active user-links-collapsible-item"><a data-mw="interface" href="#" class="uls-trigger cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet"><span class="vector-icon mw-ui-icon-wikimedia-language mw-ui-icon-wikimedia-wikimedia-language"></span>

<span>English</span></a>
</li>

			
		</ul>
		
	</div>
</div>

	
<div id="p-vector-user-menu-userpage" class="vector-menu mw-portlet emptyPortlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	<nav class="vector-client-prefs-landmark" aria-label="Appearance">
		
		
	</nav>
	
<div id="p-vector-user-menu-notifications" class="vector-menu mw-portlet emptyPortlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	
<div id="p-vector-user-menu-overflow" class="vector-menu mw-portlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			<li id="pt-login-2" class="user-links-collapsible-item mw-list-item user-links-collapsible-item"><a data-mw="interface" href="/w/index.php?title=Special:UserLogin&amp;returnto=Event+Platform%2FEventStreams+HTTP+Service" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o" class=""><span>Log in</span></a>
</li>

			
		</ul>
		
	</div>
</div>

	</div>
	
<div id="vector-user-links-dropdown" class="vector-dropdown vector-user-menu vector-button-flush-right vector-user-menu-logged-out"  title="More options" >
	<input type="checkbox" id="vector-user-links-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-user-links-dropdown" class="vector-dropdown-checkbox "  aria-label="Personal tools"  >
	<label id="vector-user-links-dropdown-label" for="vector-user-links-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"  ><span class="vector-icon mw-ui-icon-ellipsis mw-ui-icon-wikimedia-ellipsis"></span>

<span class="vector-dropdown-label-text">Personal tools</span>
	</label>
	<div class="vector-dropdown-content">


		
<div id="p-personal" class="vector-menu mw-portlet mw-portlet-personal"  title="User menu" >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="pt-login" class="user-links-collapsible-item mw-list-item"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Event+Platform%2FEventStreams+HTTP+Service" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span class="vector-icon mw-ui-icon-logIn mw-ui-icon-wikimedia-logIn"></span> <span>Log in</span></a></li>
		</ul>
		
	</div>
</div>

	
	</div>
</div>

</nav>

		</div>
	</header>
</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-sitenotice-container">
			<div id="siteNotice"><div id="mw-dismissablenotice-anonplace"></div><script>(function(){var node=document.getElementById("mw-dismissablenotice-anonplace");if(node){node.outerHTML="\u003Cdiv class=\"mw-dismissable-notice\"\u003E\u003Cdiv class=\"mw-dismissable-notice-close\"\u003E[\u003Ca tabindex=\"0\" role=\"button\"\u003Edismiss\u003C/a\u003E]\u003C/div\u003E\u003Cdiv class=\"mw-dismissable-notice-body\"\u003E\u003Cdiv id=\"localNotice\" data-nosnippet=\"\"\u003E\u003Cdiv class=\"sitenotice\" lang=\"en\" dir=\"ltr\"\u003E\u003Cp\u003E🛠️ Nominate your favorite tools for the \u003Ca href=\"https://meta.wikimedia.org/wiki/Coolest_Tool_Award#Coolest_Tool_Award_2024\" class=\"extiw\" title=\"meta:Coolest Tool Award\"\u003Efifth edition of the Coolest Tool Award\u003C/a\u003E. Nominations will be open until 2024-05-10.\n\u003C/p\u003E\u003C/div\u003E\u003C/div\u003E\u003C/div\u003E\u003C/div\u003E";}}());</script></div>
		</div>
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		<div id="mw-navigation">
			<nav id="mw-panel" class="vector-main-menu-landmark" aria-label="Site" role="navigation">
				<div id="vector-main-menu-pinned-container" class="vector-pinned-container">
				
				</div>
		</nav>
		</div>
	</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div
	class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned"
	data-feature-name="toc-pinned"
	data-pinnable-element-id="vector-toc"
	
	
>
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text"
			class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Streams"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Streams">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Streams</div>
		</a>
		
		<ul id="toc-Streams-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-When_not_to_use_EventStreams"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#When_not_to_use_EventStreams">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>When not to use EventStreams</div>
		</a>
		
		<ul id="toc-When_not_to_use_EventStreams-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Examples"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Examples">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Examples</div>
		</a>
		
			<button aria-controls="toc-Examples-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Examples subsection</span>
			</button>
		
		<ul id="toc-Examples-sublist" class="vector-toc-list">
			<li id="toc-Web_browser"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Web_browser">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Web browser</div>
			</a>
			
			<ul id="toc-Web_browser-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-JavaScript"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#JavaScript">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>JavaScript</div>
			</a>
			
			<ul id="toc-JavaScript-sublist" class="vector-toc-list">
				<li id="toc-Node.js_ESM_(with_wikimedia-streams)"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Node.js_ESM_(with_wikimedia-streams)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Node.js ESM (with wikimedia-streams)</div>
			</a>
			
			<ul id="toc-Node.js_ESM_(with_wikimedia-streams)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Node.js_(with_eventsource)"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Node.js_(with_eventsource)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Node.js (with eventsource)</div>
			</a>
			
			<ul id="toc-Node.js_(with_eventsource)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-TypeScript"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#TypeScript">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>TypeScript</div>
			</a>
			
			<ul id="toc-TypeScript-sublist" class="vector-toc-list">
				<li id="toc-Node.js_(with_wikimedia-streams)"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Node.js_(with_wikimedia-streams)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Node.js (with wikimedia-streams)</div>
			</a>
			
			<ul id="toc-Node.js_(with_wikimedia-streams)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Python"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Python">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Python</div>
			</a>
			
			<ul id="toc-Python-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Command-line"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Command-line">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Command-line</div>
			</a>
			
			<ul id="toc-Command-line-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-API"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#API">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>API</div>
		</a>
		
			<button aria-controls="toc-API-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle API subsection</span>
			</button>
		
		<ul id="toc-API-sublist" class="vector-toc-list">
			<li id="toc-Stream_selection"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Stream_selection">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Stream selection</div>
			</a>
			
			<ul id="toc-Stream_selection-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Historical_Consumption"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Historical_Consumption">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Historical Consumption</div>
			</a>
			
			<ul id="toc-Historical_Consumption-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Response_Format"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Response_Format">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Response Format</div>
			</a>
			
			<ul id="toc-Response_Format-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Canary_Events"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Canary_Events">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Canary Events</div>
			</a>
			
			<ul id="toc-Canary_Events-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Filtering"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Filtering">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Filtering</div>
			</a>
			
			<ul id="toc-Filtering-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Architecture"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Architecture">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Architecture</div>
		</a>
		
			<button aria-controls="toc-Architecture-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Architecture subsection</span>
			</button>
		
		<ul id="toc-Architecture-sublist" class="vector-toc-list">
			<li id="toc-SSE_vs._WebSockets/Socket.IO"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SSE_vs._WebSockets/Socket.IO">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>SSE vs. WebSockets/Socket.IO</div>
			</a>
			
			<ul id="toc-SSE_vs._WebSockets/Socket.IO-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-KafkaSSE"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#KafkaSSE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>KafkaSSE</div>
			</a>
			
			<ul id="toc-KafkaSSE-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Kafka"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kafka">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Kafka</div>
			</a>
			
			<ul id="toc-Kafka-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Notes"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Notes">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Notes</div>
		</a>
		
			<button aria-controls="toc-Notes-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Notes subsection</span>
			</button>
		
		<ul id="toc-Notes-sublist" class="vector-toc-list">
			<li id="toc-Server_side_enforced_timeout"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Server_side_enforced_timeout">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Server side enforced timeout</div>
			</a>
			
			<ul id="toc-Server_side_enforced_timeout-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Further_reading"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Further_reading">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Further reading</div>
		</a>
		
		<ul id="toc-Further_reading-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-External_links"
		class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#External_links">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>External links</div>
		</a>
		
		<ul id="toc-External_links-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left"  >
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox "  aria-label="Toggle the table of contents"  >
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"  ><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Event Platform/EventStreams HTTP Service</span></h1>
				</header>
				<div class="vector-page-toolbar">
					<div class="vector-page-toolbar-container">
						<div id="left-navigation">
							<nav aria-label="Namespaces">
								
<div id="p-associated-pages" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-associated-pages"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-nstab-main" class="selected vector-tab-noicon mw-list-item"><a href="/wiki/Event_Platform/EventStreams_HTTP_Service" title="View the content page [c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="vector-tab-noicon mw-list-item"><a href="/wiki/Talk:Event_Platform/EventStreams_HTTP_Service" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
		</ul>
		
	</div>
</div>

								
<div id="p-variants" class="vector-dropdown emptyPortlet"  >
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-dropdown-checkbox " aria-label="Change language variant"   >
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true"  ><span class="vector-dropdown-label-text">English</span>
	</label>
	<div class="vector-dropdown-content">


					
<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

				
	</div>
</div>

							</nav>
						</div>
						<div id="right-navigation" class="vector-collapsible">
							<nav aria-label="Views">
								
<div id="p-views" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-views"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-view" class="selected vector-tab-noicon mw-list-item"><a href="/wiki/Event_Platform/EventStreams_HTTP_Service"><span>Read</span></a></li><li id="ca-viewsource" class="vector-tab-noicon mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="vector-tab-noicon mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
		</ul>
		
	</div>
</div>

							</nav>
				
							<nav class="vector-page-tools-landmark" aria-label="Page tools">
								
<div id="vector-page-tools-dropdown" class="vector-dropdown vector-page-tools-dropdown"  >
	<input type="checkbox" id="vector-page-tools-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-tools-dropdown" class="vector-dropdown-checkbox "  aria-label="Tools"  >
	<label id="vector-page-tools-dropdown-label" for="vector-page-tools-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true"  ><span class="vector-dropdown-label-text">Tools</span>
	</label>
	<div class="vector-dropdown-content">


									<div id="vector-page-tools-unpinned-container" class="vector-unpinned-container">
						
<div id="vector-page-tools" class="vector-page-tools vector-pinnable-element">
	<div
	class="vector-pinnable-header vector-page-tools-pinnable-header vector-pinnable-header-unpinned"
	data-feature-name="page-tools-pinned"
	data-pinnable-element-id="vector-page-tools"
	data-pinned-container-id="vector-page-tools-pinned-container"
	data-unpinned-container-id="vector-page-tools-unpinned-container"
>
	<div class="vector-pinnable-header-label">Tools</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-page-tools.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-page-tools.unpin">hide</button>
</div>

	
<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-has-collapsible-items"  title="More options" >
	<div class="vector-menu-heading">
		Actions
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="/wiki/Event_Platform/EventStreams_HTTP_Service"><span>Read</span></a></li><li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;action=edit"><span>View source</span></a></li><li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;action=history"><span>View history</span></a></li>
		</ul>
		
	</div>
</div>

<div id="p-tb" class="vector-menu mw-portlet mw-portlet-tb"  >
	<div class="vector-menu-heading">
		General
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="t-whatlinkshere" class="mw-list-item"><a href="/wiki/Special:WhatLinksHere/Event_Platform/EventStreams_HTTP_Service" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="/wiki/Special:RecentChangesLinked/Event_Platform/EventStreams_HTTP_Service" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li><li id="t-permalink" class="mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;oldid=2172043" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;action=info" title="More information about this page"><span>Page information</span></a></li><li id="t-cite" class="mw-list-item"><a href="/w/index.php?title=Special:CiteThisPage&amp;page=Event_Platform%2FEventStreams_HTTP_Service&amp;id=2172043&amp;wpFormIdentifier=titleform" title="Information on how to cite this page"><span>Cite this page</span></a></li>
		</ul>
		
	</div>
</div>

<div id="p-coll-print_export" class="vector-menu mw-portlet mw-portlet-coll-print_export"  >
	<div class="vector-menu-heading">
		Print/export
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="coll-create_a_book" class="mw-list-item"><a href="/w/index.php?title=Special:Book&amp;bookcmd=book_creator&amp;referer=Event+Platform%2FEventStreams+HTTP+Service"><span>Create a book</span></a></li><li id="coll-download-as-rl" class="mw-list-item"><a href="/w/index.php?title=Special:DownloadAsPdf&amp;page=Event_Platform%2FEventStreams_HTTP_Service&amp;action=show-download-screen"><span>Download as PDF</span></a></li><li id="t-print" class="mw-list-item"><a href="/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;printable=yes" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li>
		</ul>
		
	</div>
</div>

</div>

									</div>
				
	</div>
</div>

							</nav>
						</div>
					</div>
				</div>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From Wikitech</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="/wiki/Event_Platform" title="Event Platform">Event Platform</a></div><span class="mw-redirectedfrom">(Redirected from <a href="/w/index.php?title=EventStreams&amp;redirect=no" class="mw-redirect" title="EventStreams">EventStreams</a>)</span></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content"><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><style data-mw-deduplicate="TemplateStyles:r2022625">.mw-parser-output .tpl-navsidebar{max-width:22em;background:#fff;border:1px solid #a2a9b1;float:right;clear:right;margin:.5em 0 1em 1em}.mw-parser-output .tpl-navsidebar-floatright{float:right;clear:right;margin:.5em 0 1em 1em}.mw-parser-output .tpl-navsidebar-floatleft{float:left;clear:left;margin:.5em 1em 1em 0}.mw-parser-output .tpl-navsidebar-floatnone{float:none;clear:both;margin:.5em 0}.mw-parser-output .tpl-navsidebar-topimage{margin:0 0 16px 0}.mw-parser-output .tpl-navsidebar-title{margin:8px 16px;border-bottom:3px solid #eaecf0;font-size:20px;text-align:center}.mw-parser-output .tpl-navsidebar-image{margin:0 0 8px}.mw-parser-output .tpl-navsidebar-content{margin:0 0 16px 0;padding:0 8px}.mw-parser-output .tpl-navsidebar-heading{margin:8px 0 0 0;font-weight:bold}.mw-parser-output .tpl-navsidebar-foot{padding:0 8px;margin:0;text-align:right;font-size:smaller}@media not (min-width:720px){.mw-parser-output .tpl-navsidebar{float:none;clear:both;margin:.5em 0;max-width:none}}</style><div role="navigation" class="navigation-not-searchable tpl-navsidebar" style=""><p class="tpl-navsidebar-title"><a href="/wiki/Event_Platform" title="Event Platform">Event Platform</a></p><div class="tpl-navsidebar-image"><figure class="mw-halign-center" typeof="mw:File"><a href="/wiki/File:EventPlatformIcon.png" class="mw-file-description"><img src="//upload.wikimedia.org/wikipedia/labs/thumb/6/62/EventPlatformIcon.png/100px-EventPlatformIcon.png" decoding="async" width="100" height="100" class="mw-file-element" srcset="//upload.wikimedia.org/wikipedia/labs/thumb/6/62/EventPlatformIcon.png/150px-EventPlatformIcon.png 1.5x, //upload.wikimedia.org/wikipedia/labs/thumb/6/62/EventPlatformIcon.png/200px-EventPlatformIcon.png 2x" data-file-width="401" data-file-height="401"/></a><figcaption></figcaption></figure></div><div class="tpl-navsidebar-contents"><div class="tpl-navsidebar-content">
<div style="font-size: 85%;">
<div class="mw-inputbox-centered" style=""><form name="searchbox" class="searchbox" action="/wiki/Special:Search"><input class="mw-searchInput searchboxInput mw-ui-input mw-ui-input-inline" name="search" placeholder="Search Event Platform Documentation" size="35" dir="ltr"/><input type="hidden" value="&quot;Event Platform&quot;" name="prefix"/> <input type="submit" name="fulltext" value="Search" class="mw-ui-button"/><input type="hidden" value="Search" name="fulltext"/></form></div>
</div>
</div><div class="tpl-navsidebar-content">
<p class="tpl-navsidebar-heading">Documentation</p><p class="mw-empty-elt">
</p><ul><li><a href="/wiki/Event_Platform/Schemas" title="Event Platform/Schemas">Schemas</a></li>
<li><a href="/wiki/Event_Platform/Schemas/Guidelines" title="Event Platform/Schemas/Guidelines">Schema guidelines</a></li>
<li><a href="/wiki/Event_Platform/Stream_Configuration" title="Event Platform/Stream Configuration">Event Stream Configuration</a></li>
<li><a href="/wiki/Event_Platform/Producer_Requirements" title="Event Platform/Producer Requirements">Producer requirements</a></li>
<li><a href="/wiki/Event_Platform/Flaws" title="Event Platform/Flaws">Flaws</a></li>
<li><a href="/wiki/Event_Platform/Decision_Log" title="Event Platform/Decision Log">Decision Log</a></li></ul>
<hr/>
<ul><li><a href="/wiki/Event_Platform/Stream_Processing/Flink" title="Event Platform/Stream Processing/Flink">Stream Processing/Flink</a></li>
<li><a href="/wiki/Event_Platform/Stream_Processing/Flink_Catalog" title="Event Platform/Stream Processing/Flink Catalog">Stream Processing/Flink Catalog</a></li>
<li><a href="/wiki/Event_Platform/Stream_Processing/Use_cases" title="Event Platform/Stream Processing/Use cases">Stream Processing Use Cases</a></li>
<li><a href="/wiki/Event_Platform/Stream_Processing/Framework_Evaluation" class="mw-redirect" title="Event Platform/Stream Processing/Framework Evaluation">Stream Processing Framework Evaluation</a></li></ul>
<hr/>
<ul><li><a href="/wiki/Event_Platform/Instrumentation_How_To" title="Event Platform/Instrumentation How To">Instrumentation tutorial</a></li>
<li><a href="/wiki/Event_Platform/EventLogging_legacy" title="Event Platform/EventLogging legacy">Differences with EventLogging legacy</a></li></ul>
<hr/>
<ul><li><a href="/wiki/Event*" title="Event*">Disambiguation page</a></li>
<li><a href="/wiki/Event_Platform/Maintainers" title="Event Platform/Maintainers">Maintainers</a></li></ul>
<hr/>
</div><div class="tpl-navsidebar-content">
<p class="tpl-navsidebar-heading">Services, libraries, and repositories</p><p class="mw-empty-elt">
</p><ul><li><a href="/wiki/Event_Platform/Event_Utilities" title="Event Platform/Event Utilities">Event Utilities</a> (code client libraries)</li>
<li><a href="/wiki/Event_Platform/EventGate" title="Event Platform/EventGate">EventGate service</a> (<a href="/wiki/Event_Platform/EventGate/Administration" title="Event Platform/EventGate/Administration">admin</a>)</li>
<li><a href="/wiki/Event_Platform/EventStreams" title="Event Platform/EventStreams">EventStreams service</a> (admin)</li>
<li><a class="external text" href="https://schema.wikimedia.org/#!/">Schema API</a></li>
<li><a class="external text" href="https://stream.wikimedia.org/v2/ui/#/">EventStreams API</a></li>
<li><a rel="nofollow" class="external text" href="https://stream-beta.wmflabs.org/v2/ui/#/">EventStreams API (Beta Cluster)</a></li>
<li><a class="external text" href="https://gerrit.wikimedia.org/g/schemas/event/primary">Primary event schema repo</a></li>
<li><a class="external text" href="https://gerrit.wikimedia.org/g/schemas/event/secondary">Secondary event schema repo</a></li></ul>
<hr/>
</div><div class="tpl-navsidebar-content">
<p class="tpl-navsidebar-heading">Event Platform Usages</p><p class="mw-empty-elt">
</p><ul><li><a href="/wiki/Wikidata_Query_Service/Streaming_Updater" title="Wikidata Query Service/Streaming Updater">Wikidata Query Service Updater</a></li>
<li><a href="/wiki/Kafka_Job_Queue" title="Kafka Job Queue">MediaWiki (Kafka) Job Queue</a></li>
<li><a href="/wiki/Changeprop" title="Changeprop">ChangeProp</a></li>
<li><a href="/wiki/Data_Engineering/Systems/Hadoop_Event_Ingestion_Lifecycle" title="Data Engineering/Systems/Hadoop Event Ingestion Lifecycle">Hadoop &amp; Hive Event Ingestion Lifecycle</a></li>
<li><a href="/wiki/Analytics/Systems/Event_Sanitization" class="mw-redirect" title="Analytics/Systems/Event Sanitization">Event data sanitization in Hadoop</a></li>
<li><a href="/wiki/MediaWiki_Event_Enrichment" title="MediaWiki Event Enrichment">MediaWiki Event Enrichment</a></li>
<li><a href="https://meta.wikimedia.org/wiki/Wikimedia_Enterprise" class="extiw" title="metawiki:Wikimedia Enterprise">Wikimedia Enterprise</a> (<a href="https://www.mediawiki.org/wiki/Wikimedia_Enterprise#Design_Documents" class="extiw" title="mw:Wikimedia Enterprise">via</a> <a href="/wiki/Event_Platform/EventStreams" title="Event Platform/EventStreams">EventStreams</a>)</li></ul>
</div><div class="tpl-navsidebar-content">
<p class="tpl-navsidebar-heading">See also</p><p class="mw-empty-elt">
</p><ul><li><a href="https://www.mediawiki.org/wiki/Extension:EventBus" class="extiw" title="mw:Extension:EventBus">EventBus extension (mediawiki.org)</a></li>
<li><a href="https://www.mediawiki.org/wiki/Extension:EventLogging" class="extiw" title="mw:Extension:EventLogging">EventLogging extension (mediawiki.org)</a></li>
<li><a href="https://phabricator.wikimedia.org/tag/event-platform/" class="extiw" title="phab:tag/event-platform/">Issue tracker (Phabricator)</a></li>
<li><a href="https://phabricator.wikimedia.org/T185233" class="extiw" title="phab:T185233">Event Platform epic task (Phabricator)</a></li></ul>
</div></div><p class="tpl-navsidebar-foot">[<span class="noprint plainlinks"><a class="external text" href="https://wikitech.wikimedia.org/w/index.php?title=Template:Navigation_Event_Platform&amp;action=edit"><span title="Edit this template">edit</span></a></span>]</p></div>
<figure typeof="mw:File/Thumb"><a href="https://codepen.io/ottomata/pen/LYpPpxj?editors=1010" rel="nofollow"><img resource="/wiki/File:EventStreams_Example.png" src="//upload.wikimedia.org/wikipedia/labs/thumb/a/ad/EventStreams_Example.png/500px-EventStreams_Example.png" decoding="async" width="500" height="239" class="mw-file-element" srcset="//upload.wikimedia.org/wikipedia/labs/thumb/a/ad/EventStreams_Example.png/750px-EventStreams_Example.png 1.5x, //upload.wikimedia.org/wikipedia/labs/thumb/a/ad/EventStreams_Example.png/1000px-EventStreams_Example.png 2x" data-file-width="3692" data-file-height="1768"/></a><figcaption>Example client at <a rel="nofollow" class="external text" href="https://codepen.io/ottomata/pen/LYpPpxj?editors=1010">codepen.io/ottomata/pen/LYpPpxj</a>.</figcaption></figure>
<figure typeof="mw:File/Thumb"><a href="https://codepen.io/Krinkle/pen/BwEKgW?editors=1010" rel="nofollow"><img resource="/wiki/File:EventStreams_Example2.jpg" src="//upload.wikimedia.org/wikipedia/labs/thumb/f/f4/EventStreams_Example2.jpg/500px-EventStreams_Example2.jpg" decoding="async" width="500" height="297" class="mw-file-element" srcset="//upload.wikimedia.org/wikipedia/labs/thumb/f/f4/EventStreams_Example2.jpg/750px-EventStreams_Example2.jpg 1.5x, //upload.wikimedia.org/wikipedia/labs/thumb/f/f4/EventStreams_Example2.jpg/1000px-EventStreams_Example2.jpg 2x" data-file-width="1163" data-file-height="691"/></a><figcaption>RecentChange stats tool, built with EventStreams – at <a rel="nofollow" class="external text" href="https://codepen.io/Krinkle/pen/BwEKgW?editors=1010">https://codepen.io/Krinkle/pen/BwEKgW</a>.</figcaption></figure>
<p><b>EventStreams</b> is a web service that exposes continuous streams of structured event data.  It does so over HTTP using <a class="external text" href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding">chunked transfer encoding</a> following the <a href="https://en.wikipedia.org/wiki/Server-sent_events" class="extiw" title="en:Server-sent events">Server-Sent Events</a> protocol (SSE). EventStreams can be consumed directly via HTTP, but is more commonly used via a client library.  
</p><p>The service supersedes <a href="/wiki/Obsolete:RCStream" title="Obsolete:RCStream">RCStream</a>, and might in the future replace <a href="/wiki/Irc.wikimedia.org" title="Irc.wikimedia.org">irc.wikimedia.org</a>.  EventStreams is internally backed by <a rel="nofollow" class="external text" href="https://kafka.apache.org/">Apache Kafka</a>.
</p><p><i>Note: <code>SSE</code> and <code>EventSource</code> are often used interchangeably as the names of this web technology.  This document refers to SSE as the server-side protocol, and EventSource as the client-side interface.</i>
</p>
<meta property="mw:PageProp/toc"/>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Streams"><span class="mw-headline" id="Streams"><span data-mw-comment-start="" id="h-Streams"></span>Streams<span data-mw-comment-end="h-Streams"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Streams","replies":[]}}--></div>
<p>EventStreams provides access to several different data streams, most notably the <code>recentchange</code> stream which emits <a href="https://www.mediawiki.org/wiki/Manual:RCFeed" class="extiw" title="mw:Manual:RCFeed">MediaWiki Recent changes</a> events.
</p><p>For a complete list of available streams, refer to the documentation at <a class="external free" href="https://stream.wikimedia.org/?doc#/streams">https://stream.wikimedia.org/?doc#/streams</a>.
</p><p>The data format of each stream follows a schema. The schemas can be obtained via <a class="external free" href="https://schema.wikimedia.org/#!/primary/jsonschema">https://schema.wikimedia.org/#!/primary/jsonschema</a>, for example <a class="external text" href="https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/recentchange/latest.yaml">jsonschema/mediawiki/recentchange/latest.yaml</a>.
</p><p>For the <code>recentchange</code> stream there is additional documentation at <a href="https://www.mediawiki.org/wiki/Manual:RCFeed" class="extiw" title="mw:Manual:RCFeed">Manual:RCFeed on mediawiki.org</a>.
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-When_not_to_use_EventStreams"><span class="mw-headline" id="When_not_to_use_EventStreams"><span data-mw-comment-start="" id="h-When_not_to_use_EventStreams"></span>When not to use EventStreams<span data-mw-comment-end="h-When_not_to_use_EventStreams"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-When_not_to_use_EventStreams","replies":[]}}--></div>
<p>The public EventStreams service is intended for use by small scale external tool developers.  It should not be used to build production services within Wikimedia Foundation.  WMF production services that react to events should directly consume the underlying Kafka topic(s).
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Examples"><span class="mw-headline" id="Examples"><span data-mw-comment-start="" id="h-Examples"></span>Examples<span data-mw-comment-end="h-Examples"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Examples","replies":["h-Web_browser-Examples","h-JavaScript-Examples","h-TypeScript-Examples","h-Python-Examples","h-Command-line-Examples"]}}--></div>
<h3 data-mw-thread-id="h-Web_browser-Examples"><span class="mw-headline" id="Web_browser"><span data-mw-comment-start="" id="h-Web_browser-Examples"></span>Web browser<span data-mw-comment-end="h-Web_browser-Examples"></span></span></h3><p>
Use the built-in <a rel="nofollow" class="external text" href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource">EventSource API</a> in modern browsers:</p><div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr" dir="ltr"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'https://stream.wikimedia.org/v2/stream/recentchange'</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">'Opened connection.'</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Encountered error'</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// event.data will be a JSON message</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// discard all canary events</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">meta</span><span class="p">.</span><span class="nx">domain</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'canary'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Edits from English Wikipedia</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">server_name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'en.wikipedia.org'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Output the title of the edited page</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
<h3 data-mw-thread-id="h-JavaScript-Examples"><span class="mw-headline" id="JavaScript"><span data-mw-comment-start="" id="h-JavaScript-Examples"></span>JavaScript<span data-mw-comment-end="h-JavaScript-Examples"></span></span></h3>
<h4 data-mw-thread-id="h-Node.js_ESM_(with_wikimedia-streams)-JavaScript"><span id="Node.js_ESM_.28with_wikimedia-streams.29"></span><span class="mw-headline" id="Node.js_ESM_(with_wikimedia-streams)"><span data-mw-comment-start="" id="h-Node.js_ESM_(with_wikimedia-streams)-JavaScript"></span>Node.js ESM (with <a rel="nofollow" class="external text" href="https://www.npmjs.com/package/wikimedia-streams">wikimedia-streams</a>)<span data-mw-comment-end="h-Node.js_ESM_(with_wikimedia-streams)-JavaScript"></span></span></h4>
<div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr" dir="ltr"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nx">WikimediaStream</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'wikimedia-streams'</span><span class="p">;</span>

<span class="c1">// 'recentchange' can be replaced with another stream topic</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WikimediaStream</span><span class="p">(</span><span class="s1">'recentchange'</span><span class="p">);</span>

<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">'Opened connection.'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Encountered error'</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">stream</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">"mediawiki.recentchange"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">all</span><span class="p">({</span><span class="w"> </span><span class="nx">wiki</span><span class="o">:</span><span class="w"> </span><span class="s2">"enwiki"</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// Edits from English Wikipedia</span>
<span class="w">    </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'recentchange'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Output page title</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
<h4 data-mw-thread-id="h-Node.js_(with_eventsource)-JavaScript"><span id="Node.js_.28with_eventsource.29"></span><span class="mw-headline" id="Node.js_(with_eventsource)"><span data-mw-comment-start="" id="h-Node.js_(with_eventsource)-JavaScript"></span>Node.js (with <a rel="nofollow" class="external text" href="https://github.com/aslakhellesoy/eventsource">eventsource</a>)<span data-mw-comment-end="h-Node.js_(with_eventsource)-JavaScript"></span></span></h4>
<div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr" dir="ltr"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">EventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">'eventsource'</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'https://stream.wikimedia.org/v2/stream/recentchange'</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">'Opened connection.'</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Encountered error'</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// discard canary events</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">meta</span><span class="p">.</span><span class="nx">domain</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'canary'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">server_name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'en.wikipedia.org'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Output the page title</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
<p>Server side filtering is not supported. You can filter client-side instead, for example to listen for changes to a specific wiki only:
</p>
<div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr" dir="ltr"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">wiki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'commonswiki'</span><span class="p">;</span>
<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// event.data will be a JSON string containing the message event.</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// discard canary events</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">meta</span><span class="p">.</span><span class="nx">domain</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'canary'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">change</span><span class="p">.</span><span class="nx">wiki</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">wiki</span><span class="p">)</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Got commons wiki change on page </span><span class="si">${</span><span class="nx">change</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<h3 data-mw-thread-id="h-TypeScript-Examples"><span class="mw-headline" id="TypeScript"><span data-mw-comment-start="" id="h-TypeScript-Examples"></span>TypeScript<span data-mw-comment-end="h-TypeScript-Examples"></span></span></h3>
<h4 data-mw-thread-id="h-Node.js_(with_wikimedia-streams)-TypeScript"><span id="Node.js_.28with_wikimedia-streams.29"></span><span class="mw-headline" id="Node.js_(with_wikimedia-streams)"><span data-mw-comment-start="" id="h-Node.js_(with_wikimedia-streams)-TypeScript"></span>Node.js (with <a rel="nofollow" class="external text" href="https://www.npmjs.com/package/wikimedia-streams">wikimedia-streams</a>)<span data-mw-comment-end="h-Node.js_(with_wikimedia-streams)-TypeScript"></span></span></h4>
<div class="mw-highlight mw-highlight-lang-typescript mw-content-ltr" dir="ltr"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nx">WikimediaStream</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"wikimedia-streams"</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">MediaWikiRecentChangeEvent</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'wikimedia-streams/build/streams/MediaWikiRecentChangeEvent'</span><span class="p">;</span>

<span class="c1">// "recentchange" can be replaced with any valid stream</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WikimediaStream</span><span class="p">(</span><span class="s2">"recentchange"</span><span class="p">);</span>

<span class="nx">stream</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">"mediawiki.recentchange"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">all</span><span class="p">({</span><span class="w"> </span><span class="nx">wiki</span><span class="o">:</span><span class="w"> </span><span class="s2">"enwiki"</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// Edits from English Wikipedia</span>
<span class="w">    </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'recentchange'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="cm">/* MediaWikiRecentChangeEvent &amp; { wiki: 'enwiki' } */</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=></span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Output page title</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
<h3 data-mw-thread-id="h-Python-Examples"><span class="mw-headline" id="Python"><span data-mw-comment-start="" id="h-Python-Examples"></span>Python<span data-mw-comment-end="h-Python-Examples"></span></span></h3>
<p>Using <a rel="nofollow" class="external text" href="https://pypi.python.org/pypi/sseclient/">python-sseclient</a>. There is also a more asynchronous-friendly version called <a rel="nofollow" class="external text" href="https://github.com/ebraminio/aiosseclient">aiosseclient</a> (requires Python 3.6+).
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">sseclient</span> <span class="kn">import</span> <span class="n">SSEClient</span> <span class="k">as</span> <span class="n">EventSource</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">'https://stream.wikimedia.org/v2/stream/recentchange'</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">EventSource</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s1">'message'</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># discard canary events</span>
            <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">'meta'</span><span class="p">][</span><span class="s1">'domain'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'canary'</span><span class="p">:</span>
                <span class="k">continue</span>            
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{user}</span><span class="s1"> edited </span><span class="si">{title}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">change</span><span class="p">))</span>
</pre></div><p>
The standard SSE protocol defines ways to continue where you left after a failure or other disconnect. We support this in EventStreams as well. For example:</p><div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">sseclient</span> <span class="kn">import</span> <span class="n">SSEClient</span> <span class="k">as</span> <span class="n">EventSource</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">'https://stream.wikimedia.org/v2/stream/recentchange'</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">EventSource</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">last_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s1">'message'</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># discard canary events</span>
            <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">'meta'</span><span class="p">][</span><span class="s1">'domain'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'canary'</span><span class="p">:</span>
                <span class="k">continue</span>            
            <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="s1">'Yourname'</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="c1"># - Run this Python script.</span>
<span class="c1"># - Publish an edit to [[Sandbox]] on test.wikipedia.org, and observe it getting printed.</span>
<span class="c1"># - Quit the Python process.</span>
<span class="c1"># - Change last_id=None to last_id='[{"topic":"…"},{…}]', as taken from the last printed line.</span>
<span class="c1"># - Publish another edit, while the Python process remains off.</span>
<span class="c1"># - Run this Python script again, and notice it finding and printing the missed edit.</span>
</pre></div>
<p>Server-side filtering is not supported. To filter for something like a wiki domain, you'll need to do this on the consumer side side. For example:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">wiki</span> <span class="o">=</span> <span class="s1">'commonswiki'</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">EventSource</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event</span> <span class="o">==</span> <span class="s1">'message'</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># discard canary events</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">'meta'</span><span class="p">][</span><span class="s1">'domain'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'canary'</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">'wiki'</span><span class="p">]</span> <span class="o">==</span> <span class="n">wiki</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{user}</span><span class="s1"> edited </span><span class="si">{title}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">change</span><span class="p">))</span>
</pre></div>
<p><a href="https://www.mediawiki.org/wiki/Manual:Pywikibot" class="extiw" title="mw:Manual:Pywikibot">Pywikibot</a> is another way to consume EventStreams in Python. It provides an abstraction that takes care of automatic reconnection, easy filtering, and combination of multiple topics into one stream. For example:</p><div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">>>></span> <span class="kn">from</span> <span class="nn">pywikibot.comms.eventstreams</span> <span class="kn">import</span> <span class="n">EventStreams</span>
<span class="o">>>></span> <span class="n">stream</span> <span class="o">=</span> <span class="n">EventStreams</span><span class="p">(</span><span class="n">streams</span><span class="o">=</span><span class="p">[</span><span class="s1">'recentchange'</span><span class="p">,</span> <span class="s1">'revision-create'</span><span class="p">],</span>
		          <span class="n">since</span><span class="o">=</span><span class="s1">'20190111'</span><span class="p">)</span>
<span class="o">>>></span> <span class="n">stream</span><span class="o">.</span><span class="n">register_filter</span><span class="p">(</span><span class="n">server_name</span><span class="o">=</span><span class="s1">'fr.wikipedia.org'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'edit'</span><span class="p">)</span>
<span class="o">>>></span> <span class="n">change</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">stream</span><span class="p">))</span>
<span class="o">>>></span> <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{type}</span><span class="s1"> on page "</span><span class="si">{title}</span><span class="s1">" by "</span><span class="si">{user}</span><span class="s1">" at </span><span class="si">{meta[dt]}</span><span class="s1">.'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">change</span><span class="p">))</span>
<span class="n">edit</span> <span class="n">on</span> <span class="n">page</span> <span class="s2">"Véronique Le Guen"</span> <span class="n">by</span> <span class="s2">"Speculos"</span> <span class="n">at</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span><span class="n">T21</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">43</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>
</pre></div>
<h3 data-mw-thread-id="h-Command-line-Examples"><span class="mw-headline" id="Command-line"><span data-mw-comment-start="" id="h-Command-line-Examples"></span>Command-line<span data-mw-comment-end="h-Command-line-Examples"></span></span></h3>
<p>With <a rel="nofollow" class="external text" href="https://linux.die.net/man/1/curl">curl</a> and <a rel="nofollow" class="external text" href="https://stedolan.github.io/jq/manual/">jq</a>
Set the <tt>Accept</tt> header and prettify the events with jq.
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>curl<span class="w"> </span>-s<span class="w"> </span>-H<span class="w"> </span><span class="s1">'Accept: application/json'</span><span class="w">  </span>https://stream.wikimedia.org/v2/stream/recentchange<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</pre></div>
<p>Setting the <tt>Accept: application/json</tt> will cause EventStreams to send you newline delimited JSON objects, rather than data in the SSE format.
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-API"><span class="mw-headline" id="API"><span data-mw-comment-start="" id="h-API"></span>API<span data-mw-comment-end="h-API"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-API","replies":["h-Stream_selection-API","h-Historical_Consumption-API","h-Response_Format-API","h-Canary_Events-API","h-Filtering-API"]}}--></div>
<p>The list of streams that are available will change over time, so they will not be documented here.  To see the active list of available streams, visit the <a class="external text" href="https://stream.wikimedia.org/?doc">swagger-ui documentation</a>, or request the swagger spec directly from <a class="external free" href="https://stream.wikimedia.org/?spec">https://stream.wikimedia.org/?spec</a>.  The available stream URI paths all begin with <code>/v2/stream</code>, e.g.
</p>
<div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr" dir="ltr"><pre><span></span><span class="s2">"/v2/stream/recentchange"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">"get"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">"produces"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">"text/event-stream; charset=utf-8"</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="s2">"description"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Mediawiki RecentChanges feed. Schema: https://schema.wikimedia.org/#!//primary/jsonschema/mediawiki/recentchange"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="s2">"/v2/stream/revision-create"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">"get"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">"produces"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"text/event-stream; charset=utf-8"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="s2">"description"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Mediawiki Revision Create feed. Schema: https://schema.wikimedia.org/#!//primary/jsonschema/mediawiki/revision/create"</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
<h3 data-mw-thread-id="h-Stream_selection-API"><span class="mw-headline" id="Stream_selection"><span data-mw-comment-start="" id="h-Stream_selection-API"></span>Stream selection<span data-mw-comment-end="h-Stream_selection-API"></span></span></h3>
<p>Streams are addressable either individually, e.g. <code>/v2/stream/revision-create</code>, or as a comma separated list of streams to compose, e.g. <code>/v2/stream/page-create,page-delete,page-undelete</code>.
</p><p>See available streams: <a class="external free" href="https://stream.wikimedia.org/?doc">https://stream.wikimedia.org/?doc</a>
</p>
<h3 data-mw-thread-id="h-Historical_Consumption-API"><span class="mw-headline" id="Historical_Consumption"><span data-mw-comment-start="" id="h-Historical_Consumption-API"></span>Historical Consumption<span data-mw-comment-end="h-Historical_Consumption-API"></span></span></h3>
<p>Since 2018-06, EventStreams supports timestamp based historical consumption.  This can be provided as individual assignment objects in the <code>Last-Event-ID</code> by setting a timestamp field instead of an offset field.  Or, more simply, a <code>since</code> query parameter can be provided in the stream URL, e.g. <code>since=2018-06-14T00:00:00Z</code>.  <code>since</code> can either be given as anything parseable by Javascript <code>Date.parse()</code>, e.g. a UTC <a class="external text" href="https://en.m.wikipedia.org/wiki/ISO_8601">ISO-8601</a> datetime string.
</p><p>When given a timestamp, EventStreams will ask Kafka for the message offset in the stream(s) that most closely match the timestamp. Kafka guarantees that all events after the returned message offset will be after the given timestamp.  NOTE: The stream history is not kept indefinitely. Depending on the stream configuration, there will likely be between 7 and 31 days of history available.  Please be kind when providing timestamps. There may be a lot of historical data available, and reading it and sending it all out can be compute resource intensive.  Please only consume the minimum of data you need.
</p><p>Example URL: <a class="external free" href="https://stream.wikimedia.org/v2/stream/revision-create?since=2016-06-14T00:00:00Z">https://stream.wikimedia.org/v2/stream/revision-create?since=2016-06-14T00:00:00Z</a>.
</p><p>If you want to manually set which topics, partitions, and timestamps or offsets your client starts consuming from, you can set the Last-Event-ID HTTP request header to an array of objects that specify this.  E.g.
</p><p><code lang="json">
[{"topic": "eqiad.mediawiki.recentchange", "partition": 0, "offset": 1234567}, {"topic": "codfw.mediawiki.recentchange", "partition": 0, "timestamp": 1575906290000}]
</code>
</p>
<h3 data-mw-thread-id="h-Response_Format-API"><span class="mw-headline" id="Response_Format"><span data-mw-comment-start="" id="h-Response_Format-API"></span>Response Format<span data-mw-comment-end="h-Response_Format-API"></span></span></h3>
<p>All examples here will consume recent changes from <a class="external free" href="https://stream.wikimedia.org/v2/stream/recentchange">https://stream.wikimedia.org/v2/stream/recentchange</a>.  This section describes the format of a response body from a EventStreams stream endpoint.
</p><p>Requesting <code>/v2/stream/recentchange</code> will start a stream of data in the SSE format.  This format is best interpreted using an EventSource client.  If you choose not to use one of these, the raw stream is still human readable and looks as follows:
</p>
<div class="mw-highlight mw-highlight-lang-json mw-content-ltr" dir="ltr"><pre><span></span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="err">message</span>
<span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"topic"</span><span class="p">:</span><span class="s2">"eqiad.mediawiki.recentchange"</span><span class="p">,</span><span class="nt">"partition"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">"timestamp"</span><span class="p">:</span><span class="mi">1532031066001</span><span class="p">},{</span><span class="nt">"topic"</span><span class="p">:</span><span class="s2">"codfw.mediawiki.recentchange"</span><span class="p">,</span><span class="nt">"partition"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">"offset"</span><span class="p">:</span><span class="mi">-1</span><span class="p">}]</span>
<span class="err">da</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="nt">"is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"here"</span><span class="p">}</span>
</pre></div>
<p>Each event will be separated by 2 line breaks (<code>\n\n</code>), and have <code>event</code>, <code>id</code>, and <code>data</code> fields.
</p><p>The <code>event</code> will be <code>message</code> for data events, and <code>error</code> for error events.  <code>id</code> is a JSON-formatted array of Kafka topic, partition and offset|timestamp metadata.  The <code>id</code> field can be used to tell EventStreams to start consuming from an earlier position in the stream.  This enables clients to automatically resume from where they left off if they are disconnected.  EventSource implementations handle this transparently.  Note that the topic partition and offset|timestamp for all topics and partitions that make up this stream are included in every message's <tt>id</tt> field.  This allows EventSource to be specific about where it left off even if the consumed stream is composed of multiple Kafka topic-partitions.
</p><p>Note that offsets and timestamps may be used interchangeably SSE <code>id</code>.  WMF runs stream.wikimedia.org in a multi-DC active/active setup, backed by multiple Kafka clusters.  Since Kafka offsets are unique per cluster, using them in a multi DC setup is not reliable.  Instead, <code>id</code> fields will always use timestamps instead of offsets.  This is not as precise as using offsets, but allows for a reliable multi DC service.
</p><p>You may request that EventStreams begins streaming to you from different offsets by setting an array of topic, partition, offset|timestamp objects in the <tt>Last-Event-ID</tt> HTTP header.
</p>
<h3 data-mw-thread-id="h-Canary_Events-API"><span class="mw-headline" id="Canary_Events"><span data-mw-comment-start="" id="h-Canary_Events-API"></span>Canary Events<span data-mw-comment-end="h-Canary_Events-API"></span></span></h3>
<p>WMF <a href="/wiki/Data_Engineering" title="Data Engineering">Data Engineering team</a> <a href="/wiki/Data_Engineering/Systems/Hadoop_Event_Ingestion_Lifecycle" title="Data Engineering/Systems/Hadoop Event Ingestion Lifecycle">produces artificial 'canary' events</a> into each stream multiple times an hour.  The presence of these canary events in a stream allow us to differentiate between a broken event stream, and an empty one.  If a stream has canary_events_enabled=true, then we should expect at least one event in a stream's Kafka topics every hour.  If we get no events in an hour, then we can trigger an alert that a stream is broken.
</p><p>These events are not filtered out in the streams available at <a href="/wiki/Stream.wikimedia.org" title="Stream.wikimedia.org">stream.wikimedia.org</a>.  As a user of these streams, you should discard all canary events; i.e. all events where <code>meta.domain === 'canary'</code>. 
</p>
<style data-mw-deduplicate="TemplateStyles:r2109784">.mw-parser-output .note{background-position:left 7px top 50%;padding:0.5em 0.5em 0.5em 40px;margin:0.5em 0;overflow:hidden;background-color:#f8f9fa;background-repeat:no-repeat;border:1px solid #ddd}.mw-parser-output .note-inline{display:inline-block;vertical-align:middle}.mw-parser-output .note-info{background-color:#eaf3ff;background-image:url("https://upload.wikimedia.org/wikipedia/commons/e/ec/OOjs_UI_icon_information-progressive.svg");background-size:25px;border-color:#a3caff;padding-left:40px;min-height:25px}.mw-parser-output .note-reminder{background-color:#fff9ea;background-image:url("https://upload.wikimedia.org/wikipedia/commons/a/a8/OOjs_UI_icon_lightbulb-yellow.svg");background-size:25px;border-color:#fc3;min-height:25px}.mw-parser-output .note-warn{background-color:#fff9ea;background-image:url("https://upload.wikimedia.org/wikipedia/commons/3/3b/OOjs_UI_icon_alert-warning.svg");background-size:25px;border-color:#fc3;min-height:25px}.mw-parser-output .note-error{background-color:#fee7e6;background-image:url("https://upload.wikimedia.org/wikipedia/commons/b/bf/OOjs_UI_icon_notice-destructive.svg");background-size:25px;border-color:#c33;min-height:25px}</style><div role="note" class="note note-warn"><b>If you are not using canary events for alerting, discard them! </b> Discard all events where <pre>meta.domain === 'canary'</pre></div><p>The content of most canary event fields are copied directly from the first example event in the event's schema.  E.g. <a rel="nofollow" class="external text" href="https://github.com/wikimedia/schemas-event-primary/blob/master/jsonschema/mediawiki/recentchange/1.0.1.yaml#L159">mediawiki/recentchange example</a>, <a rel="nofollow" class="external text" href="https://github.com/wikimedia/schemas-event-primary/blob/master/jsonschema/mediawiki/revision/create/2.0.0.yaml#L288">mediawiki/revision/create example</a>.  These examples can also be seen in the <a class="external text" href="https://stream.wikimedia.org/?doc#/streams">OpenAPI docs for the streams</a>, e.g. <a class="external text" href="https://stream.wikimedia.org/?doc#/streams/get_v2_stream_mediawiki_page_move">mediawiki.page-move example value</a>.  The code that creates canary events can be found <a href="https://gerrit.wikimedia.org/r/plugins/gitiles/wikimedia-event-utilities/%2B/refs/heads/master/eventutilities/src/main/java/org/wikimedia/eventutilities/monitoring/CanaryEventProducer.java#118" class="extiw" title="gerrit:plugins/gitiles/wikimedia-event-utilities/+/refs/heads/master/eventutilities/src/main/java/org/wikimedia/eventutilities/monitoring/CanaryEventProducer.java">here</a> (as of 2023-11).
</p><h3 data-mw-thread-id="h-Filtering-API"><span class="mw-headline" id="Filtering"><span data-mw-comment-start="" id="h-Filtering-API"></span>Filtering<span data-mw-comment-end="h-Filtering-API"></span></span></h3>
<p>EventStreams does not have <tt>$wgServerName</tt> (or any other) server side filtering capabilities. You'll need to do your filtering client side, e.g.
</p>
<div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr" dir="ltr"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Calls cb(event) for every event where recentchange event.server_name == server_name.</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">filterWiki</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">server_name</span><span class="p">,</span><span class="w"> </span><span class="nx">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">server_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">server_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">cb</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">eventSource</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Print only events that come from Wikimedia Commons.</span>
<span class="w">    </span><span class="nx">filterWiki</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="s1">'commons.wikimedia.org'</span><span class="p">,</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Architecture"><span class="mw-headline" id="Architecture"><span data-mw-comment-start="" id="h-Architecture"></span>Architecture<span data-mw-comment-end="h-Architecture"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Architecture","replies":["h-SSE_vs._WebSockets\/Socket.IO-Architecture","h-KafkaSSE-Architecture","h-Kafka-Architecture"]}}--></div>
<h3 data-mw-thread-id="h-SSE_vs._WebSockets/Socket.IO-Architecture"><span id="SSE_vs._WebSockets.2FSocket.IO"></span><span class="mw-headline" id="SSE_vs._WebSockets/Socket.IO"><span data-mw-comment-start="" id="h-SSE_vs._WebSockets/Socket.IO-Architecture"></span>SSE vs. WebSockets/Socket.IO<span data-mw-comment-end="h-SSE_vs._WebSockets/Socket.IO-Architecture"></span></span></h3>
<p>The previous "RCStream" service was written for consumption via Socket.IO, so why did we change the protocol for its replacement?  
</p><p>The WebSocket protocol doesn't use HTTP, which makes it different from most other services we run at Wikimedia Foundation. WebSockets are powerful and can e.g. let clients and servers communicate asynchronously with a bi-directional pipe. EventStreams, on the other hand, is read-only and only needs to send events from the server to a client. By using only 100% standard HTTP, EventStreams can be consumed from any HTTP client out there, without the need for programming several RPC-like initialization steps.
</p><p>We originally prototyped a Kafka -> Socket.io library (<a rel="nofollow" class="external text" href="https://github.com/wikimedia/kasocki">Kasocki</a>). After doing so we decided that HTTP-SSE was a better fit, and developed <a rel="nofollow" class="external text" href="https://github.com/wikimedia/kafkasse">KafkaSSE</a> instead.
</p>
<h3 data-mw-thread-id="h-KafkaSSE-Architecture"><span class="mw-headline" id="KafkaSSE"><span data-mw-comment-start="" id="h-KafkaSSE-Architecture"></span>KafkaSSE<span data-mw-comment-end="h-KafkaSSE-Architecture"></span></span></h3>
<p>KafkaSSE is a library that glues a Kafka Consumer to a connected HTTP SSE client.  A Kafka Consumer is assigned topics, partitions, and offsets, and then events are streamed from the consumer to the HTTP client in <a class="external text" href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding">chunked-transfer encoding</a>.  EventStreams maps stream routes (e.g <tt>/v2/stream/recentchanges</tt>) to specific topics in Kafka.
</p>
<h3 data-mw-thread-id="h-Kafka-Architecture"><span class="mw-headline" id="Kafka"><span data-mw-comment-start="" id="h-Kafka-Architecture"></span>Kafka<span data-mw-comment-end="h-Kafka-Architecture"></span></span></h3>
<p>WMF maintains several internal <a href="/wiki/Kafka" title="Kafka">Kafka</a> clusters, producing hundreds of thousands of messages per second.  It has proved to be highly scalable and feature-ful.  It is multi producer and multi consumer.  Our internal events are already produced through Kafka, so using it as the EventStreams backend was a natural choice.
</p><p>Kafka allows us to begin consuming from any message offset (that is still present on the backend Kafka cluster).  This feature is what allows connected EventStreams clients to auto-resume (via EventSource) when they disconnect.
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Notes"><span class="mw-headline" id="Notes"><span data-mw-comment-start="" id="h-Notes"></span>Notes<span data-mw-comment-end="h-Notes"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Notes","replies":["h-Server_side_enforced_timeout-Notes"]}}--></div>
<h3 data-mw-thread-id="h-Server_side_enforced_timeout-Notes"><span class="mw-headline" id="Server_side_enforced_timeout"><span data-mw-comment-start="" id="h-Server_side_enforced_timeout-Notes"></span>Server side enforced timeout<span data-mw-comment-end="h-Server_side_enforced_timeout-Notes"></span></span></h3>
<p>WMF's HTTP connection termination layer enforces a connection timeout of 15 minutes.  A good SSE / EventSource client should be able to automatically reconnect and begin consuming at the right location using the Last-Event-ID header.
</p><p>See <a class="external text" href="https://phabricator.wikimedia.org/T242767#6202636">this Phabricator discussion</a> for more info. 
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-See_also"><span class="mw-headline" id="See_also"><span data-mw-comment-start="" id="h-See_also"></span>See also<span data-mw-comment-end="h-See_also"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-See_also","replies":[]}}--></div>
<ul><li><a href="/wiki/EventStreams/Administration" class="mw-redirect" title="EventStreams/Administration">EventStreams/Administration</a>, for WMF administration.</li></ul>
<ul><li><a href="/wiki/EventStreams/Powered_By" class="mw-redirect" title="EventStreams/Powered By">EventStreams/Powered By</a>, for a list of example tools that are built on EventStreams.</li>
<li><a href="/wiki/Event*" title="Event*">Event*</a>, disambiguation for various event-related services at Wikimedia.</li>
<li><a href="/wiki/Obsolete:RCStream" title="Obsolete:RCStream">RCStream</a>, predecessor to EventStreams.</li>
<li><a href="https://www.mediawiki.org/wiki/Manual:RCFeed" class="extiw" title="mw:Manual:RCFeed">Manual:RCFeed</a> on mediawiki.org, about the underlying format of the recent changes messages.</li>
<li><a href="https://www.mediawiki.org/wiki/Manual:$wgRCFeeds" class="extiw" title="mw:Manual:$wgRCFeeds">Manual:$wgRCFeeds</a> on mediawiki.org, about setting up RCFeed (EventStreams uses the EventBusRCEngine from <a href="https://www.mediawiki.org/wiki/Extension:EventBus" class="extiw" title="mw:Extension:EventBus">EventBus</a>).</li>
<li><a href="https://www.mediawiki.org/wiki/API:Recent_changes_stream" class="extiw" title="mw:API:Recent changes stream">API:Recent changes stream</a> on mediawiki.org.</li></ul>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Further_reading"><span class="mw-headline" id="Further_reading"><span data-mw-comment-start="" id="h-Further_reading"></span>Further reading<span data-mw-comment-end="h-Further_reading"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Further_reading","replies":[]}}--></div>
<ul><li><a href="https://diff.wikimedia.org/2017/03/20/eventstreams/" class="extiw" title="wmfblog:2017/03/20/eventstreams/">"Get live updates to Wikimedia projects with EventStreams"</a>, by Andrew Otto (2017).</li>
<li><a href="https://diff.wikimedia.org/2018/08/08/eventstreams-updates/" class="extiw" title="wmfblog:2018/08/08/eventstreams-updates/">"EventStreams updates: New events, composite streams, historical subscription"</a>, by Andrew Otto (2018).</li></ul>
<ul><li><a rel="nofollow" class="external text" href="https://germano.dev/sse-websockets/">"Server-Sent Events: the alternative to WebSockets you should be using"</a>, by Germano Gabbianelli (2022).</li></ul>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-External_links"><span class="mw-headline" id="External_links"><span data-mw-comment-start="" id="h-External_links"></span>External links<span data-mw-comment-end="h-External_links"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-External_links","replies":[]}}--></div>
<ul><li><a href="https://gerrit.wikimedia.org/g/mediawiki/services/eventstreams" class="extiw" title="git:mediawiki/services/eventstreams">Source code of eventstreams service</a> (<a rel="nofollow" class="external text" href="https://github.com/wikimedia/mediawiki-services-eventstreams">GitHub mirror</a>)</li>
<li><a rel="nofollow" class="external text" href="https://github.com/wikimedia/KafkaSSE">Source code node-kafka-sse library</a></li>
<li><a href="https://phabricator.wikimedia.org/tag/wikimedia-stream" class="extiw" title="phab:tag/wikimedia-stream">Issue tracker (Phabricator workboard)</a></li></ul>
<!-- 
NewPP limit report
Parsed by cloudweb1003
Cached time: 20240425175325
Cache expiry: 2592000
Reduced expiry: false
Complications: [show‐toc]
DiscussionTools time usage: 0.033 seconds
CPU time usage: 0.098 seconds
Real time usage: 0.108 seconds
Preprocessor visited node count: 379/1000000
Post‐expand include size: 10893/2097152 bytes
Template argument size: 5432/2097152 bytes
Highest expansion depth: 8/100
Expensive parser function count: 13/500
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 36662/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   24.537      1 -total
 56.92%   13.966      1 Template:Navigation_Event_Platform
 50.92%   12.494      1 Template:Navigation_sidebar
 27.38%    6.719      1 Template:Note
  7.39%    1.814      1 Template:Prefix_search
-->

<!-- Saved in parser cache with key labswiki:pcache:idhash:327375-0!canonical and timestamp 20240425175325 and revision id 2172043. Rendering was triggered because: MovePage
 -->
</div>
<div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wikitech.wikimedia.org/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;oldid=2172043">https://wikitech.wikimedia.org/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;oldid=2172043</a>"</div></div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="/wiki/Category:Services" title="Category:Services">Services</a></li><li><a href="/wiki/Category:Event_Platform" title="Category:Event Platform">Event Platform</a></li></ul></div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" >
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last edited on 25 April 2024, at 17:53.</li>
	<li id="footer-info-copyright">Text is available under the <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">Creative Commons Attribution-ShareAlike License</a>;
additional terms may apply.
See <a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Terms_of_Use">Terms of Use</a> for details.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Privacy_policy">Privacy policy</a></li>
	<li id="footer-places-about"><a href="/wiki/Main_Page">About Wikitech</a></li>
	<li id="footer-places-disclaimers"><a href="https://foundation.wikimedia.org/wiki/General_disclaimer">Disclaimers</a></li>
	<li id="footer-places-wm-codeofconduct"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Code_of_Conduct">Code of Conduct</a></li>
	<li id="footer-places-developers"><a href="https://developer.wikimedia.org">Developers</a></li>
	<li id="footer-places-statslink"><a href="https://stats.wikimedia.org/#/wikitech.wikimedia.org">Statistics</a></li>
	<li id="footer-places-cookiestatement"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Cookie_statement">Cookie statement</a></li>
	<li id="footer-places-mobileview"><a href="//wikitech.wikimedia.org/w/index.php?title=Event_Platform/EventStreams_HTTP_Service&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://wikimediafoundation.org/"><img src="/static/images/footer/wikimedia-button.png" srcset="/static/images/footer/wikimedia-button-1.5x.png 1.5x, /static/images/footer/wikimedia-button-2x.png 2x" width="88" height="31" alt="Wikimedia Foundation" loading="lazy" /></a></li>
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="/static/images/footer/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/static/images/footer/poweredby_mediawiki_132x47.png 1.5x, /static/images/footer/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
<script>(RLQ=window.RLQ||[]).push(function(){mw.log.warn("This page is using the deprecated ResourceLoader module \"mediawiki.ui.input\".\n[1.41] Please use Codex. See migration guidelines: https://www.mediawiki.org/wiki/Codex/Migrating_from_MediaWiki_UI");mw.log.warn("This page is using the deprecated ResourceLoader module \"mediawiki.ui.checkbox\".\n[1.41] Please use Codex. See migration guidelines: https://www.mediawiki.org/wiki/Codex/Migrating_from_MediaWiki_UI");mw.log.warn("This page is using the deprecated ResourceLoader module \"mediawiki.ui.button\".\n[1.41] Please use Codex. See migration guidelines: https://www.mediawiki.org/wiki/Codex/Migrating_from_MediaWiki_UI");mw.config.set({"wgHostname":"cloudweb1003","wgBackendResponseTime":109,"wgDiscussionToolsPageThreads":[{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Streams","replies":[]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-When_not_to_use_EventStreams","replies":[]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Examples","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Web_browser-Examples","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-JavaScript-Examples","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Node.js_ESM_(with_wikimedia-streams)-JavaScript","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Node.js_(with_eventsource)-JavaScript","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-TypeScript-Examples","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Node.js_(with_wikimedia-streams)-TypeScript","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Python-Examples","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Command-line-Examples","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-API","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Stream_selection-API","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Historical_Consumption-API","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Response_Format-API","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Canary_Events-API","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Filtering-API","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Architecture","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-SSE_vs._WebSockets/Socket.IO-Architecture","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-KafkaSSE-Architecture","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Kafka-Architecture","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Notes","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Server_side_enforced_timeout-Notes","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-See_also","replies":[]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Further_reading","replies":[]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-External_links","replies":[]}],"wgPageParseReport":{"discussiontools":{"limitreport-timeusage":"0.033"},"limitreport":{"cputime":"0.098","walltime":"0.108","ppvisitednodes":{"value":379,"limit":1000000},"postexpandincludesize":{"value":10893,"limit":2097152},"templateargumentsize":{"value":5432,"limit":2097152},"expansiondepth":{"value":8,"limit":100},"expensivefunctioncount":{"value":13,"limit":500},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":36662,"limit":5000000},"timingprofile":["100.00%   24.537      1 -total"," 56.92%   13.966      1 Template:Navigation_Event_Platform"," 50.92%   12.494      1 Template:Navigation_sidebar"," 27.38%    6.719      1 Template:Note","  7.39%    1.814      1 Template:Prefix_search"]},"cachereport":{"origin":"cloudweb1003","timestamp":"20240425175325","ttl":2592000,"transientcontent":false}}});});</script>
</body>
</html> contentType 9 text/html url 52 https://wikitech.wikimedia.org:443/wiki/EventStreams responseCode 3 200 