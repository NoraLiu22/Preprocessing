eonqoofaoqaejokckgzegkzakifqdqzklgramqbq length 6 224730 page 224730 <!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>User:Rillke/SVGedit.js - Wikimedia Commons</title>




<meta name="ResourceLoaderDynamicStyles" content="">


<meta name="generator" content="MediaWiki 1.43.0-wmf.2">
<meta name="referrer" content="origin">
<meta name="referrer" content="origin-when-cross-origin">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1000">
<meta property="og:title" content="User:Rillke/SVGedit.js - Wikimedia Commons">
<meta property="og:type" content="website">











</head>
<body class="skin-vector-legacy mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-2 ns-subject page-User_Rillke_SVGedit_js rootpage-User_Rillke skin-vector action-view"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	<div id="siteNotice"><!-- CentralNotice --></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-namespace">User</span><span class="mw-page-title-separator">:</span><span class="mw-page-title-main">Rillke/SVGedit.js</span></h1>
	<div id="bodyContent" class="vector-body">
		<div id="siteSub" class="noprint">From Wikimedia Commons, the free media repository</div>
		<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="/wiki/User:Rillke" title="User:Rillke">User:Rillke</a></div></div></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" class="mw-body-content"><div id="mw-clearyourcache" lang="en" dir="ltr" class="mw-content-ltr">
<b>Note:</b> After saving, you have to <a href="https://en.wikipedia.org/wiki/Wikipedia:Bypass_your_cache" class="extiw" title="w:Wikipedia:Bypass your cache">bypass your browser's cache</a> to see the changes. <b>Internet Explorer:</b> press <i>Ctrl-F5</i>, <b>Mozilla:</b> hold down <i>Shift</i> while clicking <i>Reload</i> (or press <i>Ctrl-Shift-R</i>), <b>Opera/Konqueror:</b> press <i>F5</i>, <b>Safari:</b> hold down <i>Shift + Alt</i> while clicking <i>Reload</i>, <b>Chrome:</b> hold down <i>Shift</i> while clicking <i>Reload</i>.<table id="mw-script-doc" class="plainlinks fmbox fmbox-system" style="background: #ecfcf4;" lang="en" dir="ltr">
<tbody><tr>
<td class="mbox-image">
  <span typeof="mw:File"><a href="/wiki/File:Template-info.svg" class="mw-file-description"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Template-info.svg/43px-Template-info.svg.png" decoding="async" width="43" height="22" class="mw-file-element" srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Template-info.svg/65px-Template-info.svg.png 1.5x, https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Template-info.svg/86px-Template-info.svg.png 2x" data-file-width="117" data-file-height="60" /></a></span></td>
<td class="mbox-text" style=""> This <a href="/wiki/Special:MyLanguage/Commons:User_scripts" title="Special:MyLanguage/Commons:User scripts">user script</a> seems to have a documentation page at <a href="/wiki/User:Rillke/SVGedit" class="mw-redirect" title="User:Rillke/SVGedit">User:Rillke/SVGedit</a> and an accompanying <bdi>.css</bdi> page at <a href="/wiki/User:Rillke/SVGedit.css" title="User:Rillke/SVGedit.css">User:Rillke/SVGedit.css</a>. </td>
</tr>
</tbody></table>
</div><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><div class="mw-highlight mw-highlight-lang-javascript mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos" data-line="1"></span></a><span class="cm">/**</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos" data-line="2"></span></a><span class="cm">* Allow editing SVG file&#39;s source code without having to save them locally (aka &quot;download&quot;) them.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos" data-line="3"></span></a><span class="cm">* @docu https://commons.wikimedia.org/wiki/User_talk:Rillke/SVGedit.js</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos" data-line="4"></span></a><span class="cm">*</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos" data-line="5"></span></a><span class="cm">* @rev 1 (2014-03-22)</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos" data-line="6"></span></a><span class="cm">* @rev 2 (2015-05-29)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos" data-line="7"></span></a><span class="cm">* @author Rillke, 2014-2015</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos" data-line="8"></span></a><span class="cm">*/</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos" data-line="9"></span></a><span class="c1">// List the global variables for jsHint-Validation. Please make sure that it passes http://jshint.com/</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos" data-line="10"></span></a><span class="c1">// Scheme: globalVariable:allowOverwriting[, globalVariable:allowOverwriting][, globalVariable:allowOverwriting]</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos" data-line="11"></span></a><span class="cm">/* global jQuery:false, mediaWiki:false, MwJSBot:false, CodeMirror:false */</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos" data-line="12"></span></a><span class="c1">// Set jsHint-options. You should not set forin or undef to false if your script does not validate.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos" data-line="13"></span></a><span class="cm">/* jshint forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, strict:true,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos" data-line="14"></span></a><span class="cm"> undef:true, curly:false, browser:true, multistr:true */</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos" data-line="15"></span></a><span class="cm">/* eslint indent:[&quot;error&quot;,&quot;tab&quot;,{&quot;outerIIFEBody&quot;:0}] */</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos" data-line="16"></span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos" data-line="17"></span></a><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">$</span><span class="p">,</span><span class="w"> </span><span class="nx">mw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos" data-line="18"></span></a><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos" data-line="19"></span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos" data-line="20"></span></a><span class="kd">var</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos" data-line="21"></span></a><span class="w">	</span><span class="nx">i</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos" data-line="22"></span></a><span class="w">	</span><span class="nx">MYSELF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SVGEdit&#39;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos" data-line="23"></span></a><span class="w">	</span><span class="nx">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">([</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos" data-line="24"></span></a><span class="w">		</span><span class="s1">&#39;wgDBname&#39;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos" data-line="25"></span></a><span class="w">		</span><span class="s1">&#39;wgPageName&#39;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos" data-line="26"></span></a><span class="w">		</span><span class="s1">&#39;wgNamespaceNumber&#39;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos" data-line="27"></span></a><span class="w">		</span><span class="s1">&#39;wgRevisionId&#39;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos" data-line="28"></span></a><span class="w">		</span><span class="s1">&#39;wgTitle&#39;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos" data-line="29"></span></a><span class="w">	</span><span class="p">]),</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos" data-line="30"></span></a><span class="w">	</span><span class="nx">isCommonsWiki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgDBname</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;commonswiki&#39;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos" data-line="31"></span></a><span class="w">	</span><span class="nx">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mh">0x1000000000</span><span class="p">),</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos" data-line="32"></span></a><span class="w">	</span><span class="nx">commonwWikiKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;commonswiki&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">random</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos" data-line="33"></span></a><span class="w">	</span><span class="nx">commonsWiki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos" data-line="34"></span></a><span class="w">	</span><span class="nx">modules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos" data-line="35"></span></a><span class="w">		</span><span class="p">[</span><span class="s1">&#39;ext.gadget.jquery.blockUI&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ver1_svg&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">commonwWikiKey</span><span class="p">],</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos" data-line="36"></span></a><span class="w">		</span><span class="p">[</span><span class="s1">&#39;ext.gadget.libAPI&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ver1_svg&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;user.options&#39;</span><span class="p">],</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">commonwWikiKey</span><span class="p">],</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos" data-line="37"></span></a><span class="w">		</span><span class="p">[</span><span class="s1">&#39;ext.gadget.editDropdown&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ver1_svg&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;jquery.client&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user.options&#39;</span><span class="p">],</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">commonwWikiKey</span><span class="p">]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos" data-line="38"></span></a><span class="w">	</span><span class="p">];</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos" data-line="39"></span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos" data-line="40"></span></a><span class="nx">svgEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos" data-line="41"></span></a><span class="w">	</span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;0.0.15.2&#39;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos" data-line="42"></span></a><span class="w">	</span><span class="nx">init</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos" data-line="43"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">$activationLinks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">();</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos" data-line="44"></span></a><span class="w">		</span><span class="c1">// File namespace?</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos" data-line="45"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgNamespaceNumber</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">6</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="sr">/\.svg$/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgPageName</span><span class="p">))</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos" data-line="46"></span></a><span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Not a SVG-file. Aborting initialization.&#39;</span><span class="p">);</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos" data-line="47"></span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos" data-line="48"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAnon</span><span class="p">())</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos" data-line="49"></span></a><span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Anonymous users cannot upload files. Aborting initialization.&#39;</span><span class="p">);</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos" data-line="50"></span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos" data-line="51"></span></a><span class="w">		</span><span class="c1">// if (!conf.wgRevisionId || !$(&#39;.filehistory&#39;).find(&#39;td.filehistory-selected&#39;).length) return svgEdit.log(&#39;Page or file does not exist.&#39;);</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos" data-line="52"></span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos" data-line="53"></span></a><span class="w">		</span><span class="nx">$activationLinks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$activationLinks</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">commons</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">addEditLink</span><span class="p">(</span><span class="s1">&#39;#SVGedit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Edit SVG&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;e-edit-raw-SVG&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Edit SVG source code&#39;</span><span class="p">));</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos" data-line="54"></span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos" data-line="55"></span></a><span class="w">		</span><span class="nx">$activationLinks</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos" data-line="56"></span></a><span class="w">			</span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos" data-line="57"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos" data-line="58"></span></a><span class="w">			</span><span class="nx">$activationLinks</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;ui-state-disabled&#39;</span><span class="p">);</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos" data-line="59"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos" data-line="60"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getParamValue</span><span class="p">(</span><span class="s1">&#39;svgrawedit&#39;</span><span class="p">))</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos" data-line="61"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos" data-line="62"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos" data-line="63"></span></a><span class="w">	</span><span class="nx">registerModules</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos" data-line="64"></span></a><span class="w">		</span><span class="c1">// Register custom modules</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos" data-line="65"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">getState</span><span class="p">(</span><span class="s1">&#39;mediawiki.commons.MwJSBot&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos" data-line="66"></span></a><span class="w">			</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">implement</span><span class="p">(</span><span class="s1">&#39;mediawiki.commons.MwJSBot&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;//commons.wikimedia.org/w/index.php?action=raw&amp;ctype=text/javascript&amp;title=User:Rillke/MwJSBot.js&#39;</span><span class="p">],</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos" data-line="67"></span></a><span class="w">				</span><span class="p">{</span><span class="w"> </span><span class="cm">/* no styles*/</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* no messages*/</span><span class="w"> </span><span class="p">});</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos" data-line="68"></span></a><span class="w">		</span><span class="p">}</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos" data-line="69"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos" data-line="70"></span></a><span class="w">	</span><span class="nx">run</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos" data-line="71"></span></a><span class="w">		</span><span class="c1">// Create GUI</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos" data-line="72"></span></a><span class="w">		</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">registerModules</span><span class="p">();</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos" data-line="73"></span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos" data-line="74"></span></a><span class="w">		</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">using</span><span class="p">([</span><span class="s1">&#39;mediawiki.commons.MwJSBot&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user.options&#39;</span><span class="p">],</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos" data-line="75"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">gui</span><span class="p">();</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos" data-line="76"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos" data-line="77"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos" data-line="78"></span></a><span class="w">	</span><span class="nx">gui</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos" data-line="79"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">$gui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;form action=&quot;/&quot;&gt;&#39;</span><span class="p">),</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos" data-line="80"></span></a><span class="w">			</span><span class="nx">$preview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos" data-line="81"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$gui</span><span class="p">),</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos" data-line="82"></span></a><span class="w">			</span><span class="nx">$diffContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos" data-line="83"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="w"> </span><span class="nx">border</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1px solid grey&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos" data-line="84"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Diff: &#39;</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos" data-line="85"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos" data-line="86"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$gui</span><span class="p">),</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos" data-line="87"></span></a><span class="w">			</span><span class="nx">$validationWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos" data-line="88"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos" data-line="89"></span></a><span class="w">					</span><span class="s1">&#39;border&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1px solid grey&#39;</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos" data-line="90"></span></a><span class="w">					</span><span class="s1">&#39;min-height&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2em&#39;</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos" data-line="91"></span></a><span class="w">					</span><span class="s1">&#39;max-height&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;40em&#39;</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos" data-line="92"></span></a><span class="w">					</span><span class="s1">&#39;resize&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos" data-line="93"></span></a><span class="w">					</span><span class="s1">&#39;overflow&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos" data-line="94"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos" data-line="95"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos" data-line="96"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$gui</span><span class="p">),</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos" data-line="97"></span></a><span class="w">			</span><span class="nx">$validationDoctypeLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos" data-line="98"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos" data-line="99"></span></a><span class="w">					</span><span class="s1">&#39;float&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos" data-line="100"></span></a><span class="w">					</span><span class="s1">&#39;background&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#FFD&#39;</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos" data-line="101"></span></a><span class="w">					</span><span class="s1">&#39;padding&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;.3em&#39;</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos" data-line="102"></span></a><span class="w">					</span><span class="s1">&#39;font-family&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;monospace&#39;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos" data-line="103"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos" data-line="104"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;document type used for validation&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos" data-line="105"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$validationWrapper</span><span class="p">),</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos" data-line="106"></span></a><span class="w">			</span><span class="nx">$validationContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;ul&gt;&#39;</span><span class="p">)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos" data-line="107"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$validationWrapper</span><span class="p">),</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos" data-line="108"></span></a><span class="w">			</span><span class="nx">$validationContainer2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;ul&gt;&#39;</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos" data-line="109"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$validationWrapper</span><span class="p">),</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos" data-line="110"></span></a><span class="w">			</span><span class="nx">$diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos" data-line="111"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="w"> </span><span class="nx">font</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;12px &quot;Monaco&quot;,&quot;Menlo&quot;,&quot;Ubuntu Mono&quot;,&quot;Consolas&quot;,&quot;source-code-pro&quot;,monospace&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos" data-line="112"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$diffContainer</span><span class="p">),</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos" data-line="113"></span></a><span class="w">			</span><span class="nx">$imgPreviewContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos" data-line="114"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos" data-line="115"></span></a><span class="w">					</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;relative&#39;</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos" data-line="116"></span></a><span class="w">					</span><span class="nx">overflow</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hidden&#39;</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos" data-line="117"></span></a><span class="w">					</span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;inline-block&#39;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos" data-line="118"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos" data-line="119"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;https://en.wikipedia.org/wiki/Librsvg&quot; target=&quot;_blank&quot;&gt;RSVG&lt;/a&gt; rendering:&lt;br&gt;&#39;</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos" data-line="120"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos" data-line="121"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$preview</span><span class="p">),</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos" data-line="122"></span></a><span class="w">			</span><span class="nx">$imgPreview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;img&gt;&#39;</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos" data-line="123"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;rsvg preview&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos" data-line="124"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="w"> </span><span class="s1">&#39;vertical-align&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;top&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos" data-line="125"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;com-svgedit-preview&#39;</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos" data-line="126"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$imgPreviewContainer</span><span class="p">),</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos" data-line="127"></span></a><span class="w">			</span><span class="nx">$imgPreview2Container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos" data-line="128"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos" data-line="129"></span></a><span class="w">					</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;relative&#39;</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos" data-line="130"></span></a><span class="w">					</span><span class="nx">overflow</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hidden&#39;</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos" data-line="131"></span></a><span class="w">					</span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;inline-block&#39;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos" data-line="132"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos" data-line="133"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;Browser rendering (iframe):&lt;br&gt;&#39;</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos" data-line="134"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos" data-line="135"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$preview</span><span class="p">),</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos" data-line="136"></span></a><span class="w">			</span><span class="nx">$imgPreview2Overlay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos" data-line="137"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;browser preview&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos" data-line="138"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos" data-line="139"></span></a><span class="w">					</span><span class="s1">&#39;position&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos" data-line="140"></span></a><span class="w">					</span><span class="s1">&#39;left&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos" data-line="141"></span></a><span class="w">					</span><span class="s1">&#39;top&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos" data-line="142"></span></a><span class="w">					</span><span class="s1">&#39;bottom&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos" data-line="143"></span></a><span class="w">					</span><span class="s1">&#39;right&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos" data-line="144"></span></a><span class="w">					</span><span class="s1">&#39;z-index&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos" data-line="145"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos" data-line="146"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$imgPreview2Container</span><span class="p">),</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos" data-line="147"></span></a><span class="w">			</span><span class="nx">$imgPreview2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;iframe&gt;&#39;</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos" data-line="148"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos" data-line="149"></span></a><span class="w">					</span><span class="nx">sandbox</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;sandbox&#39;</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos" data-line="150"></span></a><span class="w">					</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;browser preview&#39;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos" data-line="151"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos" data-line="152"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos" data-line="153"></span></a><span class="w">					</span><span class="s1">&#39;border&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1px solid #EEE&#39;</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos" data-line="154"></span></a><span class="w">					</span><span class="s1">&#39;width&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos" data-line="155"></span></a><span class="w">					</span><span class="s1">&#39;height&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos" data-line="156"></span></a><span class="w">					</span><span class="s1">&#39;resizable&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos" data-line="157"></span></a><span class="w">					</span><span class="s1">&#39;vertical-align&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;top&#39;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos" data-line="158"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos" data-line="159"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;com-svgedit-preview&#39;</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos" data-line="160"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$imgPreview2Container</span><span class="p">),</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos" data-line="161"></span></a><span class="w">			</span><span class="nx">$taWrap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos" data-line="162"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$gui</span><span class="p">),</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos" data-line="163"></span></a><span class="w">			</span><span class="nx">$ta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;textarea&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos" data-line="164"></span></a><span class="w">				</span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;rows&#39;</span><span class="p">),</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos" data-line="165"></span></a><span class="w">				</span><span class="nx">cols</span><span class="o">:</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;cols&#39;</span><span class="p">),</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos" data-line="166"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos" data-line="167"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">css</span><span class="p">({</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;99%&#39;</span><span class="w"> </span><span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$taWrap</span><span class="p">),</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos" data-line="168"></span></a><span class="w">			</span><span class="nx">$sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; style=&quot;width:99%&quot; maxlength=&quot;200&quot; pattern=&quot;.{3,}&quot; required placeholder=&quot;upload summary (changes, techniques, 3-200 characters)&quot; title=&quot;3-200 letters, please&quot;&gt;&#39;</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos" data-line="169"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$gui</span><span class="p">),</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos" data-line="170"></span></a><span class="w">			</span><span class="nx">$buttonPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos" data-line="171"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;com-svg-edit-buttonpane&#39;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos" data-line="172"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$gui</span><span class="p">),</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos" data-line="173"></span></a><span class="w">			</span><span class="nx">$saveBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos" data-line="174"></span></a><span class="w">				</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;submit&#39;</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos" data-line="175"></span></a><span class="w">				</span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;submit&#39;</span><span class="p">,</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos" data-line="176"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos" data-line="177"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Save SVG&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos" data-line="178"></span></a><span class="w">			</span><span class="nx">$loadCodeEditorBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos" data-line="179"></span></a><span class="w">				</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos" data-line="180"></span></a><span class="w">				</span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos" data-line="181"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos" data-line="182"></span></a><span class="w">				</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Loads a code editor (XML mode)&#39;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos" data-line="183"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Load CodeMirror&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos" data-line="184"></span></a><span class="w">			</span><span class="nx">$previewBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos" data-line="185"></span></a><span class="w">				</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos" data-line="186"></span></a><span class="w">				</span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos" data-line="187"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos" data-line="188"></span></a><span class="w">				</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Render a preview&#39;</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos" data-line="189"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Preview&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos" data-line="190"></span></a><span class="w">			</span><span class="nx">$diffBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos" data-line="191"></span></a><span class="w">				</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos" data-line="192"></span></a><span class="w">				</span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos" data-line="193"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos" data-line="194"></span></a><span class="w">				</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Show difference between saved and working copy&#39;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos" data-line="195"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Diff&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos" data-line="196"></span></a><span class="w">			</span><span class="nx">$validationDoctype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;select&gt;&#39;</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos" data-line="197"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos" data-line="198"></span></a><span class="s1">&#39;&lt;option value=&quot;Inline&quot; selected=&quot;&quot;&gt;(detect automatically)&lt;/option&gt;\</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos" data-line="199"></span></a><span class="s1">&lt;option value=&quot;SVG 1.0&quot;&gt;SVG 1.0&lt;/option&gt;\</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos" data-line="200"></span></a><span class="s1">&lt;option value=&quot;SVG 1.1&quot;&gt;SVG 1.1&lt;/option&gt;\</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos" data-line="201"></span></a><span class="s1">&lt;option value=&quot;SVG 1.1 Tiny&quot;&gt;SVG 1.1 Tiny&lt;/option&gt;\</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos" data-line="202"></span></a><span class="s1">&lt;option value=&quot;SVG 1.1 Basic&quot;&gt;SVG 1.1 Basic&lt;/option&gt;&#39;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos" data-line="203"></span></a><span class="w">				</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos" data-line="204"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos" data-line="205"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos" data-line="206"></span></a><span class="w">			</span><span class="nx">$validateButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;button&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos" data-line="207"></span></a><span class="w">				</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos" data-line="208"></span></a><span class="w">				</span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos" data-line="209"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos" data-line="210"></span></a><span class="w">				</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Check for glitches against validators&#39;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos" data-line="211"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Validate&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos" data-line="212"></span></a><span class="w">			</span><span class="nx">$uploadButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;file&quot;&gt;&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos" data-line="213"></span></a><span class="w">				</span><span class="nx">disabled</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos" data-line="214"></span></a><span class="w">				</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Replace editor contents with file contents&#39;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos" data-line="215"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">),</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos" data-line="216"></span></a><span class="w">			</span><span class="nx">allowCloseWindow</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos" data-line="217"></span></a><span class="w">			</span><span class="nx">timeout</span><span class="p">,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos" data-line="218"></span></a><span class="w">			</span><span class="nx">getCurrentValue</span><span class="p">,</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos" data-line="219"></span></a><span class="w">			</span><span class="nx">setCurrentValue</span><span class="p">,</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos" data-line="220"></span></a><span class="w">			</span><span class="nx">getOriginal</span><span class="p">,</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos" data-line="221"></span></a><span class="w">			</span><span class="nx">$fetchCB</span><span class="p">;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos" data-line="222"></span></a><span class="w">		</span><span class="nx">mw</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">addCSS</span><span class="p">(</span><span class="s1">&#39;.com-svgedit-preview:hover, .com-svgedit-preview-hover { \</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos" data-line="223"></span></a><span class="s1">			background: url(&quot;//upload.wikimedia.org/wikipedia/commons/5/5d/Checker-16x16.png&quot;) repeat scroll }&#39;</span><span class="p">);</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos" data-line="224"></span></a><span class="w">		</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos" data-line="225"></span></a><span class="w">			</span><span class="s1">&#39;float&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos" data-line="226"></span></a><span class="w">			</span><span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#DDD&#39;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos" data-line="227"></span></a><span class="w">		</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Version: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">version</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$buttonPane</span><span class="p">);</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos" data-line="228"></span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos" data-line="229"></span></a><span class="w">		</span><span class="nx">getCurrentValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos" data-line="230"></span></a><span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="w"> </span><span class="o">?</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos" data-line="231"></span></a><span class="w">				</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos" data-line="232"></span></a><span class="w">				</span><span class="nx">$ta</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos" data-line="233"></span></a><span class="w">		</span><span class="p">};</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos" data-line="234"></span></a><span class="w">		</span><span class="nx">setCurrentValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos" data-line="235"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos" data-line="236"></span></a><span class="w">				</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos" data-line="237"></span></a><span class="w">			</span><span class="k">else</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos" data-line="238"></span></a><span class="w">				</span><span class="nx">$ta</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos" data-line="239"></span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos" data-line="240"></span></a><span class="w">		</span><span class="p">};</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos" data-line="241"></span></a><span class="w">		</span><span class="nx">getOriginal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos" data-line="242"></span></a><span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nx">$ta</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;orignal-svg&#39;</span><span class="p">);</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos" data-line="243"></span></a><span class="w">		</span><span class="p">};</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos" data-line="244"></span></a><span class="w">		</span><span class="nx">$fetchCB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos" data-line="245"></span></a><span class="w">			</span><span class="nx">$ta</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos" data-line="246"></span></a><span class="w">			</span><span class="nx">$ta</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;orignal-svg&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">);</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos" data-line="247"></span></a><span class="w">			</span><span class="nx">$saveBtn</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos" data-line="248"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$ta</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos" data-line="249"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$loadCodeEditorBtn</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos" data-line="250"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$previewBtn</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos" data-line="251"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$diffBtn</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos" data-line="252"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$validateButton</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos" data-line="253"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$uploadButton</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos" data-line="254"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos" data-line="255"></span></a><span class="w">			</span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos" data-line="256"></span></a><span class="w">				</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">using</span><span class="p">(</span><span class="s1">&#39;mediawiki.confirmCloseWindow&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos" data-line="257"></span></a><span class="w">					</span><span class="nx">allowCloseWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">confirmCloseWindow</span><span class="p">({</span><span class="w"> </span><span class="nx">test</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos" data-line="258"></span></a><span class="w">						</span><span class="k">return</span><span class="w"> </span><span class="nx">getCurrentValue</span><span class="p">()</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">getOriginal</span><span class="p">();</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos" data-line="259"></span></a><span class="w">					</span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos" data-line="260"></span></a><span class="w">				</span><span class="p">});</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos" data-line="261"></span></a><span class="w">			</span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos" data-line="262"></span></a><span class="w">		</span><span class="p">};</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos" data-line="263"></span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos" data-line="264"></span></a><span class="w">		</span><span class="nx">$ta</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;Loading SVG&#39;</span><span class="p">);</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos" data-line="265"></span></a><span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="nx">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos" data-line="266"></span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos" data-line="267"></span></a><span class="w">		</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#file&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos" data-line="268"></span></a><span class="w">			</span><span class="kd">var</span><span class="w"> </span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">),</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos" data-line="269"></span></a><span class="w">				</span><span class="nx">fileDomainPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;upload.wikimedia.org&#39;</span><span class="p">);</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos" data-line="270"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fileDomainPos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fileDomainPos</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="sr">/\.svg$/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">href</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos" data-line="271"></span></a><span class="w">				</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">href</span><span class="p">;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos" data-line="272"></span></a><span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos" data-line="273"></span></a><span class="w">			</span><span class="p">}</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos" data-line="274"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos" data-line="275"></span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos" data-line="276"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">fileUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos" data-line="277"></span></a><span class="w">		</span><span class="c1">// Get filepath if in edit-mode</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos" data-line="278"></span></a><span class="w">			</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos" data-line="279"></span></a><span class="w">				</span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;wgServer&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">wikiScript</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;?action=query&amp;format=json&amp;prop=imageinfo&amp;titles=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">wikiUrlencode</span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgPageName</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&amp;iiprop=url&amp;iilimit=1&#39;</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos" data-line="280"></span></a><span class="w">				</span><span class="nx">dataType</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos" data-line="281"></span></a><span class="w">				</span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos" data-line="282"></span></a><span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">pages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos" data-line="283"></span></a><span class="w">						</span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos" data-line="284"></span></a><span class="w">						</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos" data-line="285"></span></a><span class="w">							</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">imageinfo</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">imageinfo</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos" data-line="286"></span></a><span class="w">								</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">imageinfo</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">url</span><span class="p">;</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos" data-line="287"></span></a><span class="w">								</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">$fetch</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="nx">$fetchCB</span><span class="p">);</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos" data-line="288"></span></a><span class="w">							</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos" data-line="289"></span></a><span class="w">								</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">failURL</span><span class="p">();</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos" data-line="290"></span></a><span class="w">							</span><span class="p">}</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos" data-line="291"></span></a><span class="w">						</span><span class="p">}</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos" data-line="292"></span></a><span class="w">					</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos" data-line="293"></span></a><span class="w">						</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">failURL</span><span class="p">();</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos" data-line="294"></span></a><span class="w">					</span><span class="p">}</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos" data-line="295"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos" data-line="296"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos" data-line="297"></span></a><span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos" data-line="298"></span></a><span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="nx">$fetch</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="nx">$fetchCB</span><span class="p">);</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos" data-line="299"></span></a><span class="w">		</span><span class="p">}</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos" data-line="300"></span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos" data-line="301"></span></a><span class="w">		</span><span class="nx">$imgPreview2Overlay</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos" data-line="302"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;DANGER ZONE: For your security, we added \</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos" data-line="303"></span></a><span class="s1">				an overlay over the iframe protecting you from accidental \</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos" data-line="304"></span></a><span class="s1">				interactions with the potentially evil/ harmful SVG code. \</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos" data-line="305"></span></a><span class="s1">				Type &quot;sudo&quot; to disable this security-layer. \</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos" data-line="306"></span></a><span class="s1">				(Otherwise just cancel)&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;sudo&#39;</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos" data-line="307"></span></a><span class="w">				</span><span class="nx">$imgPreview2Overlay</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos" data-line="308"></span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos" data-line="309"></span></a><span class="w">		</span><span class="p">}).</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos" data-line="310"></span></a><span class="w">			</span><span class="nx">$imgPreview2</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;com-svgedit-preview-hover&#39;</span><span class="p">);</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos" data-line="311"></span></a><span class="w">		</span><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos" data-line="312"></span></a><span class="w">			</span><span class="nx">$imgPreview2</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;com-svgedit-preview-hover&#39;</span><span class="p">);</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos" data-line="313"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos" data-line="314"></span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos" data-line="315"></span></a><span class="w">		</span><span class="nx">$gui</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos" data-line="316"></span></a><span class="w">			</span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos" data-line="317"></span></a><span class="w">			</span><span class="nx">$saveBtn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$sum</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos" data-line="318"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos" data-line="319"></span></a><span class="w">				</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="w"> </span><span class="o">?</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos" data-line="320"></span></a><span class="w">					</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos" data-line="321"></span></a><span class="w">					</span><span class="nx">$ta</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos" data-line="322"></span></a><span class="w">				</span><span class="nx">$sum</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos" data-line="323"></span></a><span class="w">			</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">httpStatus</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos" data-line="324"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nb">JSON</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos" data-line="325"></span></a><span class="w">					</span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos" data-line="326"></span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos" data-line="327"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos" data-line="328"></span></a><span class="w">					</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;API Error &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:\n&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">info</span><span class="p">);</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos" data-line="329"></span></a><span class="w">					</span><span class="nx">$saveBtn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$sum</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos" data-line="330"></span></a><span class="w">					</span><span class="nx">$taWrap</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;noblock&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">unblock</span><span class="p">();</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos" data-line="331"></span></a><span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos" data-line="332"></span></a><span class="w">					</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos" data-line="333"></span></a><span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allowCloseWindow</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos" data-line="334"></span></a><span class="w">						</span><span class="nx">allowCloseWindow</span><span class="p">.</span><span class="nx">release</span><span class="p">();</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos" data-line="335"></span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos" data-line="336"></span></a><span class="w">					</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos" data-line="337"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos" data-line="338"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos" data-line="339"></span></a><span class="w">				</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Server error: Something went wrong&#39;</span><span class="p">);</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos" data-line="340"></span></a><span class="w">				</span><span class="nx">$saveBtn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$sum</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos" data-line="341"></span></a><span class="w">				</span><span class="nx">$taWrap</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;noblock&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">unblock</span><span class="p">();</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos" data-line="342"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos" data-line="343"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">block</span><span class="p">(</span><span class="nx">$taWrap</span><span class="p">);</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos" data-line="344"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos" data-line="345"></span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos" data-line="346"></span></a><span class="w">		</span><span class="nx">$loadCodeEditorBtn</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos" data-line="347"></span></a><span class="w">			</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos" data-line="348"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">loadCodeEditor</span><span class="p">(</span><span class="nx">$ta</span><span class="p">);</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos" data-line="349"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos" data-line="350"></span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos" data-line="351"></span></a><span class="w">		</span><span class="nx">$previewBtn</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos" data-line="352"></span></a><span class="w">			</span><span class="kd">var</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getCurrentValue</span><span class="p">(),</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos" data-line="353"></span></a><span class="w">				</span><span class="nx">blob</span><span class="p">,</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos" data-line="354"></span></a><span class="w">				</span><span class="nx">URL</span><span class="p">,</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos" data-line="355"></span></a><span class="w">				</span><span class="nx">dataUrl</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos" data-line="356"></span></a><span class="w">				</span><span class="nx">typedArray</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos" data-line="357"></span></a><span class="w">				</span><span class="nx">v</span><span class="p">,</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos" data-line="358"></span></a><span class="w">				</span><span class="nx">w</span><span class="p">,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos" data-line="359"></span></a><span class="w">				</span><span class="nx">h</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos" data-line="360"></span></a><span class="w">				</span><span class="nx">m</span><span class="p">;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos" data-line="361"></span></a><span class="w">			</span><span class="nx">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span><span class="p">;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos" data-line="362"></span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos" data-line="363"></span></a><span class="w">			</span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">val</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;image/svg+xml&#39;</span><span class="w"> </span><span class="p">});</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos" data-line="364"></span></a><span class="w">			</span><span class="nx">dataUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos" data-line="365"></span></a><span class="w">			</span><span class="c1">// Naive RegExp matching (avoids parsing the whole document)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos" data-line="366"></span></a><span class="w">			</span><span class="c1">// and possible security or malformed SVG troubles</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos" data-line="367"></span></a><span class="w">			</span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos" data-line="368"></span></a><span class="w">			</span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/height\s*=\s*[&quot;&#39;]([\d.]+)[&quot;&#39;]/</span><span class="p">);</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos" data-line="369"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">h</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">15</span><span class="p">))</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos" data-line="370"></span></a><span class="w">				</span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos" data-line="371"></span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos" data-line="372"></span></a><span class="w">			</span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/width\s*=\s*[&quot;&#39;]([\d.]+)[&quot;&#39;]/</span><span class="p">);</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos" data-line="373"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">w</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">15</span><span class="p">))</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos" data-line="374"></span></a><span class="w">				</span><span class="nx">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos" data-line="375"></span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos" data-line="376"></span></a><span class="w">			</span><span class="nx">$previewBtn</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos" data-line="377"></span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos" data-line="378"></span></a><span class="w">			</span><span class="nx">$imgPreview2Container</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos" data-line="379"></span></a><span class="w">			</span><span class="nx">$imgPreviewContainer</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos" data-line="380"></span></a><span class="w">				</span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">500</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos" data-line="381"></span></a><span class="w">				</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">500</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos" data-line="382"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">show</span><span class="p">();</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos" data-line="383"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">block</span><span class="p">(</span><span class="nx">$imgPreviewContainer</span><span class="p">);</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos" data-line="384"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">block</span><span class="p">(</span><span class="nx">$imgPreview2Container</span><span class="p">);</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos" data-line="385"></span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos" data-line="386"></span></a><span class="w">			</span><span class="nx">$imgPreview2</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos" data-line="387"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">$imgPreview2Container</span><span class="p">.</span><span class="nx">unblock</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos" data-line="388"></span></a><span class="w">					</span><span class="nx">$imgPreview2Container</span><span class="p">.</span><span class="nx">unblock</span><span class="p">();</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos" data-line="389"></span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos" data-line="390"></span></a><span class="w">			</span><span class="p">}).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">dataUrl</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos" data-line="391"></span></a><span class="w">				</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">w</span><span class="p">,</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos" data-line="392"></span></a><span class="w">				</span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">h</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos" data-line="393"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos" data-line="394"></span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos" data-line="395"></span></a><span class="w">			</span><span class="nx">svgEdit</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos" data-line="396"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">fetchPreview</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos" data-line="397"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">statusText</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos" data-line="398"></span></a><span class="w">					</span><span class="nx">typedArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos" data-line="399"></span></a><span class="w">					</span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">typedArray</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;image/jpeg&#39;</span><span class="w"> </span><span class="p">});</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos" data-line="400"></span></a><span class="w">					</span><span class="nx">dataUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos" data-line="401"></span></a><span class="w">					</span><span class="nx">$imgPreviewContainer</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos" data-line="402"></span></a><span class="w">						</span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos" data-line="403"></span></a><span class="w">						</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos" data-line="404"></span></a><span class="w">					</span><span class="p">});</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos" data-line="405"></span></a><span class="w">					</span><span class="nx">$imgPreview</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">dataUrl</span><span class="p">);</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos" data-line="406"></span></a><span class="w">					</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos" data-line="407"></span></a><span class="w">						</span><span class="nx">$imgPreview2</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos" data-line="408"></span></a><span class="w">							</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">$imgPreview</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos" data-line="409"></span></a><span class="w">							</span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">$imgPreview</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos" data-line="410"></span></a><span class="w">						</span><span class="p">});</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos" data-line="411"></span></a><span class="w">					</span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos" data-line="412"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos" data-line="413"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="cm">/* r*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos" data-line="414"></span></a><span class="w">					</span><span class="nx">$imgPreview</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;//upload.wikimedia.org/wikipedia/commons/thumb/5/55/Bug_blank.svg/200px-Bug_blank.svg.png&#39;</span><span class="p">);</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos" data-line="415"></span></a><span class="w">				</span><span class="p">})</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos" data-line="416"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos" data-line="417"></span></a><span class="w">					</span><span class="nx">$previewBtn</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos" data-line="418"></span></a><span class="w">					</span><span class="nx">$imgPreviewContainer</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$imgPreview2Container</span><span class="p">).</span><span class="nx">unblock</span><span class="p">();</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos" data-line="419"></span></a><span class="w">				</span><span class="p">});</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos" data-line="420"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos" data-line="421"></span></a><span class="w">		</span><span class="nx">$diffBtn</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos" data-line="422"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">block</span><span class="p">(</span><span class="nx">$diffContainer</span><span class="p">.</span><span class="nx">show</span><span class="p">());</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos" data-line="423"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">$usingScharkDiff</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos" data-line="424"></span></a><span class="w">				</span><span class="nx">$diff</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">htmlDiff</span><span class="p">(</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos" data-line="425"></span></a><span class="w">					</span><span class="nx">getOriginal</span><span class="p">(),</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos" data-line="426"></span></a><span class="w">					</span><span class="nx">getCurrentValue</span><span class="p">(),</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos" data-line="427"></span></a><span class="w">					</span><span class="kc">true</span><span class="p">));</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos" data-line="428"></span></a><span class="w">				</span><span class="nx">$diffContainer</span><span class="p">.</span><span class="nx">unblock</span><span class="p">();</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos" data-line="429"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos" data-line="430"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos" data-line="431"></span></a><span class="w">		</span><span class="nx">$validateButton</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos" data-line="432"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">$validationDoctype</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos" data-line="433"></span></a><span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="nx">$validationDoctype</span><span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos" data-line="434"></span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos" data-line="435"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">block</span><span class="p">(</span><span class="nx">$validationWrapper</span><span class="p">.</span><span class="nx">show</span><span class="p">());</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos" data-line="436"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">$validate</span><span class="p">(</span><span class="nx">getCurrentValue</span><span class="p">(),</span><span class="w"> </span><span class="nx">$validationDoctype</span><span class="p">.</span><span class="nx">val</span><span class="p">()).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">textStatus</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos" data-line="437"></span></a><span class="w">				</span><span class="nx">$validationWrapper</span><span class="p">.</span><span class="nx">unblock</span><span class="p">();</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos" data-line="438"></span></a><span class="w">				</span><span class="nx">$validationContainer</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$validationContainer2</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos" data-line="439"></span></a><span class="w">				</span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos" data-line="440"></span></a><span class="w">					</span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos" data-line="441"></span></a><span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">invalidJSON</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos" data-line="442"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">source</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos" data-line="443"></span></a><span class="w">					</span><span class="nx">$validationDoctypeLabel</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">doctype</span><span class="p">);</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos" data-line="444"></span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos" data-line="445"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">svgcheck</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">svgcheck</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos" data-line="446"></span></a><span class="w">					</span><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">svgcheck</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos" data-line="447"></span></a><span class="w">						</span><span class="nx">$validationContainer2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">$validationItem2</span><span class="p">(</span><span class="nx">msg</span><span class="p">));</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos" data-line="448"></span></a><span class="w">					</span><span class="p">});</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos" data-line="449"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos" data-line="450"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos" data-line="451"></span></a><span class="w">					</span><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos" data-line="452"></span></a><span class="w">						</span><span class="nx">$validationContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">$validationItem</span><span class="p">(</span><span class="nx">msg</span><span class="p">));</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos" data-line="453"></span></a><span class="w">					</span><span class="p">});</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos" data-line="454"></span></a><span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos" data-line="455"></span></a><span class="w">						</span><span class="nx">$validationContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;Well done :)&lt;/li&gt;&#39;</span><span class="p">));</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos" data-line="456"></span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos" data-line="457"></span></a><span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos" data-line="458"></span></a><span class="w">					</span><span class="nx">$validationContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos" data-line="459"></span></a><span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos" data-line="460"></span></a><span class="w">					</span><span class="nx">$validationContainer</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">r</span><span class="p">));</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos" data-line="461"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos" data-line="462"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos" data-line="463"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos" data-line="464"></span></a><span class="w">		</span><span class="nx">$uploadButton</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos" data-line="465"></span></a><span class="w">			</span><span class="kd">var</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$uploadButton</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos" data-line="466"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">file</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos" data-line="467"></span></a><span class="w">				</span><span class="k">return</span><span class="p">;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos" data-line="468"></span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos" data-line="469"></span></a><span class="w">			</span><span class="kd">var</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos" data-line="470"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos" data-line="471"></span></a><span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Selected file is &gt; 15 MiB. Aborting.&#39;</span><span class="p">);</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos" data-line="472"></span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos" data-line="473"></span></a><span class="w">			</span><span class="kd">var</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FileReader</span><span class="p">();</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos" data-line="474"></span></a><span class="w">			</span><span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos" data-line="475"></span></a><span class="w">				</span><span class="c1">// Clear upload button</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos" data-line="476"></span></a><span class="w">				</span><span class="nx">$uploadButton</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos" data-line="477"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getCurrentValue</span><span class="p">()</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">$ta</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;orignal-svg&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos" data-line="478"></span></a><span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;The editor contents changed from the stored revision. Are you sure you want to replace the editor contents with the contents loaded from the file selected?&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos" data-line="479"></span></a><span class="w">						</span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// Cancel: Do nothing!</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos" data-line="480"></span></a><span class="w">					</span><span class="p">}</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos" data-line="481"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos" data-line="482"></span></a><span class="w">				</span><span class="nx">setCurrentValue</span><span class="p">(</span><span class="nx">reader</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos" data-line="483"></span></a><span class="w">			</span><span class="p">};</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos" data-line="484"></span></a><span class="w">			</span><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsText</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos" data-line="485"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos" data-line="486"></span></a><span class="w">		</span><span class="nx">$gui</span><span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="s1">&#39;#mw-content-text&#39;</span><span class="p">);</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos" data-line="487"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos" data-line="488"></span></a><span class="w">	</span><span class="nx">block</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">$el</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos" data-line="489"></span></a><span class="w">		</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">using</span><span class="p">(</span><span class="s1">&#39;ext.gadget.jquery.blockUI&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos" data-line="490"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;noblock&#39;</span><span class="p">))</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos" data-line="491"></span></a><span class="w">				</span><span class="k">return</span><span class="p">;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos" data-line="492"></span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos" data-line="493"></span></a><span class="w">			</span><span class="nx">$el</span><span class="p">.</span><span class="nx">block</span><span class="p">({</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos" data-line="494"></span></a><span class="w">				</span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&lt;img src=&quot;//upload.wikimedia.org/wikipedia/commons/1/10/Loading-special.gif&quot; height=&quot;15&quot; width=&quot;128&quot;&gt;&#39;</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos" data-line="495"></span></a><span class="w">				</span><span class="nx">css</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos" data-line="496"></span></a><span class="w">					</span><span class="nx">border</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos" data-line="497"></span></a><span class="w">					</span><span class="nx">background</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;none&#39;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos" data-line="498"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos" data-line="499"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos" data-line="500"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos" data-line="501"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos" data-line="502"></span></a><span class="w">	</span><span class="nx">$validationItem</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">validatorMsg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos" data-line="503"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;com-svgedit-validation-&#39;</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos" data-line="504"></span></a><span class="w">			</span><span class="nx">$l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;code&gt;&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;line&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;L.&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">lastLine</span><span class="p">),</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos" data-line="505"></span></a><span class="w">			</span><span class="nx">$col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">lastColumn</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;code&gt;&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos" data-line="506"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;col.&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">lastColumn</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos" data-line="507"></span></a><span class="w">			</span><span class="nx">$msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">message</span><span class="p">),</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos" data-line="508"></span></a><span class="w">			</span><span class="nx">$msgId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;messageid&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">messageid</span><span class="p">),</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos" data-line="509"></span></a><span class="w">			</span><span class="nx">$li</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$l</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$col</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$msg</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; (&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$msgId</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;)&#39;</span><span class="p">);</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos" data-line="510"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">$li</span><span class="p">;</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos" data-line="511"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos" data-line="512"></span></a><span class="w">	</span><span class="nx">$validationItem2</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">validatorMsg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos" data-line="513"></span></a><span class="w">		</span><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">issues</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">issue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos" data-line="514"></span></a><span class="w">			</span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">issues</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">issue</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos" data-line="515"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\*\*(.+?)\*\*/</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&lt;b&gt;&lt;i&gt;$1&lt;/i&gt;&lt;/b&gt;&#39;</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos" data-line="516"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\*(.+?)\*/</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&lt;i&gt;$1&lt;/i&gt;&#39;</span><span class="p">);</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos" data-line="517"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos" data-line="518"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;com-svgedit-validation-&#39;</span><span class="p">,</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos" data-line="519"></span></a><span class="w">			</span><span class="nx">$l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;code&gt;&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;line&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;L.&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">line</span><span class="p">),</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos" data-line="520"></span></a><span class="w">			</span><span class="nx">$msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;message&#39;</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos" data-line="521"></span></a><span class="w">				</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">validatorMsg</span><span class="p">.</span><span class="nx">issues</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)),</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos" data-line="522"></span></a><span class="w">			</span><span class="nx">$li</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$l</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$msg</span><span class="p">);</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos" data-line="523"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">$li</span><span class="p">;</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos" data-line="524"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos" data-line="525"></span></a><span class="w">	</span><span class="nx">$validate</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="nx">doctype</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos" data-line="526"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">bot</span><span class="p">.</span><span class="nx">multipartMessageForUTF8Files</span><span class="p">()</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos" data-line="527"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;svgcheck&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos" data-line="528"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;doctype&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">doctype</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos" data-line="529"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;input.svg&#39;</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos" data-line="530"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">$send</span><span class="p">(</span><span class="s1">&#39;//validator.toolforge.org/w3.php&#39;</span><span class="p">);</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos" data-line="531"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos" data-line="532"></span></a><span class="w">	</span><span class="nx">$usingScharkDiff</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos" data-line="533"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">$deferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos" data-line="534"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">htmlDiff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos" data-line="535"></span></a><span class="w">			</span><span class="nx">$deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos" data-line="536"></span></a><span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos" data-line="537"></span></a><span class="w">			</span><span class="nx">mw</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="s1">&#39;userjs.load-script.diff-core&#39;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos" data-line="538"></span></a><span class="w">				</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;ins&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text-decoration: underline; font-weight: bold; font-size:1.2em; color: #020; background-color: #ABE; -moz-text-decoration-color:#474;&#39;</span><span class="p">);</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos" data-line="539"></span></a><span class="w">				</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;font-size:1.2em; color: #200; background-color: #FD9; text-decoration-color:#744;&#39;</span><span class="p">);</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos" data-line="540"></span></a><span class="w">				</span><span class="nx">mw</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">addCSS</span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">getCSS</span><span class="p">());</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos" data-line="541"></span></a><span class="w">				</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;minMovedLength&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="p">);</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos" data-line="542"></span></a><span class="w">				</span><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">schnarkDiff</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;tooShort&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos" data-line="543"></span></a><span class="w">				</span><span class="nx">$deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos" data-line="544"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos" data-line="545"></span></a><span class="w">			</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;//de.wikipedia.org/w/index.php?title=Benutzer:Schnark/js/diff.js/core.js&amp;action=raw&amp;ctype=text/javascript&#39;</span><span class="p">);</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos" data-line="546"></span></a><span class="w">		</span><span class="p">}</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos" data-line="547"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">$deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos" data-line="548"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos" data-line="549"></span></a><span class="w">	</span><span class="nx">failURL</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos" data-line="550"></span></a><span class="w">		</span><span class="nx">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Unable to extract file URL.&#39;</span><span class="p">;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos" data-line="551"></span></a><span class="w">		</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos" data-line="552"></span></a><span class="w">		</span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos" data-line="553"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos" data-line="554"></span></a><span class="w">	</span><span class="nx">$fetch</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos" data-line="555"></span></a><span class="w">		</span><span class="c1">// Fetch SVG source code</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos" data-line="556"></span></a><span class="w">		</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">bot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MwJSBot</span><span class="p">();</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos" data-line="557"></span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos" data-line="558"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">fileUrl</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos" data-line="559"></span></a><span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">failURL</span><span class="p">();</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos" data-line="560"></span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos" data-line="561"></span></a><span class="w">		</span><span class="c1">// Assuming the SVG is UTF-8-encoded</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos" data-line="562"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos" data-line="563"></span></a><span class="w">			</span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">fileUrl</span><span class="p">,</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos" data-line="564"></span></a><span class="w">			</span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos" data-line="565"></span></a><span class="w">			</span><span class="nx">beforeSend</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos" data-line="566"></span></a><span class="w">				</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">overrideMimeType</span><span class="p">(</span><span class="s1">&#39;text/plain; charset=UTF-8&#39;</span><span class="p">);</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos" data-line="567"></span></a><span class="w">			</span><span class="p">}</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos" data-line="568"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos" data-line="569"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos" data-line="570"></span></a><span class="w">	</span><span class="nx">loadCodeEditor</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">$textArea</span><span class="cm">/* , $parent*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos" data-line="571"></span></a><span class="w">		</span><span class="c1">// Just in case someone complains about the license ...</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos" data-line="572"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">mirrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos" data-line="573"></span></a><span class="w">				</span><span class="s1">&#39;//commons.wikimedia.org/w/index.php?&#39;</span><span class="p">,</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos" data-line="574"></span></a><span class="w">				</span><span class="s1">&#39;//tools-static.wmflabs.org/rillke/CodeMirror/&#39;</span><span class="p">,</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos" data-line="575"></span></a><span class="w">				</span><span class="s1">&#39;//mol-static.wmflabs.org/CodeMirror/&#39;</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos" data-line="576"></span></a><span class="w">			</span><span class="p">],</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos" data-line="577"></span></a><span class="w">			</span><span class="nx">scripts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;lib/codemirror.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mode/xml/xml.js&#39;</span><span class="p">],</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos" data-line="578"></span></a><span class="w">			</span><span class="nx">styles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;lib/codemirror.css&#39;</span><span class="p">],</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos" data-line="579"></span></a><span class="w">			</span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos" data-line="580"></span></a><span class="w">				</span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctype</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/javascript&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;?&#39;</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos" data-line="581"></span></a><span class="w">			</span><span class="p">},</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos" data-line="582"></span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos" data-line="583"></span></a><span class="w">			</span><span class="nx">rlScripts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">scripts</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos" data-line="584"></span></a><span class="w">				</span><span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;User:Rillke/CodeMirror/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">el</span><span class="p">;</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos" data-line="585"></span></a><span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="nx">mirrors</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos" data-line="586"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos" data-line="587"></span></a><span class="w">		</span><span class="nx">params</span><span class="p">.</span><span class="nx">ctype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;text/css&#39;</span><span class="p">;</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos" data-line="588"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">rlStyles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">styles</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos" data-line="589"></span></a><span class="w">			</span><span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;User:Rillke/CodeMirror/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">el</span><span class="p">;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos" data-line="590"></span></a><span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nx">mirrors</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos" data-line="591"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos" data-line="592"></span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos" data-line="593"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">getState</span><span class="p">(</span><span class="s1">&#39;mediawiki.commons.CodeMirror&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos" data-line="594"></span></a><span class="w">			</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">implement</span><span class="p">(</span><span class="s1">&#39;mediawiki.commons.CodeMirror&#39;</span><span class="p">,</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos" data-line="595"></span></a><span class="w">				</span><span class="nx">rlScripts</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">screen</span><span class="o">:</span><span class="w"> </span><span class="nx">rlStyles</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos" data-line="596"></span></a><span class="w">				</span><span class="p">{</span><span class="w"> </span><span class="cm">/* no messages*/</span><span class="w"> </span><span class="p">});</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos" data-line="597"></span></a><span class="w">		</span><span class="p">}</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos" data-line="598"></span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos" data-line="599"></span></a><span class="w">		</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">using</span><span class="p">(</span><span class="s1">&#39;mediawiki.commons.CodeMirror&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos" data-line="600"></span></a><span class="w">			</span><span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$textArea</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">height</span><span class="p">(),</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos" data-line="601"></span></a><span class="w">				</span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$textArea</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos" data-line="602"></span></a><span class="w">					</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">6000</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos" data-line="603"></span></a><span class="w">					</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/.+\n([\t ]+)&lt;\S+(?:.|\n)*\n\1&lt;/</span><span class="p">),</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos" data-line="604"></span></a><span class="w">				</span><span class="nx">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos" data-line="605"></span></a><span class="w">					</span><span class="nx">lineNumbers</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos" data-line="606"></span></a><span class="w">					</span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;xml&#39;</span><span class="p">,</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos" data-line="607"></span></a><span class="w">					</span><span class="nx">viewportMargin</span><span class="o">:</span><span class="w"> </span><span class="mf">120</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos" data-line="608"></span></a><span class="w">				</span><span class="p">},</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos" data-line="609"></span></a><span class="w">				</span><span class="nx">l</span><span class="p">;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos" data-line="610"></span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos" data-line="611"></span></a><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos" data-line="612"></span></a><span class="w">				</span><span class="nx">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos" data-line="613"></span></a><span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">9</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos" data-line="614"></span></a><span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="sr">/ /</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos" data-line="615"></span></a><span class="w">						</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Indention with spaces&#39;</span><span class="p">);</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos" data-line="616"></span></a><span class="w">						</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">settings</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos" data-line="617"></span></a><span class="w">							</span><span class="nx">extraKeys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Tab</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos" data-line="618"></span></a><span class="w">								</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="s1">&#39;insertSoftTab&#39;</span><span class="p">);</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos" data-line="619"></span></a><span class="w">							</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos" data-line="620"></span></a><span class="w">							</span><span class="nx">tabSize</span><span class="o">:</span><span class="w"> </span><span class="nx">l</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos" data-line="621"></span></a><span class="w">						</span><span class="p">});</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos" data-line="622"></span></a><span class="w">					</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="sr">/\t/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos" data-line="623"></span></a><span class="w">						</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Indention with tabs&#39;</span><span class="p">);</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos" data-line="624"></span></a><span class="w">						</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">settings</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos" data-line="625"></span></a><span class="w">							</span><span class="nx">indentWithTabs</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos" data-line="626"></span></a><span class="w">							</span><span class="nx">tabSize</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos" data-line="627"></span></a><span class="w">						</span><span class="p">});</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos" data-line="628"></span></a><span class="w">					</span><span class="p">}</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos" data-line="629"></span></a><span class="w">				</span><span class="p">}</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos" data-line="630"></span></a><span class="w">			</span><span class="p">}</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos" data-line="631"></span></a><span class="w">			</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">fromTextArea</span><span class="p">(</span><span class="nx">$textArea</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">settings</span><span class="p">);</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos" data-line="632"></span></a><span class="w">			</span><span class="nx">$</span><span class="p">(</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">scroller</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;px&#39;</span><span class="w"> </span><span class="p">});</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos" data-line="633"></span></a><span class="w">			</span><span class="nx">$</span><span class="p">(</span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos" data-line="634"></span></a><span class="w">				</span><span class="nx">border</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1px solid #EEE&#39;</span><span class="p">,</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos" data-line="635"></span></a><span class="w">				</span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;auto&#39;</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos" data-line="636"></span></a><span class="w">			</span><span class="p">});</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos" data-line="637"></span></a><span class="w">		</span><span class="p">});</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos" data-line="638"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos" data-line="639"></span></a><span class="w">	</span><span class="nx">save</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">summary</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos" data-line="640"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">summary</span><span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos" data-line="641"></span></a><span class="w">			</span><span class="nx">summary</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39; // &#39;</span><span class="p">;</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos" data-line="642"></span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos" data-line="643"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">bot</span><span class="p">.</span><span class="nx">multipartMessageForUTF8Files</span><span class="p">()</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos" data-line="644"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos" data-line="645"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;upload&#39;</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos" data-line="646"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgTitle</span><span class="p">)</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos" data-line="647"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">summary</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;Editing SVG source code using [[c:User:Rillke/SVGedit.js]]&#39;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos" data-line="648"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgTitle</span><span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos" data-line="649"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;ignorewarnings&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos" data-line="650"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;csrfToken&#39;</span><span class="p">));</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos" data-line="651"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isCommonsWiki</span><span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos" data-line="652"></span></a><span class="w">			</span><span class="nx">message</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;rillke-mw-js-bot&#39;</span><span class="p">);</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos" data-line="653"></span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos" data-line="654"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">$send</span><span class="p">();</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos" data-line="655"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos" data-line="656"></span></a><span class="w">	</span><span class="nx">fetchPreview</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">svg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos" data-line="657"></span></a><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">bot</span><span class="p">.</span><span class="nx">multipartMessageForUTF8Files</span><span class="p">()</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos" data-line="658"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">appendPart</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;input.svg&#39;</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos" data-line="659"></span></a><span class="w">			</span><span class="p">.</span><span class="nx">$send</span><span class="p">(</span><span class="s1">&#39;//convert.toolforge.org/svg2png.php&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;arraybuffer&#39;</span><span class="p">);</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos" data-line="660"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos" data-line="661"></span></a><span class="w">	</span><span class="nx">reload</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos" data-line="662"></span></a><span class="w">		</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mw</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getUrl</span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgPageName</span><span class="p">);</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos" data-line="663"></span></a><span class="w">	</span><span class="p">},</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos" data-line="664"></span></a><span class="w">	</span><span class="nx">log</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos" data-line="665"></span></a><span class="w">		</span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos" data-line="666"></span></a><span class="w">		</span><span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">MYSELF</span><span class="p">);</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos" data-line="667"></span></a><span class="w">		</span><span class="nx">mw</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">mw</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos" data-line="668"></span></a><span class="w">	</span><span class="p">}</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos" data-line="669"></span></a><span class="p">};</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos" data-line="670"></span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos" data-line="671"></span></a><span class="c1">// Register globally</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos" data-line="672"></span></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isCommonsWiki</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">conf</span><span class="p">.</span><span class="nx">wgDBname</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;commonsarchivewiki&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos" data-line="673"></span></a><span class="w">	</span><span class="c1">// mw.loader.addSource has a check for source key uniqueness</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos" data-line="674"></span></a><span class="w">	</span><span class="c1">// that if it fails, throws an error.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos" data-line="675"></span></a><span class="w">	</span><span class="c1">// Since I am offering many scripts, I would like to be able to register</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos" data-line="676"></span></a><span class="w">	</span><span class="c1">// a source from multiple code positions. However the loader has no</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos" data-line="677"></span></a><span class="w">	</span><span class="c1">// accessors to its internally maintained list of sources. Therefore</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos" data-line="678"></span></a><span class="w">	</span><span class="c1">// ensure with high probabiltiy that every source key added is unique.</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos" data-line="679"></span></a><span class="w">	</span><span class="nx">commonsWiki</span><span class="p">[</span><span class="nx">commonwWikiKey</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;//commons.wikimedia.org/w/load.php&#39;</span><span class="p">;</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos" data-line="680"></span></a><span class="w">	</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="nx">commonsWiki</span><span class="p">);</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos" data-line="681"></span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos" data-line="682"></span></a><span class="w">	</span><span class="c1">// Register Commons RL modules</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos" data-line="683"></span></a><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos" data-line="684"></span></a><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">getState</span><span class="p">(</span><span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mf">0</span><span class="p">]))</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos" data-line="685"></span></a><span class="w">			</span><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">register</span><span class="p">([</span><span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">]]);</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos" data-line="686"></span></a><span class="w">	</span><span class="p">}</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos" data-line="687"></span></a><span class="p">}</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos" data-line="688"></span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos" data-line="689"></span></a><span class="c1">// Expose globally</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos" data-line="690"></span></a><span class="nx">mw</span><span class="p">.</span><span class="nx">libs</span><span class="p">.</span><span class="nx">svgRawEditor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">;</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos" data-line="691"></span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos" data-line="692"></span></a><span class="nx">mw</span><span class="p">.</span><span class="nx">loader</span><span class="p">.</span><span class="nx">using</span><span class="p">([</span><span class="s1">&#39;mediawiki.util&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mediawiki.user&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ext.gadget.editDropdown&#39;</span><span class="p">],</span><span class="w"> </span><span class="nx">svgEdit</span><span class="p">.</span><span class="nx">init</span><span class="p">);</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos" data-line="693"></span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos" data-line="694"></span></a><span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">mediaWiki</span><span class="p">));</span>
</span></pre></div>
<!-- 
NewPP limit report
Parsed by mw1436
Cached time: 20240428082352
Cache expiry: 2592000
Reduced expiry: false
Complications: []
CPU time usage: 0.006 seconds
Real time usage: 0.007 seconds
Preprocessor visited node count: 1/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 1/100
Expensive parser function count: 0/500
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
Number of Wikibase entities loaded: 0/400
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div><!--esi <esi:include src="/esitest-fa8a495983347898/content" /> --><noscript><img src="https://login.wikimedia.org/wiki/Special:CentralAutoLogin/start?type=1x1" alt="" width="1" height="1" style="border: none; position: absolute;"></noscript>
<div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="https://commons.wikimedia.org/w/index.php?title=User:Rillke/SVGedit.js&amp;oldid=435901332">https://commons.wikimedia.org/w/index.php?title=User:Rillke/SVGedit.js&amp;oldid=435901332</a>"</div></div>
		<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>
	</div>
</div>

<div id="mw-navigation">
	<h2>Navigation menu</h2>
	<div id="mw-head">
		
<nav id="p-personal" class="mw-portlet mw-portlet-personal vector-user-menu-legacy vector-menu" aria-labelledby="p-personal-label" role="navigation"  >
	<h3
		id="p-personal-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Personal tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="pt-uls" class="mw-list-item active"><a class="uls-trigger" href="#"><span>English</span></a></li><li id="pt-anonuserpage" class="mw-list-item"><span title="The user page for the IP address you are editing as">Not logged in</span></li><li id="pt-anontalk" class="mw-list-item"><a href="/wiki/Special:MyTalk" title="Discussion about edits from this IP address [n]" accesskey="n"><span>Talk</span></a></li><li id="pt-anoncontribs" class="mw-list-item"><a href="/wiki/Special:MyContributions" title="A list of edits made from this IP address [y]" accesskey="y"><span>Contributions</span></a></li><li id="pt-createaccount" class="mw-list-item"><a href="/w/index.php?title=Special:CreateAccount&amp;returnto=User%3ARillke%2FSVGedit.js" title="You are encouraged to create an account and log in; however, it is not mandatory"><span>Create account</span></a></li><li id="pt-login" class="mw-list-item"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=User%3ARillke%2FSVGedit.js" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span>Log in</span></a></li>
		</ul>
		
	</div>
</nav>

		<div id="left-navigation">
			
<nav id="p-namespaces" class="mw-portlet mw-portlet-namespaces vector-menu-tabs vector-menu-tabs-legacy vector-menu" aria-labelledby="p-namespaces-label" role="navigation"  >
	<h3
		id="p-namespaces-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Namespaces</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-nstab-user" class="selected mw-list-item"><a href="/wiki/User:Rillke/SVGedit.js" title="View the user page [c]" accesskey="c"><span>User page</span></a></li><li id="ca-talk" class="mw-list-item"><a href="/wiki/User_talk:Rillke/SVGedit.js" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li>
		</ul>
		
	</div>
</nav>

			
<nav id="p-variants" class="mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown vector-menu" aria-labelledby="p-variants-label" role="navigation"  >
	<input type="checkbox"
		id="p-variants-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-variants"
		class="vector-menu-checkbox"
		aria-labelledby="p-variants-label"
	>
	<label
		id="p-variants-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</nav>

		</div>
		<div id="right-navigation">
			
<nav id="p-views" class="mw-portlet mw-portlet-views vector-menu-tabs vector-menu-tabs-legacy vector-menu" aria-labelledby="p-views-label" role="navigation"  >
	<h3
		id="p-views-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Views</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-view" class="selected mw-list-item"><a href="/wiki/User:Rillke/SVGedit.js"><span>View</span></a></li><li id="ca-viewsource" class="mw-list-item"><a href="/w/index.php?title=User:Rillke/SVGedit.js&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="mw-list-item"><a href="/w/index.php?title=User:Rillke/SVGedit.js&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>History</span></a></li>
		</ul>
		
	</div>
</nav>

			
<nav id="p-cactions" class="mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-menu" aria-labelledby="p-cactions-label" role="navigation"  title="More options" >
	<input type="checkbox"
		id="p-cactions-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-cactions"
		class="vector-menu-checkbox"
		aria-labelledby="p-cactions-label"
	>
	<label
		id="p-cactions-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</nav>

			
<div id="p-search" role="search" class="vector-search-box-vue vector-search-box">
	<h3 >Search</h3>
	<form action="/w/index.php" id="searchform" class="vector-search-box-form">
		<div id="simpleSearch"
			class="vector-search-box-inner"
			 data-search-loc="header-navigation">
			<input class="vector-search-box-input"
				 type="search" name="search" placeholder="Search Wikimedia Commons" aria-label="Search Wikimedia Commons" autocapitalize="sentences" title="Search Wikimedia Commons [f]" accesskey="f" id="searchInput"
			>
			<input type="hidden" name="title" value="Special:MediaSearch">
			<input id="mw-searchButton"
				 class="searchButton mw-fallbackSearchButton" type="submit" name="fulltext" title="Search the pages for this text" value="Search">
			<input id="searchButton"
				 class="searchButton" type="submit" name="go" title="Go to a page with this exact name if it exists" value="Go">
		</div>
	</form>
</div>

		</div>
	</div>
	
<div id="mw-panel" class="vector-legacy-sidebar">
	<div id="p-logo" role="banner">
		<a class="mw-wiki-logo" href="/wiki/Main_Page"
			title="Visit the main page"></a>
	</div>
	
<nav id="p-navigation" class="mw-portlet mw-portlet-navigation vector-menu-portal portal vector-menu" aria-labelledby="p-navigation-label" role="navigation"  >
	<h3
		id="p-navigation-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Navigate</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-mainpage-description" class="mw-list-item"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z"><span>Main page</span></a></li><li id="n-welcome" class="mw-list-item"><a href="/wiki/Commons:Welcome"><span>Welcome</span></a></li><li id="n-portal" class="mw-list-item"><a href="/wiki/Commons:Community_portal" title="About the project, what you can do, where to find things"><span>Community portal</span></a></li><li id="n-village-pump" class="mw-list-item"><a href="/wiki/Commons:Village_pump"><span>Village pump</span></a></li><li id="n-help" class="mw-list-item"><a href="/wiki/Special:MyLanguage/Help:Contents" title="The place to find out"><span>Help center</span></a></li>
		</ul>
		
	</div>
</nav>

	
<nav id="p-participate" class="mw-portlet mw-portlet-participate vector-menu-portal portal vector-menu" aria-labelledby="p-participate-label" role="navigation"  >
	<h3
		id="p-participate-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Participate</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-uploadbtn" class="mw-list-item"><a href="/wiki/Special:UploadWizard"><span>Upload file</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li><li id="n-latestfiles" class="mw-list-item"><a href="/wiki/Special:NewFiles"><span>Latest files</span></a></li><li id="n-randomimage" class="mw-list-item"><a href="/wiki/Special:Random/File" title="Load a random file [x]" accesskey="x"><span>Random file</span></a></li><li id="n-contact" class="mw-list-item"><a href="/wiki/Commons:Contact_us"><span>Contact us</span></a></li>
		</ul>
		
	</div>
</nav>

<nav id="p-tb" class="mw-portlet mw-portlet-tb vector-menu-portal portal vector-menu" aria-labelledby="p-tb-label" role="navigation"  >
	<h3
		id="p-tb-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="t-whatlinkshere" class="mw-list-item"><a href="/wiki/Special:WhatLinksHere/User:Rillke/SVGedit.js" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="/wiki/Special:RecentChangesLinked/User:Rillke/SVGedit.js" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="tb-uploads" class="mw-list-item"><a href="/w/index.php?title=Special:ListFiles/Rillke&amp;ilshowall=1" title="A list of uploads by this user"><span>User uploads</span></a></li><li id="t-contributions" class="mw-list-item"><a href="/wiki/Special:Contributions/Rillke" title="A list of contributions by this user"><span>User contributions</span></a></li><li id="t-log" class="mw-list-item"><a href="/wiki/Special:Log/Rillke"><span>Logs</span></a></li><li id="t-userrights" class="mw-list-item"><a href="/wiki/Special:UserRights/Rillke"><span>View user groups</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li><li id="t-permalink" class="mw-list-item"><a href="/w/index.php?title=User:Rillke/SVGedit.js&amp;oldid=435901332" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="/w/index.php?title=User:Rillke/SVGedit.js&amp;action=info" title="More information about this page"><span>Page information</span></a></li><li id="t-urlshortener" class="mw-list-item"><a href="/w/index.php?title=Special:UrlShortener&amp;url=https%3A%2F%2Fcommons.wikimedia.org%2Fwiki%2FUser%3ARillke%2FSVGedit.js"><span>Get shortened URL</span></a></li><li id="t-urlshortener-qrcode" class="mw-list-item"><a href="/w/index.php?title=Special:QrCode&amp;url=https%3A%2F%2Fcommons.wikimedia.org%2Fwiki%2FUser%3ARillke%2FSVGedit.js"><span>Download QR code</span></a></li>
		</ul>
		
	</div>
</nav>

<nav id="p-coll-print_export" class="mw-portlet mw-portlet-coll-print_export vector-menu-portal portal vector-menu" aria-labelledby="p-coll-print_export-label" role="navigation"  >
	<h3
		id="p-coll-print_export-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Print/export</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="coll-create_a_book" class="mw-list-item"><a href="/w/index.php?title=Special:Book&amp;bookcmd=book_creator&amp;referer=User%3ARillke%2FSVGedit.js"><span>Create a book</span></a></li><li id="coll-download-as-rl" class="mw-list-item"><a href="/w/index.php?title=Special:DownloadAsPdf&amp;page=User%3ARillke%2FSVGedit.js&amp;action=show-download-screen"><span>Download as PDF</span></a></li><li id="t-print" class="mw-list-item"><a href="/w/index.php?title=User:Rillke/SVGedit.js&amp;printable=yes" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li>
		</ul>
		
	</div>
</nav>

	
</div>

</div>

<footer id="footer" class="mw-footer" role="contentinfo" >
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last edited on 29 July 2020, at 07:21.</li>
	<li id="footer-info-copyright">Files are available under licenses specified on their description page. All structured data from the file namespace is available under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" title="Definition of the Creative Commons CC0 License">Creative Commons CC0 License</a>; all unstructured text is available under the <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" title="Definition of the Creative Commons Attribution/Share-Alike License">Creative Commons Attribution-ShareAlike License</a>;
additional terms may apply.
By using this site, you agree to the <a href="//foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Terms_of_Use" title="Wikimedia Foundation Terms of Use">Terms of Use</a> and the <a href="//foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Privacy_policy" title="Wikimedia Foundation Privacy Policy">Privacy Policy</a>.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Privacy_policy">Privacy policy</a></li>
	<li id="footer-places-about"><a href="/wiki/Commons:Welcome">About Wikimedia Commons</a></li>
	<li id="footer-places-disclaimers"><a href="/wiki/Commons:General_disclaimer">Disclaimers</a></li>
	<li id="footer-places-wm-codeofconduct"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Universal_Code_of_Conduct">Code of Conduct</a></li>
	<li id="footer-places-developers"><a href="https://developer.wikimedia.org">Developers</a></li>
	<li id="footer-places-statslink"><a href="https://stats.wikimedia.org/#/commons.wikimedia.org">Statistics</a></li>
	<li id="footer-places-cookiestatement"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Cookie_statement">Cookie statement</a></li>
	<li id="footer-places-mobileview"><a href="//commons.m.wikimedia.org/w/index.php?title=User:Rillke/SVGedit.js&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://wikimediafoundation.org/"><img src="/static/images/footer/wikimedia-button.png" srcset="/static/images/footer/wikimedia-button-1.5x.png 1.5x, /static/images/footer/wikimedia-button-2x.png 2x" width="88" height="31" alt="Wikimedia Foundation" loading="lazy" /></a></li>
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="/static/images/footer/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/static/images/footer/poweredby_mediawiki_132x47.png 1.5x, /static/images/footer/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>


</body>
</html> contentType 9 text/html url 61 https://commons.wikimedia.org:443/wiki/User:Rillke/SVGedit.js responseCode 3 200 