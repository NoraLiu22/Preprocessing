bqtgtofsqkyikmaeqaeksakeacuqgkmczaygjaok length 5 26900 page 26900 <!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Partial Replication/Aggregation &#8212; Cordra  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/minimal-fixes.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tools" href="../tools/index.html" />
    <link rel="prev" title="Neo4j as an Additional Index" href="neo4j-as-an-additional-index.html" />
    <link rel="shortcut icon" href="../_static/img/favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700%7COpen+Sans:300,400,700,800' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Rasa:400,700%7COpen+Sans:300,400,700,800' rel='stylesheet' />
    <link rel="stylesheet" href="../_static/libs/font-awesome/css/font-awesome.min.css"></link>
    <link rel="stylesheet" href="../_static/libs/bootstrap/dist/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="../_static/icons/nucleo.css"></link>
    <link rel="stylesheet" href="../_static/libs/animate.css/animate.min.css"></link>
    <link rel="stylesheet" href="../_static/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="../_static/css/blog.css"></link>
    <link rel="stylesheet" href="../_static/css/buttons.css"></link>
    <link rel="stylesheet" href="../_static/css/colors.css"></link>
    <link rel="stylesheet" href="../_static/css/footers.css"></link>
    <link rel="stylesheet" href="../_static/css/widgets.css"></link>
    <link rel="stylesheet" href="../_static/css/nav.css"></link>
    <link rel="stylesheet" href="../_static/css/preloader.css"></link>
    <link rel="stylesheet" href="../_static/css/custom.css"></link>
    <link rel="stylesheet" href="../_static/css/ui.css"></link>

  </head><body>
<!-- BEGIN LATERAL NAVIGATION -->
<aside id="aside-nav">
    <div id="main-aside-navigation">
        <div class="main-nav-wrapper">
            <div class="close-aside-nav">
                <i class="nc-icon-outline ui-1_simple-remove"></i>
            </div>
            <div id="aside-logo">
                    <a href="/index.html" data-logo-light="../_static/img/cordra-light.png" data-logo-dark="../_static/img/cordra-primary-blue.png">
                    <img width="170" height="166" src="../_static/img/cordra-primary-blue.png" alt="logo">
                </a>
            </div>
            <nav id="main-aside-menu">
                <ul>
                    <li class="submenu">
                        <a href="/cordra.html">What's Cordra?</a>
                    </li>
                    <li class="submenu">
                        <a href="/getstarted.html">Get Started</a>
                    </li>
                    <li class="submenu">
                        <a href="/download.html">Download</a>
                    </li>
                    <li class="submenu">
                        <a href="/documentation/introduction/introduction.html">Developer Resources</a>
                    </li>
                    <li class="submenu">
                        <a href="/standards.html">Standards</a>
                    </li>
                    <li class="submenu">
                        <a href="../search.html">Search</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</aside>
<!-- END LATERAL NAVIGATION -->

<!-- BEGIN MAIN NAVIGATION -->
<header id="header">
    <div id="main-navigation">
        <div class="main-nav-wrapper">
            <div class="container-fluid">
                <div class="nav-left">
                    <div id="logo">
                        <a href="/index.html" data-logo-light="../_static/img/cordra-light.png" data-logo-dark="../_static/img/cordra-primary-blue.png">
                        <img width="145" height="36" src="../_static/img/cordra-primary-blue.png" alt="logo">
                        </a>
                    </div>
                </div>
                <div class="nav-right">
                    <nav id="main-menu">
                        <ul>
                            <li class="mega-menu menu-layouts">
                                <a href="/cordra.html">What's Cordra?</a>
                            </li>
                            <li class="mega-menu menu-layouts">
                                <a href="/getstarted.html">Get Started</a>
                            </li>
                            <li>
                                <a href="/download.html">Download</a>
                            </li>
                            <li class="mega-menu">
                                <a href="/documentation/introduction/introduction.html">Developer Resources</a>
                            </li>
                            <li class="mega-menu">
                                <a href="/standards.html">Standards</a>
                            </li>
                            <li class="mega-menu">
                                <a href="../search.html">Search</a>
                            </li>
                        </ul>
                    </nav>
                    <ul class="nav-tools">
                        <li class="mobile-menu-btn">
                            <button class="toggle-menu" data-toggle="mobile-menu" data-effect="hover">
                                <span class="menu-label label-left">Menu</span>
                                <i class="nc-icon-outline ui-2_menu-35"></i>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- END MAIN NAVIGATION -->


  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://hdl.handle.net/20.1000/129">Developer Resources (in PDF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Cordra Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction to Cordra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/release-notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/system-requirements.html">System Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Application Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/identifiers.html">Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/schemas.html">Schemas/Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/design-object.html">Design Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/payloads.html">Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/authentication-and-access-controls.html">Authentication and Access Controls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/javascript-lifecycle-hooks.html">Lifecycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/type-methods.html">Type Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/java-hooks-and-methods.html">Java Hooks and Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/handle-integration.html">Handle Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/object-versioning.html">Digital Object Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/object-hashing.html">Digital Object Hashing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/doip.html">DOIP and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/doip-api-for-http-clients.html">DOIP API for HTTP Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/rest-api.html">HTTP REST API and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/search.html">Query Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../client/index.html">Clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../client/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/rest-java.html">REST - Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/javascript.html">REST - JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/doip-java.html">DOIP - Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/third-party.html">Third Party Clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/single-instance-deployment.html">Deploying Single-Instance Cordra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/single-instance-production.html">Production Single Instance Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/distributed-deployment.html">Deploying Cordra as a Distributed System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/reindexing.html">Reindexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/logs-management.html">Managing Cordra Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/storage-backends.html">Configuring Storage Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/indexing-backends.html">Configuring Indexing Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/sessions-manager.html">Distributed Sessions Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/user-management.html">Managing Users and Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/admin-user-interface.html">Administrative UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/enabling-tls.html">Enabling TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/https.html">Configuring HTTPS Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/migration.html">Migration across Cordra Environments</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Extensions and Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="calling-java-from-javascript.html">Calling Java from JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="document-repository.html">Document Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="medical-records-application.html">Medical Records Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="person-registry.html">Person Registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-registration.html">User Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="object-linking.html">Digital Object Linking</a></li>
<li class="toctree-l2"><a class="reference internal" href="oai-pmh.html">OAI-PMH in Cordra</a></li>
<li class="toctree-l2"><a class="reference internal" href="sending-emails.html">Sending Emails</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-authentication-provider.html">External Authentication Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="collab-prototype.html">Collab Prototype Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j-as-an-additional-index.html">Neo4j as an Additional Index</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Partial Replication/Aggregation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/import-export.html">Import and Export Tools</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="partial-replication-aggregation">
<span id="id1"></span><h1>Partial Replication/Aggregation<a class="headerlink" href="#partial-replication-aggregation" title="Permalink to this heading">¶</a></h1>
<p>This project demonstrates how to install a module into Cordra that performs partial replication/aggregation from other
Cordra servers.</p>
<p>This is pull-based replication in that the destination Cordra server is the one doing the work of pulling objects from
one or more remote Cordra servers. Which objects are pulled is highly configurable, types of objects can be explicitly
included or excluded. In addition a custom query can be supplied to filter which objects are pulled. One advantage of
this pull-based approach is that it allows the destination Cordra server to have complete control over which objects are
replicated, and when they are replicated. This can be useful in cases where the destination Cordra server has limited
resources, or if the network connection between the two Cordra servers is unreliable.</p>
<p>Replication in this project is performed by using the existing Cordra search API. In short the pulling Cordra
periodically searches each remote Cordra for new or updated objects that match the constructed query. This is made
possible because each object contains a transaction id and that transaction id is indexed and searchable. As such the
pulling Cordra can record the highest transaction id it has seen so far and on the next poll include a range search from
that highest seen transaction id to the latest transaction id.</p>
<section id="installation-instructions">
<h2>Installation Instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this heading">¶</a></h2>
<p>Note that installation and configuration is only performed on the destination Cordra instance. This instance
will pull objects from the source instance. From the source Cordra’s perspective it is responding to ordinary
search and retrieve requests. It may be necessary to add a user account and access control on the source instance.</p>
<ol class="arabic simple">
<li><p>Obtain the file <code class="docutils literal notranslate"><span class="pre">cordra-replication-1.0.0.jar</span></code> from the Cordra download distribution in the <code class="docutils literal notranslate"><span class="pre">extensions/replication</span></code> directory.</p></li>
<li><p>Create a new type in Cordra called CordraReplicationState.</p></li>
</ol>
<p>The JsonSchema for this type is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    &quot;type&quot;: &quot;object&quot;,
    &quot;properties&quot;: {
        &quot;serviceId&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;pollingIntervalSeconds&quot;: {
            &quot;type&quot;: &quot;number&quot;
        },
        &quot;services&quot;: {
            &quot;type&quot;: &quot;array&quot;,
            &quot;items&quot;: {
                &quot;type&quot;: &quot;object&quot;,
                &quot;properties&quot;: {
                    &quot;id&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;baseUri&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;ipAddress&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;port&quot;: {
                        &quot;type&quot;: &quot;number&quot;
                    },
                    &quot;username&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;password&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;protocol&quot;: {
                        &quot;type&quot;: &quot;string&quot;,
                        &quot;enum&quot;: [
                            &quot;DOIP&quot;,
                            &quot;DOIP-HTTP&quot;,
                            &quot;CORDRA-HTTP&quot;
                        ]
                    },
                    &quot;latestTxnId&quot;: {
                        &quot;type&quot;: &quot;number&quot;
                    },
                    &quot;error&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;lastRunTimestamp&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    },
                    &quot;includeTypes&quot;: {
                        &quot;type&quot;: &quot;array&quot;,
                        &quot;items&quot;: {
                            &quot;type&quot;: &quot;string&quot;
                        }
                    },
                    &quot;excludeTypes&quot;: {
                        &quot;type&quot;: &quot;array&quot;,
                        &quot;items&quot;: {
                            &quot;type&quot;: &quot;string&quot;
                        }
                    },
                    &quot;customQuery&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    }
                }
            }
        }
    }
}
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p>Attach the jar file as a payload to the CordraReplicationState Schema object. You must name that payload “java”.</p></li>
<li><p>Configure access control for the type CordraReplicationState such that only your admin user can read and write to objects of that type. This is important as instances of CordraReplicationState contain the credentials used to connect to other Cordra instances.</p></li>
<li><p>Create an instance of the CordraReplicationState type. Give it the following values - change the details as needed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    &quot;pollingIntervalSeconds&quot;: 60,
    &quot;services&quot;: [
        {
            &quot;id&quot;: &quot;test/service&quot;,
            &quot;baseUri&quot;: &quot;https://10.0.1.157:8443/doip/&quot;,
            &quot;ipAddress&quot;: &quot;10.0.1.157&quot;,
            &quot;port&quot;: 9000,
            &quot;username&quot;: &quot;admin&quot;,
            &quot;password&quot;: &quot;password&quot;,
            &quot;protocol&quot;: &quot;DOIP&quot;,
            &quot;excludeTypes&quot;: [
                &quot;Schema&quot;
            ]
        }
    ]
}
</pre></div>
</div>
</li>
</ol>
<p>“pollingIntervalSeconds”: Number of seconds to wait between the end of one replication process and starting the next.</p>
<p>The “services” property holds an array of objects where each object describes how to connect to another Cordra service
that this Cordra will be pulling from.</p>
<p>“id”: The id of the service being pulled from.</p>
<p>“baseUri”: The base URI of the remote Cordra to use if connecting via DOIP-HTTP or CORDRA-HTTP protocols.</p>
<p>“ipAddress”: The ip address of the remote Cordra to use if connecting via the binary DOIP protocol.</p>
<p>“port”: The port of the remote Cordra to use if connecting via the binary DOIP protocol.</p>
<p>“username”: The username to use when talking to this remote Cordra.</p>
<p>“password”: The password to use when talking to this remote Cordra.</p>
<p>“protocol”: The protocol to use when talking to this remote Cordra. May be “DOIP”, “DOIP-HTTP”, “CORDRA-HTTP”.</p>
<p>“excludeTypes”: Types of Cordra objects to be be excluded when pulling from this remote Cordra.</p>
<p>“includeType”: (Optional) Types of Cordra objects to be be excluded when pulling from this remote Cordra.</p>
<p>“customQuery”: (Optional) A custom query that will be ANDed into the replication query when pulling new objects.</p>
</section>
<section id="behavior">
<h2>Behavior<a class="headerlink" href="#behavior" title="Permalink to this heading">¶</a></h2>
<p>In order to demonstrate the replication behavior:</p>
<ol class="arabic simple">
<li><p>Run a source Cordra.</p></li>
<li><p>Run a destination Cordra, configured with CordraReplicationState as above, with the source Cordra a service to be pulled from.</p></li>
</ol>
<p>Any objects (except of types excluded by the configuration in the destination Cordra’s CordraReplicationState)
which are created or updated in the source Cordra will be replicated into the destination Cordra, after
at most the time interval in the configured pollingIntervalSeconds.</p>
</section>
<section id="custom-operations">
<h2>Custom Operations<a class="headerlink" href="#custom-operations" title="Permalink to this heading">¶</a></h2>
<p>The CordraReplicationState type comes with two custom operations, “start” and “stop”. These can be used to pause and
resume replication while Cordra is running.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>

<!-- BEGIN FOOTER -->
<footer id="footer">
    <div id="footer-main" class="container-large">
        <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-4">
                <div class="widget widget-text">
                    <h3 class="widget-title">Who are we?</h3>
                    <!-- <img width="200" height="50" class="footer-logo" src="_static/img/logo/cordra-light.png" alt="logo"> -->
                    <p>CNRI is a not-for-profit organization formed in 1986 to undertake, foster, and promote research on information infrastructure in the public interest.</p>
                    <p><i class="nc-icon-outline ui-1_home-minimal"></i> Corporation for National Research Initiatives</p>
                    <p><i class="nc-icon-outline location_position-marker"></i> 1895 Preston White Drive, Suite 100, Reston, Virginia 20191, USA</p>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 hidden-xs-down">
                <div class="widget widget-links">
                    <div class="widget-title">
                        <h3 class="widget-title">Quick Links</h3>
                    </div>
                    <ul>
                        <li>
                            <a href="/cordra.html">What's Cordra</a>
                        </li>
                        <li>
                            <a href="/download.html">Download</a>
                        </li>
                        <li>
                            <a href="/documentation/introduction/introduction.html">Developer Resources</a>
                        </li>
                        <li>
                            <a href="/download.html#section-licenses">Licenses</a>
                        </li>
                        <li>
                            <a href="/privacypolicy.html">Privacy Policy</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 hidden-md-down">
                <div class="widget">
                    <h3 class="widget-title">Contact Us</h3>
                    <p>Drop us an
                        <span class="f-18 c-white w-700 font-handwriting">
                            <a href="#" onclick="document.getElementById('emailAddress').style.display = 'block'; return false;" class="c-white">email.</a>
                            <span id="emailAddress" style="display: none;" class="c-white text-sm w-100">support@cordra.org</span>
                        </span>
                    </p>
                    <p>Join us on <a href="https://hdl.handle.net/20.5000/cordra-slack" target="_blank"><img width="100px" height="100px" src="../_static/img/slack_white.png" alt="Slack" class="m-l--10" /></a><span
                            class="f-18 c-white w-700 font-handwriting m-l--10">.</span></p>
                </div>
            </div>
        </div>
    </div>
    <div id="footer-bottom">
        <div class="container-large">
            <div class="row">
                <div class="col-sm-12 t-center">
                    <p class="copyright">Copyright&copy; 2020. Corporation for National Resesarch Initiatives. Cordra&reg; is a trademark of Corporation for National Research Initiatives.</p>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- END FOOTER -->

  </body>
</html> contentType 9 text/html url 88 https://www.cordra.org:443/documentation/extensions/partial-replication-aggregation.html responseCode 3 200 