cmziksuisqracmmobqvswolkjmamqcfcpipehepa length 5 36134 page 36134 <!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Deploying Single-Instance Cordra &#8212; Cordra  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/minimal-fixes.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Production Single Instance Deployment" href="single-instance-production.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
    <link rel="shortcut icon" href="../_static/img/favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700%7COpen+Sans:300,400,700,800' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Rasa:400,700%7COpen+Sans:300,400,700,800' rel='stylesheet' />
    <link rel="stylesheet" href="../_static/libs/font-awesome/css/font-awesome.min.css"></link>
    <link rel="stylesheet" href="../_static/libs/bootstrap/dist/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="../_static/icons/nucleo.css"></link>
    <link rel="stylesheet" href="../_static/libs/animate.css/animate.min.css"></link>
    <link rel="stylesheet" href="../_static/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="../_static/css/blog.css"></link>
    <link rel="stylesheet" href="../_static/css/buttons.css"></link>
    <link rel="stylesheet" href="../_static/css/colors.css"></link>
    <link rel="stylesheet" href="../_static/css/footers.css"></link>
    <link rel="stylesheet" href="../_static/css/widgets.css"></link>
    <link rel="stylesheet" href="../_static/css/nav.css"></link>
    <link rel="stylesheet" href="../_static/css/preloader.css"></link>
    <link rel="stylesheet" href="../_static/css/custom.css"></link>
    <link rel="stylesheet" href="../_static/css/ui.css"></link>

  </head><body>
<!-- BEGIN LATERAL NAVIGATION -->
<aside id="aside-nav">
    <div id="main-aside-navigation">
        <div class="main-nav-wrapper">
            <div class="close-aside-nav">
                <i class="nc-icon-outline ui-1_simple-remove"></i>
            </div>
            <div id="aside-logo">
                    <a href="/index.html" data-logo-light="../_static/img/cordra-light.png" data-logo-dark="../_static/img/cordra-primary-blue.png">
                    <img width="170" height="166" src="../_static/img/cordra-primary-blue.png" alt="logo">
                </a>
            </div>
            <nav id="main-aside-menu">
                <ul>
                    <li class="submenu">
                        <a href="/cordra.html">What's Cordra?</a>
                    </li>
                    <li class="submenu">
                        <a href="/getstarted.html">Get Started</a>
                    </li>
                    <li class="submenu">
                        <a href="/download.html">Download</a>
                    </li>
                    <li class="submenu">
                        <a href="/documentation/introduction/introduction.html">Developer Resources</a>
                    </li>
                    <li class="submenu">
                        <a href="/standards.html">Standards</a>
                    </li>
                    <li class="submenu">
                        <a href="../search.html">Search</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</aside>
<!-- END LATERAL NAVIGATION -->

<!-- BEGIN MAIN NAVIGATION -->
<header id="header">
    <div id="main-navigation">
        <div class="main-nav-wrapper">
            <div class="container-fluid">
                <div class="nav-left">
                    <div id="logo">
                        <a href="/index.html" data-logo-light="../_static/img/cordra-light.png" data-logo-dark="../_static/img/cordra-primary-blue.png">
                        <img width="145" height="36" src="../_static/img/cordra-primary-blue.png" alt="logo">
                        </a>
                    </div>
                </div>
                <div class="nav-right">
                    <nav id="main-menu">
                        <ul>
                            <li class="mega-menu menu-layouts">
                                <a href="/cordra.html">What's Cordra?</a>
                            </li>
                            <li class="mega-menu menu-layouts">
                                <a href="/getstarted.html">Get Started</a>
                            </li>
                            <li>
                                <a href="/download.html">Download</a>
                            </li>
                            <li class="mega-menu">
                                <a href="/documentation/introduction/introduction.html">Developer Resources</a>
                            </li>
                            <li class="mega-menu">
                                <a href="/standards.html">Standards</a>
                            </li>
                            <li class="mega-menu">
                                <a href="../search.html">Search</a>
                            </li>
                        </ul>
                    </nav>
                    <ul class="nav-tools">
                        <li class="mobile-menu-btn">
                            <button class="toggle-menu" data-toggle="mobile-menu" data-effect="hover">
                                <span class="menu-label label-left">Menu</span>
                                <i class="nc-icon-outline ui-2_menu-35"></i>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- END MAIN NAVIGATION -->


  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://hdl.handle.net/20.1000/129">Developer Resources (in PDF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Cordra Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html">Introduction to Cordra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/release-notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/system-requirements.html">System Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Application Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/identifiers.html">Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/schemas.html">Schemas/Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/design-object.html">Design Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/payloads.html">Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/authentication-and-access-controls.html">Authentication and Access Controls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/javascript-lifecycle-hooks.html">Lifecycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/type-methods.html">Type Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/java-hooks-and-methods.html">Java Hooks and Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/handle-integration.html">Handle Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/object-versioning.html">Digital Object Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/object-hashing.html">Digital Object Hashing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/doip.html">DOIP and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/doip-api-for-http-clients.html">DOIP API for HTTP Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/rest-api.html">HTTP REST API and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/search.html">Query Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../client/index.html">Clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../client/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/rest-java.html">REST - Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/javascript.html">REST - JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/doip-java.html">DOIP - Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/third-party.html">Third Party Clients</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deploying Single-Instance Cordra</a></li>
<li class="toctree-l2"><a class="reference internal" href="single-instance-production.html">Production Single Instance Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed-deployment.html">Deploying Cordra as a Distributed System</a></li>
<li class="toctree-l2"><a class="reference internal" href="reindexing.html">Reindexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs-management.html">Managing Cordra Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="storage-backends.html">Configuring Storage Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing-backends.html">Configuring Indexing Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="sessions-manager.html">Distributed Sessions Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-management.html">Managing Users and Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin-user-interface.html">Administrative UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="enabling-tls.html">Enabling TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="https.html">Configuring HTTPS Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration.html">Migration across Cordra Environments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extensions/index.html">Extensions and Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../extensions/calling-java-from-javascript.html">Calling Java from JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/document-repository.html">Document Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/medical-records-application.html">Medical Records Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/person-registry.html">Person Registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/user-registration.html">User Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/object-linking.html">Digital Object Linking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/oai-pmh.html">OAI-PMH in Cordra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/sending-emails.html">Sending Emails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/external-authentication-provider.html">External Authentication Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/collab-prototype.html">Collab Prototype Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/neo4j-as-an-additional-index.html">Neo4j as an Additional Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/partial-replication-aggregation.html">Partial Replication/Aggregation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/import-export.html">Import and Export Tools</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="deploying-single-instance-cordra">
<span id="single-instance-deployment"></span><h1>Deploying Single-Instance Cordra<a class="headerlink" href="#deploying-single-instance-cordra" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="in-this-section">
<p class="topic-title">In This Section</p>
<ul class="simple">
<li><p><a class="reference internal" href="#software-distribution-details" id="id1">Software Distribution Details</a></p></li>
<li><p><a class="reference internal" href="#locally-run-instance" id="id2">Locally Run Instance</a></p>
<ul>
<li><p><a class="reference internal" href="#deploying-using-apache-tomcat" id="id3">Deploying Using Apache Tomcat</a></p>
<ul>
<li><p><a class="reference internal" href="#configuring-tomcat-for-graalvm-javascript-compilation" id="id4">Configuring Tomcat for GraalVM JavaScript Compilation</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#docker-instance" id="id5">Docker Instance</a></p>
<ul>
<li><p><a class="reference internal" href="#pre-configured-cordra-distribution" id="id6">Pre-configured Cordra Distribution</a></p></li>
<li><p><a class="reference internal" href="#deploying-using-docker-compose" id="id7">Deploying using Docker Compose</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-configuration" id="id8">Additional Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#production-considerations" id="id9">Production Considerations</a></p></li>
<li><p><a class="reference internal" href="#external-indexing-and-storage" id="id10">External Indexing and Storage</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="software-distribution-details">
<h2>Software Distribution Details<a class="headerlink" href="#software-distribution-details" title="Permalink to this heading">¶</a></h2>
<p>The Cordra software can be downloaded from <a class="reference external" href="https://www.cordra.org">here</a>. There are
two options available: One which is pre-configured to use our hosted identifier (aka handle)
service for a trial that allows digital objects to be locatable in the Internet, and one which
you can configure to use your own handle server at a later point when you deem it is important for your users to auto
locate digital objects. For more information about the Handle technology and setting up a handle server, please see
<a class="reference external" href="https://handle.net/download_hnr.html">here</a> .</p>
<p>For most users evaluating Cordra, we recommend trialing the hosted handle service by requesting a pre-configured
Cordra software distribution. See <a class="reference external" href="https://www.cordra.org/download.html">here</a> for details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pre-configured Cordra software distribution includes a handle prefix and a necessary key pair
useful for a quick start. We strongly recommend that you update the key pair if security is important
during the trial.</p>
</div>
</section>
<section id="locally-run-instance">
<span id="local-single-deploy"></span><h2>Locally Run Instance<a class="headerlink" href="#locally-run-instance" title="Permalink to this heading">¶</a></h2>
<p>Before starting Cordra for the first time, the admin password needs to be set in a <code class="docutils literal notranslate"><span class="pre">repoInit.json</span></code> file
under the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory.  This file should also contain the desired handle prefix, from which the unique
identifiers will be generated; if the prefix is omitted, the prefix <code class="docutils literal notranslate"><span class="pre">test</span></code> will be used by default to create objects.</p>
<p>Pre-configured Cordra software distribution downloaded from the Cordra website includes the prefix,
but admin password must be set prior to starting Cordra for the first time.</p>
<p>Example <code class="docutils literal notranslate"><span class="pre">data/repoInit.json</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    &quot;adminPassword&quot;: &quot;changeit&quot;,
    &quot;prefix&quot;: &quot;20.5000.123.TEST&quot;
}
</pre></div>
</div>
<p>Once data/repoInit.json is in place, you can start Cordra with the <code class="docutils literal notranslate"><span class="pre">startup</span></code> script, and stop it with the <code class="docutils literal notranslate"><span class="pre">shutdown</span></code>
script.</p>
<p>When Cordra starts, the admin password will be securely stored in the system and the <code class="docutils literal notranslate"><span class="pre">repoInit.json</span></code> file will be
deleted. The admin password can then be changed using the UI while signed in as admin.</p>
<p>Cordra can be started by running the <code class="docutils literal notranslate"><span class="pre">startup</span></code> script in the distribution directory. The Cordra UI will be
available at <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a> and <a class="reference external" href="https://localhost:8443">https://localhost:8443</a>. You can sign in as admin in order to further configure
your Cordra server, if desired.</p>
<p>Except on Java 8, the GraalVM JavaScript engine used by JavaScript lifecycle hooks and methods
supports compilation for improved performance.  Certain JAR files for GraalVM compilation
are not distributed with Cordra.  To acquire these JAR files, you can use the <code class="docutils literal notranslate"><span class="pre">bin/fetch-graalvm-compiler-jars</span></code> script.</p>
<p>Cordra can by stopped by running the <code class="docutils literal notranslate"><span class="pre">shutdown</span></code> script.</p>
<section id="deploying-using-apache-tomcat">
<h3>Deploying Using Apache Tomcat<a class="headerlink" href="#deploying-using-apache-tomcat" title="Permalink to this heading">¶</a></h3>
<p>The Cordra software can be run using a servlet container instead of running in a standalone fashion as described above.
The details below describe how to run Cordra using Apache Tomcat.</p>
<p>The Cordra war file is located in the Cordra distribution at <code class="docutils literal notranslate"><span class="pre">sw/webapps-priority/cordra.war</span></code>. It can be renamed to
<code class="docutils literal notranslate"><span class="pre">ROOT.war</span></code>, for instance, if desired.
(Note that <code class="docutils literal notranslate"><span class="pre">sw/webapps-priority/ROOT.war</span></code> in the Cordra distribution is included simply to forward requests
to <code class="docutils literal notranslate"><span class="pre">cordra.war</span></code> by default.)</p>
<p>You should copy the war file into the Tomcat <code class="docutils literal notranslate"><span class="pre">webapps</span></code> directory,</p>
<p>The only change needed from a default Tomcat installation is to specify the Cordra data directory. This is done using
Java system properties, which can be set in Tomcat via an environment variable <code class="docutils literal notranslate"><span class="pre">CATALINA_OPTS</span></code>. This setting can be
set using the file <code class="docutils literal notranslate"><span class="pre">bin/setenv.sh</span></code> which can be created as a sibling of <code class="docutils literal notranslate"><span class="pre">bin/catalina.sh</span></code>. Ensure
that <code class="docutils literal notranslate"><span class="pre">bin/setenv.sh</span></code> has the following contents:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CATALINA_OPTS=&quot;-Dcordra.data=/path/to/cordra/datadir ${CATALINA_OPTS}&quot;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CATALINA_OPTS</span></code> can also be used to specify memory configuration, such as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CATALINA_OPTS=&quot;-Xmx2G -Dcordra.data=/path/to/cordra/datadir ${CATALINA_OPTS}&quot;
</pre></div>
</div>
<p>Logging can be configured with a <code class="docutils literal notranslate"><span class="pre">log4j2.xml</span></code> file in the <code class="docutils literal notranslate"><span class="pre">cordra.data</span></code> directory.</p>
<p>Note: we recommend adding the following attributes to the Connector configuration in server.xml:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>relaxedPathChars=&quot;[]|{}^&amp;#x5c;&amp;#x60;&amp;quot;&amp;lt;&amp;gt;&quot; relaxedQueryChars=&quot;[]|{}^&amp;#x5c;&amp;#x60;&amp;quot;&amp;lt;&amp;gt;&quot;
</pre></div>
</div>
<p>This prevents Tomcat from giving errors if certain characters are used unencoded in URLs.
Additionally we recommend in catalina.properties:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>org.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=true
org.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH=true
</pre></div>
</div>
<section id="configuring-tomcat-for-graalvm-javascript-compilation">
<span id="tomcat-graalvm-javascript-compilation"></span><h4>Configuring Tomcat for GraalVM JavaScript Compilation<a class="headerlink" href="#configuring-tomcat-for-graalvm-javascript-compilation" title="Permalink to this heading">¶</a></h4>
<p>Except on Java 8, the GraalVM JavaScript engine used by JavaScript lifecycle hooks and methods
supports compilation for improved performance.  To enable this on Tomcat, copy the files from the Cordra
distribution in <code class="docutils literal notranslate"><span class="pre">sw/lib/graalvm</span></code>, and also the non-distributed files which can be downloaded using
the script <code class="docutils literal notranslate"><span class="pre">bin/fetch-graalvm-compiler-jars</span></code>,
to a directory accessible to Tomcat; in the following we assume they
are in a directory <code class="docutils literal notranslate"><span class="pre">graalvm</span></code> which is a sibling of <code class="docutils literal notranslate"><span class="pre">webapps</span></code>.  Then ensure that <code class="docutils literal notranslate"><span class="pre">bin/setenv.sh</span></code>
has the following contents (in addition to the setting of cordra.data described above):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CATALINA_OPTS=&quot;-XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI --upgrade-module-path=$CATALINA_BASE/graalvm ${CATALINA_OPTS}&quot;
</pre></div>
</div>
<p>Finally add to <code class="docutils literal notranslate"><span class="pre">conf/context.xml</span></code>, under <code class="docutils literal notranslate"><span class="pre">&lt;Context&gt;</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Loader delegate=&quot;true&quot;/&gt;
</pre></div>
</div>
<p>(If for some reason adding the <code class="docutils literal notranslate"><span class="pre">Loader</span></code> configuration is not desired, an alternative is to remove
those JAR files from the Cordra webapp’s <code class="docutils literal notranslate"><span class="pre">WEB-INF/lib</span></code> directory which are also found in
<code class="docutils literal notranslate"><span class="pre">graalvm</span></code>.)</p>
</section>
</section>
</section>
<section id="docker-instance">
<span id="docker-single-deploy"></span><h2>Docker Instance<a class="headerlink" href="#docker-instance" title="Permalink to this heading">¶</a></h2>
<p>The Cordra distribution comes with the files necessary to build a Docker image that includes the Cordra software
distribution.</p>
<p>There are four environment variables that can be set for the Docker image:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CORDRA_ADMIN_PASS</span></code> (REQUIRED) - password for the admin user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORDRA_BASE_URI</span></code> - base uri for this Cordra HTTP API endpoint</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORDRA_PREFIX</span></code> - Handle prefix to use</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORDRA_HDL_ADMIN</span></code> - Handle admin for the prefix</p></li>
</ul>
<p>These variables can be set on the command line, or in the <code class="docutils literal notranslate"><span class="pre">variables.env</span></code> file located in the <code class="docutils literal notranslate"><span class="pre">docker</span></code> folder.</p>
<p>To build the Docker image, use the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker build -t cordra -f docker/Dockerfile .
</pre></div>
</div>
<p>You can start Cordra using the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run -it -p8080:8080 -p8443:8443 -p2641:2641 -p9000:9000 --env-file docker/variables.env cordra
</pre></div>
</div>
<p>To persist the Cordra data directory, the following command can be used.  Note that the <code class="docutils literal notranslate"><span class="pre">&quot;$(pwd)&quot;/data</span></code> directory
must exist in order for this command to work:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run -it -p8080:8080 -p8443:8443 -p2641:2641 -p9000:9000 \
        --env-file docker/variables.env \
        --mount type=bind,source=&quot;$(pwd)&quot;/data,target=/opt/cordra/data \
        cordra
</pre></div>
</div>
<section id="pre-configured-cordra-distribution">
<span id="docker-single-deploy-preconfigured"></span><h3>Pre-configured Cordra Distribution<a class="headerlink" href="#pre-configured-cordra-distribution" title="Permalink to this heading">¶</a></h3>
<p>If you have downloaded a pre-configured Cordra distribution from the Cordra website, the package will include
<code class="docutils literal notranslate"><span class="pre">variables.env</span></code> file with the CORDRA_PREFIX and CORDRA_HDL_ADMIN variables populated. You should edit that file
to fill in values for other environment variables including the admin password.</p>
<p>You can then build and run the Docker image as described above.</p>
</section>
<section id="deploying-using-docker-compose">
<h3>Deploying using Docker Compose<a class="headerlink" href="#deploying-using-docker-compose" title="Permalink to this heading">¶</a></h3>
<p>You may also use Docker compose to modify the Docker image built using the above instructions further. This is useful
if you need to include the key pair your Cordra will use, or if you would like to modify the config.json file. There is a
sample <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> configuration file included that shows how to start a single instance of Cordra.</p>
<p>You can start Cordra by running this command from inside the <code class="docutils literal notranslate"><span class="pre">docker</span></code> subdirectory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker-compose up
</pre></div>
</div>
</section>
</section>
<section id="additional-configuration">
<h2>Additional Configuration<a class="headerlink" href="#additional-configuration" title="Permalink to this heading">¶</a></h2>
<p>There are a number of configuration options available for deploying Cordra. To learn more, see
<a class="reference internal" href="introduction.html#configuration-introduction"><span class="std std-ref">here</span></a>.</p>
<section id="production-considerations">
<h3>Production Considerations<a class="headerlink" href="#production-considerations" title="Permalink to this heading">¶</a></h3>
<p>To deploy a single-instance Cordra in for productions, you will want to configure Cordra as a service. You will also
likely want to put a reverse proxy in front of Cordra. For an example of how such a deployment might look, see
<a class="reference internal" href="single-instance-production.html#single-instance-production"><span class="std std-ref">Production Single Instance Deployment</span></a>.</p>
</section>
<section id="external-indexing-and-storage">
<h3>External Indexing and Storage<a class="headerlink" href="#external-indexing-and-storage" title="Permalink to this heading">¶</a></h3>
<p>Cordra can be configured to use external indexing and storage services by editing the <code class="docutils literal notranslate"><span class="pre">data/config.json</span></code> file in the Cordra
distribution. An example might look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    &quot;httpPort&quot;: 8080,
    &quot;listenAddress&quot;: &quot;0.0.0.0&quot;,

    &quot;index&quot; : {
        &quot;module&quot; : &quot;elasticsearch&quot;,
        &quot;options&quot; : {
            &quot;address&quot; : &quot;localhost&quot;,
            &quot;port&quot;    : &quot;9200&quot;,
            &quot;addressScheme&quot;  : &quot;http&quot;,
            &quot;index.mapping.total_fields.limit&quot;: &quot;2000&quot;
        }
    }

    &quot;storage&quot; : {
        &quot;module&quot; : &quot;s3&quot;,
        &quot;options&quot; : {
            &quot;accessKey&quot; : &quot;XXXXXXXXXXXXX&quot;,
            &quot;secretKey&quot;    : &quot;XXXXXXXXXXXXX&quot;,
            &quot;bucketName&quot;  : &quot;test.cordra.org&quot;,
            &quot;s3KeyPrefix&quot;: &quot;testing1234&quot;,
            &quot;region&quot;: &quot;us-east-1&quot;
        }
    }
}
</pre></div>
</div>
<p>For more details on configuring external storage and indexing services, see <a class="reference internal" href="storage-backends.html#storage-configuration"><span class="std std-ref">Configuring Storage Backend</span></a> and <a class="reference internal" href="indexing-backends.html#indexing-configuration"><span class="std std-ref">Configuring Indexing Backend</span></a>.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>

<!-- BEGIN FOOTER -->
<footer id="footer">
    <div id="footer-main" class="container-large">
        <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-4">
                <div class="widget widget-text">
                    <h3 class="widget-title">Who are we?</h3>
                    <!-- <img width="200" height="50" class="footer-logo" src="_static/img/logo/cordra-light.png" alt="logo"> -->
                    <p>CNRI is a not-for-profit organization formed in 1986 to undertake, foster, and promote research on information infrastructure in the public interest.</p>
                    <p><i class="nc-icon-outline ui-1_home-minimal"></i> Corporation for National Research Initiatives</p>
                    <p><i class="nc-icon-outline location_position-marker"></i> 1895 Preston White Drive, Suite 100, Reston, Virginia 20191, USA</p>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 hidden-xs-down">
                <div class="widget widget-links">
                    <div class="widget-title">
                        <h3 class="widget-title">Quick Links</h3>
                    </div>
                    <ul>
                        <li>
                            <a href="/cordra.html">What's Cordra</a>
                        </li>
                        <li>
                            <a href="/download.html">Download</a>
                        </li>
                        <li>
                            <a href="/documentation/introduction/introduction.html">Developer Resources</a>
                        </li>
                        <li>
                            <a href="/download.html#section-licenses">Licenses</a>
                        </li>
                        <li>
                            <a href="/privacypolicy.html">Privacy Policy</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 hidden-md-down">
                <div class="widget">
                    <h3 class="widget-title">Contact Us</h3>
                    <p>Drop us an
                        <span class="f-18 c-white w-700 font-handwriting">
                            <a href="#" onclick="document.getElementById('emailAddress').style.display = 'block'; return false;" class="c-white">email.</a>
                            <span id="emailAddress" style="display: none;" class="c-white text-sm w-100">support@cordra.org</span>
                        </span>
                    </p>
                    <p>Join us on <a href="https://hdl.handle.net/20.5000/cordra-slack" target="_blank"><img width="100px" height="100px" src="../_static/img/slack_white.png" alt="Slack" class="m-l--10" /></a><span
                            class="f-18 c-white w-700 font-handwriting m-l--10">.</span></p>
                </div>
            </div>
        </div>
    </div>
    <div id="footer-bottom">
        <div class="container-large">
            <div class="row">
                <div class="col-sm-12 t-center">
                    <p class="copyright">Copyright&copy; 2020. Corporation for National Resesarch Initiatives. Cordra&reg; is a trademark of Corporation for National Research Initiatives.</p>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- END FOOTER -->

  </body>
</html> contentType 9 text/html url 86 https://www.cordra.org:443/documentation/configuration/single-instance-deployment.html responseCode 3 200 