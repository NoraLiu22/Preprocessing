mkxihqnmjaoknofgtklskawilmxetorogqqkoezg length 6 148048 page 148048 <!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-clientpref-0 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Switch Datacenter - Wikitech</title>
<script>(function(){var className="client-js vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-clientpref-0 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available";var cookie=document.cookie.match(/(?:^|; )labswikimwclientpreferences=([^;]+)/);if(cookie){cookie[1].split('%2C').forEach(function(pref){className=className.replace(new RegExp('(^| )'+pref.replace(/-clientpref-\w+$|[^\w-]+/g,'')+'-clientpref-\\w+( |$)'),'$1'+pref+'$2');});}document.documentElement.className=className;}());RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],
"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"c4869b95-f764-4160-aecc-0b80f357ed49","wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Switch_Datacenter","wgTitle":"Switch Datacenter","wgCurRevisionId":2164096,"wgRevisionId":2164096,"wgArticleId":56257,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["SRE Service Operations"],"wgPageViewLanguage":"en","wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Switch_Datacenter","wgRelevantArticleId":56257,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgMediaViewerOnClick":true,"wgMediaViewerEnabledByDefault":true,"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr",
"pageVariantFallbacks":"en"},"wgMFDisplayWikibaseDescriptions":{"search":true,"watchlist":true,"tagline":false,"nearby":true},"wgWMESchemaEditAttemptStepOversample":false,"wgWMEPageLength":40000,"wgULSCurrentAutonym":"English","wgEditSubmitButtonLabelPublish":true,"wgDiscussionToolsFeaturesEnabled":{"replytool":true,"newtopictool":true,"sourcemodetoolbar":true,"topicsubscription":false,"autotopicsub":false,"visualenhancements":false,"visualenhancements_reply":false,"visualenhancements_pageframe":false},"wgDiscussionToolsFallbackEditMode":"visual","wgULSPosition":"personal","wgULSisCompactLinksEnabled":false,"wgVector2022LanguageInHeader":true,"wgULSisLanguageSelectorEmpty":false,"wgCheckUserClientHintsHeadersJsApi":["architecture","bitness","brands","fullVersionList","mobile","model","platform","platformVersion"],"wgSiteNoticeId":"2.0"};RLSTATE={"skins.vector.user.styles":"ready","ext.gadget.enwp-boxes":"ready","site.styles":"ready","user.styles":"ready","skins.vector.user":"ready",
"user":"ready","user.options":"loading","ext.pygments":"ready","ext.discussionTools.init.styles":"ready","oojs-ui-core.styles":"ready","oojs-ui.styles.indicators":"ready","mediawiki.widgets.styles":"ready","oojs-ui-core.icons":"ready","skins.vector.search.codex.styles":"ready","skins.vector.styles":"ready","skins.vector.icons":"ready","ext.wikimediamessages.styles":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready","ext.uls.pt":"ready","ext.dismissableSiteNotice.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.vector.js","ext.gadget.site","mmv.head","mmv.bootstrap.autostart","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader","ext.discussionTools.init","ext.eventLogging","ext.wikimediaEvents","ext.uls.interface","ext.checkUser.clientHints","ext.dismissableSiteNotice"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.impl(function(){return["user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
}];});});</script>
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=ext.discussionTools.init.styles%7Cext.dismissableSiteNotice.styles%7Cext.pygments%7Cext.uls.pt%7Cext.visualEditor.desktopArticleTarget.noscript%7Cext.wikimediamessages.styles%7Cmediawiki.widgets.styles%7Coojs-ui-core.icons%2Cstyles%7Coojs-ui.styles.indicators%7Cskins.vector.icons%2Cstyles%7Cskins.vector.search.codex.styles&amp;only=styles&amp;skin=vector-2022">
<script async="" src="/w/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector-2022"></script>
<meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=ext.gadget.enwp-boxes&amp;only=styles&amp;skin=vector-2022">
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector-2022">
<meta name="generator" content="MediaWiki 1.43.0-wmf.2">
<meta name="referrer" content="origin">
<meta name="referrer" content="origin-when-cross-origin">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1000">
<meta property="og:title" content="Switch Datacenter - Wikitech">
<meta property="og:type" content="website">
<link rel="preconnect" href="//upload.wikimedia.org">
<link rel="icon" href="/static/favicon/wikitech.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikitech (en)">
<link rel="EditURI" type="application/rsd+xml" href="//wikitech.wikimedia.org/w/api.php?action=rsd">
<link rel="canonical" href="https://wikitech.wikimedia.org/wiki/Switch_Datacenter">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="Wikitech Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="ext-discussiontools-replytool-enabled ext-discussiontools-newtopictool-enabled ext-discussiontools-sourcemodetoolbar-enabled skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Switch_Datacenter rootpage-Switch_Datacenter skin-vector-2022 action-view"><a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	<header class="vector-header mw-header">
		<div class="vector-header-start">
			<nav class="vector-main-menu-landmark" aria-label="Site" role="navigation">
				
<div id="vector-main-menu-dropdown" class="vector-dropdown vector-main-menu-dropdown vector-button-flush-left vector-button-flush-right"  >
	<input type="checkbox" id="vector-main-menu-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-main-menu-dropdown" class="vector-dropdown-checkbox "  aria-label="Main menu"  >
	<label id="vector-main-menu-dropdown-label" for="vector-main-menu-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"  ><span class="vector-icon mw-ui-icon-menu mw-ui-icon-wikimedia-menu"></span>

<span class="vector-dropdown-label-text">Main menu</span>
	</label>
	<div class="vector-dropdown-content">


				<div id="vector-main-menu-unpinned-container" class="vector-unpinned-container">
		
<div id="vector-main-menu" class="vector-main-menu vector-pinnable-element">
	<div
	class="vector-pinnable-header vector-main-menu-pinnable-header vector-pinnable-header-unpinned"
	data-feature-name="main-menu-pinned"
	data-pinnable-element-id="vector-main-menu"
	data-pinned-container-id="vector-main-menu-pinned-container"
	data-unpinned-container-id="vector-main-menu-unpinned-container"
>
	<div class="vector-pinnable-header-label">Main menu</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-main-menu.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-main-menu.unpin">hide</button>
</div>

	
<div id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation"  >
	<div class="vector-menu-heading">
		Navigation
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-mainpage-description" class="mw-list-item"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z"><span>Main page</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li><li id="n-Server-admin-log:-Prod" class="mw-list-item"><a href="/wiki/Server_Admin_Log"><span>Server admin log: Prod</span></a></li><li id="n-Admin-log:-RelEng" class="mw-list-item"><a href="/wiki/Release_Engineering/SAL"><span>Admin log: RelEng</span></a></li><li id="n-Incident-status" class="mw-list-item"><a href="/wiki/Incident_status"><span>Incident status</span></a></li><li id="n-Deployments" class="mw-list-item"><a href="/wiki/Deployments"><span>Deployments</span></a></li><li id="n-SRE-Team-Help" class="mw-list-item"><a href="/wiki/SRE/SRE_Team_requests"><span>SRE Team Help</span></a></li>
		</ul>
		
	</div>
</div>

	
	
<div id="p-Cloud_VPS_&amp;_Toolforge" class="vector-menu mw-portlet mw-portlet-Cloud_VPS_Toolforge"  >
	<div class="vector-menu-heading">
		Cloud VPS &amp; Toolforge
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-Cloud-VPS-portal" class="mw-list-item"><a href="/wiki/Portal:Cloud_VPS"><span>Cloud VPS portal</span></a></li><li id="n-Toolforge-portal" class="mw-list-item"><a href="/wiki/Portal:Toolforge"><span>Toolforge portal</span></a></li><li id="n-Request-VPS-project" class="mw-list-item"><a href="https://phabricator.wikimedia.org/project/view/2875/"><span>Request VPS project</span></a></li><li id="n-Admin-log:-Cloud-VPS" class="mw-list-item"><a href="/wiki/Cloud_VPS_Server_Admin_Log"><span>Admin log: Cloud VPS</span></a></li>
		</ul>
		
	</div>
</div>

</div>

				</div>

	</div>
</div>

		</nav>
			
<a href="/wiki/Main_Page" class="mw-logo">
	<img class="mw-logo-icon" src="/static/images/icons/wikitech.svg" alt="" aria-hidden="true" height="50" width="50">
	<span class="mw-logo-container">
		<img class="mw-logo-wordmark" alt="Wikitech" src="/static/images/mobile/copyright/wikitech-wordmark.svg" style="width: 8.75em; height: 1.6875em;">
	</span>
</a>

		</div>
		<div class="vector-header-end">
			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-collapses vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<a href="/wiki/Special:Search" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only search-toggle" id="" title="Search Wikitech [f]" accesskey="f"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
	</a>
	<div class="vector-typeahead-search-container">
		<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail cdx-typeahead-search--auto-expand-width">
			<form action="/w/index.php" id="searchform" class="cdx-search-input cdx-search-input--has-end-button">
				<div id="simpleSearch" class="cdx-search-input__input-wrapper"  data-search-loc="header-moved">
					<div class="cdx-text-input cdx-text-input--has-start-icon">
						<input
							class="cdx-text-input__input"
							 type="search" name="search" placeholder="Search Wikitech" aria-label="Search Wikitech" autocapitalize="sentences" title="Search Wikitech [f]" accesskey="f" id="searchInput"
							>
						<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
					</div>
					<input type="hidden" name="title" value="Special:Search">
				</div>
				<button class="cdx-button cdx-search-input__end-button">Search</button>
			</form>
		</div>
	</div>
</div>

			<nav class="vector-user-links vector-user-links-wide" aria-label="Personal tools" role="navigation" >
	<div class="vector-user-links-main">
	
<div id="p-vector-user-menu-preferences" class="vector-menu mw-portlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			<li id="ca-uls" class="mw-list-item active user-links-collapsible-item"><a data-mw="interface" href="#" class="uls-trigger cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet"><span class="vector-icon mw-ui-icon-wikimedia-language mw-ui-icon-wikimedia-wikimedia-language"></span>

<span>English</span></a>
</li>

			
		</ul>
		
	</div>
</div>

	
<div id="p-vector-user-menu-userpage" class="vector-menu mw-portlet emptyPortlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	<nav class="vector-client-prefs-landmark" aria-label="Appearance">
		
		
	</nav>
	
<div id="p-vector-user-menu-notifications" class="vector-menu mw-portlet emptyPortlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	
<div id="p-vector-user-menu-overflow" class="vector-menu mw-portlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			<li id="pt-login-2" class="user-links-collapsible-item mw-list-item user-links-collapsible-item"><a data-mw="interface" href="/w/index.php?title=Special:UserLogin&amp;returnto=Switch+Datacenter" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o" class=""><span>Log in</span></a>
</li>

			
		</ul>
		
	</div>
</div>

	</div>
	
<div id="vector-user-links-dropdown" class="vector-dropdown vector-user-menu vector-button-flush-right vector-user-menu-logged-out"  title="More options" >
	<input type="checkbox" id="vector-user-links-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-user-links-dropdown" class="vector-dropdown-checkbox "  aria-label="Personal tools"  >
	<label id="vector-user-links-dropdown-label" for="vector-user-links-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"  ><span class="vector-icon mw-ui-icon-ellipsis mw-ui-icon-wikimedia-ellipsis"></span>

<span class="vector-dropdown-label-text">Personal tools</span>
	</label>
	<div class="vector-dropdown-content">


		
<div id="p-personal" class="vector-menu mw-portlet mw-portlet-personal"  title="User menu" >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="pt-login" class="user-links-collapsible-item mw-list-item"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Switch+Datacenter" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span class="vector-icon mw-ui-icon-logIn mw-ui-icon-wikimedia-logIn"></span> <span>Log in</span></a></li>
		</ul>
		
	</div>
</div>

	
	</div>
</div>

</nav>

		</div>
	</header>
</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-sitenotice-container">
			<div id="siteNotice"><div id="mw-dismissablenotice-anonplace"></div><script>(function(){var node=document.getElementById("mw-dismissablenotice-anonplace");if(node){node.outerHTML="\u003Cdiv class=\"mw-dismissable-notice\"\u003E\u003Cdiv class=\"mw-dismissable-notice-close\"\u003E[\u003Ca tabindex=\"0\" role=\"button\"\u003Edismiss\u003C/a\u003E]\u003C/div\u003E\u003Cdiv class=\"mw-dismissable-notice-body\"\u003E\u003Cdiv id=\"localNotice\" data-nosnippet=\"\"\u003E\u003Cdiv class=\"sitenotice\" lang=\"en\" dir=\"ltr\"\u003E\u003Cp\u003Eüõ†Ô∏è Nominate your favorite tools for the \u003Ca href=\"https://meta.wikimedia.org/wiki/Coolest_Tool_Award#Coolest_Tool_Award_2024\" class=\"extiw\" title=\"meta:Coolest Tool Award\"\u003Efifth edition of the Coolest Tool Award\u003C/a\u003E. Nominations will be open until 2024-05-10.\n\u003C/p\u003E\u003C/div\u003E\u003C/div\u003E\u003C/div\u003E\u003C/div\u003E";}}());</script></div>
		</div>
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		<div id="mw-navigation">
			<nav id="mw-panel" class="vector-main-menu-landmark" aria-label="Site" role="navigation">
				<div id="vector-main-menu-pinned-container" class="vector-pinned-container">
				
				</div>
		</nav>
		</div>
	</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div
	class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned"
	data-feature-name="toc-pinned"
	data-pinnable-element-id="vector-toc"
	
	
>
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text"
			class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Introduction"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Introduction">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Introduction</div>
		</a>
		
			<button aria-controls="toc-Introduction-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Introduction subsection</span>
			</button>
		
		<ul id="toc-Introduction-sublist" class="vector-toc-list">
			<li id="toc-What?"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#What?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>What?</div>
			</a>
			
			<ul id="toc-What?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-When?"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#When?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>When?</div>
			</a>
			
			<ul id="toc-When?-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Impact"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Impact">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Impact</div>
		</a>
		
			<button aria-controls="toc-Impact-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Impact subsection</span>
			</button>
		
		<ul id="toc-Impact-sublist" class="vector-toc-list">
			<li id="toc-What_does_read-only_mean?"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#What_does_read-only_mean?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>What does read-only mean?</div>
			</a>
			
			<ul id="toc-What_does_read-only_mean?-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-High_Level_switchover_flow"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#High_Level_switchover_flow">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>High Level switchover flow</div>
		</a>
		
			<button aria-controls="toc-High_Level_switchover_flow-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle High Level switchover flow subsection</span>
			</button>
		
		<ul id="toc-High_Level_switchover_flow-sublist" class="vector-toc-list">
			<li id="toc-Scheduling_details"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Scheduling_details">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Scheduling details</div>
			</a>
			
			<ul id="toc-Scheduling_details-sublist" class="vector-toc-list">
				<li id="toc-Day_1_-_Tuesday:_Traffic+Services"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_1_-_Tuesday:_Traffic+Services">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>Day 1 - Tuesday: Traffic+Services</div>
			</a>
			
			<ul id="toc-Day_1_-_Tuesday:_Traffic+Services-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_2_-_Wednesday:_MediaWiki"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_2_-_Wednesday:_MediaWiki">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>Day 2 - Wednesday: MediaWiki</div>
			</a>
			
			<ul id="toc-Day_2_-_Wednesday:_MediaWiki-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_3_-_Thursday:_Deployment_Server_+_Special_cases"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_3_-_Thursday:_Deployment_Server_+_Special_cases">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3</span>Day 3 - Thursday: Deployment Server + Special cases</div>
			</a>
			
			<ul id="toc-Day_3_-_Thursday:_Deployment_Server_+_Special_cases-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_8_-_Wednesday:_Pool_back_inactive_DC"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_8_-_Wednesday:_Pool_back_inactive_DC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4</span>Day 8 - Wednesday: Pool back inactive DC</div>
			</a>
			
			<ul id="toc-Day_8_-_Wednesday:_Pool_back_inactive_DC-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Weeks_in_advance:_communication,_testing,_and_preparation"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Weeks_in_advance:_communication,_testing,_and_preparation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Weeks in advance: communication, testing, and preparation</div>
		</a>
		
			<button aria-controls="toc-Weeks_in_advance:_communication,_testing,_and_preparation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Weeks in advance: communication, testing, and preparation subsection</span>
			</button>
		
		<ul id="toc-Weeks_in_advance:_communication,_testing,_and_preparation-sublist" class="vector-toc-list">
			<li id="toc-Communication_-_10_weeks_before"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Communication_-_10_weeks_before">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Communication - 10 weeks before</div>
			</a>
			
			<ul id="toc-Communication_-_10_weeks_before-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Testing_-_3_weeks_before"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Testing_-_3_weeks_before">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Testing - 3 weeks before</div>
			</a>
			
			<ul id="toc-Testing_-_3_weeks_before-sublist" class="vector-toc-list">
				<li id="toc-Live_Test"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Live_Test">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>Live Test</div>
			</a>
			
			<ul id="toc-Live_Test-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dry_Run"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dry_Run">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.2</span>Dry Run</div>
			</a>
			
			<ul id="toc-Dry_Run-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Preparation_-_a_few_days_before"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preparation_-_a_few_days_before">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Preparation - a few days before</div>
			</a>
			
			<ul id="toc-Preparation_-_a_few_days_before-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Per-service_switchover_instructions"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Per-service_switchover_instructions">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Per-service switchover instructions</div>
		</a>
		
			<button aria-controls="toc-Per-service_switchover_instructions-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Per-service switchover instructions subsection</span>
			</button>
		
		<ul id="toc-Per-service_switchover_instructions-sublist" class="vector-toc-list">
			<li id="toc-Traffic"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Traffic">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Traffic</div>
			</a>
			
			<ul id="toc-Traffic-sublist" class="vector-toc-list">
				<li id="toc-General_procedure"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#General_procedure">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>General procedure</div>
			</a>
			
			<ul id="toc-General_procedure-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_1:_Depool_source_datacentre"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_1:_Depool_source_datacentre">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Day 1: Depool source datacentre</div>
			</a>
			
			<ul id="toc-Day_1:_Depool_source_datacentre-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_8:_Switch_to_Multi-DC_again"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_8:_Switch_to_Multi-DC_again">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.3</span>Day 8: Switch to Multi-DC again</div>
			</a>
			
			<ul id="toc-Day_8:_Switch_to_Multi-DC_again-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dashboards"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dashboards">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.4</span>Dashboards</div>
			</a>
			
			<ul id="toc-Dashboards-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Services"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Services">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Services</div>
			</a>
			
			<ul id="toc-Services-sublist" class="vector-toc-list">
				<li id="toc-General_procedure_2"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#General_procedure_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>General procedure</div>
			</a>
			
			<ul id="toc-General_procedure_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_1:_Depooling_source_DC"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_1:_Depooling_source_DC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>Day 1: Depooling source DC</div>
			</a>
			
			<ul id="toc-Day_1:_Depooling_source_DC-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Day_8:_Switch_to_Multi-DC_again_2"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_8:_Switch_to_Multi-DC_again_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.3</span>Day 8: Switch to Multi-DC again</div>
			</a>
			
			<ul id="toc-Day_8:_Switch_to_Multi-DC_again_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-MediaWiki"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MediaWiki">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>MediaWiki</div>
			</a>
			
			<ul id="toc-MediaWiki-sublist" class="vector-toc-list">
				<li id="toc-Day_2:_MediaWiki_Switchover"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Day_2:_MediaWiki_Switchover">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.1</span>Day 2: MediaWiki Switchover</div>
			</a>
			
			<ul id="toc-Day_2:_MediaWiki_Switchover-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_0_-_preparation"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_0_-_preparation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.2</span>Phase 0 - preparation</div>
			</a>
			
			<ul id="toc-Phase_0_-_preparation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_1_-_stop_maintenance"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_1_-_stop_maintenance">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.3</span>Phase 1 - stop maintenance</div>
			</a>
			
			<ul id="toc-Phase_1_-_stop_maintenance-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_2_-_read-only_mode"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_2_-_read-only_mode">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.4</span>Phase 2 - read-only mode</div>
			</a>
			
			<ul id="toc-Phase_2_-_read-only_mode-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_3_-_lock_down_database_masters"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_3_-_lock_down_database_masters">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.5</span>Phase 3 - lock down database masters</div>
			</a>
			
			<ul id="toc-Phase_3_-_lock_down_database_masters-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_4_-_switch_active_datacenter_configuration"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_4_-_switch_active_datacenter_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.6</span>Phase 4 - switch active datacenter configuration</div>
			</a>
			
			<ul id="toc-Phase_4_-_switch_active_datacenter_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.7</span>Phase 5 - DEPRECATED - Invert Redis replication for MediaWiki sessions</div>
			</a>
			
			<ul id="toc-Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_6_-_Set_new_site&#039;s_databases_to_read-write"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_6_-_Set_new_site&#039;s_databases_to_read-write">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.8</span>Phase 6 - Set new site's databases to read-write</div>
			</a>
			
			<ul id="toc-Phase_6_-_Set_new_site&#039;s_databases_to_read-write-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_7_-_Set_MediaWiki_to_read-write"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_7_-_Set_MediaWiki_to_read-write">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.9</span>Phase 7 - Set MediaWiki to read-write</div>
			</a>
			
			<ul id="toc-Phase_7_-_Set_MediaWiki_to_read-write-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_8_-_Restore_rest_of_MediaWiki"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_8_-_Restore_rest_of_MediaWiki">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.10</span>Phase 8 - Restore rest of MediaWiki</div>
			</a>
			
			<ul id="toc-Phase_8_-_Restore_rest_of_MediaWiki-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_9_-_Post_read-only"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_9_-_Post_read-only">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.11</span>Phase 9 - Post read-only</div>
			</a>
			
			<ul id="toc-Phase_9_-_Post_read-only-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Phase_10_-_verification_and_troubleshooting"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Phase_10_-_verification_and_troubleshooting">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.12</span>Phase 10 - verification and troubleshooting</div>
			</a>
			
			<ul id="toc-Phase_10_-_verification_and_troubleshooting-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dashboards_2"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dashboards_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.13</span>Dashboards</div>
			</a>
			
			<ul id="toc-Dashboards_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dashboards_3"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dashboards_3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.14</span>Dashboards</div>
			</a>
			
			<ul id="toc-Dashboards_3-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-ElasticSearch"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ElasticSearch">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>ElasticSearch</div>
			</a>
			
			<ul id="toc-ElasticSearch-sublist" class="vector-toc-list">
				<li id="toc-General_context_on_how_to_switchover"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#General_context_on_how_to_switchover">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4.1</span>General context on how to switchover</div>
			</a>
			
			<ul id="toc-General_context_on_how_to_switchover-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dashboards_4"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dashboards_4">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4.2</span>Dashboards</div>
			</a>
			
			<ul id="toc-Dashboards_4-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Special_cases"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Special_cases">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Special cases</div>
			</a>
			
			<ul id="toc-Special_cases-sublist" class="vector-toc-list">
				<li id="toc-Exclusions"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Exclusions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.1</span>Exclusions</div>
			</a>
			
			<ul id="toc-Exclusions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Single_service"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Single_service">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.2</span>Single service</div>
			</a>
			
			<ul id="toc-Single_service-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-apt"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#apt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.3</span>apt</div>
			</a>
			
			<ul id="toc-apt-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-restbase-async"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#restbase-async">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.4</span>restbase-async</div>
			</a>
			
			<ul id="toc-restbase-async-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manual_switch"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Manual_switch">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.5</span>Manual switch</div>
			</a>
			
			<ul id="toc-Manual_switch-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dashboards_5"
			class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dashboards_5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.6</span>Dashboards</div>
			</a>
			
			<ul id="toc-Dashboards_5-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Databases"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Databases">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Databases</div>
			</a>
			
			<ul id="toc-Databases-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Other_miscellaneous"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Other_miscellaneous">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Other miscellaneous</div>
			</a>
			
			<ul id="toc-Other_miscellaneous-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Predictable,_Recurring_Switchovers"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Predictable,_Recurring_Switchovers">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Predictable, Recurring Switchovers</div>
		</a>
		
		<ul id="toc-Predictable,_Recurring_Switchovers-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Upcoming_Switches"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Upcoming_Switches">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Upcoming Switches</div>
		</a>
		
		<ul id="toc-Upcoming_Switches-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Past_Switches"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Past_Switches">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Past Switches</div>
		</a>
		
			<button aria-controls="toc-Past_Switches-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Past Switches subsection</span>
			</button>
		
		<ul id="toc-Past_Switches-sublist" class="vector-toc-list">
			<li id="toc-2024_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2024_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>2024 switches</div>
			</a>
			
			<ul id="toc-2024_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-2023_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2023_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.2</span>2023 switches</div>
			</a>
			
			<ul id="toc-2023_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-2021_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2021_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.3</span>2021 switches</div>
			</a>
			
			<ul id="toc-2021_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-2020_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2020_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.4</span>2020 switches</div>
			</a>
			
			<ul id="toc-2020_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-2018_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2018_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.5</span>2018 switches</div>
			</a>
			
			<ul id="toc-2018_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-2017_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2017_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.6</span>2017 switches</div>
			</a>
			
			<ul id="toc-2017_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-2016_switches"
			class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#2016_switches">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.7</span>2016 switches</div>
			</a>
			
			<ul id="toc-2016_switches-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Monitoring_Dashboards"
		class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Monitoring_Dashboards">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Monitoring Dashboards</div>
		</a>
		
		<ul id="toc-Monitoring_Dashboards-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left"  >
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox "  aria-label="Toggle the table of contents"  >
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"  ><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Switch Datacenter</span></h1>
				</header>
				<div class="vector-page-toolbar">
					<div class="vector-page-toolbar-container">
						<div id="left-navigation">
							<nav aria-label="Namespaces">
								
<div id="p-associated-pages" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-associated-pages"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-nstab-main" class="selected vector-tab-noicon mw-list-item"><a href="/wiki/Switch_Datacenter" title="View the content page [c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="new vector-tab-noicon mw-list-item"><a href="/w/index.php?title=Talk:Switch_Datacenter&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
		</ul>
		
	</div>
</div>

								
<div id="p-variants" class="vector-dropdown emptyPortlet"  >
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-dropdown-checkbox " aria-label="Change language variant"   >
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true"  ><span class="vector-dropdown-label-text">English</span>
	</label>
	<div class="vector-dropdown-content">


					
<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

				
	</div>
</div>

							</nav>
						</div>
						<div id="right-navigation" class="vector-collapsible">
							<nav aria-label="Views">
								
<div id="p-views" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-views"  >
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-view" class="selected vector-tab-noicon mw-list-item"><a href="/wiki/Switch_Datacenter"><span>Read</span></a></li><li id="ca-viewsource" class="vector-tab-noicon mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="vector-tab-noicon mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
		</ul>
		
	</div>
</div>

							</nav>
				
							<nav class="vector-page-tools-landmark" aria-label="Page tools">
								
<div id="vector-page-tools-dropdown" class="vector-dropdown vector-page-tools-dropdown"  >
	<input type="checkbox" id="vector-page-tools-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-tools-dropdown" class="vector-dropdown-checkbox "  aria-label="Tools"  >
	<label id="vector-page-tools-dropdown-label" for="vector-page-tools-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true"  ><span class="vector-dropdown-label-text">Tools</span>
	</label>
	<div class="vector-dropdown-content">


									<div id="vector-page-tools-unpinned-container" class="vector-unpinned-container">
						
<div id="vector-page-tools" class="vector-page-tools vector-pinnable-element">
	<div
	class="vector-pinnable-header vector-page-tools-pinnable-header vector-pinnable-header-unpinned"
	data-feature-name="page-tools-pinned"
	data-pinnable-element-id="vector-page-tools"
	data-pinned-container-id="vector-page-tools-pinned-container"
	data-unpinned-container-id="vector-page-tools-unpinned-container"
>
	<div class="vector-pinnable-header-label">Tools</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-page-tools.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-page-tools.unpin">hide</button>
</div>

	
<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-has-collapsible-items"  title="More options" >
	<div class="vector-menu-heading">
		Actions
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="/wiki/Switch_Datacenter"><span>Read</span></a></li><li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;action=edit"><span>View source</span></a></li><li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;action=history"><span>View history</span></a></li>
		</ul>
		
	</div>
</div>

<div id="p-tb" class="vector-menu mw-portlet mw-portlet-tb"  >
	<div class="vector-menu-heading">
		General
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="t-whatlinkshere" class="mw-list-item"><a href="/wiki/Special:WhatLinksHere/Switch_Datacenter" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="/wiki/Special:RecentChangesLinked/Switch_Datacenter" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li><li id="t-permalink" class="mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;oldid=2164096" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;action=info" title="More information about this page"><span>Page information</span></a></li><li id="t-cite" class="mw-list-item"><a href="/w/index.php?title=Special:CiteThisPage&amp;page=Switch_Datacenter&amp;id=2164096&amp;wpFormIdentifier=titleform" title="Information on how to cite this page"><span>Cite this page</span></a></li>
		</ul>
		
	</div>
</div>

<div id="p-coll-print_export" class="vector-menu mw-portlet mw-portlet-coll-print_export"  >
	<div class="vector-menu-heading">
		Print/export
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="coll-create_a_book" class="mw-list-item"><a href="/w/index.php?title=Special:Book&amp;bookcmd=book_creator&amp;referer=Switch+Datacenter"><span>Create a book</span></a></li><li id="coll-download-as-rl" class="mw-list-item"><a href="/w/index.php?title=Special:DownloadAsPdf&amp;page=Switch_Datacenter&amp;action=show-download-screen"><span>Download as PDF</span></a></li><li id="t-print" class="mw-list-item"><a href="/w/index.php?title=Switch_Datacenter&amp;printable=yes" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li>
		</ul>
		
	</div>
</div>

</div>

									</div>
				
	</div>
</div>

							</nav>
						</div>
					</div>
				</div>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From Wikitech</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content"><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><div class="rellink mw-tpl-rellink">See also the blog posts from the "<a class="external text" href="https://blog.wikimedia.org/2016/04/11/wikimedia-failover-test/">2016 Failover</a>" and "<a class="external text" href="https://blog.wikimedia.org/2017/04/18/codfw-temporary-editing-pause/">2017 Failover</a>" and "<a class="external text" href="https://techblog.wikimedia.org/2021/07/23/june-2021-data-center-switchover/">2021 Switchover</a>" on the Wikimedia Blogs.</div>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Introduction"><span class="mw-headline" id="Introduction"><span data-mw-comment-start="" id="h-Introduction"></span>Introduction<span data-mw-comment-end="h-Introduction"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Introduction","replies":["h-What?-Introduction","h-When?-Introduction"]}}--></div>
<p><b>Datacenter switchovers</b> are a standard response to certain types of situations  (<a rel="nofollow" class="external text" href="https://duckduckgo.com/?q=Datacenter+switchover">web search</a>), where traffic is shifted from one site to another. Technology organisations regularly practice them to ensure that tooling and hardware will respond appropriately in case of an emergency. Moreover, switching between datacenters makes room for potentially disruptive maintenance work on inactive servers, such as database upgrades/changes, hardware replacement etc. In other words, while we're serving traffic from an active datacentre, we are doing our regular upkeep work on the inactive one to maintain its efficiency and reliability.
</p>
<h3 data-mw-thread-id="h-What?-Introduction"><span id="What.3F"></span><span class="mw-headline" id="What?"><span data-mw-comment-start="" id="h-What?-Introduction"></span>What?<span data-mw-comment-end="h-What?-Introduction"></span></span></h3>
<p>At Wikimedia, a datacentre switchover means switching over different components between our two main datacentres; <a href="/wiki/Eqiad" class="mw-redirect" title="Eqiad">eqiad</a> and <a href="/wiki/Codfw" class="mw-redirect" title="Codfw">codfw</a>. 
</p>
<h3 data-mw-thread-id="h-When?-Introduction"><span id="When.3F"></span><span class="mw-headline" id="When?"><span data-mw-comment-start="" id="h-When?-Introduction"></span>When?<span data-mw-comment-end="h-When?-Introduction"></span></span></h3>
<p>We perform two datacenter switchovers annually, during the week of the solar equinox:
</p>
<ul><li><b>Northward: ~21st March</b></li>
<li><b>Southward: ~21st September</b></li></ul>
<p>Our switchover process is broken down into stages, where some can progress independently, while others need to progress in lockstep. This page documents all the steps needed for this work, broken down by component. <a href="/wiki/SRE/Service_Operations" title="SRE/Service Operations">SRE/Service_Operations</a> is driving the process and maintains the software necessary to run the switchover, with a little help from their friends. 
</p>
<meta property="mw:PageProp/toc"/>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Impact"><span class="mw-headline" id="Impact"><span data-mw-comment-start="" id="h-Impact"></span>Impact<span data-mw-comment-end="h-Impact"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Impact","replies":["h-What_does_read-only_mean?-Impact"]}}--></div>
<p>Impact of a switchover is expected to be <b>2-3 minutes of read-only for MediaWiki</b>, including extensions. Any other services/features/infrastructures not participating directly in the Switchover, will continue to work as normal. However, anything relying on MediaWiki indirectly (e.g. via some data pipeline) may experience some minor impact, for example some delay in receiving events. This is expected.
</p>
<h3 data-mw-thread-id="h-What_does_read-only_mean?-Impact"><span id="What_does_read-only_mean.3F"></span><span class="mw-headline" id="What_does_read-only_mean?"><span data-mw-comment-start="" id="h-What_does_read-only_mean?-Impact"></span>What does read-only mean?<span data-mw-comment-end="h-What_does_read-only_mean?-Impact"></span></span></h3>
<p>Read-only is a two-step process: we first set MediaWiki itself read-only, and then the<a href="/wiki/MariaDB#Core_MediaWiki_databases" title="MariaDB">MediaWiki databases</a>. We allow an amount of time between the two so to allow the last in-flight edits to land safely. All read-only functionality will continue to function as usual. 
</p><p>During read-only, any kind of writes reaching our <a href="/wiki/MariaDB#Core_MediaWiki_databases" title="MariaDB">MediaWiki databases</a> (<code>UPDATE, DELETE, INSERT</code> in SQL terms) will be denied. Additionally, any features ignoring the global MediaWiki read-only configuration, will not function during this time window. This scheduled read-only period, adds a 0.001% MediaWiki edit unavailability per year.  
</p><p><b>Notes:</b> <a href="/wiki/MariaDB#Sections_and_shards" title="MariaDB">Non-MediaWiki databases</a>, are not part of the switchover.
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-High_Level_switchover_flow"><span class="mw-headline" id="High_Level_switchover_flow"><span data-mw-comment-start="" id="h-High_Level_switchover_flow"></span>High Level switchover flow<span data-mw-comment-end="h-High_Level_switchover_flow"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-High_Level_switchover_flow","replies":["h-Scheduling_details-High_Level_switchover_flow"]}}--></div>
<h3 data-mw-thread-id="h-Scheduling_details-High_Level_switchover_flow"><span class="mw-headline" id="Scheduling_details"><span data-mw-comment-start="" id="h-Scheduling_details-High_Level_switchover_flow"></span>Scheduling details<span data-mw-comment-end="h-Scheduling_details-High_Level_switchover_flow"></span></span></h3>
<p>Datacenter Switchovers will take place <b>on the work week of a Solar Equinox</b>, where we have assumed that the Northward Solar Equinox happens on <b>March 21st</b>, and the Southward Solar Equinox on <b>September 21st</b>. This doesn't match exactly the astronomical event on purpose.
</p><p>A controlled switchover occurs in a span of 8 days:
</p>
<h4 data-mw-thread-id="h-Day_1_-_Tuesday:_Traffic+Services-Scheduling_details"><span id="Day_1_-_Tuesday:_Traffic.2BServices"></span><span class="mw-headline" id="Day_1_-_Tuesday:_Traffic+Services"><span data-mw-comment-start="" id="h-Day_1_-_Tuesday:_Traffic+Services-Scheduling_details"></span><u>Day 1 - Tuesday:</u> Traffic+Services<span data-mw-comment-end="h-Day_1_-_Tuesday:_Traffic+Services-Scheduling_details"></span></span></h4>
<p>Non read-only parts of the Switchover always take place on Tuesday. This process is non disruptive and lower risk and it may be scheduled @ 14:00 UTC, however that is not necessary.
</p>
<ul><li><b>Traffic:</b> Disable caching in the origin datacenter  - <a class="mw-selflink-fragment" href="#Traffic">Switch_Datacenter#Traffic</a>
<ul><li><b>~20 minutes</b> for disabling caching completely from origin <code>dc_from</code> datacentre</li></ul></li>
<li><b>Services:</b> Depool services in the origin datacenter to destination - <a class="mw-selflink-fragment" href="#Services">Switch_Datacenter#Services</a>
<ul><li><b>~15-40 minutes</b> to switchover services to destination <code>dc_to</code>
<ul><li>Leave active/active services pooled only to destination <code>dc_to</code></li>
<li>Switchover active/passive services from origin <code>dc_from</code> to destination <code>dc_to</code></li></ul></li></ul></li></ul>
<h4 data-mw-thread-id="h-Day_2_-_Wednesday:_MediaWiki-Scheduling_details"><span class="mw-headline" id="Day_2_-_Wednesday:_MediaWiki"><span data-mw-comment-start="" id="h-Day_2_-_Wednesday:_MediaWiki-Scheduling_details"></span><u>Day 2 - Wednesday:</u> MediaWiki<span data-mw-comment-end="h-Day_2_-_Wednesday:_MediaWiki-Scheduling_details"></span></span></h4>
<p><b>The MediaWiki Switchover (read-only), will always take place on the Wednesday of the above mentioned week</b>. During read-only (2-3 minutes), no Wikis will be editable and editors will be seeing a warning message asking to try again later. <b>Read-only starts @ 14:00 UTC</b>. Readers should experience no changes for the entirety of the event.
</p>
<ul><li>Switch Mediawiki itself to destination datacentre  <a class="mw-selflink-fragment" href="#MediaWiki_2">Switch_Datacenter#MediaWiki</a>
<ul><li><b>~35 minutes</b> for a complete run of the cookbook, from disabling puppet to re-enabling it, if timed right for the read-only part of the cookbook to fall at the start of the announced window. Doing it in an emergency can be done faster since there is no need to wait for a set time.</li></ul></li></ul>
<p><b>Note:</b> For the <b>next 7 calendar days</b> after the MW read-only phase <b>traffic will be flowing solely to one datacentre</b> (destination), rendering the other datacenter effectively inactive.
</p>
<h4 data-mw-thread-id="h-Day_3_-_Thursday:_Deployment_Server_+_Special_cases-Scheduling_details"><span id="Day_3_-_Thursday:_Deployment_Server_.2B_Special_cases"></span><span class="mw-headline" id="Day_3_-_Thursday:_Deployment_Server_+_Special_cases"><span data-mw-comment-start="" id="h-Day_3_-_Thursday:_Deployment_Server_+_Special_cases-Scheduling_details"></span><u>Day 3 - Thursday:</u> Deployment Server + Special cases<span data-mw-comment-end="h-Day_3_-_Thursday:_Deployment_Server_+_Special_cases-Scheduling_details"></span></span></h4>
<p>At your convenience, after coordinating with deployers, you may switch the Special cases
</p>
<ul><li><a href="/wiki/Switch_Datacenter/DeploymentServer" title="Switch Datacenter/DeploymentServer">Deployment Server</a>
<ul><li><b>~1 hour</b> for the deployment server switch. This process has quite a few manual steps, so you need to plan plenty of time.</li></ul></li>
<li>Special Cases - <a class="mw-selflink-fragment" href="#Manual_switch">Switch Datacenter#Manual switch</a></li></ul>
<h4 data-mw-thread-id="h-Day_8_-_Wednesday:_Pool_back_inactive_DC-Scheduling_details"><span class="mw-headline" id="Day_8_-_Wednesday:_Pool_back_inactive_DC"><span data-mw-comment-start="" id="h-Day_8_-_Wednesday:_Pool_back_inactive_DC-Scheduling_details"></span><u>Day 8 - Wednesday:</u> Pool back inactive DC<span data-mw-comment-end="h-Day_8_-_Wednesday:_Pool_back_inactive_DC-Scheduling_details"></span></span></h4>
<p>A week later, <b>we activate caching and services in the inactive/secondary datacenter again</b>. With traffic flowing in both DCs, we are backin the normal Multi-DC mode.<b> This period may be extended, depending how maintenance work progresses at the inactive DC.</b>
</p><p><b>Note:</b> As of September 2023, we are running each datacenter as primary for half of the year. <b>The 2 datacentres are be considered coequal, alternating roles every 6 months</b>.
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Weeks_in_advance:_communication,_testing,_and_preparation"><span id="Weeks_in_advance:_communication.2C_testing.2C_and_preparation"></span><span class="mw-headline" id="Weeks_in_advance:_communication,_testing,_and_preparation"><span data-mw-comment-start="" id="h-Weeks_in_advance:_communication,_testing,_and_preparation"></span>Weeks in advance: communication, testing, and preparation<span data-mw-comment-end="h-Weeks_in_advance:_communication,_testing,_and_preparation"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Weeks_in_advance:_communication,_testing,_and_preparation","replies":["h-Communication_-_10_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation","h-Testing_-_3_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation","h-Preparation_-_a_few_days_before-Weeks_in_advance:_communication,_testing,_and_preparation"]}}--></div>
<h3 data-mw-thread-id="h-Communication_-_10_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation"><span class="mw-headline" id="Communication_-_10_weeks_before"><span data-mw-comment-start="" id="h-Communication_-_10_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation"></span>Communication - 10 weeks before<span data-mw-comment-end="h-Communication_-_10_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation"></span></span></h3>
<p>See <a href="/wiki/Switch_Datacenter/Coordination" title="Switch Datacenter/Coordination">Switch_Datacenter/Coordination</a>, coordinate dates and communication plan with involved groups.
</p>
<h3 data-mw-thread-id="h-Testing_-_3_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation"><span class="mw-headline" id="Testing_-_3_weeks_before"><span data-mw-comment-start="" id="h-Testing_-_3_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation"></span>Testing - 3 weeks before<span data-mw-comment-end="h-Testing_-_3_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation"></span></span></h3>
<p>Run a "live test" of the MediaWiki cookbook, and a dry-run for everything.
</p><p>Depending on what changes have occurred to our infrastructure/production from the previous switchover, code changes in cookbooks are expected. The purpose of the live-test and the dry-run is to test most of the existing and updated codepaths, and identify potential issues there. 
</p><p><b>Note: Always use the <code>--dry-run</code> flag when running cookbooks for testing purposes</b>
</p>
<h4 data-mw-thread-id="h-Live_Test-Testing_-_3_weeks_before"><span class="mw-headline" id="Live_Test"><span data-mw-comment-start="" id="h-Live_Test-Testing_-_3_weeks_before"></span>Live Test<span data-mw-comment-end="h-Live_Test-Testing_-_3_weeks_before"></span></span></h4>
<p>A live test ( <code>--live-test</code>) flag, will skip actions that could harm the primary DC or perform them on the secondary DC, and is available only for the <code>sre.switchdc.mediawiki</code> cookbook. What we should be careful about it is that <i>we "switch" from the currently secondary DC to the currently primary DC</i>. While the live-test process will log your actions to SAL, please remember to announce to #wikimedia-sre and to #wikimedia-operations too, that you will be running this test. Unless something goes really badly, this is a non-disruptive test. 
</p><p>For example, if currently our primary DC is <code>codfw</code> and for the upcoming switchover we will be switching to <code>eqiad</code>, <b>the direction for a live test is eqiad‚Üícodfw:</b>
</p>
<pre>cumin1002:~# cookbook sre.switchdc.mediawiki --live-test <b>eqiad codfw</b>
&lt;entering cookbook menu>

> 00-disable-puppet
> 00-reduce-ttl 
</pre>
<p><b>Limitations:</b> The <code>03-set-db-readonly</code> cookbook will fail if circular replication is not already enabled everywhere. It can be skipped if the live-test is run before circular replication is enabled. Please check with <a href="/wiki/SRE/Data_Persistence/About" title="SRE/Data Persistence/About"> Data Persistence</a> if you need to run this test or not. 
</p>
<h4 data-mw-thread-id="h-Dry_Run-Testing_-_3_weeks_before"><span class="mw-headline" id="Dry_Run"><span data-mw-comment-start="" id="h-Dry_Run-Testing_-_3_weeks_before"></span>Dry Run<span data-mw-comment-end="h-Dry_Run-Testing_-_3_weeks_before"></span></span></h4>
<p>A dry-run is available for both cookbooks we use during a switchover; <code>sre.switchdc.mediawiki</code> and <code>sre.discovery.datacenter</code>. During a dry-run, the direction is the one we have announced. 
</p><p>For example, if we are currently on codfw, switching over to eqiad, a dry-run's direction would be codfw‚Üíeqiad, as follows: 
</p>
<pre>cumin1002:~# cookbook --dry-run sre.switchdc.mediawiki <b>codfw eqiad</b>
&lt;entering cookbook menu>

> 00-disable-puppet
> 00-reduce-ttl
</pre>
<pre>cumin1002:~# cookbook --dry-run sre.discovery.datacenter depool codfw \
                      --all --reason "Datacenter services switchover dry-run" \
                      --task-id T357547
</pre>
<h3 data-mw-thread-id="h-Preparation_-_a_few_days_before-Weeks_in_advance:_communication,_testing,_and_preparation"><span class="mw-headline" id="Preparation_-_a_few_days_before"><span data-mw-comment-start="" id="h-Preparation_-_a_few_days_before-Weeks_in_advance:_communication,_testing,_and_preparation"></span>Preparation - a few days before<span data-mw-comment-end="h-Preparation_-_a_few_days_before-Weeks_in_advance:_communication,_testing,_and_preparation"></span></span></h3>
<p><u>Data Persistance checklist:</u>
</p>
<ul><li>There is no ongoing long-running maintenance that affects database availability or lag (schema changes, upgrades, hardware issues, etc.)</li>
<li>Replication is flowing from eqiad -> codfw and from codfw -> eqiad</li>
<li>All database servers have its buffer pool filled up. This is taken care automatically with the <a href="/wiki/MariaDB/buffer_pool_dump" title="MariaDB/buffer pool dump">automatic buffer pool warmup functionality</a>. For sanity checks, some sample load could be sent to the MediaWiki application server to check requests happen as quickly as in the active datacenter.</li></ul>
<p><u>Service Operations checklist:</u>
</p>
<ul><li><b>Check capacity in destination datacentre</b>. More specifically, ensure that MediaWiki deployments share at least the same number of pods in both datacentres.</li>
<li>Prepare all patches
<ul><li>Day 1: <a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1012645/" class="extiw" title="gerrit:">#1 Depool Traffic from source DC (DNS)</a></li>
<li>Day 2:
<ul><li><a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013005/" class="extiw" title="gerrit:">#2 Update DNS records for master DBs</a></li>
<li><a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013064/" class="extiw" title="gerrit:">#3 Update DNS records for maintenance host</a></li>
<li><a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013070/" class="extiw" title="gerrit:">#4 geo-maps: set default datacentre</a></li>
<li><a href="https://gerrit.wikimedia.org/r/#/c//operations/mediawiki-config/+/1013083/" class="extiw" title="gerrit:">#5 debug.json: List primary DC servers first </a></li></ul></li>
<li>Day 3:
<ul><li><a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013272/" class="extiw" title="gerrit:">#6 update deployment DNS record </a></li>
<li><a href="https://gerrit.wikimedia.org/r/#/c/operations/puppet/+/1013274" class="extiw" title="gerrit:">#7 update deployment_server on puppet</a></li></ul></li></ul></li></ul>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Per-service_switchover_instructions"><span class="mw-headline" id="Per-service_switchover_instructions"><span data-mw-comment-start="" id="h-Per-service_switchover_instructions"></span>Per-service switchover instructions<span data-mw-comment-end="h-Per-service_switchover_instructions"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Per-service_switchover_instructions","replies":["h-Traffic-Per-service_switchover_instructions","h-Services-Per-service_switchover_instructions","h-MediaWiki-Per-service_switchover_instructions","h-ElasticSearch-Per-service_switchover_instructions","h-Special_cases-Per-service_switchover_instructions","h-Databases-Per-service_switchover_instructions","h-Other_miscellaneous-Per-service_switchover_instructions"]}}--></div>
<h3 data-mw-thread-id="h-Traffic-Per-service_switchover_instructions"><span class="mw-headline" id="Traffic"><span data-mw-comment-start="" id="h-Traffic-Per-service_switchover_instructions"></span>Traffic<span data-mw-comment-end="h-Traffic-Per-service_switchover_instructions"></span></span></h3>
<h4 data-mw-thread-id="h-General_procedure-Traffic"><span class="mw-headline" id="General_procedure"><span data-mw-comment-start="" id="h-General_procedure-Traffic"></span>General procedure<span data-mw-comment-end="h-General_procedure-Traffic"></span></span></h4>
<p>See: <a href="/wiki/Global_traffic_routing" title="Global traffic routing">Global traffic routing</a>.
</p>
<h4 data-mw-thread-id="h-Day_1:_Depool_source_datacentre-Traffic"><span class="mw-headline" id="Day_1:_Depool_source_datacentre"><span data-mw-comment-start="" id="h-Day_1:_Depool_source_datacentre-Traffic"></span>Day 1: Depool source datacentre<span data-mw-comment-end="h-Day_1:_Depool_source_datacentre-Traffic"></span></span></h4>
<style data-mw-deduplicate="TemplateStyles:r2109784">.mw-parser-output .note{background-position:left 7px top 50%;padding:0.5em 0.5em 0.5em 40px;margin:0.5em 0;overflow:hidden;background-color:#f8f9fa;background-repeat:no-repeat;border:1px solid #ddd}.mw-parser-output .note-inline{display:inline-block;vertical-align:middle}.mw-parser-output .note-info{background-color:#eaf3ff;background-image:url("https://upload.wikimedia.org/wikipedia/commons/e/ec/OOjs_UI_icon_information-progressive.svg");background-size:25px;border-color:#a3caff;padding-left:40px;min-height:25px}.mw-parser-output .note-reminder{background-color:#fff9ea;background-image:url("https://upload.wikimedia.org/wikipedia/commons/a/a8/OOjs_UI_icon_lightbulb-yellow.svg");background-size:25px;border-color:#fc3;min-height:25px}.mw-parser-output .note-warn{background-color:#fff9ea;background-image:url("https://upload.wikimedia.org/wikipedia/commons/3/3b/OOjs_UI_icon_alert-warning.svg");background-size:25px;border-color:#fc3;min-height:25px}.mw-parser-output .note-error{background-color:#fee7e6;background-image:url("https://upload.wikimedia.org/wikipedia/commons/b/bf/OOjs_UI_icon_notice-destructive.svg");background-size:25px;border-color:#c33;min-height:25px}</style><div role="note" class="note note-warn">Make sure you have gone through <a class="mw-selflink-fragment" href="#Testing_-_3_weeks_before"> Testing</a>, and <a class="mw-selflink-fragment" href="#Preparation_-_a_few_days_before">Preperation</a>, including patches.</div>
<p>GeoDNS (User-facing) Routing:
</p>
<ol><li><a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1012645/" class="extiw" title="gerrit:">#1 Depool Traffic from source DC (DNS)</a>: C+2 and Submit</li>
<li><code>dns1004:~# authdns-update</code> -- This will propagate the change to all nameservers</li>
<li><code>!log Traffic: depool eqiad from user traffic</code> - Log to AWQ</li></ol>
<h4 data-mw-thread-id="h-Day_8:_Switch_to_Multi-DC_again-Traffic"><span class="mw-headline" id="Day_8:_Switch_to_Multi-DC_again"><span data-mw-comment-start="" id="h-Day_8:_Switch_to_Multi-DC_again-Traffic"></span>Day 8: Switch to Multi-DC again<span data-mw-comment-end="h-Day_8:_Switch_to_Multi-DC_again-Traffic"></span></span></h4>
<p>Same procedure as above, after reverting the relevant commit. 
</p>
<h4 data-mw-thread-id="h-Dashboards-Traffic"><span class="mw-headline" id="Dashboards"><span data-mw-comment-start="" id="h-Dashboards-Traffic"></span>Dashboards<span data-mw-comment-end="h-Dashboards-Traffic"></span></span></h4>
<ul><li><a class="external text" href="https://grafana.wikimedia.org/d/000000343/load-balancers-lvs?orgId=1">Load Balancers</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/d/000000479/frontend-traffic?refresh=1m&amp;orgId=1&amp;var-site=codfw&amp;var-site=eqiad&amp;var-cache_type=text&amp;var-status_type=1&amp;var-status_type=2&amp;var-status_type=3&amp;var-status_type=4">Frontend traffic (text@eqiad/codfw)</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/d/000000479/frontend-traffic?refresh=1m&amp;orgId=1&amp;var-site=codfw&amp;var-site=eqiad&amp;var-cache_type=upload&amp;var-status_type=1&amp;var-status_type=2&amp;var-status_type=3&amp;var-status_type=4">Frontend traffic (upload@eqiad/codfw)</a></li></ul>
<h3 data-mw-thread-id="h-Services-Per-service_switchover_instructions"><span class="mw-headline" id="Services"><span data-mw-comment-start="" id="h-Services-Per-service_switchover_instructions"></span>Services<span data-mw-comment-end="h-Services-Per-service_switchover_instructions"></span></span></h3>
<h4 data-mw-thread-id="h-General_procedure_2-Services"><span class="mw-headline" id="General_procedure_2"><span data-mw-comment-start="" id="h-General_procedure_2-Services"></span>General procedure<span data-mw-comment-end="h-General_procedure_2-Services"></span></span></h4>
<p>For a global switchover we are using the <a href="https://gerrit.wikimedia.org/r/plugins/gitiles/operations/cookbooks/%2B/refs/heads/master/cookbooks/sre/discovery/datacenter.py" class="extiw" title="gerrit:plugins/gitiles/operations/cookbooks/+/refs/heads/master/cookbooks/sre/discovery/datacenter.py"> sre.discovery.datacenter </a> to depool all services from a DC:
</p>
<ul><li>active-active services in DNS discovery will be depooled from said DC</li>
<li>active/passive ones will be switched over to the alternative DC, per user input</li></ul>
<p>However, there are a few services we completely exclude from this process. These are hardcoded in the <a href="https://gerrit.wikimedia.org/r/plugins/gitiles/operations/cookbooks/%2B/refs/heads/master/cookbooks/sre/discovery/datacenter.py" class="extiw" title="gerrit:plugins/gitiles/operations/cookbooks/+/refs/heads/master/cookbooks/sre/discovery/datacenter.py"> sre.discovery.datacenter </a> cookbook.
</p><p>What the cookbook does is:
</p>
<ol><li>Reduce the TTL of the DNS discovery records to 10 seconds</li>
<li>Depool the datacenter we're moving away from in confctl / discovery</li>
<li>Restore the original TTL</li></ol>
<p><br/>
</p>
<h4 data-mw-thread-id="h-Day_1:_Depooling_source_DC-Services"><span class="mw-headline" id="Day_1:_Depooling_source_DC"><span data-mw-comment-start="" id="h-Day_1:_Depooling_source_DC-Services"></span>Day 1: Depooling source DC<span data-mw-comment-end="h-Day_1:_Depooling_source_DC-Services"></span></span></h4>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-warn">Make sure you have gone through <a class="mw-selflink-fragment" href="#Testing_-_3_weeks_before"> Testing</a>, and <a class="mw-selflink-fragment" href="#Preparation_-_a_few_days_before">Preperation</a>, including patches.</div>
<p><b>Before depooling any service,</b> do not forget to review (and copy/paste) the current status of all services, but running: 
</p>
<pre>cookbook sre discovery.datacenter status all
</pre>
<p>The following command will depool all active/active services from a DC, and will prompt to move or skip the active/passive ones.
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># Switch all services to eqiad</span>
$<span class="w"> </span>sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.discovery.datacenter<span class="w"> </span>depool<span class="w"> </span>codfw<span class="w"> </span>--all<span class="w"> </span>--reason<span class="w"> </span><span class="s2">"Datacenter Switchover"</span><span class="w"> </span>--task-id<span class="w"> </span>T12345
</pre></div>
<h4 data-mw-thread-id="h-Day_8:_Switch_to_Multi-DC_again_2-Services"><span class="mw-headline" id="Day_8:_Switch_to_Multi-DC_again_2"><span data-mw-comment-start="" id="h-Day_8:_Switch_to_Multi-DC_again_2-Services"></span>Day 8: Switch to Multi-DC again<span data-mw-comment-end="h-Day_8:_Switch_to_Multi-DC_again_2-Services"></span></span></h4>
<p>The following command will repool all active/active services to a DC, and will prompt to move or skip the active/passive ones.
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># Repool codfw</span>
$<span class="w"> </span>sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.discovery.datacenter<span class="w"> </span>pool<span class="w"> </span>codfw<span class="w"> </span>--reason<span class="w"> </span><span class="s2">"Datacenter switch to Multi-DC"</span><span class="w"> </span>--task-id<span class="w"> </span>T12345
</pre></div>
<h3 data-mw-thread-id="h-MediaWiki-Per-service_switchover_instructions"><span class="mw-headline" id="MediaWiki"><span data-mw-comment-start="" id="h-MediaWiki-Per-service_switchover_instructions"></span>MediaWiki<span data-mw-comment-end="h-MediaWiki-Per-service_switchover_instructions"></span></span></h3>
<p>We divide the process in logical phases that should be executed sequentially. Within any phase, top-level tasks can be executed in parallel to each other, while subtasks are to be executed sequentially to each other. The phase number is referred to in the names of the tasks in the <a href="https://gerrit.wikimedia.org/g/operations/cookbooks/" class="extiw" title="git:operations/cookbooks/">operations/cookbooks</a> repository, in the <a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/">cookbooks/sre/switchdc/mediawiki/</a> path.
</p>
<h4 data-mw-thread-id="h-Day_2:_MediaWiki_Switchover-MediaWiki"><span class="mw-headline" id="Day_2:_MediaWiki_Switchover"><span data-mw-comment-start="" id="h-Day_2:_MediaWiki_Switchover-MediaWiki"></span>Day 2: MediaWiki Switchover<span data-mw-comment-end="h-Day_2:_MediaWiki_Switchover-MediaWiki"></span></span></h4>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-warn">Make sure you have gone through <a class="mw-selflink-fragment" href="#Testing_-_3_weeks_before"> Testing</a>, and <a class="mw-selflink-fragment" href="#Preparation_-_a_few_days_before">Preperation</a>, including patches.</div>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-reminder"> 
<b>Audible indicator</b>: Put <a rel="nofollow" class="external text" href="http://listen.hatnote.com">Listen to wikipedia</a> in the background during the switchover. Silence indicates read-only, when it starts to make sounds again, edits are back up.</div>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-reminder">
<p><b>Execution tip:</b> The best way to run this multi step cookbook is to start it in interactive mode from the cookbook root: <br/>
<code>sudo cookbook sre.switchdc.mediawiki --ro-reason 'DC switchover (TXXXXXX)' codfw eqiad</code><br/>
</p>
and proceed through the steps</div>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-info">Start the following steps <b>about 30-60mins before the scheduled switchover time</b>, in a tmux or a screen.</div>
<h4 data-mw-thread-id="h-Phase_0_-_preparation-MediaWiki"><span class="mw-headline" id="Phase_0_-_preparation"><span data-mw-comment-start="" id="h-Phase_0_-_preparation-MediaWiki"></span>Phase 0 - preparation<span data-mw-comment-end="h-Phase_0_-_preparation-MediaWiki"></span></span></h4>
<ol>

<li><u>Manual</u> <a rel="nofollow" class="external text" href="https://manage.statuspage.io/pages/nnqjzz7cd4tj/incidents">StatusPage</a>:  Add a scheduled maintenance (Maintenances -> Schedule Maintenance)</li>

<li><u>Manual</u> <b>scap lock:</b> Add a scap lock on a separate tmux/screen on the deployment server. This will block any scap deployments, and it will stay there waiting for your input to unlock it. 
 scap lock --all "Datacenter Switchover - T12345"</li>

<li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/00-disable-puppet.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/00-disable-puppet.py">00-disable-puppet</a></code>: Disables puppet on maintenance hosts in both eqiad and codfw</li>

<li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/00-reduce-ttl.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/00-reduce-ttl.py">00-reduce-ttl</a>:</code> Reduces TTL for various DNS discovery entries. <b>Make sure that at least 5 minutes (the old TTL) have passed before moving to Phase 1. The cookbook should force you to wait anyway</b>.</li>

<li>(Optional-Skip)<code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/00-warmup-caches.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/00-warmup-caches.py">00-warmup-caches</a>:</code> Warms up APC running the mediawiki-cache-warmup on the new site clusters. The warmup queries will repeat automatically until the response times stabilize: 
<ul><li>The global "urls-cluster" warmup against the appservers cluster</li>
<li>The "urls-server" warmup against all hosts in the appservers cluster.</li>
<li>The "urls-server" warmup against all hosts in the api-appservers cluster.</li></ul>

</li><li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/00-downtime-db-readonly-checks" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/00-downtime-db-readonly-checks">00-downtime-db-readonly-checks</a>:</code> Sets downtime for Read only checks on mariadb masters changed on Phase 3 so they don't page. </li>
</ol>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-error"><b>Stop for GO/NOGO</b>: Ask your peers for Go or NoGo</div>
<h4 data-mw-thread-id="h-Phase_1_-_stop_maintenance-MediaWiki"><span class="mw-headline" id="Phase_1_-_stop_maintenance"><span data-mw-comment-start="" id="h-Phase_1_-_stop_maintenance-MediaWiki"></span>Phase 1 - stop maintenance<span data-mw-comment-end="h-Phase_1_-_stop_maintenance-MediaWiki"></span></span></h4>
<ul><li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/01-stop-maintenance.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/01-stop-maintenance.py">01-stop-maintenance</a>:</code> Stops maintenance jobs in both datacenters and kill all the periodic jobs (systemd timers) on maintenance hosts in both datacenters. Keep in mind there is a chance of a manual job running. Check again with your peers; usually the way forward is to kill the job by forcr.</li></ul>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-error"><b>Final GO/NOGO before read-only</b>: Ask what time is it. <u><i>This is the point of no return.</i></u><i> The following steps until Phase 7 need to be executed in quick succession to minimise read-only time</i></div>
<h4 data-mw-thread-id="h-Phase_2_-_read-only_mode-MediaWiki"><span class="mw-headline" id="Phase_2_-_read-only_mode"><span data-mw-comment-start="" id="h-Phase_2_-_read-only_mode-MediaWiki"></span>Phase 2 - read-only mode<span data-mw-comment-end="h-Phase_2_-_read-only_mode-MediaWiki"></span></span></h4>
<ul><li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/02-set-readonly.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/02-set-readonly.py">02-set-readonly</a>:</code> Sets read-only mode by changing the <code>ReadOnly</code> conftool value</li></ul>
<h4 data-mw-thread-id="h-Phase_3_-_lock_down_database_masters-MediaWiki"><span class="mw-headline" id="Phase_3_-_lock_down_database_masters"><span data-mw-comment-start="" id="h-Phase_3_-_lock_down_database_masters-MediaWiki"></span>Phase 3 - lock down database masters<span data-mw-comment-end="h-Phase_3_-_lock_down_database_masters-MediaWiki"></span></span></h4>
<ul><li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/03-set-db-readonly.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/03-set-db-readonly.py">03-set-db-readonly</a>:</code> Puts origin DC <code>DC_FROM</code> core DB masters (shards: s1-s8, x1, es4-es5) in read-only mode and waits for destination DC's <code>DC_TO</code>  databases to catch up with replication</li></ul>
<h4 data-mw-thread-id="h-Phase_4_-_switch_active_datacenter_configuration-MediaWiki"><span class="mw-headline" id="Phase_4_-_switch_active_datacenter_configuration"><span data-mw-comment-start="" id="h-Phase_4_-_switch_active_datacenter_configuration-MediaWiki"></span>Phase 4 - switch active datacenter configuration<span data-mw-comment-end="h-Phase_4_-_switch_active_datacenter_configuration-MediaWiki"></span></span></h4>
<ul><li><code> <a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/04-switch-mediawiki.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/04-switch-mediawiki.py">04-switch-mediawiki</a>:</code> Switches the discovery records and MediaWiki active datacenter
<ul><li>Flips <code> <a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/_init_.py#17" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/ init .py"> MEDIAWIKI_SERVICE</a></code> to <code>pooled=true</code> in destination DC</li>
<li>Flips <code>WMFMasterDatacenter</code> from <code>DC_FROM</code> to <code>DC_TO</code></li>
<li>Flips <code> <a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/_init_.py#17" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/ init .py"> MEDIAWIKI_SERVICE</a></code> to <code>pooled=false</code> in source DC</li></ul></li></ul>
<p>After this, DNS will be changed for the source DC and internal applications (except mediawiki) will start hitting the new DC
</p>
<h4 data-mw-thread-id="h-Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions-MediaWiki"><span class="mw-headline" id="Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions"><span data-mw-comment-start="" id="h-Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions-MediaWiki"></span><del>Phase 5 - DEPRECATED - Invert Redis replication for MediaWiki sessions</del><span data-mw-comment-end="h-Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions-MediaWiki"></span></span></h4>
<h4 data-mw-thread-id="h-Phase_6_-_Set_new_site&#039;s_databases_to_read-write-MediaWiki"><span id="Phase_6_-_Set_new_site.27s_databases_to_read-write"></span><span class="mw-headline" id="Phase_6_-_Set_new_site's_databases_to_read-write"><span data-mw-comment-start="" id="h-Phase_6_-_Set_new_site's_databases_to_read-write-MediaWiki"></span>Phase 6 - Set new site's databases to read-write<span data-mw-comment-end="h-Phase_6_-_Set_new_site's_databases_to_read-write-MediaWiki"></span></span></h4>
<ul><li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/06-set-db-readwrite.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/06-set-db-readwrite.py">06-set-db-readwrite</a>:</code> Sets destination DC's core DB masters (shards: s1-s8, x1, es4-es5) in read-write mode</li></ul>
<h4 data-mw-thread-id="h-Phase_7_-_Set_MediaWiki_to_read-write-MediaWiki"><span class="mw-headline" id="Phase_7_-_Set_MediaWiki_to_read-write"><span data-mw-comment-start="" id="h-Phase_7_-_Set_MediaWiki_to_read-write-MediaWiki"></span>Phase 7 - Set MediaWiki to read-write<span data-mw-comment-end="h-Phase_7_-_Set_MediaWiki_to_read-write-MediaWiki"></span></span></h4>
<ul><li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/07-set-readwrite.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/07-set-readwrite.py">07-set-readwrite</a>:</code> Goes back to read-write mode by changing the <code>ReadOnly</code> conftool value</li></ul>
<div class="mw-tpl-colorbox" style="background-color: #eaf3ff;"><style data-mw-deduplicate="TemplateStyles:r2172024">.mw-parser-output .mw-tpl-colorbox{box-sizing:border-box;margin:0.5em 0.5em 1em 0.5em;border-radius:2px;overflow:hidden;background:#fff;border:1px solid #a2a9b1;box-shadow:0 2px 2px rgba(0,0,0,0.2)}.mw-parser-output .mw-tpl-colorbox-title{background:#eaecf0;color:#000000;display:flex;gap:0.5rem;padding-top:0.4rem;padding-bottom:0.4rem}.mw-parser-output .mw-tpl-colorbox-title--linked:hover{background:#eaf3ff}.mw-parser-output .mw-tpl-colorbox-title>*:first-child{padding-left:1rem}.mw-parser-output .mw-tpl-colorbox-title>*:last-child{padding-right:1rem}.mw-parser-output .mw-tpl-colorbox-title>strong,.mw-parser-output .mw-tpl-colorbox-title>a{flex-grow:1}.mw-parser-output .mw-tpl-colorbox-title-icon{opacity:0.8}.mw-parser-output .mw-tpl-colorbox-title-corner{float:right;font-size:0.7em}.mw-parser-output .mw-tpl-colorbox-content{padding:0.5rem 1rem}.mw-parser-output .mw-tpl-colorbox-content::after{content:"";display:block;clear:both}</style><div class="mw-tpl-colorbox-title" style="background-color: #36c; color: #fff;"><span class="mw-tpl-colorbox-title-icon" typeof="mw:File"><span><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/OOjs_UI_icon_logo-wikipedia-invert.svg/20px-OOjs_UI_icon_logo-wikipedia-invert.svg.png" decoding="async" width="20" height="20" class="mw-file-element" srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/OOjs_UI_icon_logo-wikipedia-invert.svg/30px-OOjs_UI_icon_logo-wikipedia-invert.svg.png 1.5x, https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/OOjs_UI_icon_logo-wikipedia-invert.svg/40px-OOjs_UI_icon_logo-wikipedia-invert.svg.png 2x" data-file-width="20" data-file-height="20"/></span></span> <strong>You are now out of read-only mode.</strong>
</div><div class="mw-tpl-colorbox-content">
<p>Take a breath, smile!
</p>
</div>
</div>
<h4 data-mw-thread-id="h-Phase_8_-_Restore_rest_of_MediaWiki-MediaWiki"><span class="mw-headline" id="Phase_8_-_Restore_rest_of_MediaWiki"><span data-mw-comment-start="" id="h-Phase_8_-_Restore_rest_of_MediaWiki-MediaWiki"></span>Phase 8 - Restore rest of MediaWiki<span data-mw-comment-end="h-Phase_8_-_Restore_rest_of_MediaWiki-MediaWiki"></span></span></h4>
<ol>
<li><code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/08-restart-envoy-on-jobrunners.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/08-restart-envoy-on-jobrunners.py">08-restart-envoy-on-jobrunners</a>:</code> Restarts pods on the (now) inactive jobrunners, trigger changeprop to re-resolve the DNS name and connect to destination DC
<ul><li>A steady rate of 500s is expected until this step is completed, as changeprop may still be sending edits to source DC, though the database master will reject them.</li></ul>
</li>

<li>
<code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/08-start-maintenance.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/08-start-maintenance.py">08-start-maintenance</a>:</code> Starts maintenance on destination DC
<ul><li>Runs puppet on the <a href="/wiki/Maintenance_server" title="Maintenance server">maintenance hosts</a>, which will reactivate systemd timers in destination DC</li>
<li>Most Wikidata-editing bots will restart once this is done and the "<a class="external text" href="https://grafana.wikimedia.org/d/TUJ0V-0Zk/wikidata-alerts?orgId=1&amp;refresh=5s">dispatch lag</a>" has recovered. This should bring us back to 100% of editing traffic.</li></ul>
</li>

<li>
<u>Manual</u> <a rel="nofollow" class="external text" href="https://manage.statuspage.io/pages/nnqjzz7cd4tj/incidents">StatusPage</a>: End the planned maintenance 
</li>
</ol>
<h4 data-mw-thread-id="h-Phase_9_-_Post_read-only-MediaWiki"><span class="mw-headline" id="Phase_9_-_Post_read-only"><span data-mw-comment-start="" id="h-Phase_9_-_Post_read-only-MediaWiki"></span>Phase 9 - Post read-only<span data-mw-comment-end="h-Phase_9_-_Post_read-only-MediaWiki"></span></span></h4>
<ol>
<li>
<code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/09-restore-ttl.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/09-restore-ttl.py">09-restore-ttl</a>:</code> Sets the TTL for the DNS records to 300 seconds again
</li>

<li><u>Manual</u> <a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013005/" class="extiw" title="gerrit:">#2 Update DNS records for master DBs</a>: merge and run <code>authdns-update</code>
<ul><li>Please use the following to SAL log: <code>!log Phase 9: Update DNS records for new database masters</code></li></ul>
</li>

<li>
<code><a href="https://gerrit.wikimedia.org/g/operations/cookbooks/%2B/master/cookbooks/sre/switchdc/mediawiki/09-run-puppet-on-db-masters.py" class="extiw" title="git:operations/cookbooks/+/master/cookbooks/sre/switchdc/mediawiki/09-run-puppet-on-db-masters.py">09-run-puppet-on-db-masters</a>:</code> Runs Puppet on the database masters in both DCs, to update expected read-only state.
<ul><li>This also removes the downtimes set in Phase 0</li></ul>
</li>

<li><u>Manual</u> <b>CentralNotice banner:</b> Ensure the banner informing users of readonly is removed. There is some minor HTTP caching involved (~5mins) here too.
</li>
<li><u>Manual</u> <b>Scap lock:</b> Go back to the terminal where you added the lock and press enter
</li>
<li>
<u>Manual</u> <a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013064/" class="extiw" title="gerrit:">#3 Update DNS records for maintenance host</a>: merge and run <code>authdns-update</code>
</li>
<li>
<u>Manual</u> <a href="https://gerrit.wikimedia.org/r/#/c/operations/dns/+/1013070/" class="extiw" title="gerrit:">#4 geo-maps: set default datacentre</a>: merge and run <code>authdns-update</code>
<ul><li>This default only affects a small portion of traffic, so this is mostly about logical consistency (when we have no idea where to route a request, we prefer the primary DC).</li></ul>
</li>
<li>
<u>Manual</u> <a href="https://gerrit.wikimedia.org/r/#/c//operations/mediawiki-config/+/1013083/" class="extiw" title="gerrit:">#5 debug.json: List primary DC servers first </a>: Re-order noc.wm.o's debug.json to have primary servers listed first, see <a href="https://phabricator.wikimedia.org/T289745" class="extiw" title="phab:T289745">T289745</a>. Run scap backport to deploy.
</li>
</ol>
<h4 data-mw-thread-id="h-Phase_10_-_verification_and_troubleshooting-MediaWiki"><span class="mw-headline" id="Phase_10_-_verification_and_troubleshooting"><span data-mw-comment-start="" id="h-Phase_10_-_verification_and_troubleshooting-MediaWiki"></span>Phase 10 - verification and troubleshooting<span data-mw-comment-end="h-Phase_10_-_verification_and_troubleshooting-MediaWiki"></span></span></h4>
<ol>
<li><u>Manual</u> <b>Reading and Editing:</b> Ensure they work!¬†:)</li>
<li><u>Manual</u> <b>Recent Changes:</b> Ensure recent changes are flowing 
<ul><li>See Special:RecentChanges, <a href="/wiki/EventStreams" class="mw-redirect" title="EventStreams">EventStreams</a>, and the IRC feeds</li>
<li><code>curl -s -H 'Accept: application/json'  <a class="external free" href="https://stream.wikimedia.org/v2/stream/recentchange">https://stream.wikimedia.org/v2/stream/recentchange</a> | jq .</code></li></ul>
</li><li> <u>Manual</u> <b>Email:</b> Ensure email works via <a href="https://www.mediawiki.org/wiki/Special:EmailUser" class="extiw" title="mw:Special:EmailUser">test an email</a>
. The following command should fluctuate between 0m and a few minutes </li>
 <code> mx1001:~$ sudo -i; sudo exim4 -bp | exiqsumm | tail -n 5 </code>
</ol>
<h4 data-mw-thread-id="h-Dashboards_2-MediaWiki"><span class="mw-headline" id="Dashboards_2"><span data-mw-comment-start="" id="h-Dashboards_2-MediaWiki"></span>Dashboards<span data-mw-comment-end="h-Dashboards_2-MediaWiki"></span></span></h4>
<h4 data-mw-thread-id="h-Dashboards_3-MediaWiki"><span class="mw-headline" id="Dashboards_3"><span data-mw-comment-start="" id="h-Dashboards_3-MediaWiki"></span>Dashboards<span data-mw-comment-end="h-Dashboards_3-MediaWiki"></span></span></h4>
<ul><li><a class="external text" href="https://grafana.wikimedia.org/d/000000327/apache-fcgi?orgId=1">Apache/FCGI</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/mediawiki-application-servers?orgId=1">App servers</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/d/kHk7W6OZz/ats-cluster-view?orgId=1&amp;var-datasource=esams%20prometheus%2Fops&amp;var-layer=backend&amp;var-cluster=text">ATS cluster view (text)</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/d/1T_4O08Wk/ats-backends-origin-servers-overview?orgId=1&amp;var-datasource=esams%20prometheus%2Fops&amp;var-cluster=text&amp;var-origin=api-rw.discovery.wmnet&amp;var-origin=appservers-rw.discovery.wmnet&amp;var-origin=restbase.discovery.wmnet">ATS backends&lt;->Origin servers overview (appservers, api, restbase)</a></li>
<li><a class="external text" href="https://logstash.wikimedia.org/app/dashboards#/view/mediawiki-errors">Logstash: mediawiki-errors</a></li></ul>
<h3 data-mw-thread-id="h-ElasticSearch-Per-service_switchover_instructions"><span class="mw-headline" id="ElasticSearch"><span data-mw-comment-start="" id="h-ElasticSearch-Per-service_switchover_instructions"></span>ElasticSearch<span data-mw-comment-end="h-ElasticSearch-Per-service_switchover_instructions"></span></span></h3>
<h4 data-mw-thread-id="h-General_context_on_how_to_switchover-ElasticSearch"><span class="mw-headline" id="General_context_on_how_to_switchover"><span data-mw-comment-start="" id="h-General_context_on_how_to_switchover-ElasticSearch"></span>General context on how to switchover<span data-mw-comment-end="h-General_context_on_how_to_switchover-ElasticSearch"></span></span></h4>
<p>CirrusSearch talks by default to the local datacenter (<code>$wmgDatacenter</code>). No special actions are required when disabling a datacenter.
</p><p>Manually switching CirrusSearch to a specific datacenter can always be done. Point CirrusSearch to codfw by editing <code>wgCirrusSearchDefaultCluster</code> <a rel="nofollow" class="external text" href="https://github.com/wikimedia/operations-mediawiki-config/blob/master/wmf-config/ext-CirrusSearch.php#L12">ext-CirrusSearch.php</a>.
</p><p>To ensure coherence in case of lost updates, a reindex of the pages modified during the switch can be done by following <a href="/wiki/Search#Recovering_from_an_Elasticsearch_outage.2Finterruption_in_updates" title="Search">Recovering from an Elasticsearch outage / interruption in updates</a>.
</p>
<h4 data-mw-thread-id="h-Dashboards_4-ElasticSearch"><span class="mw-headline" id="Dashboards_4"><span data-mw-comment-start="" id="h-Dashboards_4-ElasticSearch"></span>Dashboards<span data-mw-comment-end="h-Dashboards_4-ElasticSearch"></span></span></h4>
<ul><li><a class="external text" href="https://grafana.wikimedia.org/d/000000455/elasticsearch-percentiles?orgId=1&amp;refresh=1m&amp;from=now-1h&amp;to=now">ElasticSearch Percentiles</a></li></ul>
<p><br/>
</p>
<h3 data-mw-thread-id="h-Special_cases-Per-service_switchover_instructions"><span class="mw-headline" id="Special_cases"><span data-mw-comment-start="" id="h-Special_cases-Per-service_switchover_instructions"></span>Special cases<span data-mw-comment-end="h-Special_cases-Per-service_switchover_instructions"></span></span></h3>
<h4 data-mw-thread-id="h-Exclusions-Special_cases"><span class="mw-headline" id="Exclusions"><span data-mw-comment-start="" id="h-Exclusions-Special_cases"></span>Exclusions<span data-mw-comment-end="h-Exclusions-Special_cases"></span></span></h4>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-info">Exclusions have been implemented in the Switchover cookbook. The next section is still around for historical and information purposes. While it will probably not be needed, it's still useful information to have around.</div><p>
If it is needed to exclude services, using the old <code>sre.switchdc.services</code> is still necessary until exclusion is implemented.</p><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># Switch all services to codfw, excluding parsoid and cxserver</span>
$<span class="w"> </span>sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.switchdc.services<span class="w"> </span>--exclude<span class="w"> </span>parsoid<span class="w"> </span>cxserver<span class="w"> </span>--<span class="w"> </span>eqiad<span class="w"> </span>codfw
</pre></div>
<h4 data-mw-thread-id="h-Single_service-Special_cases"><span class="mw-headline" id="Single_service"><span data-mw-comment-start="" id="h-Single_service-Special_cases"></span>Single service<span data-mw-comment-end="h-Single_service-Special_cases"></span></span></h4><p>
If you are switching only one service, using the old <code>sre.switchdc.services</code> is still necessary</p><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># Switch the service "parsoid" to codfw-only</span>
$<span class="w"> </span>sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.switchdc.services<span class="w"> </span>--services<span class="w"> </span>parsoid<span class="w"> </span>--<span class="w"> </span>eqiad<span class="w"> </span>codfw
</pre></div>
<h4 data-mw-thread-id="h-apt-Special_cases"><span class="mw-headline" id="apt"><span data-mw-comment-start="" id="h-apt-Special_cases"></span>apt<span data-mw-comment-end="h-apt-Special_cases"></span></span></h4>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-warn">In March 2023 Switchover, we identified issues with apt.wikimedia.org being switched over. As of the September 2023 Switchover, those haven't been solved yet and apt.wikimedia.org won't participate in the Switchover.</div>
<p>apt.wikimedia.org needs a  <a href="https://gerrit.wikimedia.org/r/893409" class="extiw" title="gerrit:893409">puppet change</a>
</p>
<h4 data-mw-thread-id="h-restbase-async-Special_cases"><span class="mw-headline" id="restbase-async"><span data-mw-comment-start="" id="h-restbase-async-Special_cases"></span>restbase-async<span data-mw-comment-end="h-restbase-async-Special_cases"></span></span></h4>
<link rel="mw-deduplicated-inline-style" href="mw-data:TemplateStyles:r2109784"><div role="note" class="note note-info">As of September 2023, this is no longer needed. We let restbase-async pooled in both DCs for now on. This is kept in the doc for historical purposes for now.</div>
<p><s>Restbase-async is a bit of a special case, being pooled active/passive with the active in the secondary datacenter. As such, it needs an additional step if we're just switching active traffic over and not simulating a complete failover:</s>
</p>
<ol><li><s>pool restbase-async everywhere</s><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.discovery.service-route<span class="w"> </span>--reason<span class="w"> </span>T123456<span class="w"> </span>pool<span class="w"> </span>--wipe-cache<span class="w"> </span><span class="nv">$dc_from</span><span class="w"> </span>restbase-async
sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.discovery.service-route<span class="w"> </span>--reason<span class="w"> </span>T123456<span class="w"> </span>pool<span class="w"> </span>--wipe-cache<span class="w"> </span><span class="nv">$dc_to</span><span class="w"> </span>restbase-async
</pre></div></li>
<li><s>depool restbase-async in the newly active dc, so that async traffic is separated from real-users traffic as much as possible.</s><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>sudo<span class="w"> </span>cookbook<span class="w"> </span>sre.discovery.service-route<span class="w"> </span>--reason<span class="w"> </span>T123456<span class="w"> </span>depool<span class="w"> </span>--wipe-cache<span class="w"> </span><span class="nv">$dc_to</span><span class="w"> </span>restbase-async
</pre></div></li></ol>
<p><s>When simulating a complete failover, keep restbase pooled in $dc_to for as long as possible to test capacity, then switch it to $dc_from by using the above procedure.</s>
</p><p><s>As it is async, we trade the added latency from running it in the secondary datacenter for the lightened load on the primary datacenter's appservers.</s>
</p>
<h4 data-mw-thread-id="h-Manual_switch-Special_cases"><span class="mw-headline" id="Manual_switch"><span data-mw-comment-start="" id="h-Manual_switch-Special_cases"></span>Manual switch<span data-mw-comment-end="h-Manual_switch-Special_cases"></span></span></h4>
<p>These services require manual changes to be switched over and have not yet been included in service::catalog 
</p>
<ul><li><a href="/wiki/Switch_Datacenter/DeploymentServer" title="Switch Datacenter/DeploymentServer">Deployment server</a></li></ul>
<ul><li><a href="/wiki/Planet.wikimedia.org" title="Planet.wikimedia.org">planet.wikimedia.org</a>
<ul><li>The DNS discovery name planet.discovery.wmnet needs to be switched from one backend to another as in example change <a href="https://gerrit.wikimedia.org/r/891369" class="extiw" title="gerrit:891369">gerrit:891369</a>. No other change is needed.</li></ul></li></ul>
<ul><li><a href="/wiki/People.wikimedia.org" title="People.wikimedia.org">people.wikimedia.org</a>
<ul><li>In puppet hieradata the rsync_src and rsync_dst hosts need to be flipped as in example change <a href="https://gerrit.wikimedia.org/r/891382" class="extiw" title="gerrit:891382">gerrit:891382</a>.</li>
<li>FIXME: manual rsync command has to be run</li>
<li>The DNS discovery name peopleweb.discovery.wmnet needs to be switched from one backend to another as in example change <a href="https://gerrit.wikimedia.org/r/891381" class="extiw" title="gerrit:891381">gerrit::891381</a>.</li></ul></li></ul>
<ul><li><a href="/wiki/Noc.wikimedia.org" title="Noc.wikimedia.org"><s>noc.wikimedia.org</s></a> This is no longer applicable as of September 2023, noc.wikimedia.org is now active/active in mw-on-k8s.
<ul><li><s>The <a href="/wiki/Noc.wikimedia.org" title="Noc.wikimedia.org">noc.wikimedia.org</a> DNS name points to DNS discovery name mwmaint.discovery.wmnet that needs to be switched from one backend to another as in example change <a href="https://gerrit.wikimedia.org/r/896118" class="extiw" title="gerrit:896118">gerrit:896118</a>. No other change is needed.</s></li></ul></li></ul>
<h4 data-mw-thread-id="h-Dashboards_5-Special_cases"><span class="mw-headline" id="Dashboards_5"><span data-mw-comment-start="" id="h-Dashboards_5-Special_cases"></span>Dashboards<span data-mw-comment-end="h-Dashboards_5-Special_cases"></span></span></h4>
<ul><li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/eventstreams?refresh=1m&amp;orgId=1">EventStreams</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/ores?refresh=1m&amp;orgId=1">ORES</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/maps-performances?orgId=1">Maps</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/wikidata-query-service?refresh=1m">WDQS</a></li></ul>
<h3 data-mw-thread-id="h-Databases-Per-service_switchover_instructions"><span class="mw-headline" id="Databases"><span data-mw-comment-start="" id="h-Databases-Per-service_switchover_instructions"></span>Databases<span data-mw-comment-end="h-Databases-Per-service_switchover_instructions"></span></span></h3>
<p>Main document: <a href="/wiki/MariaDB/Switch_Datacenter" title="MariaDB/Switch Datacenter">MariaDB/Switch Datacenter</a>
</p>
<h3 data-mw-thread-id="h-Other_miscellaneous-Per-service_switchover_instructions"><span class="mw-headline" id="Other_miscellaneous"><span data-mw-comment-start="" id="h-Other_miscellaneous-Per-service_switchover_instructions"></span>Other miscellaneous<span data-mw-comment-end="h-Other_miscellaneous-Per-service_switchover_instructions"></span></span></h3>
<ul><li><a href="/wiki/Analytics/Systems/EventLogging" title="Analytics/Systems/EventLogging">EventLogging</a></li>
<li><a href="/wiki/Irc.wikimedia.org" title="Irc.wikimedia.org">IRC</a>, <s><a href="/wiki/RCStream" class="mw-redirect" title="RCStream">RCStream</a></s>, <a href="/wiki/EventStreams" class="mw-redirect" title="EventStreams">EventStreams</a></li></ul>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Predictable,_Recurring_Switchovers"><span id="Predictable.2C_Recurring_Switchovers"></span><span class="mw-headline" id="Predictable,_Recurring_Switchovers"><span data-mw-comment-start="" id="h-Predictable,_Recurring_Switchovers"></span>Predictable, Recurring Switchovers<span data-mw-comment-end="h-Predictable,_Recurring_Switchovers"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Predictable,_Recurring_Switchovers","replies":[]}}--></div>
<p>A few months after the Switchback of 2023, and following a feedback gathering process, a proposal to move to a predictable set of dates for the dates while also increasing the Switchover duration to 6 months was adopted and turned into a process. The document can be found in the link below:
</p><p><a href="/wiki/Switch_Datacenter/Recurring,_Equinox-based,_Data_Center_Switchovers" title="Switch Datacenter/Recurring, Equinox-based, Data Center Switchovers">Recurring, Equinox-based, Data Center Switchovers</a>
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Upcoming_Switches"><span class="mw-headline" id="Upcoming_Switches"><span data-mw-comment-start="" id="h-Upcoming_Switches"></span>Upcoming Switches<span data-mw-comment-end="h-Upcoming_Switches"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Upcoming_Switches","replies":[]}}--></div>
<p><span id="Schedule_of_past_switches"></span>
</p><p>See <a href="/wiki/Switch_Datacenter/Switchover_Dates" title="Switch Datacenter/Switchover Dates">Switch Datacenter/Switchover Dates</a> for a pre-calculated list up to 2050
</p>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Past_Switches"><span class="mw-headline" id="Past_Switches"><span data-mw-comment-start="" id="h-Past_Switches"></span>Past Switches<span data-mw-comment-end="h-Past_Switches"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Past_Switches","replies":["h-2024_switches-Past_Switches","h-2023_switches-Past_Switches","h-2021_switches-Past_Switches","h-2020_switches-Past_Switches","h-2018_switches-Past_Switches","h-2017_switches-Past_Switches","h-2016_switches-Past_Switches"]}}--></div>
<h3 data-mw-thread-id="h-2024_switches-Past_Switches"><span class="mw-headline" id="2024_switches"><span data-mw-comment-start="" id="h-2024_switches-Past_Switches"></span>2024 switches<span data-mw-comment-end="h-2024_switches-Past_Switches"></span></span></h3>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T357547" class="extiw" title="phabricator:T357547"><span class="trakfab-T357547">Task T357547</span></a></b></div>
<p><b>March</b>
</p>
<ul><li>Services + Traffic: Tuesday, March 19th, 2024 14:00 UTC</li>
<li>MediaWiki: Wednesday, March 20th, 2024 14:00UTC</li></ul>
<ul><li>Read only: 3 minutes 8 seconds</li></ul>
<h3 data-mw-thread-id="h-2023_switches-Past_Switches"><span class="mw-headline" id="2023_switches"><span data-mw-comment-start="" id="h-2023_switches-Past_Switches"></span>2023 switches<span data-mw-comment-end="h-2023_switches-Past_Switches"></span></span></h3>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T345263" class="extiw" title="phabricator:T345263"><span class="trakfab-T345263">Task T345263</span></a></b></div>
<dl><dt>September</dt></dl>
<ul><li>Services + Traffic: <a class="external text" href="https://zonestamp.toolforge.org/1695132049">Tuesday, September 19th, 2023 14:00 UTC</a></li>
<li>MediaWiki: <a class="external text" href="https://zonestamp.toolforge.org/1695218452">Wednesday, September 20th, 2023 14:00 UTC</a></li></ul>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T327920" class="extiw" title="phabricator:T327920"><span class="trakfab-T327920">Task T327920</span></a></b></div>
<dl><dt>February</dt></dl>
<ul><li>Services: <a class="external text" href="https://zonestamp.toolforge.org/1677592832">Tuesday, February 28th, 2023 14:00 UTC</a></li>
<li>Traffic: <a class="external text" href="https://zonestamp.toolforge.org/1677596427">Tuesday, February 28th, 2023 15:00 UTC</a></li>
<li>MediaWiki: <a class="external text" href="https://zonestamp.toolforge.org/1677679227">Wednesday, March 1st, 2023 14:00 UTC</a></li></ul>
<p><b>Reports</b>
</p>
<ul><li><a href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/thread/QXNSWHT7G2TUZRTYKLOGJR7IHEAHXWK7/" class="extiw" title="listarchive:list/wikitech-l@lists.wikimedia.org/thread/QXNSWHT7G2TUZRTYKLOGJR7IHEAHXWK7/">Recap</a></li>
<li>Read only: 1 minute 59 seconds</li></ul>
<p><br/>
<b>Switching back:</b>
</p><p><b>Schedule</b>
</p>
<ul><li>Services: <a class="external text" href="https://zonestamp.toolforge.org/1682431229">Tuesday, April 25th, 2023 14:00 UTC</a></li>
<li>Traffic: March 14 2023</li>
<li>MediaWiki: <a class="external text" href="https://zonestamp.toolforge.org/1682517645">Wednesday, April 26th 2023 14:00 UTC</a></li></ul>
<p><b>Reports</b>
</p>
<ul><li>Read only: 3 minutes 1 second</li></ul>
<h3 data-mw-thread-id="h-2021_switches-Past_Switches"><span class="mw-headline" id="2021_switches"><span data-mw-comment-start="" id="h-2021_switches-Past_Switches"></span>2021 switches<span data-mw-comment-end="h-2021_switches-Past_Switches"></span></span></h3>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T281515" class="extiw" title="phabricator:T281515"><span class="trakfab-T281515">Task T281515</span></a></b></div>
<dl><dt>Schedule</dt></dl>
<ul><li>Services: <a class="external text" href="https://zonestamp.toolforge.org/1624888854">Monday, June 28th, 2021 14:00 UTC</a></li>
<li>Traffic: <a class="external text" href="https://zonestamp.toolforge.org/1624892434">Monday, June 28th, 2021 15:00 UTC</a></li>
<li>MediaWiki: <a class="external text" href="https://zonestamp.toolforge.org/1624975258">Tuesday, June 29th, 2021 14:00 UTC</a></li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a class="external text" href="https://techblog.wikimedia.org/2021/07/23/june-2021-data-center-switchover/">June 2021 Data Center Switchover</a> on the Wikimedia Tech blog</li>
<li><a class="external text" href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/message/XI57Z6T2DK7IC345VFTENM5RLTQBQDEQ/">Services and Traffic</a> on wikitech-l</li>
<li><a class="external text" href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/message/ENL3P5SA7RSOHPN4ILMXQ2BGBF5XR776/">MediaWiki</a> on wikitech-l</li>
<li><a href="/wiki/Incident_documentation/2021-06-29_trwikivoyage_primary_db" class="mw-redirect" title="Incident documentation/2021-06-29 trwikivoyage primary db">Incident documentation/2021-06-29 trwikivoyage primary db</a></li>
<li>Read only duration: 1 minute 57 seconds</li></ul>
<p><b>Switching back:</b>
</p>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T287539" class="extiw" title="phabricator:T287539"><span class="trakfab-T287539">Task T287539</span></a></b></div>
<ul><li>Services: <a class="external text" href="https://zonestamp.toolforge.org/1631541650">Monday, Sept 13th 14:00 UTC</a></li>
<li>Traffic: <a class="external text" href="https://zonestamp.toolforge.org/1631545256">Monday, Sept 13th 15:00 UTC</a></li>
<li>MediaWiki: <a class="external text" href="https://zonestamp.toolforge.org/1631628029">Tuesday, Sept 14th 14:00 UTC</a></li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a class="external text" href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/message/6UZCCACCBCZLN5MHROZQXUG6ZOQTDCLO/">Datacenter switchover recap</a> on wikitech-l</li>
<li>Read only duration: 2 minutes 42 seconds</li></ul>
<h3 data-mw-thread-id="h-2020_switches-Past_Switches"><span class="mw-headline" id="2020_switches"><span data-mw-comment-start="" id="h-2020_switches-Past_Switches"></span>2020 switches<span data-mw-comment-end="h-2020_switches-Past_Switches"></span></span></h3>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T243314" class="extiw" title="phabricator:T243314"><span class="trakfab-T243314">Task T243314</span></a></b></div>
<dl><dt>Schedule</dt></dl>
<ul><li>Services: Monday, August 31st, 2020 14:00 UTC</li>
<li>Traffic: Monday, August 31st, 2020 15:00 UTC</li>
<li>MediaWiki: Tuesday, September 1st, 2020 14:00 UTC</li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a href="/wiki/Incident_documentation/2020-09-01_data-center-switchover" class="mw-redirect" title="Incident documentation/2020-09-01 data-center-switchover">Incident documentation/2020-09-01 data-center-switchover</a></li>
<li>Read only duration: 2 minutes 49 seconds</li></ul>
<p><b>Switching back:</b>
</p>
<ul><li>Traffic: Thursday, September 17th, 2020 17:00 UTC</li>
<li>MediaWiki: Tuesday, October 27th, 2020 14:00 UTC</li>
<li>Services: Wednesday, October 28th, 2020 14:00 UTC</li></ul>
<h3 data-mw-thread-id="h-2018_switches-Past_Switches"><span class="mw-headline" id="2018_switches"><span data-mw-comment-start="" id="h-2018_switches-Past_Switches"></span>2018 switches<span data-mw-comment-end="h-2018_switches-Past_Switches"></span></span></h3>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T199073" class="extiw" title="phabricator:T199073"><span class="trakfab-T199073">Task T199073</span></a></b></div>
<dl><dt>Schedule</dt></dl>
<ul><li>Services: Tuesday, September 11th 2018 14:30 UTC</li>
<li>Media storage/Swift: Tuesday, September 11th 2018 15:00 UTC</li>
<li>Traffic: Tuesday, September 11th 2018 19:00 UTC</li>
<li>MediaWiki: Wednesday, September 12th 2018: 14:00 UTC</li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a class="external text" href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/message/LU63AEQYJDWRN4PL6OHFLT5ENMQBVFMW/">Datacenter Switchover recap</a></li>
<li>Read only duration: 7 minutes 34 seconds</li></ul>
<p><b>Switching back:</b>
</p>
<dl><dt>Schedule</dt></dl>
<ul><li>Traffic: Wednesday, October 10th 2018 09:00 UTC</li>
<li>MediaWiki: Wednesday, October 10th 2018: 14:00 UTC</li>
<li>Services: Thursday, October 11th 2018 14:30 UTC</li>
<li>Media storage/Swift: Thursday, October 11th 2018 15:00 UTC</li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a class="external text" href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/message/YSAZEXIMF73OA3OBC4Z4SYJKC6I4EWJH/">Datacenter Switchback recap</a></li>
<li>Read only duration: 4 minutes 41 seconds</li></ul>
<h3 data-mw-thread-id="h-2017_switches-Past_Switches"><span class="mw-headline" id="2017_switches"><span data-mw-comment-start="" id="h-2017_switches-Past_Switches"></span>2017 switches<span data-mw-comment-end="h-2017_switches-Past_Switches"></span></span></h3>
<div style="float:right; clear:right; border:1px solid #999; border-radius: .5em; background-color:#eee; background-image: linear-gradient(#ddd, #eee); font-size:85%; text-align:center; padding:0.5em; margin-left:1em; margin-bottom:1em; width:12em" class="plainlinks mw-trackedTemplate">Tracked in <a href="https://phabricator.wikimedia.org/" class="extiw" title="phabricator:">Phabricator</a><br/><b><a href="https://phabricator.wikimedia.org/T138810" class="extiw" title="phabricator:T138810"><span class="trakfab-T138810">Task T138810</span></a></b></div>
<dl><dt>Schedule</dt></dl>
<ul><li>Elasticsearch: elasticsearch is automatically following mediawiki switch</li>
<li>Services: Tuesday, April 18th 2017 14:30 UTC</li>
<li>Media storage/Swift: Tuesday, April 18th 2017 15:00 UTC</li>
<li>Traffic: Tuesday, April 18th 2017 19:00 UTC</li>
<li>MediaWiki: Wednesday, April 19th 2017 <a rel="nofollow" class="external text" href="https://www.timeanddate.com/worldclock/fixedtime.html?iso=20170419T14">14:00 UTC</a> (user visible, requires read-only mode)</li>
<li>Deployment server: Wednesday, April 19th 2017 16:00 UTC</li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a class="external text" href="https://blog.wikimedia.org/2017/04/18/codfw-temporary-editing-pause/">Editing pause for failover test</a> on Wikimedia Blog</li>
<li><a href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/thread/OLPWQECTXOT57IGPCFMCLHOG4ADCMM4S/" class="extiw" title="listarchive:list/wikitech-l@lists.wikimedia.org/thread/OLPWQECTXOT57IGPCFMCLHOG4ADCMM4S/">Recap</a></li>
<li>Read only duration: 17 minutes</li></ul>
<p><b>Switching back:</b>
</p>
<dl><dt>Schedule</dt></dl>
<ul><li>Traffic: Pre-switchback in two phases: Mon May 1 and Tue May 2 (to avoid cold-cache issues Weds)</li>
<li>MediaWiki:  Wednesday, May 3rd 2017 <a rel="nofollow" class="external text" href="https://www.timeanddate.com/worldclock/fixedtime.html?iso=20170503T14">14:00 UTC</a> (user visible, requires read-only mode)</li>
<li>Elasticsearch: elasticsearch is automatically following mediawiki switch</li>
<li>Services: Thursday, May 4th 2017 14:30 UTC</li>
<li>Swift: Thursday, May 4th 2017 15:30 UTC</li>
<li>Deployment server: Thursday, May 4th 2017 16:00 UTC</li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a href="/wiki/Incident_documentation/2017-05-03_missing_index" class="mw-redirect" title="Incident documentation/2017-05-03 missing index">Incident documentation/2017-05-03 missing index</a></li>
<li><a href="/wiki/Incident_documentation/2017-05-03_x1_outage" class="mw-redirect" title="Incident documentation/2017-05-03 x1 outage">Incident documentation/2017-05-03 x1 outage</a></li>
<li><a href="https://lists.wikimedia.org/hyperkitty/list/wikitech-l@lists.wikimedia.org/thread/OLPWQECTXOT57IGPCFMCLHOG4ADCMM4S/" class="extiw" title="listarchive:list/wikitech-l@lists.wikimedia.org/thread/OLPWQECTXOT57IGPCFMCLHOG4ADCMM4S/">Recap</a></li>
<li>Read only duration: 13 minutes</li></ul>
<h3 data-mw-thread-id="h-2016_switches-Past_Switches"><span class="mw-headline" id="2016_switches"><span data-mw-comment-start="" id="h-2016_switches-Past_Switches"></span>2016 switches<span data-mw-comment-end="h-2016_switches-Past_Switches"></span></span></h3>
<dl><dt>Schedule</dt></dl>
<ul><li>Deployment server: Wednesday, January 20th 2016</li>
<li>Traffic: Thursday, March 10th 2016</li>
<li>MediaWiki 5-minute read-only test: Tuesday, March 15th 2016, 07:00 UTC</li>
<li>Elasticsearch: Thursday, April 7th 2016, 12:00 UTC</li>
<li>Media storage/Swift: Thursday, April 14th 2016, 17:00 UTC</li>
<li>Services: Monday, April 18th 2016, 10:00 UTC</li>
<li>MediaWiki: Tuesday, April 19th 2016, 14:00 UTC / 07:00 PDT / 16:00 CEST (requires read-only mode)</li></ul>
<dl><dt>Reports</dt></dl>
<ul><li><a class="external text" href="https://blog.wikimedia.org/2016/04/11/wikimedia-failover-test/">Wikimedia failover test</a> on Wikimedia Blog</li></ul>
<p><b>Switching back:</b>
</p>
<ul><li>MediaWiki: Thursday, April 21st 2016, 14:00 UTC / 07:00 PDT / 16:00 CEST (requires read-only mode)</li>
<li>Services, Elasticsearch, Traffic, Swift, Deployment server: Thursday, April 21st 2016, after the above is done</li></ul>
<div class="mw-heading mw-heading2 ext-discussiontools-init-section"><h2 data-mw-thread-id="h-Monitoring_Dashboards"><span class="mw-headline" id="Monitoring_Dashboards"><span data-mw-comment-start="" id="h-Monitoring_Dashboards"></span>Monitoring Dashboards<span data-mw-comment-end="h-Monitoring_Dashboards"></span></span></h2><!--__DTELLIPSISBUTTON__{"threadItem":{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Monitoring_Dashboards","replies":[]}}--></div>
<p>Aggregated list of interesting dashboards 
</p>
<ul><li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/apache-hhvm?orgId=1">Apache/HHVM</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/mediawiki-application-servers?orgId=1">App servers</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/load-balancers?orgId=1">Load Balancers</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/frontend-traffic?refresh=1m&amp;orgId=1">Frontend traffic</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/prometheus-varnish-dc-stats?orgId=1&amp;var-datasource=eqiad%20prometheus%2Fops&amp;var-cluster=cache_upload&amp;var-layear-layer=backend">Varnish eqiad</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/db/prometheus-varnish-dc-stats?orgId=1&amp;var-datasource=codfw%20prometheus%2Fops&amp;var-cluster=cache_upload&amp;var-layer=backend">Varnish codfw</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/file/swift.json?orgId=1">Swift eqiad</a></li>
<li><a class="external text" href="https://grafana.wikimedia.org/dashboard/file/swift.json?orgId=1&amp;var-DC=codfw">Swift codfw</a></li></ul>
<!-- 
NewPP limit report
Parsed by cloudweb1003
Cached time: 20240425202751
Cache expiry: 2592000
Reduced expiry: false
Complications: [show‚Äêtoc]
DiscussionTools time usage: 0.026 seconds
CPU time usage: 0.138 seconds
Real time usage: 0.151 seconds
Preprocessor visited node count: 6196/1000000
Post‚Äêexpand include size: 14901/2097152 bytes
Template argument size: 5850/2097152 bytes
Highest expansion depth: 13/100
Expensive parser function count: 6/500
Unstrip recursion depth: 0/20
Unstrip post‚Äêexpand size: 18524/5000000 bytes
Lua time usage: 0.005/10.000 seconds
Lua memory usage: 708802/52428800 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   68.935      1 -total
 61.17%   42.170      8 Template:Tracked
 55.34%   38.150     24 Template:Dir
 24.73%   17.049     24 Template:Pagelang
 16.05%   11.066      3 Template:Warning
 15.64%   10.784     11 Template:Note
 11.43%    7.878      1 Template:Colored_box
  1.69%    1.167      1 Template:Anchor
  1.31%    0.903      1 Template:See
  0.43%    0.294      1 Template:Warn
-->

<!-- Saved in parser cache with key labswiki:pcache:idhash:56257-0!canonical and timestamp 20240425202751 and revision id 2164096. Rendering was triggered because: page-view
 -->
</div>
<div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wikitech.wikimedia.org/w/index.php?title=Switch_Datacenter&amp;oldid=2164096">https://wikitech.wikimedia.org/w/index.php?title=Switch_Datacenter&amp;oldid=2164096</a>"</div></div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/wiki/Category:SRE_Service_Operations" title="Category:SRE Service Operations">SRE Service Operations</a></li></ul></div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" >
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last edited on 1 April 2024, at 13:22.</li>
	<li id="footer-info-copyright">Text is available under the <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">Creative Commons Attribution-ShareAlike License</a>;
additional terms may apply.
See <a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Terms_of_Use">Terms of Use</a> for details.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Privacy_policy">Privacy policy</a></li>
	<li id="footer-places-about"><a href="/wiki/Main_Page">About Wikitech</a></li>
	<li id="footer-places-disclaimers"><a href="https://foundation.wikimedia.org/wiki/General_disclaimer">Disclaimers</a></li>
	<li id="footer-places-wm-codeofconduct"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Code_of_Conduct">Code of Conduct</a></li>
	<li id="footer-places-developers"><a href="https://developer.wikimedia.org">Developers</a></li>
	<li id="footer-places-statslink"><a href="https://stats.wikimedia.org/#/wikitech.wikimedia.org">Statistics</a></li>
	<li id="footer-places-cookiestatement"><a href="https://foundation.wikimedia.org/wiki/Special:MyLanguage/Policy:Cookie_statement">Cookie statement</a></li>
	<li id="footer-places-mobileview"><a href="//wikitech.wikimedia.org/w/index.php?title=Switch_Datacenter&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://wikimediafoundation.org/"><img src="/static/images/footer/wikimedia-button.png" srcset="/static/images/footer/wikimedia-button-1.5x.png 1.5x, /static/images/footer/wikimedia-button-2x.png 2x" width="88" height="31" alt="Wikimedia Foundation" loading="lazy" /></a></li>
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="/static/images/footer/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/static/images/footer/poweredby_mediawiki_132x47.png 1.5x, /static/images/footer/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgHostname":"cloudweb1004","wgBackendResponseTime":90,"wgDiscussionToolsPageThreads":[{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Introduction","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-What?-Introduction","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-When?-Introduction","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Impact","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-What_does_read-only_mean?-Impact","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-High_Level_switchover_flow","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Scheduling_details-High_Level_switchover_flow","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_1_-_Tuesday:_Traffic+Services-Scheduling_details","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_2_-_Wednesday:_MediaWiki-Scheduling_details","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_3_-_Thursday:_Deployment_Server_+_Special_cases-Scheduling_details","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_8_-_Wednesday:_Pool_back_inactive_DC-Scheduling_details","replies":[]}]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Weeks_in_advance:_communication,_testing,_and_preparation","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Communication_-_10_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Testing_-_3_weeks_before-Weeks_in_advance:_communication,_testing,_and_preparation","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Live_Test-Testing_-_3_weeks_before","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Dry_Run-Testing_-_3_weeks_before","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Preparation_-_a_few_days_before-Weeks_in_advance:_communication,_testing,_and_preparation","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Per-service_switchover_instructions","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Traffic-Per-service_switchover_instructions","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-General_procedure-Traffic","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_1:_Depool_source_datacentre-Traffic","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_8:_Switch_to_Multi-DC_again-Traffic","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Dashboards-Traffic","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Services-Per-service_switchover_instructions","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-General_procedure_2-Services","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_1:_Depooling_source_DC-Services","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_8:_Switch_to_Multi-DC_again_2-Services","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-MediaWiki-Per-service_switchover_instructions","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Day_2:_MediaWiki_Switchover-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_0_-_preparation-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_1_-_stop_maintenance-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_2_-_read-only_mode-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_3_-_lock_down_database_masters-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_4_-_switch_active_datacenter_configuration-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_5_-_DEPRECATED_-_Invert_Redis_replication_for_MediaWiki_sessions-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_6_-_Set_new_site's_databases_to_read-write-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_7_-_Set_MediaWiki_to_read-write-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_8_-_Restore_rest_of_MediaWiki-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_9_-_Post_read-only-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Phase_10_-_verification_and_troubleshooting-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Dashboards_2-MediaWiki","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Dashboards_3-MediaWiki","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-ElasticSearch-Per-service_switchover_instructions","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-General_context_on_how_to_switchover-ElasticSearch","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Dashboards_4-ElasticSearch","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Special_cases-Per-service_switchover_instructions","replies":[{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Exclusions-Special_cases","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Single_service-Special_cases","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-apt-Special_cases","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-restbase-async-Special_cases","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Manual_switch-Special_cases","replies":[]},{"headingLevel":4,"name":"h-","type":"heading","level":0,"id":"h-Dashboards_5-Special_cases","replies":[]}]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Databases-Per-service_switchover_instructions","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-Other_miscellaneous-Per-service_switchover_instructions","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Predictable,_Recurring_Switchovers","replies":[]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Upcoming_Switches","replies":[]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Past_Switches","replies":[{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2024_switches-Past_Switches","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2023_switches-Past_Switches","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2021_switches-Past_Switches","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2020_switches-Past_Switches","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2018_switches-Past_Switches","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2017_switches-Past_Switches","replies":[]},{"headingLevel":3,"name":"h-","type":"heading","level":0,"id":"h-2016_switches-Past_Switches","replies":[]}]},{"headingLevel":2,"name":"h-","type":"heading","level":0,"id":"h-Monitoring_Dashboards","replies":[]}],"wgPageParseReport":{"discussiontools":{"limitreport-timeusage":"0.026"},"limitreport":{"cputime":"0.138","walltime":"0.151","ppvisitednodes":{"value":6196,"limit":1000000},"postexpandincludesize":{"value":14901,"limit":2097152},"templateargumentsize":{"value":5850,"limit":2097152},"expansiondepth":{"value":13,"limit":100},"expensivefunctioncount":{"value":6,"limit":500},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":18524,"limit":5000000},"timingprofile":["100.00%   68.935      1 -total"," 61.17%   42.170      8 Template:Tracked"," 55.34%   38.150     24 Template:Dir"," 24.73%   17.049     24 Template:Pagelang"," 16.05%   11.066      3 Template:Warning"," 15.64%   10.784     11 Template:Note"," 11.43%    7.878      1 Template:Colored_box","  1.69%    1.167      1 Template:Anchor","  1.31%    0.903      1 Template:See","  0.43%    0.294      1 Template:Warn"]},"scribunto":{"limitreport-timeusage":{"value":"0.005","limit":"10.000"},"limitreport-memusage":{"value":708802,"limit":52428800}},"cachereport":{"origin":"cloudweb1003","timestamp":"20240425202751","ttl":2592000,"transientcontent":false}}});});</script>
</body>
</html> contentType 9 text/html url 57 https://wikitech.wikimedia.org:443/wiki/Switch_Datacenter responseCode 3 200 