uakkamrmaifgbmwceonauerskapqemlotokiiczg length 5 48802 page 48802 <!DOCTYPE HTML>
<html lang="en">
  <head>
<!-- PDTQ-131 -->
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N3RT7TD');</script>
<!-- End Google Tag Manager -->
    
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>S3 Deployment - Travis CI</title>
<link rel="stylesheet" href="/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="https://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>

<script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@travisci" />
<meta name="twitter:creator" content="@travisci" />
<meta property="og:title" content="Travis CI Documentation" />
<meta property="og:type" content="website" />
<meta property="og:url" content=/user/deployment/s3/ />
<meta property="og:description" content="S3 Deployment" />
<meta property="og:image" content="/images/TravisCI-Full-Color.png" }} />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="642" />
<meta property="og:image:height" content="201" />
<meta property="og:image:alt" content="Travis CI logo" />


 

  </head>
  <body>
<!-- PDTQ-131 -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N3RT7TD"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="https://travis-ci.com/" title="Travis CI">Travis</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

          Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Getting Started</h3>
      <ul>
        <li><a href="/user/for-beginners/">Core Concepts for Beginners</a></li>
        <li><a href="/user/tutorial/">Travis CI Tutorial</a></li>
        <li><a href="/user/customizing-the-build/">Customizing the Build</a></li>
        <li><a href="/user/speeding-up-the-build/">Speeding up the Build</a></li>
        <li><a href="/user/docker/">Using Docker in your Build</a></li>
        <li><a href="/user/gui-and-headless-browsers/">Headless Testing with Browsers</a></li>
        <li><a href="/user/pull-requests/">Building Pull Requests</a></li>
        <li><a href="/user/cron-jobs/">Cron Jobs</a></li>
        <li><a href="/user/common-build-problems/">Common Build Problems</a></li>
        <li><a href="https://github.com/travis-ci/travis#readme">Command Line Client</a></li>
        <li><a href="/user/build-config-imports/">Build Config Imports</a></li>
        <li><a href="/user/build-config-validation/">Build Config Validation</a></li>
      </ul>

      <h3>Jobs, Builds, Matrices and Stages</h3>
      <ul>
        <li><a href="/user/job-lifecycle/">Job Lifecycle</a></li>
        <li><a href="/user/build-matrix/">Build Matrix</a></li>
        <li><a href="/user/build-stages/">Build Stages</a></li>
        <li><a href="/user/conditional-builds-stages-jobs/">Conditional Builds, Stages, and Jobs</a></li>
      </ul>

      <h3>Installing Dependencies</h3>
      <ul>
        <li><a href="/user/installing-dependencies/">Installing Dependencies</a></li>
        <li><a href="/user/private-dependencies/">Private Dependencies GitHub</a></li>
        <li><a href="/user/private-dependencies-bb/">Private Dependencies Bitbucket</a></li>
        <li><a href="/user/database-setup/">Setting up Services and Databases</a></li>
        <li><a href="/user/caching/">Caching Dependencies</a></li>
        <li><a href="/user/using-workspaces/">Caching Dependencies within a Build (Workspaces)</a></li>
        <li><a href="/user/ssh-known-hosts/">Adding to SSH Known Hosts</a></li>
      </ul>

      <h3>Programming Languages</h3>
      <ul>
      
        <li><a href="/user/languages/android/">Android</a></li>
      
        <li><a href="/user/languages/c/">C</a></li>
      
        <li><a href="/user/languages/csharp/">C#</a></li>
      
        <li><a href="/user/languages/cpp/">C++</a></li>
      
        <li><a href="/user/languages/clojure/">Clojure</a></li>
      
        <li><a href="/user/languages/crystal/">Crystal</a></li>
      
        <li><a href="/user/languages/d/">D</a></li>
      
        <li><a href="/user/languages/dart/">Dart</a></li>
      
        <li><a href="/user/languages/elixir/">Elixir</a></li>
      
        <li><a href="/user/languages/elm/">Elm</a></li>
      
        <li><a href="/user/languages/erlang/">Erlang</a></li>
      
        <li><a href="/user/languages/csharp/">F#</a></li>
      
        <li><a href="/user/languages/minimal-and-generic/">Generic</a></li>
      
        <li><a href="/user/languages/go/">Go</a></li>
      
        <li><a href="/user/languages/groovy/">Groovy</a></li>
      
        <li><a href="/user/languages/haskell/">Haskell</a></li>
      
        <li><a href="/user/languages/haxe/">Haxe</a></li>
      
        <li><a href="/user/languages/java/">Java</a></li>
      
        <li><a href="/user/languages/javascript-with-nodejs/">JavaScript <small>(with Node.js)</small></a></li>
      
        <li><a href="/user/languages/julia/">Julia</a></li>
      
        <li><a href="/user/languages/matlab/">MATLAB</a></li>
      
        <li><a href="/user/languages/minimal-and-generic/">Minimal</a></li>
      
        <li><a href="/user/languages/nix/">Nix</a></li>
      
        <li><a href="/user/languages/objective-c/">Objective-C</a></li>
      
        <li><a href="/user/languages/perl/">Perl</a></li>
      
        <li><a href="/user/languages/perl6/">Perl6</a></li>
      
        <li><a href="/user/languages/php/">PHP</a></li>
      
        <li><a href="/user/languages/python/">Python</a></li>
      
        <li><a href="/user/languages/r/">R</a></li>
      
        <li><a href="/user/languages/ruby/">Ruby</a></li>
      
        <li><a href="/user/languages/rust/">Rust</a></li>
      
        <li><a href="/user/languages/scala/">Scala</a></li>
      
        <li><a href="/user/languages/smalltalk/">Smalltalk</a></li>
      
        <li><a href="/user/languages/objective-c/">Swift</a></li>
      
        <li><a href="/user/languages/csharp/">Visual Basic</a></li>
      
        <li><a href="/user/languages/community-supported-languages/">Adding a language</a></li>
      </ul>

      <h3>Deployments and Uploads</h3>
      <ul>
        
          <li class="is-overview"><a href="/user/deployment/">Overview</a></li>
          
        
        
          <li><a href="/user/deployment/anynines/">anynines</a></li>
        
          <li><a href="/user/deployment/atlas/">Atlas</a></li>
        
          <li><a href="/user/deployment/codedeploy/">AWS CodeDeploy</a></li>
        
          <li><a href="/user/deployment/elasticbeanstalk/">AWS Elastic Beanstalk</a></li>
        
          <li><a href="/user/deployment/lambda/">AWS Lambda</a></li>
        
          <li><a href="/user/deployment/opsworks/">AWS OpsWorks</a></li>
        
          <li><a href="/user/deployment/s3/">AWS S3</a></li>
        
          <li><a href="/user/deployment/azure-web-apps/">Azure Web Apps</a></li>
        
          <li><a href="/user/deployment/bintray/">bintray</a></li>
        
          <li><a href="/user/deployment/bitballoon/">BitBalloon</a></li>
        
          <li><a href="/user/deployment/bluemixcloudfoundry/">Bluemix CloudFoundry</a></li>
        
          <li><a href="/user/deployment/boxfuse/">Boxfuse</a></li>
        
          <li><a href="/user/deployment/catalyze/">Catalyze</a></li>
        
          <li><a href="/user/deployment/chefsupermarket/">Chef Supermarket</a></li>
        
          <li><a href="/user/deployment/cloud66/">Cloud 66</a></li>
        
          <li><a href="/user/deployment/cloudfoundry/">CloudFoundry</a></li>
        
          <li><a href="/user/deployment/cargo/">Cargo</a></li>
        
          <li><a href="/user/deployment/engineyard/">Engine Yard</a></li>
        
          <li><a href="/user/deployment/pages/">GitHub Pages</a></li>
        
          <li><a href="/user/deployment/releases/">GitHub Releases</a></li>
        
          <li><a href="/user/deployment/google-app-engine/">Google App Engine</a></li>
        
          <li><a href="/user/deployment/gcs/">Google Cloud Storage</a></li>
        
          <li><a href="/user/deployment/firebase/">Google Firebase</a></li>
        
          <li><a href="/user/deployment/hackage/">Hackage</a></li>
        
          <li><a href="/user/deployment/hephy/">Hephy</a></li>
        
          <li><a href="/user/deployment/heroku/">Heroku</a></li>
        
          <li><a href="/user/deployment/launchpad/">Launchpad</a></li>
        
          <li><a href="/user/deployment/npm/">npm</a></li>
        
          <li><a href="/user/deployment/openshift/">OpenShift</a></li>
        
          <li><a href="/user/deployment/packagecloud/">packagecloud.io</a></li>
        
          <li><a href="/user/deployment/puppetforge/">Puppet Forge</a></li>
        
          <li><a href="/user/deployment/pypi/">PyPI</a></li>
        
          <li><a href="/user/deployment/cloudfiles/">Rackspace Cloud Files</a></li>
        
          <li><a href="/user/deployment/rubygems/">RubyGems</a></li>
        
          <li><a href="/user/deployment/scalingo/">Scalingo</a></li>
        
          <li><a href="/user/deployment/script/">Script</a></li>
        
          <li><a href="/user/deployment/snaps/">Snap Store</a></li>
        
          <li><a href="/user/deployment/surge/">Surge.sh</a></li>
        
          <li><a href="/user/deployment/testfairy/">TestFairy</a></li>
        
          <li><a href="/user/deployment/transifex/">Transifex</a></li>
        
        <li><a href="/user/uploading-artifacts/">Uploading Build Artifacts</a></li>
      </ul>

      <h3>CI Environment Reference</h3>
      <ul>
        <li class="is-overview"><a href="/user/reference/overview/">Overview</a></li>
        <li><a href="/user/reference/linux/">Ubuntu Linux CI Environment References</a></li>
        <li><a href="/user/reference/osx/">macOS CI Environment Reference</a></li>
        <li><a href="/user/reference/windows/">Windows CI Environment Reference</a></li>
        <li><a href="/user/reference/freebsd/">FreeBSD CI Environment Reference</a></li>
        <li><a href="/user/multi-os/">Building on Multiple Operating Systems</a></li>
        <li><a href="/user/multi-cpu-architectures/">Building on Multiple CPU Architectures</a></li>
        <li><a href="/user/environment-variables/">Environment Variables</a></li>
        <li><a href="/user/build-environment-updates/">Build Environment Updates</a></li>
        <li><a href="/user/ip-addresses/">Build Machines IP Addresses</a></li>
      </ul>

      <h3>Security and Secure Software Supply Chain</h3>
      <ul>
        <li><a href="/user/encryption-keys/">Encrypting Sensitive Data</a></li>
        <li><a href="/user/encrypting-files/">Encrypting Files</a></li>
        <li><a href="/user/github-oauth-scopes/">GitHub Permissions used by Travis CI</a></li>
        <li><a href="/user/bb-oauth-scopes/">Bitbucket Permissions used by Travis CI</a></li>
        <li><a href="/user/assembla-oauth-scopes/">Assembla Permissions used by Travis CI</a></li>
        <li><a href="/user/gl-oauth-scopes/">GitLab Permissions used by Travis CI</a></li>
        <li><a href="/user/disable-job-logs/">Disable Job Logs Availability</a></li>
        <li><a href="/user/best-practices-security/">Best Practices in Securing Your Data</a></li>
        <li><a href="/user/securely-signing-software">Securely Signing Software</a></li>
        <li><a href="/user/sbom">Software Bill of Materials</a></li>
      </ul>

      <h3>Integrations and Notifications</h3>
      <ul>
        <li><a href="/user/notifications/">Configuring Notifications</a></li>
        <li><a href="/user/status-images/">Showing Build Status Images</a></li>
        <li><a href="/user/code-climate/">Code Climate</a></li>
        <li><a href="/user/deepsource/">DeepSource</a></li>
        <li><a href="/user/coveralls/">Coveralls</a></li>
        <li><a href="/user/coverity-scan/">Coverity Scan</a></li>
        <li><a href="/user/browserstack/">BrowserStack</a></li>
        <li><a href="/user/sauce-connect/">Sauce Labs</a></li>
        <li><a href="/user/sonarcloud/">SonarCloud</a></li>
        <li><a href="/user/sourceclear/">SourceClear</a></li>
        <li><a href="/user/build-feeds/">Atom Feeds</a></li>
        <li><a href="/user/cc-menu/">CCMenu / CCTray Feeds</a></li>
        <li><a href="/user/integration/platformio/">Embedded Builds with PlatformIO</a></li>
        <li><a href="/user/hashicorp-vault-integration">Hashicorp Vault</a></li>
        <li><a href="/user/apps/">3rd Party Apps, Clients and Tools</a></li>
      </ul>

      <h3>Developer Program</h3>
      <ul>
        <li class="is-overview"><a href="/user/developer/">Overview</a></li>
        <li><a href="https://developer.travis-ci.com/">API V3</a></li>
        <li><a href="/user/triggering-builds/">Triggering Builds with API V3</a></li>
        <li><a href="https://github.com/travis-ci/travis#ruby-library">The Ruby Library</a></li>
      </ul>
      
      <h3>Hosted Billing</h3>
      <ul>
        <li class="is-overview"><a href="/user/billing-overview/">Overview</a></li>
        <li><a href="/user/billing-autorefill/">Auto-refill</a></li>
        <li><a href="/user/billing-faq/">FAQ</a></li>
      </ul>

      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">Enterprise Docs</a></li>
      </ul>

    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is Open Source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
    <p>Travis CI relies on Open Source <a href="/user/open_source_license/">licensing information</a>.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page" data-swiftype-index='false'><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/deployment/s3.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">S3 Deployment</h1>
          

          
            <blockquote>
              <p>
                This page documents deployments using dpl v1 which currently is the default
                version. The next major version dpl v2 will be released soon, and we recommend
                starting to use it. Please see <a href="https://blog.travis-ci.com/2019-08-27-deployment-tooling-dpl-v2-preview-release">our blog post</a>
                for details. <a href="/user/deployment-v2">dpl v2 documentation can be found here</a>.
              </p>
            </blockquote>
          


          
            <div id="toc" class="toc">
              <ul class="list-language">
  <li><a href="#s3-acl-via-option">S3 ACL via option</a></li>
  <li><a href="#s3-acl-with-bucket-policy">S3 ACL with bucket policy</a></li>
  <li><a href="#s3-bucket-regions">S3 bucket regions</a></li>
  <li><a href="#deploy-one-or-more-files-matching-a-pattern">Deploy One or More files Matching a Pattern</a></li>
  <li><a href="#deploy-from-only-one-folder">Deploy From Only One Folder</a></li>
  <li><a href="#deploy-to-a-specific-s3-folder">Deploy to a Specific S3 Folder</a></li>
  <li><a href="#deploy-to-a-s3-hosted-website">Deploy to a S3 hosted website:</a></li>
  <li><a href="#deploy-to-multiple-buckets">Deploy to Multiple Buckets:</a></li>
  <li><a href="#conditional-releases">Conditional releases</a></li>
  <li><a href="#running-commands-before-and-after-release">Running commands before and after release</a></li>
  <li><a href="#setting-content-encoding-header">Setting <code class="highlighter-rouge">Content-Encoding</code> header</a></li>
  <li><a href="#setting-charset-on-content-type-header">Setting <code class="highlighter-rouge">charset</code> on <code class="highlighter-rouge">Content-Type</code> header</a></li>
  <li><a href="#http-cache-control">HTTP cache control</a></li>
  <li><a href="#set-dot_match-flag-to-upload-files-starting-with-a-period">Set dot_match flag to upload files starting with a period</a></li>
  <li><a href="#using-s3-compatible-object-storage">Using S3-compatible Object Storage</a></li>
</ul>

            </div>
          

          <p>Travis CI can automatically upload your build to Amazon S3 after a successful build.</p>

<p>For a minimal configuration, add the following to your <code class="highlighter-rouge">.travis.yml</code>:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
</code></pre></div></div>

<p>You can find your <a href="https://console.aws.amazon.com/iam/home?#security_credential">AWS Access Keys</a> in your Amazon Console. You should probably encrypt the secret key with the Travis CI command line:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>travis encrypt <span class="nt">--add</span> deploy.secret_access_key
</code></pre></div></div>

<p>The previous example is almost certainly not ideal, as you probably want to upload your built binaries and documentation. Set <code class="highlighter-rouge">skip_cleanup</code> to <code class="highlighter-rouge">true</code> to prevent Travis CI from deleting your build artifacts.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<blockquote>
  <p>Note that deploying to S3 only adds files to your bucket, it does not remove them. If you need to remove deprecated files you can do that manually in your Amazon S3 console.</p>
</blockquote>

<p>Instead of adding your Amazon S3 configuration to your <code class="highlighter-rouge">.travis.yml</code> you can run the Travis CI command line in your project directory to set it up:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis setup s3
</code></pre></div></div>

<p>Keep in mind that the above command has to run in your project directory, so it can modify the <code class="highlighter-rouge">.travis.yml</code> for you.</p>

<h2 id="s3-acl-via-option">S3 ACL via option <a href="#s3-acl-via-option" class="toc-anchor">#</a></h2>

<p>You can set the acl of your uploaded files via the <code class="highlighter-rouge">acl</code> option like this:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">acl</span><span class="pi">:</span> <span class="s">public_read</span>
</code></pre></div></div>

<p>Valid ACL values are: <code class="highlighter-rouge">private</code>, <code class="highlighter-rouge">public_read</code>, <code class="highlighter-rouge">public_read_write</code>, <code class="highlighter-rouge">authenticated_read</code>, <code class="highlighter-rouge">bucket_owner_read</code>, <code class="highlighter-rouge">bucket_owner_full_control</code>. The ACL defaults to <code class="highlighter-rouge">private</code>.</p>

<p>Note that, in order to set <code class="highlighter-rouge">acl</code>, the bucket’s policy must allow such operations via the <code class="highlighter-rouge">s3:PutObjectAcl</code> action.
An example policy might look like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowPublicRead"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRINCIPAL_ID"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"s3:AbortMultipartUpload"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"s3:GetObjectAcl"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"s3:PutObject"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"s3:PutObjectAcl"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::BUCKET_NAME/*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Be sure to set up the principal and resources according to your needs.</p>

<h2 id="s3-acl-with-bucket-policy">S3 ACL with bucket policy <a href="#s3-acl-with-bucket-policy" class="toc-anchor">#</a></h2>

<p>Another way to set ACL for your artifacts is via a S3 bucket policy.</p>

<p>This bucket policy grants the public read permission:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-09-25"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:[{</span><span class="w">
    </span><span class="nl">"Sid"</span><span class="p">:</span><span class="s2">"AllowPublicRead"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:[</span><span class="s2">"s3:GetObject"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:[</span><span class="s2">"arn:aws:s3:::"</span><span class="err">YOUR</span><span class="w"> </span><span class="err">BUCKET</span><span class="w"> </span><span class="err">NAME</span><span class="s2">"/*"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>You have to disable the <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/block-public-access.html">Block Public Access</a> permission on your S3 bucket for this to work. Thus it is safer to avoid storing sensitive information in this S3 bucket.</p>
</blockquote>

<h2 id="s3-bucket-regions">S3 bucket regions <a href="#s3-bucket-regions" class="toc-anchor">#</a></h2>

<p>By default the region <code class="highlighter-rouge">us-east-1</code> is used when deploying to S3. If your bucket is hosted in a different region, deploying using the default region results in the following error.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The bucket you are attempting to access must be addressed using the specified endpoint.
Please send all future requests to this endpoint. (AWS::S3::Errors::PermanentRedirect)
</code></pre></div></div>

<p>This can be resolved by specifying your bucket’s region using the <code class="highlighter-rouge">region</code> configuration. For example, this example uses the <code class="highlighter-rouge">eu-west-1</code> region.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">region</span><span class="pi">:</span> <span class="s">eu-west-1</span>
</code></pre></div></div>

<h2 id="deploy-one-or-more-files-matching-a-pattern">Deploy One or More files Matching a Pattern <a href="#deploy-one-or-more-files-matching-a-pattern" class="toc-anchor">#</a></h2>

<p>To upload files matching a specific pattern, you can add the pattern via the <code class="highlighter-rouge">glob</code> directive as illustrated in the following example:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">glob</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*.txt"</span>
</code></pre></div></div>

<p>This matches all <code class="highlighter-rouge">.txt</code> files in the current directory.</p>

<h2 id="deploy-from-only-one-folder">Deploy From Only One Folder <a href="#deploy-from-only-one-folder" class="toc-anchor">#</a></h2>

<p>Often, you don’t want to upload your entire project to S3. You can tell Travis CI to only upload a single folder to S3. You can use the <code class="highlighter-rouge">local_dir</code> option to do so. This example uploads the <code class="highlighter-rouge">build</code> directory of your project to S3:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">local_dir</span><span class="pi">:</span> <span class="s">build</span>
</code></pre></div></div>

<h2 id="deploy-to-a-specific-s3-folder">Deploy to a Specific S3 Folder <a href="#deploy-to-a-specific-s3-folder" class="toc-anchor">#</a></h2>

<p>Often, you want to upload only to a specific S3 Folder. You can use the <code class="highlighter-rouge">upload-dir</code> option to set the S3 destination folder. This example uploads to the <code class="highlighter-rouge">travis-builds</code> folder of your s3 bucket.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">upload-dir</span><span class="pi">:</span> <span class="s">travis-builds</span>
</code></pre></div></div>

<h2 id="deploy-to-a-s3-hosted-website">Deploy to a S3 hosted website: <a href="#deploy-to-a-s3-hosted-website" class="toc-anchor">#</a></h2>

<p>To upload to a S3 hosted website, to use this template to upload to your website.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
  <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Bucket</span><span class="nv"> </span><span class="s">region"</span>
</code></pre></div></div>

<p>Remember that you need to set the bucket to have an ACL of <code class="highlighter-rouge">public</code> for anybody to be able to see your website.</p>

<h2 id="deploy-to-multiple-buckets">Deploy to Multiple Buckets: <a href="#deploy-to-multiple-buckets" class="toc-anchor">#</a></h2>

<p>If you want to upload to multiple buckets, you can do this:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
    <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
    <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
    <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
    <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="pi">-</span> <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
    <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">ACCESS</span><span class="nv"> </span><span class="s">KEY"</span>
    <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YOUR</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">SECRET</span><span class="nv"> </span><span class="s">KEY"</span>
    <span class="na">bucket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Second</span><span class="nv"> </span><span class="s">S3</span><span class="nv"> </span><span class="s">Bucket"</span>
    <span class="na">skip_cleanup</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h2 id="conditional-releases">Conditional releases <a href="#conditional-releases" class="toc-anchor">#</a></h2>

<p>You can deploy only when certain conditions are met.
See <a href="/user/deployment#conditional-releases-with-on">Conditional Releases with <code class="highlighter-rouge">on:</code></a>.</p>

<h2 id="running-commands-before-and-after-release">Running commands before and after release <a href="#running-commands-before-and-after-release" class="toc-anchor">#</a></h2>

<p>Sometimes you want to run commands before or after releasing a gem. You can use the <code class="highlighter-rouge">before_deploy</code> and <code class="highlighter-rouge">after_deploy</code> stages for this. These will only be triggered if Travis CI is actually pushing a release.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">before_deploy</span><span class="pi">:</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">'ready?'"</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="s">..</span>
    <span class="na">after_deploy</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./after_deploy_1.sh</span>
      <span class="pi">-</span> <span class="s">./after_deploy_2.sh</span>
</code></pre></div></div>

<h2 id="setting-content-encoding-header">Setting <code class="highlighter-rouge">Content-Encoding</code> header <a href="#setting-content-encoding-header" class="toc-anchor">#</a></h2>

<p>S3 uploads can optionally set HTTP header <code class="highlighter-rouge">Content-Encoding</code>.
This header allows files to be sent compressed while retaining file extensions and
the associated MIME types.</p>

<p>To enable this feature, add:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="s">..</span>
  <span class="na">detect_encoding</span><span class="pi">:</span> <span class="no">true</span> <span class="c1"># &lt;== default is false</span>
</code></pre></div></div>

<p>If the file is compressed with <code class="highlighter-rouge">gzip</code> or <code class="highlighter-rouge">compress</code>, it will be uploaded with
the appropriate header.</p>

<h2 id="setting-charset-on-content-type-header">Setting <code class="highlighter-rouge">charset</code> on <code class="highlighter-rouge">Content-Type</code> header <a href="#setting-charset-on-content-type-header" class="toc-anchor">#</a></h2>

<p>S3 can take a content-type header. Normally this doesn’t include a character set as well. If you would like to add a character set, add the <code class="highlighter-rouge">default_text_charset</code> option with what you want it to be. For example:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="s">..</span>
  <span class="na">default_text_charset</span><span class="pi">:</span> <span class="s1">'</span><span class="s">utf-8'</span>  <span class="c1"># Default is ''</span>
</code></pre></div></div>

<h2 id="http-cache-control">HTTP cache control <a href="#http-cache-control" class="toc-anchor">#</a></h2>

<p>S3 uploads can optionally set  <code class="highlighter-rouge">Cache-Control</code> and <code class="highlighter-rouge">Expires</code> HTTP headers.</p>

<p>Set HTTP header <code class="highlighter-rouge">Cache-Control</code> to suggest that the browser cache the file. Defaults to <code class="highlighter-rouge">no-cache</code>. Valid options are <code class="highlighter-rouge">no-cache</code>, <code class="highlighter-rouge">no-store</code>, <code class="highlighter-rouge">max-age=&lt;seconds&gt;</code>, <code class="highlighter-rouge">s-maxage=&lt;seconds&gt; no-transform</code>, <code class="highlighter-rouge">public</code>, <code class="highlighter-rouge">private</code>.</p>

<p><code class="highlighter-rouge">Expires</code> sets the date and time that the cached object is no longer cacheable. Defaults to not set. The date must be in the format <code class="highlighter-rouge">YYYY-MM-DD HH:MM:SS -ZONE</code>.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="s">..</span>
  <span class="na">cache_control</span><span class="pi">:</span> <span class="s2">"</span><span class="s">max-age=31536000"</span>
  <span class="na">expires</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2012-12-21</span><span class="nv"> </span><span class="s">00:00:00</span><span class="nv"> </span><span class="s">-0000"</span>
</code></pre></div></div>

<h2 id="set-dot_match-flag-to-upload-files-starting-with-a-period">Set dot_match flag to upload files starting with a period <a href="#set-dot_match-flag-to-upload-files-starting-with-a-period" class="toc-anchor">#</a></h2>

<p>S3 uploads can be set to upload all files starting with a <code class="highlighter-rouge">.</code></p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="s">..</span>
  <span class="na">dot_match</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h2 id="using-s3-compatible-object-storage">Using S3-compatible Object Storage <a href="#using-s3-compatible-object-storage" class="toc-anchor">#</a></h2>

<p>You can use an S3-compatible object storage such as Digital Ocean Spaces
by setting the <code class="highlighter-rouge">endpoint</code> key.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">s3</span>
  <span class="s">..</span>
  <span class="na">endpoint</span><span class="pi">:</span> <span class="s">https://nyc3.digitaloceanspaces.com</span>
</code></pre></div></div>


        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="layout-inner">
    <div class="footer-elem">
      <svg width="142px" height="45.381px" viewBox="0 0 142 45.381" enable-background="new 0 0 142 45.381" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">
        <title>Travis CI Mascot</title>
        <image xlink:href="https://styleguide.travis-ci.com/images/logos/travis-footer-logo-new.svg" x="0" y="0" width="142px" height="45.381px" />
      </svg>
    </div>

    <div class="footer-elem"></div>

    <div class="footer-elem">
      <h3 class="footer-title">©Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Work with Travis CI</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://changelog.travis-ci.com/">Changelog</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Company</h3>
      <ul>
        <li><a href="/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="https://ideracorp.com/legal/TravisCI">Legal</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle none">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

<script>
 fetch('https://pnpcptp8xh9k.statuspage.io/api/v2/status.json').then(function(response) {
   return response.json();
 }).then(function(data) {
   if (data.status && data.status.indicator) {
     document.querySelector('.status-circle').classList.add(data.status.indicator);
   }
 });
</script>

    </div><!-- /.wrapper -->
  </body>
</html>
 contentType 9 text/html url 50 https://docs.travis-ci.com:443/user/deployment/s3/ responseCode 3 200 