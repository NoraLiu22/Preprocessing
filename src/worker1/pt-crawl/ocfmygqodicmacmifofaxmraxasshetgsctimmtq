ocfmygqodicmacmifofaxmraxasshetgsctimmtq length 5 15616 page 15616 
<html>
<head>
<title>r17321 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r17321 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/17321" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./17320.html" title="Special:Code/MediaWiki/17320">r17320</a>‎ | <b>r17321</b> | <a href="./17322.html" title="Special:Code/MediaWiki/17322">r17322</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>13:25, 31 October 2006</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/tstarling" title="Special:Code/MediaWiki/author/tstarling">tstarling</a></td></tr>
<tr><td>Status:</td><td>old</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">Added {{#special:}} parser function, to give the local default title for special pages</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/RELEASE-NOTES</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2FRELEASE-NOTES" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/CoreParserFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FCoreParserFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/Parser.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FParser.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/SpecialPage.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FSpecialPage.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/languages/messages/MessagesEn.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Flanguages%2Fmessages%2FMessagesEn.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/17321&amp;action=purge" title="Special:Code/MediaWiki/17321">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/RELEASE-NOTES</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -108,6 +108,8 @@</span></td></tr>
<tr id="6"><td class="linenumbers">109</td><td class="linenumbers">109</td><td class="unchanged"><span> * Used special page subpages in a few more places, instead of query parameters.</span></td></tr>
<tr id="7"><td class="linenumbers">110</td><td class="linenumbers">110</td><td class="unchanged"><span> * (bug 7758) Added wrapper span to "templates used" explanation to allow CSS</span></td></tr>
<tr id="8"><td class="linenumbers">111</td><td class="linenumbers">111</td><td class="unchanged"><span>   styling (class="mw-templatesUsedExplanation").</span></td></tr>
<tr id="9"><td class="linenumbers"> </td><td class="linenumbers">112</td><td class="ins"><ins>+* Added {{#special:}} parser function, to give the local default title for </ins></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">113</td><td class="ins"><ins>+  special pages</ins></td></tr>
<tr id="11"><td class="linenumbers">112</td><td class="linenumbers">114</td><td class="unchanged"><span> </span></td></tr>
<tr id="12"><td class="linenumbers">113</td><td class="linenumbers">115</td><td class="unchanged"><span> == Languages updated ==</span></td></tr>
<tr id="13"><td class="linenumbers">114</td><td class="linenumbers">116</td><td class="unchanged"><span> </span></td></tr>
<tr id="14" class="patchedfile"><td colspan="3">Index: trunk/phase3/languages/messages/MessagesEn.php</td></tr>



<tr id="18"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -318,6 +318,7 @@</span></td></tr>
<tr id="19"><td class="linenumbers">319</td><td class="linenumbers">319</td><td class="unchanged"><span> 	'formatnum'              => array( 0,    'FORMATNUM'              ),</span></td></tr>
<tr id="20"><td class="linenumbers">320</td><td class="linenumbers">320</td><td class="unchanged"><span> 	'padleft'                => array( 0,    'PADLEFT'                ),</span></td></tr>
<tr id="21"><td class="linenumbers">321</td><td class="linenumbers">321</td><td class="unchanged"><span> 	'padright'               => array( 0,    'PADRIGHT'               ),</span></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">322</td><td class="ins"><ins>+	'special'                => array( 0,    'special',               ),</ins></td></tr>
<tr id="23"><td class="linenumbers">322</td><td class="linenumbers">323</td><td class="unchanged"><span> );</span></td></tr>
<tr id="24"><td class="linenumbers">323</td><td class="linenumbers">324</td><td class="unchanged"><span> </span></td></tr>
<tr id="25"><td class="linenumbers">324</td><td class="linenumbers">325</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="26" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/Parser.php</td></tr>



<tr id="30"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -164,6 +164,7 @@</span></td></tr>
<tr id="31"><td class="linenumbers">165</td><td class="linenumbers">165</td><td class="unchanged"><span> 		$this->setFunctionHook( 'padleft', array( 'CoreParserFunctions', 'padleft' ), SFH_NO_HASH );</span></td></tr>
<tr id="32"><td class="linenumbers">166</td><td class="linenumbers">166</td><td class="unchanged"><span> 		$this->setFunctionHook( 'padright', array( 'CoreParserFunctions', 'padright' ), SFH_NO_HASH );</span></td></tr>
<tr id="33"><td class="linenumbers">167</td><td class="linenumbers">167</td><td class="unchanged"><span> 		$this->setFunctionHook( 'anchorencode', array( 'CoreParserFunctions', 'anchorencode' ), SFH_NO_HASH );</span></td></tr>
<tr id="34"><td class="linenumbers"> </td><td class="linenumbers">168</td><td class="ins"><ins>+		$this->setFunctionHook( 'special', array( 'CoreParserFunctions', 'special' ) );</ins></td></tr>
<tr id="35"><td class="linenumbers">168</td><td class="linenumbers">169</td><td class="unchanged"><span> </span></td></tr>
<tr id="36"><td class="linenumbers">169</td><td class="linenumbers">170</td><td class="unchanged"><span> 		if ( $wgAllowDisplayTitle ) {</span></td></tr>
<tr id="37"><td class="linenumbers">170</td><td class="linenumbers">171</td><td class="unchanged"><span> 			$this->setFunctionHook( 'displaytitle', array( 'CoreParserFunctions', 'displaytitle' ), SFH_NO_HASH );</span></td></tr>
<tr id="38" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/CoreParserFunctions.php</td></tr>



<tr id="42"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -174,7 +174,15 @@</span></td></tr>
<tr id="43"><td class="linenumbers">175</td><td class="linenumbers">175</td><td class="unchanged"><span> 	function anchorencode( $parser, $text ) {</span></td></tr>
<tr id="44"><td class="linenumbers">176</td><td class="linenumbers">176</td><td class="unchanged"><span> 		return str_replace( '%', '.', str_replace('+', '_', urlencode( $text ) ) );</span></td></tr>
<tr id="45"><td class="linenumbers">177</td><td class="linenumbers">177</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="46"><td class="linenumbers">178</td><td class="linenumbers"> </td><td class="del"><del>-	</del></td></tr>
<tr id="47"><td class="linenumbers"> </td><td class="linenumbers">178</td><td class="ins"><ins>+</ins></td></tr>
<tr id="48"><td class="linenumbers"> </td><td class="linenumbers">179</td><td class="ins"><ins>+	function special( $parser, $text ) {</ins></td></tr>
<tr id="49"><td class="linenumbers"> </td><td class="linenumbers">180</td><td class="ins"><ins>+		$title = SpecialPage::getTitleForAlias( $text );</ins></td></tr>
<tr id="50"><td class="linenumbers"> </td><td class="linenumbers">181</td><td class="ins"><ins>+		if ( $title ) {</ins></td></tr>
<tr id="51"><td class="linenumbers"> </td><td class="linenumbers">182</td><td class="ins"><ins>+			return $title->getPrefixedText();</ins></td></tr>
<tr id="52"><td class="linenumbers"> </td><td class="linenumbers">183</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="53"><td class="linenumbers"> </td><td class="linenumbers">184</td><td class="ins"><ins>+			return wfMsgForContent( 'nosuchspecialpage' );</ins></td></tr>
<tr id="54"><td class="linenumbers"> </td><td class="linenumbers">185</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="55"><td class="linenumbers"> </td><td class="linenumbers">186</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="56"><td class="linenumbers">179</td><td class="linenumbers">187</td><td class="unchanged"><span> }</span></td></tr>
<tr id="57"><td class="linenumbers">180</td><td class="linenumbers">188</td><td class="unchanged"><span> </span></td></tr>
<tr id="58"><td class="linenumbers">181</td><td class="linenumbers">189</td><td class="unchanged"><span> ?></span></td></tr>
<tr id="59" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/SpecialPage.php</td></tr>



<tr id="63"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -475,7 +475,11 @@</span></td></tr>
<tr id="64"><td class="linenumbers">476</td><td class="linenumbers">476</td><td class="unchanged"><span> 	 */</span></td></tr>
<tr id="65"><td class="linenumbers">477</td><td class="linenumbers">477</td><td class="unchanged"><span> 	static function getTitleFor( $name, $subpage = false ) {</span></td></tr>
<tr id="66"><td class="linenumbers">478</td><td class="linenumbers">478</td><td class="unchanged"><span> 		$name = self::getLocalNameFor( $name, $subpage );</span></td></tr>
<tr id="67"><td class="linenumbers">479</td><td class="linenumbers"> </td><td class="del"><del>-		return Title::makeTitle( NS_SPECIAL, $name );</del></td></tr>
<tr id="68"><td class="linenumbers"> </td><td class="linenumbers">479</td><td class="ins"><ins>+		if ( $name ) {</ins></td></tr>
<tr id="69"><td class="linenumbers"> </td><td class="linenumbers">480</td><td class="ins"><ins>+			return Title::makeTitle( NS_SPECIAL, $name );</ins></td></tr>
<tr id="70"><td class="linenumbers"> </td><td class="linenumbers">481</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="71"><td class="linenumbers"> </td><td class="linenumbers">482</td><td class="ins"><ins>+			throw new MWException( "Invalid special page name \"$name\"" );</ins></td></tr>
<tr id="72"><td class="linenumbers"> </td><td class="linenumbers">483</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="73"><td class="linenumbers">480</td><td class="linenumbers">484</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="74"><td class="linenumbers">481</td><td class="linenumbers">485</td><td class="unchanged"><span> </span></td></tr>
<tr id="75"><td class="linenumbers">482</td><td class="linenumbers">486</td><td class="unchanged"><span> 	/**</span></td></tr>
<tr id="76"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -483,15 +487,24 @@</span></td></tr>
<tr id="77"><td class="linenumbers">484</td><td class="linenumbers">488</td><td class="unchanged"><span> 	 */</span></td></tr>
<tr id="78"><td class="linenumbers">485</td><td class="linenumbers">489</td><td class="unchanged"><span> 	static function getSafeTitleFor( $name, $subpage = false ) {</span></td></tr>
<tr id="79"><td class="linenumbers">486</td><td class="linenumbers">490</td><td class="unchanged"><span> 		$name = self::getLocalNameFor( $name, $subpage );</span></td></tr>
<tr id="80"><td class="linenumbers">487</td><td class="linenumbers"> </td><td class="del"><del>-		return Title::makeTitleSafe( NS_SPECIAL, $name );</del></td></tr>
<tr id="81"><td class="linenumbers"> </td><td class="linenumbers">491</td><td class="ins"><ins>+		if ( $name ) {</ins></td></tr>
<tr id="82"><td class="linenumbers"> </td><td class="linenumbers">492</td><td class="ins"><ins>+			return Title::makeTitleSafe( NS_SPECIAL, $name );</ins></td></tr>
<tr id="83"><td class="linenumbers"> </td><td class="linenumbers">493</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="84"><td class="linenumbers"> </td><td class="linenumbers">494</td><td class="ins"><ins>+			return null;</ins></td></tr>
<tr id="85"><td class="linenumbers"> </td><td class="linenumbers">495</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="86"><td class="linenumbers">488</td><td class="linenumbers">496</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="87"><td class="linenumbers">489</td><td class="linenumbers">497</td><td class="unchanged"><span> </span></td></tr>
<tr id="88"><td class="linenumbers">490</td><td class="linenumbers">498</td><td class="unchanged"><span> 	/**</span></td></tr>
<tr id="89"><td class="linenumbers">491</td><td class="linenumbers">499</td><td class="unchanged"><span> 	 * Get a title for a given alias</span></td></tr>
<tr id="90"><td class="linenumbers"> </td><td class="linenumbers">500</td><td class="ins"><ins>+	 * @return Title or null if there is no such alias</ins></td></tr>
<tr id="91"><td class="linenumbers">492</td><td class="linenumbers">501</td><td class="unchanged"><span> 	 */</span></td></tr>
<tr id="92"><td class="linenumbers">493</td><td class="linenumbers">502</td><td class="unchanged"><span> 	static function getTitleForAlias( $alias ) {</span></td></tr>
<tr id="93"><td class="linenumbers">494</td><td class="linenumbers">503</td><td class="unchanged"><span> 		$name = self::resolveAlias( $alias );</span></td></tr>
<tr id="94"><td class="linenumbers">495</td><td class="linenumbers"> </td><td class="del"><del>-		return self::getTitleFor( $name );</del></td></tr>
<tr id="95"><td class="linenumbers"> </td><td class="linenumbers">504</td><td class="ins"><ins>+		if ( $name ) {</ins></td></tr>
<tr id="96"><td class="linenumbers"> </td><td class="linenumbers">505</td><td class="ins"><ins>+			return self::getTitleFor( $name );</ins></td></tr>
<tr id="97"><td class="linenumbers"> </td><td class="linenumbers">506</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="98"><td class="linenumbers"> </td><td class="linenumbers">507</td><td class="ins"><ins>+			return null;</ins></td></tr>
<tr id="99"><td class="linenumbers"> </td><td class="linenumbers">508</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="100"><td class="linenumbers">496</td><td class="linenumbers">509</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="101"><td class="linenumbers">497</td><td class="linenumbers">510</td><td class="unchanged"><span> </span></td></tr>
<tr id="102"><td class="linenumbers">498</td><td class="linenumbers">511</td><td class="unchanged"><span> 	/**</span></td></tr>
</table>
</div>
</form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/17321.html responseCode 3 200 