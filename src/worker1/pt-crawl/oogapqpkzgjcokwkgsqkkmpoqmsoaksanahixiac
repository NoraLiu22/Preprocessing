oogapqpkzgjcokwkgsqkkmpoqmsoaksanahixiac length 5 76402 page 76402 
<html>
<head>
<title>r1695 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r1695 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/1695" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./1694.html" title="Special:Code/MediaWiki/1694">r1694</a>‎ | <b>r1695</b> | <a href="./1696.html" title="Special:Code/MediaWiki/1696">r1696</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>13:10, 21 September 2003</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/timstarling" title="Special:Code/MediaWiki/author/timstarling">timstarling</a></td></tr>
<tr><td>Status:</td><td>old</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">MediaWiki namespace</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/docs/memcached.doc</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fdocs%2Fmemcached.doc" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/Article.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FArticle.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/DatabaseFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FDatabaseFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/DefaultSettings.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FDefaultSettings.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/GlobalFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FGlobalFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/MagicWord.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FMagicWord.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/OutputPage.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FOutputPage.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/install.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Finstall.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/languages/Language.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Flanguages%2FLanguage.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/maintenance/tables.sql</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fmaintenance%2Ftables.sql" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/update.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fupdate.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/1695&amp;action=purge" title="Special:Code/MediaWiki/1695">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/maintenance/tables.sql</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -114,7 +114,7 @@</span></td></tr>
<tr id="6"><td class="linenumbers">115</td><td class="linenumbers">115</td><td class="unchanged"><span>   ipb_reason tinyblob NOT NULL default '',</span></td></tr>
<tr id="7"><td class="linenumbers">116</td><td class="linenumbers">116</td><td class="unchanged"><span>   ipb_timestamp char(14) binary NOT NULL default '',</span></td></tr>
<tr id="8"><td class="linenumbers">117</td><td class="linenumbers">117</td><td class="unchanged"><span>   ipb_auto tinyint(1) NOT NULL default '0',</span></td></tr>
<tr id="9"><td class="linenumbers">118</td><td class="linenumbers"> </td><td class="del"><del>-  UNIQUE KEY ipb_id</del></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">118</td><td class="ins"><ins>+  UNIQUE KEY ipb_id (ipb_id)</ins></td></tr>
<tr id="11"><td class="linenumbers">119</td><td class="linenumbers">119</td><td class="unchanged"><span> ) TYPE=MyISAM PACK_KEYS=1;</span></td></tr>
<tr id="12"><td class="linenumbers">120</td><td class="linenumbers">120</td><td class="unchanged"><span> </span></td></tr>
<tr id="13"><td class="linenumbers">121</td><td class="linenumbers">121</td><td class="unchanged"><span> DROP TABLE IF EXISTS image;</span></td></tr>
<tr id="14" class="patchedfile"><td colspan="3">Index: trunk/phase3/docs/memcached.doc</td></tr>



<tr id="18"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -109,5 +109,11 @@</span></td></tr>
<tr id="19"><td class="linenumbers">110</td><td class="linenumbers">110</td><td class="unchanged"><span> 	set in: LinkCache::addLink()</span></td></tr>
<tr id="20"><td class="linenumbers">111</td><td class="linenumbers">111</td><td class="unchanged"><span> 	cleared by: LinkCache::clearBadLink()</span></td></tr>
<tr id="21"><td class="linenumbers">112</td><td class="linenumbers">112</td><td class="unchanged"><span> 		should be cleared on page deletion and rename</span></td></tr>
<tr id="22"><td class="linenumbers">113</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">113</td><td class="ins"><ins>+MediaWiki namespace:</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">114</td><td class="ins"><ins>+	key: $wgDBname:MediaWiki:title:$title</ins></td></tr>
<tr id="25"><td class="linenumbers"> </td><td class="linenumbers">115</td><td class="ins"><ins>+	ex: wikidb:MediaWiki:title:Blockedtext</ins></td></tr>
<tr id="26"><td class="linenumbers"> </td><td class="linenumbers">116</td><td class="ins"><ins>+	stores: string</ins></td></tr>
<tr id="27"><td class="linenumbers"> </td><td class="linenumbers">117</td><td class="ins"><ins>+	set in: wfMsg()</ins></td></tr>
<tr id="28"><td class="linenumbers"> </td><td class="linenumbers">118</td><td class="ins"><ins>+	cleared by: Article::editUpdates()</ins></td></tr>
<tr id="29"><td class="linenumbers"> </td><td class="linenumbers">119</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="30"><td class="linenumbers">114</td><td class="linenumbers">120</td><td class="unchanged"><span> ... more to come ...</span></td></tr>
<tr id="31" class="patchedfile"><td colspan="3">Index: trunk/phase3/install.php</td></tr>



<tr id="35"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -21,6 +21,7 @@</span></td></tr>
<tr id="36"><td class="linenumbers">22</td><td class="linenumbers">22</td><td class="unchanged"><span> $DP = "./includes";</span></td></tr>
<tr id="37"><td class="linenumbers">23</td><td class="linenumbers">23</td><td class="unchanged"><span> include_once( "./LocalSettings.php" );</span></td></tr>
<tr id="38"><td class="linenumbers">24</td><td class="linenumbers">24</td><td class="unchanged"><span> include_once( "./AdminSettings.php" );</span></td></tr>
<tr id="39"><td class="linenumbers"> </td><td class="linenumbers">25</td><td class="ins"><ins>+include_once( "./maintenance/InitialiseMessages.php" );</ins></td></tr>
<tr id="40"><td class="linenumbers">25</td><td class="linenumbers">26</td><td class="unchanged"><span> </span></td></tr>
<tr id="41"><td class="linenumbers">26</td><td class="linenumbers">27</td><td class="unchanged"><span> if ( $wgUseTeX &amp;&amp; ( ! is_executable( "./math/texvc" ) ) ) {</span></td></tr>
<tr id="42"><td class="linenumbers">27</td><td class="linenumbers">28</td><td class="unchanged"><span> 	print "To use math functions, you must first compile texvc by\n" .</span></td></tr>
<tr id="43"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -272,26 +273,30 @@</span></td></tr>
<tr id="44"><td class="linenumbers">273</td><td class="linenumbers">274</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="45"><td class="linenumbers">274</td><td class="linenumbers">275</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="46"><td class="linenumbers">275</td><td class="linenumbers">276</td><td class="unchanged"><span> 	$wns = Namespace::getWikipedia();</span></td></tr>
<tr id="47"><td class="linenumbers">276</td><td class="linenumbers"> </td><td class="del"><del>-	$ulp = addslashes( wfMsg( "uploadlogpage" ) );</del></td></tr>
<tr id="48"><td class="linenumbers">277</td><td class="linenumbers"> </td><td class="del"><del>-	$dlp = addslashes( wfMsg( "dellogpage" ) );</del></td></tr>
<tr id="49"><td class="linenumbers"> </td><td class="linenumbers">277</td><td class="ins"><ins>+	$ulp = addslashes( wfMsgNoDB( "uploadlogpage" ) );</ins></td></tr>
<tr id="50"><td class="linenumbers"> </td><td class="linenumbers">278</td><td class="ins"><ins>+	$dlp = addslashes( wfMsgNoDB( "dellogpage" ) );</ins></td></tr>
<tr id="51"><td class="linenumbers">278</td><td class="linenumbers">279</td><td class="unchanged"><span> </span></td></tr>
<tr id="52"><td class="linenumbers">279</td><td class="linenumbers">280</td><td class="unchanged"><span> 	$sql = "DELETE FROM cur";</span></td></tr>
<tr id="53"><td class="linenumbers">280</td><td class="linenumbers">281</td><td class="unchanged"><span> 	wfQuery( $sql, DB_WRITE, $fname );</span></td></tr>
<tr id="54"><td class="linenumbers">281</td><td class="linenumbers">282</td><td class="unchanged"><span> </span></td></tr>
<tr id="55"><td class="linenumbers">282</td><td class="linenumbers">283</td><td class="unchanged"><span> 	$sql = "INSERT INTO cur (cur_namespace,cur_title,cur_text," .</span></td></tr>
<tr id="56"><td class="linenumbers">283</td><td class="linenumbers">284</td><td class="unchanged"><span> 	  "cur_restrictions) VALUES ({$wns},'{$ulp}','" .</span></td></tr>
<tr id="57"><td class="linenumbers">284</td><td class="linenumbers"> </td><td class="del"><del>-	  wfStrencode( wfMsg( "uploadlogpagetext" ) ) . "','sysop')";</del></td></tr>
<tr id="58"><td class="linenumbers"> </td><td class="linenumbers">285</td><td class="ins"><ins>+	  wfStrencode( wfMsgNoDB( "uploadlogpagetext" ) ) . "','sysop')";</ins></td></tr>
<tr id="59"><td class="linenumbers">285</td><td class="linenumbers">286</td><td class="unchanged"><span> 	wfQuery( $sql, DB_WRITE, $fname );</span></td></tr>
<tr id="60"><td class="linenumbers">286</td><td class="linenumbers">287</td><td class="unchanged"><span> </span></td></tr>
<tr id="61"><td class="linenumbers">287</td><td class="linenumbers">288</td><td class="unchanged"><span> 	$sql = "INSERT INTO cur (cur_namespace,cur_title,cur_text," .</span></td></tr>
<tr id="62"><td class="linenumbers">288</td><td class="linenumbers">289</td><td class="unchanged"><span> 	  "cur_restrictions) VALUES ({$wns},'{$dlp}','" .</span></td></tr>
<tr id="63"><td class="linenumbers">289</td><td class="linenumbers"> </td><td class="del"><del>-	  wfStrencode( wfMsg( "dellogpagetext" ) ) . "','sysop')";</del></td></tr>
<tr id="64"><td class="linenumbers"> </td><td class="linenumbers">290</td><td class="ins"><ins>+	  wfStrencode( wfMsgNoDB( "dellogpagetext" ) ) . "','sysop')";</ins></td></tr>
<tr id="65"><td class="linenumbers">290</td><td class="linenumbers">291</td><td class="unchanged"><span> 	wfQuery( $sql, DB_WRITE, $fname );</span></td></tr>
<tr id="66"><td class="linenumbers">291</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="67"><td class="linenumbers"> </td><td class="linenumbers">292</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="68"><td class="linenumbers"> </td><td class="linenumbers">293</td><td class="ins"><ins>+	$titleobj = Title::newFromText( wfMsgNoDB( "mainpage" ) );</ins></td></tr>
<tr id="69"><td class="linenumbers"> </td><td class="linenumbers">294</td><td class="ins"><ins>+	$title = $titleobj->getDBkey();</ins></td></tr>
<tr id="70"><td class="linenumbers">292</td><td class="linenumbers">295</td><td class="unchanged"><span> 	$sql = "INSERT INTO cur (cur_namespace,cur_title,cur_text) " .</span></td></tr>
<tr id="71"><td class="linenumbers">293</td><td class="linenumbers"> </td><td class="del"><del>-	  "VALUES (0,'" . wfStrencode( wfMsg( "mainpage" ) ) . "','" .</del></td></tr>
<tr id="72"><td class="linenumbers">294</td><td class="linenumbers"> </td><td class="del"><del>-	  wfStrencode( wfMsg( "mainpagetext" ) ) . "')";</del></td></tr>
<tr id="73"><td class="linenumbers"> </td><td class="linenumbers">296</td><td class="ins"><ins>+	  "VALUES (0,'$title','" .</ins></td></tr>
<tr id="74"><td class="linenumbers"> </td><td class="linenumbers">297</td><td class="ins"><ins>+	  wfStrencode( wfMsgNoDB( "mainpagetext" ) ) . "')";</ins></td></tr>
<tr id="75"><td class="linenumbers">295</td><td class="linenumbers">298</td><td class="unchanged"><span> 	wfQuery( $sql, DB_WRITE, $fname );</span></td></tr>
<tr id="76"><td class="linenumbers"> </td><td class="linenumbers">299</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="77"><td class="linenumbers"> </td><td class="linenumbers">300</td><td class="ins"><ins>+	initialiseMessages();</ins></td></tr>
<tr id="78"><td class="linenumbers">296</td><td class="linenumbers">301</td><td class="unchanged"><span> }</span></td></tr>
<tr id="79"><td class="linenumbers">297</td><td class="linenumbers">302</td><td class="unchanged"><span> </span></td></tr>
<tr id="80"><td class="linenumbers">298</td><td class="linenumbers">303</td><td class="unchanged"><span> ?></span></td></tr>
<tr id="81" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/MagicWord.php</td></tr>



<tr id="85"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -15,7 +15,7 @@</span></td></tr>
<tr id="86"><td class="linenumbers">16</td><td class="linenumbers">16</td><td class="unchanged"><span> </span></td></tr>
<tr id="87"><td class="linenumbers">17</td><td class="linenumbers">17</td><td class="unchanged"><span> class MagicWord {</span></td></tr>
<tr id="88"><td class="linenumbers">18</td><td class="linenumbers">18</td><td class="unchanged"><span> 	/*private*/ var $mId, $mSynonyms, $mCaseSensitive, $mRegex;</span></td></tr>
<tr id="89"><td class="linenumbers">19</td><td class="linenumbers"> </td><td class="del"><del>-	/*private*/ var $mRegexStart, $mBaseRegex;</del></td></tr>
<tr id="90"><td class="linenumbers"> </td><td class="linenumbers">19</td><td class="ins"><ins>+	/*private*/ var $mRegexStart, $mBaseRegex, $mVariableRegex;</ins></td></tr>
<tr id="91"><td class="linenumbers">20</td><td class="linenumbers">20</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="92"><td class="linenumbers">21</td><td class="linenumbers">21</td><td class="unchanged"><span> 	function MagicWord($id = 0, $syn = "", $cs = false) </span></td></tr>
<tr id="93"><td class="linenumbers">22</td><td class="linenumbers">22</td><td class="unchanged"><span> 	{</span></td></tr>
<tr id="94"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -24,6 +24,7 @@</span></td></tr>
<tr id="95"><td class="linenumbers">25</td><td class="linenumbers">25</td><td class="unchanged"><span> 		$this->mCaseSensitive = $cs;</span></td></tr>
<tr id="96"><td class="linenumbers">26</td><td class="linenumbers">26</td><td class="unchanged"><span> 		$this->mRegex = "";</span></td></tr>
<tr id="97"><td class="linenumbers">27</td><td class="linenumbers">27</td><td class="unchanged"><span> 		$this->mRegexStart = "";</span></td></tr>
<tr id="98"><td class="linenumbers"> </td><td class="linenumbers">28</td><td class="ins"><ins>+		$this->mVariableRegex = "";</ins></td></tr>
<tr id="99"><td class="linenumbers">28</td><td class="linenumbers">29</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="100"><td class="linenumbers">29</td><td class="linenumbers">30</td><td class="unchanged"><span> </span></td></tr>
<tr id="101"><td class="linenumbers">30</td><td class="linenumbers">31</td><td class="unchanged"><span> 	/*static*/ function &amp;get( $id )</span></td></tr>
<tr id="102"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -53,6 +54,8 @@</span></td></tr>
<tr id="103"><td class="linenumbers">54</td><td class="linenumbers">55</td><td class="unchanged"><span> 		$case = $this->mCaseSensitive ? "" : "i";</span></td></tr>
<tr id="104"><td class="linenumbers">55</td><td class="linenumbers">56</td><td class="unchanged"><span> 		$this->mRegex = "/{$this->mBaseRegex}/{$case}";</span></td></tr>
<tr id="105"><td class="linenumbers">56</td><td class="linenumbers">57</td><td class="unchanged"><span> 		$this->mRegexStart = "/^{$this->mBaseRegex}/{$case}";</span></td></tr>
<tr id="106"><td class="linenumbers"> </td><td class="linenumbers">58</td><td class="ins"><ins>+		$this->mVariableRegex = str_replace( "\\$1", "([A-Za-z0-9]*)", $this->mRegex );</ins></td></tr>
<tr id="107"><td class="linenumbers"> </td><td class="linenumbers">59</td><td class="ins"><ins>+		wfDebug( "{$this->mVariableRegex}\n" );</ins></td></tr>
<tr id="108"><td class="linenumbers">57</td><td class="linenumbers">60</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="109"><td class="linenumbers">58</td><td class="linenumbers">61</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="110"><td class="linenumbers">59</td><td class="linenumbers">62</td><td class="unchanged"><span> 	function getRegex()</span></td></tr>
<tr id="111"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -100,6 +103,23 @@</span></td></tr>
<tr id="112"><td class="linenumbers">101</td><td class="linenumbers">104</td><td class="unchanged"><span> 	{</span></td></tr>
<tr id="113"><td class="linenumbers">102</td><td class="linenumbers">105</td><td class="unchanged"><span> 		return preg_replace( $this->getRegex(), $replacement, $subject );</span></td></tr>
<tr id="114"><td class="linenumbers">103</td><td class="linenumbers">106</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="115"><td class="linenumbers"> </td><td class="linenumbers">107</td><td class="ins"><ins>+</ins></td></tr>
<tr id="116"><td class="linenumbers"> </td><td class="linenumbers">108</td><td class="ins"><ins>+	function substituteCallback( $text, $callback ) {</ins></td></tr>
<tr id="117"><td class="linenumbers"> </td><td class="linenumbers">109</td><td class="ins"><ins>+		$regex = $this->getVariableRegex();</ins></td></tr>
<tr id="118"><td class="linenumbers"> </td><td class="linenumbers">110</td><td class="ins"><ins>+		return preg_replace_callback( $this->getVariableRegex(), $callback, $text );</ins></td></tr>
<tr id="119"><td class="linenumbers"> </td><td class="linenumbers">111</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="120"><td class="linenumbers"> </td><td class="linenumbers">112</td><td class="ins"><ins>+</ins></td></tr>
<tr id="121"><td class="linenumbers"> </td><td class="linenumbers">113</td><td class="ins"><ins>+	function getVariableRegex()</ins></td></tr>
<tr id="122"><td class="linenumbers"> </td><td class="linenumbers">114</td><td class="ins"><ins>+	{</ins></td></tr>
<tr id="123"><td class="linenumbers"> </td><td class="linenumbers">115</td><td class="ins"><ins>+		if ( $this->mVariableRegex == "" ) {</ins></td></tr>
<tr id="124"><td class="linenumbers"> </td><td class="linenumbers">116</td><td class="ins"><ins>+			$this->initRegex();</ins></td></tr>
<tr id="125"><td class="linenumbers"> </td><td class="linenumbers">117</td><td class="ins"><ins>+		} </ins></td></tr>
<tr id="126"><td class="linenumbers"> </td><td class="linenumbers">118</td><td class="ins"><ins>+		return $this->mVariableRegex;</ins></td></tr>
<tr id="127"><td class="linenumbers"> </td><td class="linenumbers">119</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="128"><td class="linenumbers"> </td><td class="linenumbers">120</td><td class="ins"><ins>+</ins></td></tr>
<tr id="129"><td class="linenumbers"> </td><td class="linenumbers">121</td><td class="ins"><ins>+	function getSynonym( $i ) {</ins></td></tr>
<tr id="130"><td class="linenumbers"> </td><td class="linenumbers">122</td><td class="ins"><ins>+		return $this->mSynonyms[$i];</ins></td></tr>
<tr id="131"><td class="linenumbers"> </td><td class="linenumbers">123</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="132"><td class="linenumbers">104</td><td class="linenumbers">124</td><td class="unchanged"><span> }</span></td></tr>
<tr id="133"><td class="linenumbers">105</td><td class="linenumbers">125</td><td class="unchanged"><span> </span></td></tr>
<tr id="134"><td class="linenumbers">106</td><td class="linenumbers">126</td><td class="unchanged"><span> /*private*/ function pregRemoveAndRecord( $match )</span></td></tr>
<tr id="135" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/Article.php</td></tr>



<tr id="139"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -953,7 +953,7 @@</span></td></tr>
<tr id="140"><td class="linenumbers">954</td><td class="linenumbers">954</td><td class="unchanged"><span> </span></td></tr>
<tr id="141"><td class="linenumbers">955</td><td class="linenumbers">955</td><td class="unchanged"><span> 	/* private */ function editUpdates( $text )</span></td></tr>
<tr id="142"><td class="linenumbers">956</td><td class="linenumbers">956</td><td class="unchanged"><span> 	{</span></td></tr>
<tr id="143"><td class="linenumbers">957</td><td class="linenumbers"> </td><td class="del"><del>-		global $wgDeferredUpdateList;</del></td></tr>
<tr id="144"><td class="linenumbers"> </td><td class="linenumbers">957</td><td class="ins"><ins>+		global $wgDeferredUpdateList, $wgDBname, $wgMemc;</ins></td></tr>
<tr id="145"><td class="linenumbers">958</td><td class="linenumbers">958</td><td class="unchanged"><span> </span></td></tr>
<tr id="146"><td class="linenumbers">959</td><td class="linenumbers">959</td><td class="unchanged"><span> 		wfSeedRandom();</span></td></tr>
<tr id="147"><td class="linenumbers">960</td><td class="linenumbers">960</td><td class="unchanged"><span> 		if ( 0 == mt_rand( 0, 999 ) ) {</span></td></tr>
<tr id="148"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -976,6 +976,11 @@</span></td></tr>
<tr id="149"><td class="linenumbers">977</td><td class="linenumbers">977</td><td class="unchanged"><span> 			$u = new UserTalkUpdate( 1, $this->mTitle->getNamespace(),</span></td></tr>
<tr id="150"><td class="linenumbers">978</td><td class="linenumbers">978</td><td class="unchanged"><span> 			  $this->mTitle->getDBkey() );</span></td></tr>
<tr id="151"><td class="linenumbers">979</td><td class="linenumbers">979</td><td class="unchanged"><span> 			array_push( $wgDeferredUpdateList, $u );</span></td></tr>
<tr id="152"><td class="linenumbers"> </td><td class="linenumbers">980</td><td class="ins"><ins>+</ins></td></tr>
<tr id="153"><td class="linenumbers"> </td><td class="linenumbers">981</td><td class="ins"><ins>+			if ( $this->getNamespace == NS_MEDIAWIKI ) {</ins></td></tr>
<tr id="154"><td class="linenumbers"> </td><td class="linenumbers">982</td><td class="ins"><ins>+				$key = "$wgDBname:MediaWiki:title:" . $this->mTitle->getDBkey();</ins></td></tr>
<tr id="155"><td class="linenumbers"> </td><td class="linenumbers">983</td><td class="ins"><ins>+				$wgMemc->delete( $key );</ins></td></tr>
<tr id="156"><td class="linenumbers"> </td><td class="linenumbers">984</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="157"><td class="linenumbers">980</td><td class="linenumbers">985</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="158"><td class="linenumbers">981</td><td class="linenumbers">986</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="159"><td class="linenumbers">982</td><td class="linenumbers">987</td><td class="unchanged"><span> </span></td></tr>
<tr id="160"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -1055,6 +1060,11 @@</span></td></tr>
<tr id="161"><td class="linenumbers">1056</td><td class="linenumbers">1061</td><td class="unchanged"><span> 		} else {</span></td></tr>
<tr id="162"><td class="linenumbers">1057</td><td class="linenumbers">1062</td><td class="unchanged"><span> 			$text = preg_replace( $p2, "[[\\1 ({$context})|\\1]]", $text );</span></td></tr>
<tr id="163"><td class="linenumbers">1058</td><td class="linenumbers">1063</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="164"><td class="linenumbers"> </td><td class="linenumbers">1064</td><td class="ins"><ins>+		</ins></td></tr>
<tr id="165"><td class="linenumbers"> </td><td class="linenumbers">1065</td><td class="ins"><ins>+		# {{SUBST:xxx}} variables</ins></td></tr>
<tr id="166"><td class="linenumbers"> </td><td class="linenumbers">1066</td><td class="ins"><ins>+		#</ins></td></tr>
<tr id="167"><td class="linenumbers"> </td><td class="linenumbers">1067</td><td class="ins"><ins>+		$mw =&amp; MagicWord::get( MAG_SUBST );</ins></td></tr>
<tr id="168"><td class="linenumbers"> </td><td class="linenumbers">1068</td><td class="ins"><ins>+		$text = $mw->substituteCallback( $text, "replaceMsgVar" );</ins></td></tr>
<tr id="169"><td class="linenumbers">1059</td><td class="linenumbers">1069</td><td class="unchanged"><span> </span></td></tr>
<tr id="170"><td class="linenumbers">1060</td><td class="linenumbers">1070</td><td class="unchanged"><span> 		return $text;</span></td></tr>
<tr id="171"><td class="linenumbers">1061</td><td class="linenumbers">1071</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="172" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/GlobalFunctions.php</td></tr>



<tr id="176"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -173,38 +173,83 @@</span></td></tr>
<tr id="177"><td class="linenumbers">174</td><td class="linenumbers">174</td><td class="unchanged"><span> }</span></td></tr>
<tr id="178"><td class="linenumbers">175</td><td class="linenumbers">175</td><td class="unchanged"><span> </span></td></tr>
<tr id="179"><td class="linenumbers">176</td><td class="linenumbers">176</td><td class="unchanged"><span> $wgReplacementKeys = array( "$1", "$2", "$3", "$4", "$5", "$6", "$7", "$8", "$9" );</span></td></tr>
<tr id="180"><td class="linenumbers">177</td><td class="linenumbers"> </td><td class="del"><del>-function wfMsg( $key )</del></td></tr>
<tr id="181"><td class="linenumbers">178</td><td class="linenumbers"> </td><td class="del"><del>-{</del></td></tr>
<tr id="182"><td class="linenumbers">179</td><td class="linenumbers"> </td><td class="del"><del>-	global $wgLang, $wgReplacementKeys;</del></td></tr>
<tr id="183"><td class="linenumbers">180</td><td class="linenumbers"> </td><td class="del"><del>-	$message = $wgLang->getMessage( $key );</del></td></tr>
<tr id="184"><td class="linenumbers"> </td><td class="linenumbers">177</td><td class="ins"><ins>+</ins></td></tr>
<tr id="185"><td class="linenumbers"> </td><td class="linenumbers">178</td><td class="ins"><ins>+function wfMsg( $key ) {</ins></td></tr>
<tr id="186"><td class="linenumbers"> </td><td class="linenumbers">179</td><td class="ins"><ins>+	$args = func_get_args();</ins></td></tr>
<tr id="187"><td class="linenumbers"> </td><td class="linenumbers">180</td><td class="ins"><ins>+	if ( count( $args ) ) {</ins></td></tr>
<tr id="188"><td class="linenumbers"> </td><td class="linenumbers">181</td><td class="ins"><ins>+		array_shift( $args );</ins></td></tr>
<tr id="189"><td class="linenumbers"> </td><td class="linenumbers">182</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="190"><td class="linenumbers"> </td><td class="linenumbers">183</td><td class="ins"><ins>+	return wfMsgReal( $key, $args, true );</ins></td></tr>
<tr id="191"><td class="linenumbers"> </td><td class="linenumbers">184</td><td class="ins"><ins>+}</ins></td></tr>
<tr id="192"><td class="linenumbers"> </td><td class="linenumbers">185</td><td class="ins"><ins>+</ins></td></tr>
<tr id="193"><td class="linenumbers"> </td><td class="linenumbers">186</td><td class="ins"><ins>+function wfMsgNoDB( $key ) {</ins></td></tr>
<tr id="194"><td class="linenumbers"> </td><td class="linenumbers">187</td><td class="ins"><ins>+	$args = func_get_args();</ins></td></tr>
<tr id="195"><td class="linenumbers"> </td><td class="linenumbers">188</td><td class="ins"><ins>+	if ( count( $args ) ) {</ins></td></tr>
<tr id="196"><td class="linenumbers"> </td><td class="linenumbers">189</td><td class="ins"><ins>+		array_shift( $args );</ins></td></tr>
<tr id="197"><td class="linenumbers"> </td><td class="linenumbers">190</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="198"><td class="linenumbers"> </td><td class="linenumbers">191</td><td class="ins"><ins>+	return wfMsgReal( $key, $args, false );</ins></td></tr>
<tr id="199"><td class="linenumbers"> </td><td class="linenumbers">192</td><td class="ins"><ins>+}</ins></td></tr>
<tr id="200"><td class="linenumbers"> </td><td class="linenumbers">193</td><td class="ins"><ins>+</ins></td></tr>
<tr id="201"><td class="linenumbers"> </td><td class="linenumbers">194</td><td class="ins"><ins>+function wfMsgReal( $key, $args, $useDB ) {</ins></td></tr>
<tr id="202"><td class="linenumbers"> </td><td class="linenumbers">195</td><td class="ins"><ins>+	global $wgLang, $wgReplacementKeys, $wgMemc, $wgDBname;</ins></td></tr>
<tr id="203"><td class="linenumbers"> </td><td class="linenumbers">196</td><td class="ins"><ins>+	global $wgUseDatabaseMessages;</ins></td></tr>
<tr id="204"><td class="linenumbers"> </td><td class="linenumbers">197</td><td class="ins"><ins>+		</ins></td></tr>
<tr id="205"><td class="linenumbers"> </td><td class="linenumbers">198</td><td class="ins"><ins>+	static $l1cache = array();</ins></td></tr>
<tr id="206"><td class="linenumbers"> </td><td class="linenumbers">199</td><td class="ins"><ins>+	$fname = "wfMsg";</ins></td></tr>
<tr id="207"><td class="linenumbers"> </td><td class="linenumbers">200</td><td class="ins"><ins>+	$message = false;</ins></td></tr>
<tr id="208"><td class="linenumbers"> </td><td class="linenumbers">201</td><td class="ins"><ins>+	$l1hit = false;</ins></td></tr>
<tr id="209"><td class="linenumbers">181</td><td class="linenumbers">202</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="210"><td class="linenumbers">182</td><td class="linenumbers"> </td><td class="del"><del>-	if ( $message{0} == ":" ) {</del></td></tr>
<tr id="211"><td class="linenumbers">183</td><td class="linenumbers"> </td><td class="del"><del>-		# Get message from the database</del></td></tr>
<tr id="212"><td class="linenumbers">184</td><td class="linenumbers"> </td><td class="del"><del>-		$message = substr( $message, 1 );</del></td></tr>
<tr id="213"><td class="linenumbers">185</td><td class="linenumbers"> </td><td class="del"><del>-		$title = Title::newFromText( $message );</del></td></tr>
<tr id="214"><td class="linenumbers">186</td><td class="linenumbers"> </td><td class="del"><del>-		$dbKey = $title->getDBkey();</del></td></tr>
<tr id="215"><td class="linenumbers">187</td><td class="linenumbers"> </td><td class="del"><del>-		$ns = $title->getNamespace();</del></td></tr>
<tr id="216"><td class="linenumbers">188</td><td class="linenumbers"> </td><td class="del"><del>-		$sql = "SELECT cur_text FROM cur WHERE cur_namespace=$ns AND cur_title='$dbKey'";</del></td></tr>
<tr id="217"><td class="linenumbers">189</td><td class="linenumbers"> </td><td class="del"><del>-		$res = wfQuery( $sql, DB_READ, $fname );</del></td></tr>
<tr id="218"><td class="linenumbers">190</td><td class="linenumbers"> </td><td class="del"><del>-		if( ( $s = wfFetchObject( $res ) ) and ( $s->cur_text != "" ) ) {</del></td></tr>
<tr id="219"><td class="linenumbers">191</td><td class="linenumbers"> </td><td class="del"><del>-			$message = $s->cur_text;</del></td></tr>
<tr id="220"><td class="linenumbers">192</td><td class="linenumbers"> </td><td class="del"><del>-			# filter out a comment at the top if there is one</del></td></tr>
<tr id="221"><td class="linenumbers">193</td><td class="linenumbers"> </td><td class="del"><del>-			$commentPos = strpos( $message, "__START__" );</del></td></tr>
<tr id="222"><td class="linenumbers">194</td><td class="linenumbers"> </td><td class="del"><del>-			if ( $commentPos !== false ) {</del></td></tr>
<tr id="223"><td class="linenumbers">195</td><td class="linenumbers"> </td><td class="del"><del>-				$message = substr( $message, $commentPos + strlen( "__START__" ) );</del></td></tr>
<tr id="224"><td class="linenumbers">196</td><td class="linenumbers"> </td><td class="del"><del>-				wfDebug( "Comment filtered at pos $commentPos, \"$message\"\n" );</del></td></tr>
<tr id="225"><td class="linenumbers"> </td><td class="linenumbers">203</td><td class="ins"><ins>+	# Check for DB suppression</ins></td></tr>
<tr id="226"><td class="linenumbers"> </td><td class="linenumbers">204</td><td class="ins"><ins>+	if ( !$wgUseDatabaseMessages || !$useDB ) {</ins></td></tr>
<tr id="227"><td class="linenumbers"> </td><td class="linenumbers">205</td><td class="ins"><ins>+		$message = $wgLang->getMessage( $key );</ins></td></tr>
<tr id="228"><td class="linenumbers"> </td><td class="linenumbers">206</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="229"><td class="linenumbers"> </td><td class="linenumbers">207</td><td class="ins"><ins>+</ins></td></tr>
<tr id="230"><td class="linenumbers"> </td><td class="linenumbers">208</td><td class="ins"><ins>+	# Try L1 cache</ins></td></tr>
<tr id="231"><td class="linenumbers"> </td><td class="linenumbers">209</td><td class="ins"><ins>+	if ( $message === false &amp;&amp; array_key_exists( $key, $l1cache ) ) {</ins></td></tr>
<tr id="232"><td class="linenumbers"> </td><td class="linenumbers">210</td><td class="ins"><ins>+		$message  = $l1cache[$key];</ins></td></tr>
<tr id="233"><td class="linenumbers"> </td><td class="linenumbers">211</td><td class="ins"><ins>+		if ( $message === false ) {</ins></td></tr>
<tr id="234"><td class="linenumbers"> </td><td class="linenumbers">212</td><td class="ins"><ins>+			$message = $wgLang->getMessage( $key );</ins></td></tr>
<tr id="235"><td class="linenumbers"> </td><td class="linenumbers">213</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="236"><td class="linenumbers"> </td><td class="linenumbers">214</td><td class="ins"><ins>+		$l1hit = true;</ins></td></tr>
<tr id="237"><td class="linenumbers"> </td><td class="linenumbers">215</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="238"><td class="linenumbers"> </td><td class="linenumbers">216</td><td class="ins"><ins>+</ins></td></tr>
<tr id="239"><td class="linenumbers"> </td><td class="linenumbers">217</td><td class="ins"><ins>+	# Try memcached</ins></td></tr>
<tr id="240"><td class="linenumbers"> </td><td class="linenumbers">218</td><td class="ins"><ins>+	if ( $message === false ) {</ins></td></tr>
<tr id="241"><td class="linenumbers"> </td><td class="linenumbers">219</td><td class="ins"><ins>+		$titleObj = Title::newFromText( $key );</ins></td></tr>
<tr id="242"><td class="linenumbers"> </td><td class="linenumbers">220</td><td class="ins"><ins>+		$title = $titleObj->getDBkey();</ins></td></tr>
<tr id="243"><td class="linenumbers"> </td><td class="linenumbers">221</td><td class="ins"><ins>+		$mcKey = "$wgDBname:MediaWiki:title:$title";</ins></td></tr>
<tr id="244"><td class="linenumbers"> </td><td class="linenumbers">222</td><td class="ins"><ins>+		$message = $wgMemc->get( $mcKey );</ins></td></tr>
<tr id="245"><td class="linenumbers"> </td><td class="linenumbers">223</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="246"><td class="linenumbers"> </td><td class="linenumbers">224</td><td class="ins"><ins>+</ins></td></tr>
<tr id="247"><td class="linenumbers"> </td><td class="linenumbers">225</td><td class="ins"><ins>+	# Try database</ins></td></tr>
<tr id="248"><td class="linenumbers"> </td><td class="linenumbers">226</td><td class="ins"><ins>+	if ( $message === false) {</ins></td></tr>
<tr id="249"><td class="linenumbers"> </td><td class="linenumbers">227</td><td class="ins"><ins>+		if ( $useDB ) {</ins></td></tr>
<tr id="250"><td class="linenumbers"> </td><td class="linenumbers">228</td><td class="ins"><ins>+			$sql = "SELECT cur_text FROM cur WHERE cur_namespace=" . NS_MEDIAWIKI . </ins></td></tr>
<tr id="251"><td class="linenumbers"> </td><td class="linenumbers">229</td><td class="ins"><ins>+				" AND cur_title='$title'";</ins></td></tr>
<tr id="252"><td class="linenumbers"> </td><td class="linenumbers">230</td><td class="ins"><ins>+			$res = wfQuery( $sql, DB_READ, $fname );</ins></td></tr>
<tr id="253"><td class="linenumbers"> </td><td class="linenumbers">231</td><td class="ins"><ins>+</ins></td></tr>
<tr id="254"><td class="linenumbers"> </td><td class="linenumbers">232</td><td class="ins"><ins>+			if ( wfNumRows( $res ) ) {</ins></td></tr>
<tr id="255"><td class="linenumbers"> </td><td class="linenumbers">233</td><td class="ins"><ins>+				# Got it from the database, now store in MemCached</ins></td></tr>
<tr id="256"><td class="linenumbers"> </td><td class="linenumbers">234</td><td class="ins"><ins>+				$obj = wfFetchObject( $res );</ins></td></tr>
<tr id="257"><td class="linenumbers"> </td><td class="linenumbers">235</td><td class="ins"><ins>+				$message = $obj->cur_text;</ins></td></tr>
<tr id="258"><td class="linenumbers"> </td><td class="linenumbers">236</td><td class="ins"><ins>+				wfFreeResult( $res );</ins></td></tr>
<tr id="259"><td class="linenumbers"> </td><td class="linenumbers">237</td><td class="ins"><ins>+				$wgMemc->set( $key, $message, time() + 1800 );</ins></td></tr>
<tr id="260"><td class="linenumbers">197</td><td class="linenumbers">238</td><td class="unchanged"><span> 			}</span></td></tr>
<tr id="261"><td class="linenumbers">198</td><td class="linenumbers"> </td><td class="del"><del>-		} else {</del></td></tr>
<tr id="262"><td class="linenumbers">199</td><td class="linenumbers"> </td><td class="del"><del>-			# if the page doesn't exist, just make a link to where it should be</del></td></tr>
<tr id="263"><td class="linenumbers">200</td><td class="linenumbers"> </td><td class="del"><del>-			$message = "[[$message]]";</del></td></tr>
<tr id="264"><td class="linenumbers">201</td><td class="linenumbers"> </td><td class="del"><del>-		}	</del></td></tr>
<tr id="265"><td class="linenumbers">202</td><td class="linenumbers"> </td><td class="del"><del>-		wfFreeResult( $res );</del></td></tr>
<tr id="266"><td class="linenumbers"> </td><td class="linenumbers">239</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="267"><td class="linenumbers">203</td><td class="linenumbers">240</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="268"><td class="linenumbers">204</td><td class="linenumbers"> </td><td class="del"><del>-	if( func_num_args() > 1 ) {</del></td></tr>
<tr id="269"><td class="linenumbers">205</td><td class="linenumbers"> </td><td class="del"><del>-		$reps = func_get_args();</del></td></tr>
<tr id="270"><td class="linenumbers">206</td><td class="linenumbers"> </td><td class="del"><del>-		array_shift( $reps );</del></td></tr>
<tr id="271"><td class="linenumbers">207</td><td class="linenumbers"> </td><td class="del"><del>-		$message = str_replace( $wgReplacementKeys, $reps, $message );</del></td></tr>
<tr id="272"><td class="linenumbers"> </td><td class="linenumbers">241</td><td class="ins"><ins>+</ins></td></tr>
<tr id="273"><td class="linenumbers"> </td><td class="linenumbers">242</td><td class="ins"><ins>+	# Finally, try the array in $wgLang</ins></td></tr>
<tr id="274"><td class="linenumbers"> </td><td class="linenumbers">243</td><td class="ins"><ins>+	if ( $message === false ) {</ins></td></tr>
<tr id="275"><td class="linenumbers"> </td><td class="linenumbers">244</td><td class="ins"><ins>+		$message = $wgLang->getMessage( $key );</ins></td></tr>
<tr id="276"><td class="linenumbers"> </td><td class="linenumbers">245</td><td class="ins"><ins>+		$l1cache[$key] = false;</ins></td></tr>
<tr id="277"><td class="linenumbers"> </td><td class="linenumbers">246</td><td class="ins"><ins>+	} elseif ( !$l1hit &amp;&amp; $wgUseDatabaseMessages) {</ins></td></tr>
<tr id="278"><td class="linenumbers"> </td><td class="linenumbers">247</td><td class="ins"><ins>+		$l1cache[$key] = $message;</ins></td></tr>
<tr id="279"><td class="linenumbers">208</td><td class="linenumbers">248</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="280"><td class="linenumbers"> </td><td class="linenumbers">249</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="281"><td class="linenumbers"> </td><td class="linenumbers">250</td><td class="ins"><ins>+	# Replace arguments</ins></td></tr>
<tr id="282"><td class="linenumbers"> </td><td class="linenumbers">251</td><td class="ins"><ins>+	if( count( $args ) ) {</ins></td></tr>
<tr id="283"><td class="linenumbers"> </td><td class="linenumbers">252</td><td class="ins"><ins>+		$message = str_replace( $wgReplacementKeys, $args, $message );</ins></td></tr>
<tr id="284"><td class="linenumbers"> </td><td class="linenumbers">253</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="285"><td class="linenumbers">209</td><td class="linenumbers">254</td><td class="unchanged"><span> </span></td></tr>
<tr id="286"><td class="linenumbers">210</td><td class="linenumbers">255</td><td class="unchanged"><span> 	if ( "" == $message ) {</span></td></tr>
<tr id="287"><td class="linenumbers">211</td><td class="linenumbers">256</td><td class="unchanged"><span> 		# Let's at least _try_ to be graceful about this.</span></td></tr>
<tr id="288"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -590,4 +635,14 @@</span></td></tr>
<tr id="289"><td class="linenumbers">591</td><td class="linenumbers">636</td><td class="unchanged"><span> 	return array( $limit, $offset );</span></td></tr>
<tr id="290"><td class="linenumbers">592</td><td class="linenumbers">637</td><td class="unchanged"><span> }</span></td></tr>
<tr id="291"><td class="linenumbers">593</td><td class="linenumbers">638</td><td class="unchanged"><span> </span></td></tr>
<tr id="292"><td class="linenumbers"> </td><td class="linenumbers">639</td><td class="ins"><ins>+# Used in OutputPage::replaceVariables and Article:pstPass2</ins></td></tr>
<tr id="293"><td class="linenumbers"> </td><td class="linenumbers">640</td><td class="ins"><ins>+function replaceMsgVar( $matches ) {</ins></td></tr>
<tr id="294"><td class="linenumbers"> </td><td class="linenumbers">641</td><td class="ins"><ins>+	return wfMsg( $matches[1] );</ins></td></tr>
<tr id="295"><td class="linenumbers"> </td><td class="linenumbers">642</td><td class="ins"><ins>+}</ins></td></tr>
<tr id="296"><td class="linenumbers"> </td><td class="linenumbers">643</td><td class="ins"><ins>+</ins></td></tr>
<tr id="297"><td class="linenumbers"> </td><td class="linenumbers">644</td><td class="ins"><ins>+function replaceMsgVarNw( $matches ) {</ins></td></tr>
<tr id="298"><td class="linenumbers"> </td><td class="linenumbers">645</td><td class="ins"><ins>+	$text = htmlspecialchars( wfMsg( $matches[1] ) );</ins></td></tr>
<tr id="299"><td class="linenumbers"> </td><td class="linenumbers">646</td><td class="ins"><ins>+	return $text;</ins></td></tr>
<tr id="300"><td class="linenumbers"> </td><td class="linenumbers">647</td><td class="ins"><ins>+}</ins></td></tr>
<tr id="301"><td class="linenumbers"> </td><td class="linenumbers">648</td><td class="ins"><ins>+</ins></td></tr>
<tr id="302"><td class="linenumbers">594</td><td class="linenumbers">649</td><td class="unchanged"><span> ?></span></td></tr>
<tr id="303" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/DefaultSettings.php</td></tr>



<tr id="307"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -61,6 +61,10 @@</span></td></tr>
<tr id="308"><td class="linenumbers">62</td><td class="linenumbers">62</td><td class="unchanged"><span> $wgShowIPinHeader	= true; # For non-logged in users</span></td></tr>
<tr id="309"><td class="linenumbers">63</td><td class="linenumbers">63</td><td class="unchanged"><span> $wgUseDynamicDates	= true; # Allows the user to pick their preferred date format</span></td></tr>
<tr id="310"><td class="linenumbers">64</td><td class="linenumbers">64</td><td class="unchanged"><span> </span></td></tr>
<tr id="311"><td class="linenumbers"> </td><td class="linenumbers">65</td><td class="ins"><ins>+# Translation using MediaWiki: namespace</ins></td></tr>
<tr id="312"><td class="linenumbers"> </td><td class="linenumbers">66</td><td class="ins"><ins>+# Not recommended unless memcached is installed</ins></td></tr>
<tr id="313"><td class="linenumbers"> </td><td class="linenumbers">67</td><td class="ins"><ins>+$wgUseDatabaseMessages = false;</ins></td></tr>
<tr id="314"><td class="linenumbers"> </td><td class="linenumbers">68</td><td class="ins"><ins>+</ins></td></tr>
<tr id="315"><td class="linenumbers">65</td><td class="linenumbers">69</td><td class="unchanged"><span> # Miscellaneous configuration settings</span></td></tr>
<tr id="316"><td class="linenumbers">66</td><td class="linenumbers">70</td><td class="unchanged"><span> #</span></td></tr>
<tr id="317"><td class="linenumbers">67</td><td class="linenumbers">71</td><td class="unchanged"><span> $wgReadOnlyFile         = "{$wgUploadDirectory}/lock_yBgMBwiR";</span></td></tr>
<tr id="318"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -70,6 +74,8 @@</span></td></tr>
<tr id="319"><td class="linenumbers">71</td><td class="linenumbers">75</td><td class="unchanged"><span> $wgSqlLogFile           = "{$wgUploadDirectory}/sqllog_mFhyRe6";</span></td></tr>
<tr id="320"><td class="linenumbers">72</td><td class="linenumbers">76</td><td class="unchanged"><span> $wgLogQueries           = false;</span></td></tr>
<tr id="321"><td class="linenumbers">73</td><td class="linenumbers">77</td><td class="unchanged"><span> $wgUseBetterLinksUpdate = true;</span></td></tr>
<tr id="322"><td class="linenumbers"> </td><td class="linenumbers">78</td><td class="ins"><ins>+</ins></td></tr>
<tr id="323"><td class="linenumbers"> </td><td class="linenumbers">79</td><td class="ins"><ins>+# User rights settings</ins></td></tr>
<tr id="324"><td class="linenumbers">74</td><td class="linenumbers">80</td><td class="unchanged"><span> $wgSysopUserBans        = true; # Allow sysops to ban logged-in users</span></td></tr>
<tr id="325"><td class="linenumbers">75</td><td class="linenumbers">81</td><td class="unchanged"><span> $wgIPBlockExpiration    = 86400; # IP blocks expire after this many seconds, 0=infinite</span></td></tr>
<tr id="326"><td class="linenumbers">76</td><td class="linenumbers">82</td><td class="unchanged"><span> $wgUserBlockExpiration  = 0; # As above, but for logged-in users</span></td></tr>
<tr id="327" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/OutputPage.php</td></tr>



<tr id="331"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -428,28 +428,29 @@</span></td></tr>
<tr id="332"><td class="linenumbers">429</td><td class="linenumbers">429</td><td class="unchanged"><span> 	function databaseError( $fname )</span></td></tr>
<tr id="333"><td class="linenumbers">430</td><td class="linenumbers">430</td><td class="unchanged"><span> 	{</span></td></tr>
<tr id="334"><td class="linenumbers">431</td><td class="linenumbers">431</td><td class="unchanged"><span> 		global $wgUser, $wgCommandLineMode;</span></td></tr>
<tr id="335"><td class="linenumbers">432</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="336"><td class="linenumbers">433</td><td class="linenumbers"> </td><td class="del"><del>-		$this->setPageTitle( wfMsg( "databaseerror" ) );</del></td></tr>
<tr id="337"><td class="linenumbers"> </td><td class="linenumbers">432</td><td class="ins"><ins>+		</ins></td></tr>
<tr id="338"><td class="linenumbers"> </td><td class="linenumbers">433</td><td class="ins"><ins>+		$this->setPageTitle( wfMsgNoDB( "databaseerror" ) );</ins></td></tr>
<tr id="339"><td class="linenumbers">434</td><td class="linenumbers">434</td><td class="unchanged"><span> 		$this->setRobotpolicy( "noindex,nofollow" );</span></td></tr>
<tr id="340"><td class="linenumbers">435</td><td class="linenumbers">435</td><td class="unchanged"><span> 		$this->setArticleFlag( false );</span></td></tr>
<tr id="341"><td class="linenumbers">436</td><td class="linenumbers">436</td><td class="unchanged"><span> </span></td></tr>
<tr id="342"><td class="linenumbers">437</td><td class="linenumbers">437</td><td class="unchanged"><span> 		if ( $wgCommandLineMode ) {</span></td></tr>
<tr id="343"><td class="linenumbers">438</td><td class="linenumbers"> </td><td class="del"><del>-			$msg = wfMsg( "dberrortextcl" );</del></td></tr>
<tr id="344"><td class="linenumbers"> </td><td class="linenumbers">438</td><td class="ins"><ins>+			$msg = wfMsgNoDB( "dberrortextcl" );</ins></td></tr>
<tr id="345"><td class="linenumbers">439</td><td class="linenumbers">439</td><td class="unchanged"><span> 		} else {</span></td></tr>
<tr id="346"><td class="linenumbers">440</td><td class="linenumbers"> </td><td class="del"><del>-			$msg = wfMsg( "dberrortextcl" );</del></td></tr>
<tr id="347"><td class="linenumbers"> </td><td class="linenumbers">440</td><td class="ins"><ins>+			$msg = wfMsgNoDB( "dberrortextcl" );</ins></td></tr>
<tr id="348"><td class="linenumbers">441</td><td class="linenumbers">441</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="349"><td class="linenumbers"> </td><td class="linenumbers">442</td><td class="ins"><ins>+</ins></td></tr>
<tr id="350"><td class="linenumbers">442</td><td class="linenumbers">443</td><td class="unchanged"><span> 		$msg = str_replace( "$1", htmlspecialchars( wfLastDBquery() ), $msg );</span></td></tr>
<tr id="351"><td class="linenumbers">443</td><td class="linenumbers">444</td><td class="unchanged"><span> 		$msg = str_replace( "$2", htmlspecialchars( $fname ), $msg );</span></td></tr>
<tr id="352"><td class="linenumbers">444</td><td class="linenumbers">445</td><td class="unchanged"><span> 		$msg = str_replace( "$3", wfLastErrno(), $msg );</span></td></tr>
<tr id="353"><td class="linenumbers">445</td><td class="linenumbers">446</td><td class="unchanged"><span> 		$msg = str_replace( "$4", htmlspecialchars( wfLastError() ), $msg );</span></td></tr>
<tr id="354"><td class="linenumbers">446</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="355"><td class="linenumbers"> </td><td class="linenumbers">447</td><td class="ins"><ins>+		</ins></td></tr>
<tr id="356"><td class="linenumbers">447</td><td class="linenumbers">448</td><td class="unchanged"><span> 		if ( $wgCommandLineMode ) {</span></td></tr>
<tr id="357"><td class="linenumbers">448</td><td class="linenumbers"> </td><td class="del"><del>-			print $msg;</del></td></tr>
<tr id="358"><td class="linenumbers"> </td><td class="linenumbers">449</td><td class="ins"><ins>+			print "$msg\n";</ins></td></tr>
<tr id="359"><td class="linenumbers">449</td><td class="linenumbers">450</td><td class="unchanged"><span> 			exit();</span></td></tr>
<tr id="360"><td class="linenumbers">450</td><td class="linenumbers">451</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="361"><td class="linenumbers">451</td><td class="linenumbers">452</td><td class="unchanged"><span> 		$sk = $wgUser->getSkin();</span></td></tr>
<tr id="362"><td class="linenumbers">452</td><td class="linenumbers"> </td><td class="del"><del>-		$shlink = $sk->makeKnownLink( wfMsg( "searchhelppage" ),</del></td></tr>
<tr id="363"><td class="linenumbers">453</td><td class="linenumbers"> </td><td class="del"><del>-		  wfMsg( "searchingwikipedia" ) );</del></td></tr>
<tr id="364"><td class="linenumbers"> </td><td class="linenumbers">453</td><td class="ins"><ins>+		$shlink = $sk->makeKnownLink( wfMsgNoDB( "searchhelppage" ),</ins></td></tr>
<tr id="365"><td class="linenumbers"> </td><td class="linenumbers">454</td><td class="ins"><ins>+		  wfMsgNoDB( "searchingwikipedia" ) );</ins></td></tr>
<tr id="366"><td class="linenumbers">454</td><td class="linenumbers">455</td><td class="unchanged"><span> 		$msg = str_replace( "$5", $shlink, $msg );</span></td></tr>
<tr id="367"><td class="linenumbers">455</td><td class="linenumbers">456</td><td class="unchanged"><span> </span></td></tr>
<tr id="368"><td class="linenumbers">456</td><td class="linenumbers">457</td><td class="unchanged"><span> 		$this->mBodytext = $msg;</span></td></tr>
<tr id="369"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -1246,6 +1247,14 @@</span></td></tr>
<tr id="370"><td class="linenumbers">1247</td><td class="linenumbers">1248</td><td class="unchanged"><span> 			$v = wfNumberOfArticles();</span></td></tr>
<tr id="371"><td class="linenumbers">1248</td><td class="linenumbers">1249</td><td class="unchanged"><span> 			$text = $mw->replace( $v, $text );</span></td></tr>
<tr id="372"><td class="linenumbers">1249</td><td class="linenumbers">1250</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="373"><td class="linenumbers"> </td><td class="linenumbers">1251</td><td class="ins"><ins>+</ins></td></tr>
<tr id="374"><td class="linenumbers"> </td><td class="linenumbers">1252</td><td class="ins"><ins>+		# The callbacks are in GlobalFunctions.php</ins></td></tr>
<tr id="375"><td class="linenumbers"> </td><td class="linenumbers">1253</td><td class="ins"><ins>+		$mw =&amp; MagicWord::get( MAG_MSG );</ins></td></tr>
<tr id="376"><td class="linenumbers"> </td><td class="linenumbers">1254</td><td class="ins"><ins>+		$text = $mw->substituteCallback( $text, "replaceMsgVar" );</ins></td></tr>
<tr id="377"><td class="linenumbers"> </td><td class="linenumbers">1255</td><td class="ins"><ins>+</ins></td></tr>
<tr id="378"><td class="linenumbers"> </td><td class="linenumbers">1256</td><td class="ins"><ins>+		$mw =&amp; MagicWord::get( MAG_MSGNW );</ins></td></tr>
<tr id="379"><td class="linenumbers"> </td><td class="linenumbers">1257</td><td class="ins"><ins>+		$text = $mw->substituteCallback( $text, "replaceMsgVarNw" );</ins></td></tr>
<tr id="380"><td class="linenumbers"> </td><td class="linenumbers">1258</td><td class="ins"><ins>+</ins></td></tr>
<tr id="381"><td class="linenumbers">1250</td><td class="linenumbers">1259</td><td class="unchanged"><span> 		wfProfileOut();</span></td></tr>
<tr id="382"><td class="linenumbers">1251</td><td class="linenumbers">1260</td><td class="unchanged"><span> 		return $text;</span></td></tr>
<tr id="383"><td class="linenumbers">1252</td><td class="linenumbers">1261</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="384" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/DatabaseFunctions.php</td></tr>



<tr id="388"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -13,10 +13,10 @@</span></td></tr>
<tr id="389"><td class="linenumbers">14</td><td class="linenumbers">14</td><td class="unchanged"><span> {</span></td></tr>
<tr id="390"><td class="linenumbers">15</td><td class="linenumbers">15</td><td class="unchanged"><span> 	global $wgDBserver, $wgDBuser, $wgDBpassword;</span></td></tr>
<tr id="391"><td class="linenumbers">16</td><td class="linenumbers">16</td><td class="unchanged"><span> 	global $wgDBname, $wgDBconnection, $wgEmergencyContact;</span></td></tr>
<tr id="392"><td class="linenumbers"> </td><td class="linenumbers">17</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="393"><td class="linenumbers"> </td><td class="linenumbers">18</td><td class="ins"><ins>+	$noconn = str_replace( "$1", $wgDBserver, wfMsgNoDB( "noconnect" ) );</ins></td></tr>
<tr id="394"><td class="linenumbers"> </td><td class="linenumbers">19</td><td class="ins"><ins>+	$nodb = str_replace( "$1", $wgDBname, wfMsgNoDB( "nodb" ) );</ins></td></tr>
<tr id="395"><td class="linenumbers">17</td><td class="linenumbers">20</td><td class="unchanged"><span> </span></td></tr>
<tr id="396"><td class="linenumbers">18</td><td class="linenumbers"> </td><td class="del"><del>-	$noconn = str_replace( "$1", $wgDBserver, wfMsg( "noconnect" ) );</del></td></tr>
<tr id="397"><td class="linenumbers">19</td><td class="linenumbers"> </td><td class="del"><del>-	$nodb = str_replace( "$1", $wgDBname, wfMsg( "nodb" ) );</del></td></tr>
<tr id="398"><td class="linenumbers">20</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="399"><td class="linenumbers">21</td><td class="linenumbers">21</td><td class="unchanged"><span> 	$helpme = "\n&lt;p>If this error persists after reloading and clearing " .</span></td></tr>
<tr id="400"><td class="linenumbers">22</td><td class="linenumbers">22</td><td class="unchanged"><span> 	  "your browser cache, please notify the &lt;a href=\"mailto:" .</span></td></tr>
<tr id="401"><td class="linenumbers">23</td><td class="linenumbers">23</td><td class="unchanged"><span> 	  $wgEmergencyContact . "\">Wikipedia developers&lt;/a>.&lt;/p>";</span></td></tr>
<tr id="402"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -55,7 +55,7 @@</span></td></tr>
<tr id="403"><td class="linenumbers">56</td><td class="linenumbers">56</td><td class="unchanged"><span> 	global $wgTitle, $wgUseFileCache, $title, $wgOutputEncoding;</span></td></tr>
<tr id="404"><td class="linenumbers">57</td><td class="linenumbers">57</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="405"><td class="linenumbers">58</td><td class="linenumbers">58</td><td class="unchanged"><span> 	header( "Content-type: text/html; charset=$wgOutputEncoding" );</span></td></tr>
<tr id="406"><td class="linenumbers">59</td><td class="linenumbers"> </td><td class="del"><del>-	if($msg == "") $msg = wfMsg( "noconnect" );</del></td></tr>
<tr id="407"><td class="linenumbers"> </td><td class="linenumbers">59</td><td class="ins"><ins>+	if($msg == "") $msg = wfMsgNoDB( "noconnect" );</ins></td></tr>
<tr id="408"><td class="linenumbers">60</td><td class="linenumbers">60</td><td class="unchanged"><span> 	$text = $msg;</span></td></tr>
<tr id="409"><td class="linenumbers">61</td><td class="linenumbers">61</td><td class="unchanged"><span> </span></td></tr>
<tr id="410"><td class="linenumbers">62</td><td class="linenumbers">62</td><td class="unchanged"><span> 	if($wgUseFileCache) {</span></td></tr>
<tr id="411"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -65,14 +65,14 @@</span></td></tr>
<tr id="412"><td class="linenumbers">66</td><td class="linenumbers">66</td><td class="unchanged"><span> 			if($title) {</span></td></tr>
<tr id="413"><td class="linenumbers">67</td><td class="linenumbers">67</td><td class="unchanged"><span> 				$t = Title::newFromURL( $title );</span></td></tr>
<tr id="414"><td class="linenumbers">68</td><td class="linenumbers">68</td><td class="unchanged"><span> 			} else {</span></td></tr>
<tr id="415"><td class="linenumbers">69</td><td class="linenumbers"> </td><td class="del"><del>-				$t = Title::newFromText( wfMsg("mainpage") );</del></td></tr>
<tr id="416"><td class="linenumbers"> </td><td class="linenumbers">69</td><td class="ins"><ins>+				$t = Title::newFromText( wfMsgNoDB( "mainpage" ) );</ins></td></tr>
<tr id="417"><td class="linenumbers">70</td><td class="linenumbers">70</td><td class="unchanged"><span> 			}</span></td></tr>
<tr id="418"><td class="linenumbers">71</td><td class="linenumbers">71</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="419"><td class="linenumbers">72</td><td class="linenumbers">72</td><td class="unchanged"><span> </span></td></tr>
<tr id="420"><td class="linenumbers">73</td><td class="linenumbers">73</td><td class="unchanged"><span> 		$cache = new CacheManager( $t );</span></td></tr>
<tr id="421"><td class="linenumbers">74</td><td class="linenumbers">74</td><td class="unchanged"><span> 		if( $cache->isFileCached() ) {</span></td></tr>
<tr id="422"><td class="linenumbers">75</td><td class="linenumbers">75</td><td class="unchanged"><span> 			$msg = "&lt;p style='color: red'>&lt;b>$msg&lt;br>\n" .</span></td></tr>
<tr id="423"><td class="linenumbers">76</td><td class="linenumbers"> </td><td class="del"><del>-				wfMsg( "cachederror" ) . "&lt;/b>&lt;/p>\n";</del></td></tr>
<tr id="424"><td class="linenumbers"> </td><td class="linenumbers">76</td><td class="ins"><ins>+				wfMsgNoDB( "cachederror" ) . "&lt;/b>&lt;/p>\n";</ins></td></tr>
<tr id="425"><td class="linenumbers">77</td><td class="linenumbers">77</td><td class="unchanged"><span> 			</span></td></tr>
<tr id="426"><td class="linenumbers">78</td><td class="linenumbers">78</td><td class="unchanged"><span> 			$tag = "&lt;div id='article'>";</span></td></tr>
<tr id="427"><td class="linenumbers">79</td><td class="linenumbers">79</td><td class="unchanged"><span> 			$text = str_replace(</span></td></tr>
<tr id="428"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -98,7 +98,6 @@</span></td></tr>
<tr id="429"><td class="linenumbers">99</td><td class="linenumbers">99</td><td class="unchanged"><span> 	global $wgLastDatabaseQuery, $wgOut;</span></td></tr>
<tr id="430"><td class="linenumbers">100</td><td class="linenumbers">100</td><td class="unchanged"><span> ##	wfProfileIn( "wfQuery" );</span></td></tr>
<tr id="431"><td class="linenumbers">101</td><td class="linenumbers">101</td><td class="unchanged"><span> 	$wgLastDatabaseQuery = $sql;</span></td></tr>
<tr id="432"><td class="linenumbers">102</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="433"><td class="linenumbers">103</td><td class="linenumbers">102</td><td class="unchanged"><span> 	$conn = wfGetDB();</span></td></tr>
<tr id="434"><td class="linenumbers">104</td><td class="linenumbers">103</td><td class="unchanged"><span> 	$ret = mysql_query( $sql, $conn );</span></td></tr>
<tr id="435"><td class="linenumbers">105</td><td class="linenumbers">104</td><td class="unchanged"><span> </span></td></tr>
<tr id="436" class="patchedfile"><td colspan="3">Index: trunk/phase3/languages/Language.php</td></tr>



<tr id="440"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -14,6 +14,8 @@</span></td></tr>
<tr id="441"><td class="linenumbers">15</td><td class="linenumbers">15</td><td class="unchanged"><span> define("NS_WP_TALK", 5);</span></td></tr>
<tr id="442"><td class="linenumbers">16</td><td class="linenumbers">16</td><td class="unchanged"><span> define("NS_IMAGE", 6);</span></td></tr>
<tr id="443"><td class="linenumbers">17</td><td class="linenumbers">17</td><td class="unchanged"><span> define("NS_IMAGE_TALK", 7);</span></td></tr>
<tr id="444"><td class="linenumbers"> </td><td class="linenumbers">18</td><td class="ins"><ins>+define("NS_MEDIAWIKI", 8);</ins></td></tr>
<tr id="445"><td class="linenumbers"> </td><td class="linenumbers">19</td><td class="ins"><ins>+define("NS_MEDIAWIKI_TALK", 9);</ins></td></tr>
<tr id="446"><td class="linenumbers">18</td><td class="linenumbers">20</td><td class="unchanged"><span> </span></td></tr>
<tr id="447"><td class="linenumbers">19</td><td class="linenumbers">21</td><td class="unchanged"><span> # Magic words</span></td></tr>
<tr id="448"><td class="linenumbers">20</td><td class="linenumbers">22</td><td class="unchanged"><span> define("MAG_REDIRECT", 0);</span></td></tr>
<tr id="449"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -27,6 +29,9 @@</span></td></tr>
<tr id="450"><td class="linenumbers">28</td><td class="linenumbers">30</td><td class="unchanged"><span> define("MAG_CURRENTTIME", 8);</span></td></tr>
<tr id="451"><td class="linenumbers">29</td><td class="linenumbers">31</td><td class="unchanged"><span> define("MAG_NUMBEROFARTICLES", 9);</span></td></tr>
<tr id="452"><td class="linenumbers">30</td><td class="linenumbers">32</td><td class="unchanged"><span> define("MAG_CURRENTMONTHNAMEGEN", 10);</span></td></tr>
<tr id="453"><td class="linenumbers"> </td><td class="linenumbers">33</td><td class="ins"><ins>+define("MAG_MSG", 11);</ins></td></tr>
<tr id="454"><td class="linenumbers"> </td><td class="linenumbers">34</td><td class="ins"><ins>+define("MAG_SUBST", 12);</ins></td></tr>
<tr id="455"><td class="linenumbers"> </td><td class="linenumbers">35</td><td class="ins"><ins>+define("MAG_MSGNW", 13);</ins></td></tr>
<tr id="456"><td class="linenumbers">31</td><td class="linenumbers">36</td><td class="unchanged"><span> </span></td></tr>
<tr id="457"><td class="linenumbers">32</td><td class="linenumbers">37</td><td class="unchanged"><span> #--------------------------------------------------------------------------</span></td></tr>
<tr id="458"><td class="linenumbers">33</td><td class="linenumbers">38</td><td class="unchanged"><span> # Language-specific text</span></td></tr>
<tr id="459"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -48,7 +53,9 @@</span></td></tr>
<tr id="460"><td class="linenumbers">49</td><td class="linenumbers">54</td><td class="unchanged"><span> 	4	=> "Wikipedia",</span></td></tr>
<tr id="461"><td class="linenumbers">50</td><td class="linenumbers">55</td><td class="unchanged"><span> 	5	=> "Wikipedia_talk",</span></td></tr>
<tr id="462"><td class="linenumbers">51</td><td class="linenumbers">56</td><td class="unchanged"><span> 	6	=> "Image",</span></td></tr>
<tr id="463"><td class="linenumbers">52</td><td class="linenumbers"> </td><td class="del"><del>-	7	=> "Image_talk"</del></td></tr>
<tr id="464"><td class="linenumbers"> </td><td class="linenumbers">57</td><td class="ins"><ins>+	7	=> "Image_talk",</ins></td></tr>
<tr id="465"><td class="linenumbers"> </td><td class="linenumbers">58</td><td class="ins"><ins>+	8	=> "MediaWiki",</ins></td></tr>
<tr id="466"><td class="linenumbers"> </td><td class="linenumbers">59</td><td class="ins"><ins>+	9	=> "MediaWiki_talk"</ins></td></tr>
<tr id="467"><td class="linenumbers">53</td><td class="linenumbers">60</td><td class="unchanged"><span> );</span></td></tr>
<tr id="468"><td class="linenumbers">54</td><td class="linenumbers">61</td><td class="unchanged"><span> </span></td></tr>
<tr id="469"><td class="linenumbers">55</td><td class="linenumbers">62</td><td class="unchanged"><span> /* private */ $wgDefaultUserOptionsEn = array(</span></td></tr>
<tr id="470"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -285,6 +292,9 @@</span></td></tr>
<tr id="471"><td class="linenumbers">286</td><td class="linenumbers">293</td><td class="unchanged"><span>     MAG_CURRENTTIME          => array( 1,    "{{CURRENTTIME}}"        ),</span></td></tr>
<tr id="472"><td class="linenumbers">287</td><td class="linenumbers">294</td><td class="unchanged"><span>     MAG_NUMBEROFARTICLES     => array( 1,    "{{NUMBEROFARTICLES}}"   ),</span></td></tr>
<tr id="473"><td class="linenumbers">288</td><td class="linenumbers">295</td><td class="unchanged"><span>     MAG_CURRENTMONTHNAMEGEN  => array( 1,    "{{CURRENTMONTHNAMEGEN}}"),</span></td></tr>
<tr id="474"><td class="linenumbers"> </td><td class="linenumbers">296</td><td class="ins"><ins>+	MAG_MSG                  => array( 1,    "{{MSG:$1}}"             ),</ins></td></tr>
<tr id="475"><td class="linenumbers"> </td><td class="linenumbers">297</td><td class="ins"><ins>+	MAG_SUBST                => array( 1,    "{{SUBST:$1}}"           ),</ins></td></tr>
<tr id="476"><td class="linenumbers"> </td><td class="linenumbers">298</td><td class="ins"><ins>+    MAG_MSGNW                => array( 1,    "{{MSGNW:$1}}"           )</ins></td></tr>
<tr id="477"><td class="linenumbers">289</td><td class="linenumbers">299</td><td class="unchanged"><span> );</span></td></tr>
<tr id="478"><td class="linenumbers">290</td><td class="linenumbers">300</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="479"><td class="linenumbers">291</td><td class="linenumbers">301</td><td class="unchanged"><span> # All special pages have to be listed here: a description of ""</span></td></tr>
<tr id="480"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -1223,6 +1233,10 @@</span></td></tr>
<tr id="481"><td class="linenumbers">1224</td><td class="linenumbers">1234</td><td class="unchanged"><span> amusement.",</span></td></tr>
<tr id="482"><td class="linenumbers">1225</td><td class="linenumbers">1235</td><td class="unchanged"><span> "exportcuronly"	=> "Include only the current revision, not the full history",</span></td></tr>
<tr id="483"><td class="linenumbers">1226</td><td class="linenumbers">1236</td><td class="unchanged"><span> </span></td></tr>
<tr id="484"><td class="linenumbers"> </td><td class="linenumbers">1237</td><td class="ins"><ins>+# Namespace 8 related</ins></td></tr>
<tr id="485"><td class="linenumbers"> </td><td class="linenumbers">1238</td><td class="ins"><ins>+</ins></td></tr>
<tr id="486"><td class="linenumbers"> </td><td class="linenumbers">1239</td><td class="ins"><ins>+"allmessages"	=> "All_messages",</ins></td></tr>
<tr id="487"><td class="linenumbers"> </td><td class="linenumbers">1240</td><td class="ins"><ins>+"allmessagestext"	=> "This is a list of all messages available in the MediaWiki: namespace"</ins></td></tr>
<tr id="488"><td class="linenumbers">1227</td><td class="linenumbers">1241</td><td class="unchanged"><span> );</span></td></tr>
<tr id="489"><td class="linenumbers">1228</td><td class="linenumbers">1242</td><td class="unchanged"><span> </span></td></tr>
<tr id="490"><td class="linenumbers">1229</td><td class="linenumbers">1243</td><td class="unchanged"><span> #--------------------------------------------------------------------------</span></td></tr>
<tr id="491"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -1426,6 +1440,12 @@</span></td></tr>
<tr id="492"><td class="linenumbers">1427</td><td class="linenumbers">1441</td><td class="unchanged"><span> 		return $wgAllMessagesEn[$key];</span></td></tr>
<tr id="493"><td class="linenumbers">1428</td><td class="linenumbers">1442</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="494"><td class="linenumbers">1429</td><td class="linenumbers">1443</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="495"><td class="linenumbers"> </td><td class="linenumbers">1444</td><td class="ins"><ins>+	function getAllMessages()</ins></td></tr>
<tr id="496"><td class="linenumbers"> </td><td class="linenumbers">1445</td><td class="ins"><ins>+	{</ins></td></tr>
<tr id="497"><td class="linenumbers"> </td><td class="linenumbers">1446</td><td class="ins"><ins>+		global $wgAllMessagesEn;</ins></td></tr>
<tr id="498"><td class="linenumbers"> </td><td class="linenumbers">1447</td><td class="ins"><ins>+		return $wgAllMessagesEn;</ins></td></tr>
<tr id="499"><td class="linenumbers"> </td><td class="linenumbers">1448</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="500"><td class="linenumbers"> </td><td class="linenumbers">1449</td><td class="ins"><ins>+</ins></td></tr>
<tr id="501"><td class="linenumbers">1430</td><td class="linenumbers">1450</td><td class="unchanged"><span> 	function iconv( $in, $out, $string ) {</span></td></tr>
<tr id="502"><td class="linenumbers">1431</td><td class="linenumbers">1451</td><td class="unchanged"><span> 		# For most languages, this is a wrapper for iconv</span></td></tr>
<tr id="503"><td class="linenumbers">1432</td><td class="linenumbers">1452</td><td class="unchanged"><span> 		return iconv( $in, $out, $string );</span></td></tr>
<tr id="504" class="patchedfile"><td colspan="3">Index: trunk/phase3/update.php</td></tr>



<tr id="508"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -25,13 +25,15 @@</span></td></tr>
<tr id="509"><td class="linenumbers">26</td><td class="linenumbers">26</td><td class="unchanged"><span> </span></td></tr>
<tr id="510"><td class="linenumbers">27</td><td class="linenumbers">27</td><td class="unchanged"><span> include_once( "Version.php" );</span></td></tr>
<tr id="511"><td class="linenumbers">28</td><td class="linenumbers">28</td><td class="unchanged"><span> include_once( "{$IP}/Setup.php" );</span></td></tr>
<tr id="512"><td class="linenumbers"> </td><td class="linenumbers">29</td><td class="ins"><ins>+include_once( "./maintenance/InitialiseMessages.php" );</ins></td></tr>
<tr id="513"><td class="linenumbers"> </td><td class="linenumbers">30</td><td class="ins"><ins>+</ins></td></tr>
<tr id="514"><td class="linenumbers">29</td><td class="linenumbers">31</td><td class="unchanged"><span> $wgTitle = Title::newFromText( "Update script" );</span></td></tr>
<tr id="515"><td class="linenumbers">30</td><td class="linenumbers">32</td><td class="unchanged"><span> $wgCommandLineMode = true;</span></td></tr>
<tr id="516"><td class="linenumbers">31</td><td class="linenumbers">33</td><td class="unchanged"><span> $wgAlterSpecs = array();</span></td></tr>
<tr id="517"><td class="linenumbers">32</td><td class="linenumbers">34</td><td class="unchanged"><span> </span></td></tr>
<tr id="518"><td class="linenumbers">33</td><td class="linenumbers">35</td><td class="unchanged"><span> do_revision_updates();</span></td></tr>
<tr id="519"><td class="linenumbers">34</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="520"><td class="linenumbers">35</td><td class="linenumbers">36</td><td class="unchanged"><span> alter_ipblocks();</span></td></tr>
<tr id="521"><td class="linenumbers"> </td><td class="linenumbers">37</td><td class="ins"><ins>+initialiseMessages();</ins></td></tr>
<tr id="522"><td class="linenumbers">36</td><td class="linenumbers">38</td><td class="unchanged"><span> </span></td></tr>
<tr id="523"><td class="linenumbers">37</td><td class="linenumbers">39</td><td class="unchanged"><span> #</span></td></tr>
<tr id="524"><td class="linenumbers">38</td><td class="linenumbers">40</td><td class="unchanged"><span> # Run ALTER TABLE queries.</span></td></tr>
</table>
</div>
<h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>21:57, 11 October 2010&#160;<a href="https://www.mediawiki.org/wiki/User:Reedy" class="mw-userlink" title="User:Reedy"><bdi>Reedy</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Reedy" class="mw-usertoollinks-talk" title="User talk:Reedy">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Reedy" class="mw-usertoollinks-contribs" title="Special:Contributions/Reedy">contribs</a>)</span>&#160;changed the <b>status</b> of r1695 <i>[<b>removed:</b> new&#160;<b>added:</b> old]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 63 https://static-codereview.wikimedia.org:443/MediaWiki/1695.html responseCode 3 200 