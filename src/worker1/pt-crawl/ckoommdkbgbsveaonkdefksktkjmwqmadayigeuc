ckoommdkbgbsveaonkdefksktkjmwqmadayigeuc length 5 13556 page 13556 
<html>
<head>
<title>r20386 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r20386 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/20386" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./20385.html" title="Special:Code/MediaWiki/20385">r20385</a>‎ | <b>r20386</b> | <a href="./20387.html" title="Special:Code/MediaWiki/20387">r20387</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>12:19, 13 March 2007</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/daniel" title="Special:Code/MediaWiki/author/daniel">daniel</a></td></tr>
<tr><td>Status:</td><td>old</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">UNTESTED: UsernameBlacklist robustness fixes by robchurch (see <a class="external" rel="nofollow" href="http://mediawiki.pastey.net/8204)">http://mediawiki.pastey.net/8204)</a></div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/extensions/UsernameBlacklist/README</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FUsernameBlacklist%2FREADME" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/extensions/UsernameBlacklist/UsernameBlacklist.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FUsernameBlacklist%2FUsernameBlacklist.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/20386&amp;action=purge" title="Special:Code/MediaWiki/20386">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/extensions/UsernameBlacklist/README</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -1,7 +1,7 @@</span></td></tr>
<tr id="6"><td class="linenumbers">2</td><td class="linenumbers">2</td><td class="unchanged"><span> USERNAME BLACKLIST EXTENSION</span></td></tr>
<tr id="7"><td class="linenumbers">3</td><td class="linenumbers">3</td><td class="unchanged"><span> </span></td></tr>
<tr id="8"><td class="linenumbers">4</td><td class="linenumbers">4</td><td class="unchanged"><span> 	Version 1.6</span></td></tr>
<tr id="9"><td class="linenumbers">5</td><td class="linenumbers"> </td><td class="del"><del>-	© 2006 Rob Church</del></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">5</td><td class="ins"><ins>+	© 2006-2007 Rob Church</ins></td></tr>
<tr id="11"><td class="linenumbers">6</td><td class="linenumbers">6</td><td class="unchanged"><span> </span></td></tr>
<tr id="12"><td class="linenumbers">7</td><td class="linenumbers">7</td><td class="unchanged"><span> This is free software licensed under the GNU General Public License. Please</span></td></tr>
<tr id="13"><td class="linenumbers">8</td><td class="linenumbers">8</td><td class="unchanged"><span> see http://www.gnu.org/copyleft/gpl.html for further details, including the</span></td></tr>
<tr id="14"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -58,8 +58,9 @@</span></td></tr>
<tr id="15"><td class="linenumbers">59</td><td class="linenumbers">59</td><td class="unchanged"><span> The example above would prevent creation of the user account "Foo", and any</span></td></tr>
<tr id="16"><td class="linenumbers">60</td><td class="linenumbers">60</td><td class="unchanged"><span> account where the username contains "Bar" or "bar".</span></td></tr>
<tr id="17"><td class="linenumbers">61</td><td class="linenumbers">61</td><td class="unchanged"><span> </span></td></tr>
<tr id="18"><td class="linenumbers">62</td><td class="linenumbers"> </td><td class="del"><del>-You can comment out lines with #; this is useful for adding explanation as to</del></td></tr>
<tr id="19"><td class="linenumbers">63</td><td class="linenumbers"> </td><td class="del"><del>-what a complicated regular expression will block, or for providing reasons.</del></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">62</td><td class="ins"><ins>+Lines without the list token (*) will be ignored when constructing the</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">63</td><td class="ins"><ins>+regular expression, which allows for adding comments or other explanations</ins></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">64</td><td class="ins"><ins>+to the message page.</ins></td></tr>
<tr id="23"><td class="linenumbers">64</td><td class="linenumbers">65</td><td class="unchanged"><span> </span></td></tr>
<tr id="24"><td class="linenumbers">65</td><td class="linenumbers">66</td><td class="unchanged"><span> == 5. Customising Warning Messages ==</span></td></tr>
<tr id="25"><td class="linenumbers">66</td><td class="linenumbers">67</td><td class="unchanged"><span> </span></td></tr>
<tr id="26"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -112,10 +113,13 @@</span></td></tr>
<tr id="27"><td class="linenumbers">113</td><td class="linenumbers">114</td><td class="unchanged"><span> 1.6</span></td></tr>
<tr id="28"><td class="linenumbers">114</td><td class="linenumbers">115</td><td class="unchanged"><span> 	Support multiple language translations</span></td></tr>
<tr id="29"><td class="linenumbers">115</td><td class="linenumbers">116</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="30"><td class="linenumbers"> </td><td class="linenumbers">117</td><td class="ins"><ins>+1.7</ins></td></tr>
<tr id="31"><td class="linenumbers"> </td><td class="linenumbers">118</td><td class="ins"><ins>+	Ignore all non-list lines when constructing the regular expression</ins></td></tr>
<tr id="32"><td class="linenumbers"> </td><td class="linenumbers">119</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="33"><td class="linenumbers">116</td><td class="linenumbers">120</td><td class="unchanged"><span> == 8. Thanks... ==</span></td></tr>
<tr id="34"><td class="linenumbers">117</td><td class="linenumbers">121</td><td class="unchanged"><span> </span></td></tr>
<tr id="35"><td class="linenumbers">118</td><td class="linenumbers">122</td><td class="unchanged"><span> 	* Avar; whose other extensions provide better reference than the docs</span></td></tr>
<tr id="36"><td class="linenumbers">119</td><td class="linenumbers">123</td><td class="unchanged"><span> 	* To the poster on mediawiki-l who inspired it</span></td></tr>
<tr id="37"><td class="linenumbers">120</td><td class="linenumbers">124</td><td class="unchanged"><span> 	* Brion, for fixing a couple of bugs</span></td></tr>
<tr id="38"><td class="linenumbers">121</td><td class="linenumbers">125</td><td class="unchanged"><span> </span></td></tr>
<tr id="39"><td class="linenumbers">122</td><td class="linenumbers"> </td><td class="del"><del>-	All feedback welcome via &lt;robchur@gmail.com>.</del></td></tr>
<tr id="40" class="patchedfile"><td colspan="3">\ No newline at end of file</td></tr>
<tr id="41"><td class="linenumbers"> </td><td class="linenumbers">126</td><td class="ins"><ins>+	All feedback welcome via &lt;robchur@gmail.com>.</ins></td></tr>
<tr id="42" class="patchedfile"><td colspan="3">Index: trunk/extensions/UsernameBlacklist/UsernameBlacklist.php</td></tr>



<tr id="46"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -5,7 +5,7 @@</span></td></tr>
<tr id="47"><td class="linenumbers">6</td><td class="linenumbers">6</td><td class="unchanged"><span>  *</span></td></tr>
<tr id="48"><td class="linenumbers">7</td><td class="linenumbers">7</td><td class="unchanged"><span>  * @author Rob Church &lt;robchur@gmail.com></span></td></tr>
<tr id="49"><td class="linenumbers">8</td><td class="linenumbers">8</td><td class="unchanged"><span>  * @addtogroup Extensions</span></td></tr>
<tr id="50"><td class="linenumbers">9</td><td class="linenumbers"> </td><td class="del"><del>- * @copyright © 2006 Rob Church</del></td></tr>
<tr id="51"><td class="linenumbers"> </td><td class="linenumbers">9</td><td class="ins"><ins>+ * @copyright © 2006-2007 Rob Church</ins></td></tr>
<tr id="52"><td class="linenumbers">10</td><td class="linenumbers">10</td><td class="unchanged"><span>  * @license http://www.gnu.org/copyleft/gpl.html GNU General Public License 2.0</span></td></tr>
<tr id="53"><td class="linenumbers">11</td><td class="linenumbers">11</td><td class="unchanged"><span>  */</span></td></tr>
<tr id="54"><td class="linenumbers">12</td><td class="linenumbers">12</td><td class="unchanged"><span> </span></td></tr>
<tr id="55"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -86,12 +86,13 @@</span></td></tr>
<tr id="56"><td class="linenumbers">87</td><td class="linenumbers">87</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="57"><td class="linenumbers">88</td><td class="linenumbers">88</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="58"><td class="linenumbers">89</td><td class="linenumbers">89</td><td class="unchanged"><span> 		/**</span></td></tr>
<tr id="59"><td class="linenumbers">90</td><td class="linenumbers"> </td><td class="del"><del>-		 * Is the supplied text a comment?</del></td></tr>
<tr id="60"><td class="linenumbers">91</td><td class="linenumbers"> </td><td class="del"><del>-		 * @param $text Text to check</del></td></tr>
<tr id="61"><td class="linenumbers"> </td><td class="linenumbers">90</td><td class="ins"><ins>+		 * Is the supplied text an appropriate fragment to include?</ins></td></tr>
<tr id="62"><td class="linenumbers"> </td><td class="linenumbers">91</td><td class="ins"><ins>+		 *</ins></td></tr>
<tr id="63"><td class="linenumbers"> </td><td class="linenumbers">92</td><td class="ins"><ins>+		 * @param string $text Text to validate</ins></td></tr>
<tr id="64"><td class="linenumbers">92</td><td class="linenumbers">93</td><td class="unchanged"><span> 		 * @return bool</span></td></tr>
<tr id="65"><td class="linenumbers">93</td><td class="linenumbers">94</td><td class="unchanged"><span> 		 */</span></td></tr>
<tr id="66"><td class="linenumbers">94</td><td class="linenumbers"> </td><td class="del"><del>-		function isComment( $text ) {</del></td></tr>
<tr id="67"><td class="linenumbers">95</td><td class="linenumbers"> </td><td class="del"><del>-			return substr( $this->transform( $text ), 0, 1 ) == '#';</del></td></tr>
<tr id="68"><td class="linenumbers"> </td><td class="linenumbers">95</td><td class="ins"><ins>+		function isUsable( $text ) {</ins></td></tr>
<tr id="69"><td class="linenumbers"> </td><td class="linenumbers">96</td><td class="ins"><ins>+			return substr( $text, 0, 1 ) == '*';</ins></td></tr>
<tr id="70"><td class="linenumbers">96</td><td class="linenumbers">97</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="71"><td class="linenumbers">97</td><td class="linenumbers">98</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="72"><td class="linenumbers">98</td><td class="linenumbers">99</td><td class="unchanged"><span> 		/**</span></td></tr>
<tr id="73"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -122,8 +123,8 @@</span></td></tr>
<tr id="74"><td class="linenumbers">123</td><td class="linenumbers">124</td><td class="unchanged"><span> 			if( $blacklist != '&amp;lt;usernameblacklist&amp;gt;' ) {</span></td></tr>
<tr id="75"><td class="linenumbers">124</td><td class="linenumbers">125</td><td class="unchanged"><span> 				$lines = explode( "\n", $blacklist );</span></td></tr>
<tr id="76"><td class="linenumbers">125</td><td class="linenumbers">126</td><td class="unchanged"><span> 				foreach( $lines as $line ) {</span></td></tr>
<tr id="77"><td class="linenumbers">126</td><td class="linenumbers"> </td><td class="del"><del>-					$line = rtrim( $line );</del></td></tr>
<tr id="78"><td class="linenumbers">127</td><td class="linenumbers"> </td><td class="del"><del>-					if( !empty( $line ) &amp;&amp; !$this->isComment( $line ) )</del></td></tr>
<tr id="79"><td class="linenumbers"> </td><td class="linenumbers">127</td><td class="ins"><ins>+					$line = trim( $line );</ins></td></tr>
<tr id="80"><td class="linenumbers"> </td><td class="linenumbers">128</td><td class="ins"><ins>+					if( $this->isUsable( $line ) )</ins></td></tr>
<tr id="81"><td class="linenumbers">128</td><td class="linenumbers">129</td><td class="unchanged"><span> 						$groups[] = $this->transform( $line );</span></td></tr>
<tr id="82"><td class="linenumbers">129</td><td class="linenumbers">130</td><td class="unchanged"><span> 				}</span></td></tr>
<tr id="83"><td class="linenumbers">130</td><td class="linenumbers">131</td><td class="unchanged"><span> 				return count( $groups ) ? '/(' . implode( '|', $groups ) . ')/u' : false;</span></td></tr>
</table>
</div>
</form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/20386.html responseCode 3 200 