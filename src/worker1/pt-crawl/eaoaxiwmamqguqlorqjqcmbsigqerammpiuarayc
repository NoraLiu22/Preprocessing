eaoaxiwmamqguqlorqjqcmbsigqerammpiuarayc length 5 17479 page 17479 
<html>
<head>
<title>r14199 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r14199 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/14199" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./14198.html" title="Special:Code/MediaWiki/14198">r14198</a>â€Ž | <b>r14199</b> | <a href="./14200.html" title="Special:Code/MediaWiki/14200">r14200</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>17:30, 13 May 2006</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/robchurch" title="Special:Code/MediaWiki/author/robchurch">robchurch</a></td></tr>
<tr><td>Status:</td><td>old</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">* Introduce NUMBEROFPAGES magic word<br />
* (<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=5833">bug 5833</a>) Introduce CURRENTVERSION magic word</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/RELEASE-NOTES</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2FRELEASE-NOTES" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/MagicWord.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FMagicWord.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/Parser.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FParser.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/languages/Language.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Flanguages%2FLanguage.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/14199&amp;action=purge" title="Special:Code/MediaWiki/14199">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/Parser.php</td></tr>



<tr id="5"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -2150,6 +2150,11 @@</span></td></tr>
<tr id="6"><td class="linenumbers">2151</td><td class="linenumbers">2151</td><td class="unchanged"><span> 				return $varCache[$index] = $wgContLang->formatNum( wfNumberOfFiles() );</span></td></tr>
<tr id="7"><td class="linenumbers">2152</td><td class="linenumbers">2152</td><td class="unchanged"><span> 			case MAG_NUMBEROFUSERS:</span></td></tr>
<tr id="8"><td class="linenumbers">2153</td><td class="linenumbers">2153</td><td class="unchanged"><span> 				return $varCache[$index] = $wgContLang->formatNum( wfNumberOfUsers() );</span></td></tr>
<tr id="9"><td class="linenumbers">Â </td><td class="linenumbers">2154</td><td class="ins"><ins>+			case MAG_NUMBEROFPAGES:</ins></td></tr>
<tr id="10"><td class="linenumbers">Â </td><td class="linenumbers">2155</td><td class="ins"><ins>+				return $varCache[$index] = $wgContLang->formatNum( wfNumberOfPages() );</ins></td></tr>
<tr id="11"><td class="linenumbers">Â </td><td class="linenumbers">2156</td><td class="ins"><ins>+			case MAG_CURRENTVERSION:</ins></td></tr>
<tr id="12"><td class="linenumbers">Â </td><td class="linenumbers">2157</td><td class="ins"><ins>+				global $wgVersion;</ins></td></tr>
<tr id="13"><td class="linenumbers">Â </td><td class="linenumbers">2158</td><td class="ins"><ins>+				return $wgVersion;</ins></td></tr>
<tr id="14"><td class="linenumbers">2154</td><td class="linenumbers">2159</td><td class="unchanged"><span> 			case MAG_SITENAME:</span></td></tr>
<tr id="15"><td class="linenumbers">2155</td><td class="linenumbers">2160</td><td class="unchanged"><span> 				return $wgSitename;</span></td></tr>
<tr id="16"><td class="linenumbers">2156</td><td class="linenumbers">2161</td><td class="unchanged"><span> 			case MAG_SERVER:</span></td></tr>
<tr id="17"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -2664,9 +2669,12 @@</span></td></tr>
<tr id="18"><td class="linenumbers">2665</td><td class="linenumbers">2670</td><td class="unchanged"><span> 			}</span></td></tr>
<tr id="19"><td class="linenumbers">2666</td><td class="linenumbers">2671</td><td class="unchanged"><span> 		}		</span></td></tr>
<tr id="20"><td class="linenumbers">2667</td><td class="linenumbers">2672</td><td class="unchanged"><span> </span></td></tr>
<tr id="21"><td class="linenumbers">2668</td><td class="linenumbers">Â </td><td class="del"><del>-		# NUMBEROFUSERS, NUMBEROFARTICLES, and NUMBEROFFILES</del></td></tr>
<tr id="22"><td class="linenumbers">Â </td><td class="linenumbers">2673</td><td class="ins"><ins>+		# NUMBEROFPAGES, NUMBEROFUSERS, NUMBEROFARTICLES, and NUMBEROFFILES</ins></td></tr>
<tr id="23"><td class="linenumbers">2669</td><td class="linenumbers">2674</td><td class="unchanged"><span> 		if( !$found ) {</span></td></tr>
<tr id="24"><td class="linenumbers">2670</td><td class="linenumbers">Â </td><td class="del"><del>-			$mwWordsToCheck = array( MAG_NUMBEROFUSERS => 'wfNumberOfUsers', MAG_NUMBEROFARTICLES => 'wfNumberOfArticles', MAG_NUMBEROFFILES => 'wfNumberOfFiles' );</del></td></tr>
<tr id="25"><td class="linenumbers">Â </td><td class="linenumbers">2675</td><td class="ins"><ins>+			$mwWordsToCheck = array( MAG_NUMBEROFPAGES => 'wfNumberOfPages',</ins></td></tr>
<tr id="26"><td class="linenumbers">Â </td><td class="linenumbers">2676</td><td class="ins"><ins>+									 MAG_NUMBEROFUSERS => 'wfNumberOfUsers',</ins></td></tr>
<tr id="27"><td class="linenumbers">Â </td><td class="linenumbers">2677</td><td class="ins"><ins>+									 MAG_NUMBEROFARTICLES => 'wfNumberOfArticles',</ins></td></tr>
<tr id="28"><td class="linenumbers">Â </td><td class="linenumbers">2678</td><td class="ins"><ins>+									 MAG_NUMBEROFFILES => 'wfNumberOfFiles' );</ins></td></tr>
<tr id="29"><td class="linenumbers">2671</td><td class="linenumbers">2679</td><td class="unchanged"><span> 			foreach( $mwWordsToCheck as $word => $func ) {</span></td></tr>
<tr id="30"><td class="linenumbers">2672</td><td class="linenumbers">2680</td><td class="unchanged"><span> 				$mwCurrentWord =&amp; MagicWord::get( $word );</span></td></tr>
<tr id="31"><td class="linenumbers">2673</td><td class="linenumbers">2681</td><td class="unchanged"><span> 				if( $mwCurrentWord->matchStartAndRemove( $part1 ) ) {</span></td></tr>
<tr id="32"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -4318,6 +4326,18 @@</span></td></tr>
<tr id="33"><td class="linenumbers">4319</td><td class="linenumbers">4327</td><td class="unchanged"><span> }</span></td></tr>
<tr id="34"><td class="linenumbers">4320</td><td class="linenumbers">4328</td><td class="unchanged"><span> </span></td></tr>
<tr id="35"><td class="linenumbers">4321</td><td class="linenumbers">4329</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="36"><td class="linenumbers">Â </td><td class="linenumbers">4330</td><td class="ins"><ins>+ * Return the total number of pages</ins></td></tr>
<tr id="37"><td class="linenumbers">Â </td><td class="linenumbers">4331</td><td class="ins"><ins>+ * @return integer</ins></td></tr>
<tr id="38"><td class="linenumbers">Â </td><td class="linenumbers">4332</td><td class="ins"><ins>+ */</ins></td></tr>
<tr id="39"><td class="linenumbers">Â </td><td class="linenumbers">4333</td><td class="ins"><ins>+function wfNumberOfPages() {</ins></td></tr>
<tr id="40"><td class="linenumbers">Â </td><td class="linenumbers">4334</td><td class="ins"><ins>+	wfProfileIn( 'wfNumberOfPages' );</ins></td></tr>
<tr id="41"><td class="linenumbers">Â </td><td class="linenumbers">4335</td><td class="ins"><ins>+	$dbr =&amp; wfGetDB( DB_SLAVE );</ins></td></tr>
<tr id="42"><td class="linenumbers">Â </td><td class="linenumbers">4336</td><td class="ins"><ins>+	$count = $dbr->selectField( 'site_stats', 'ss_total_pages', array(), 'wfNumberOfPages' );</ins></td></tr>
<tr id="43"><td class="linenumbers">Â </td><td class="linenumbers">4337</td><td class="ins"><ins>+	wfProfileOut( 'wfNumberOfPages' );</ins></td></tr>
<tr id="44"><td class="linenumbers">Â </td><td class="linenumbers">4338</td><td class="ins"><ins>+	return (int)$count;</ins></td></tr>
<tr id="45"><td class="linenumbers">Â </td><td class="linenumbers">4339</td><td class="ins"><ins>+}</ins></td></tr>
<tr id="46"><td class="linenumbers">Â </td><td class="linenumbers">4340</td><td class="ins"><ins>+</ins></td></tr>
<tr id="47"><td class="linenumbers">Â </td><td class="linenumbers">4341</td><td class="ins"><ins>+/**</ins></td></tr>
<tr id="48"><td class="linenumbers">4322</td><td class="linenumbers">4342</td><td class="unchanged"><span>  * Get various statistics from the database</span></td></tr>
<tr id="49"><td class="linenumbers">4323</td><td class="linenumbers">4343</td><td class="unchanged"><span>  * @private</span></td></tr>
<tr id="50"><td class="linenumbers">4324</td><td class="linenumbers">4344</td><td class="unchanged"><span>  */</span></td></tr>
<tr id="51" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/MagicWord.php</td></tr>



<tr id="55"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -84,6 +84,8 @@</span></td></tr>
<tr id="56"><td class="linenumbers">85</td><td class="linenumbers">85</td><td class="unchanged"><span> 	'MAG_NUMBEROFUSERS',</span></td></tr>
<tr id="57"><td class="linenumbers">86</td><td class="linenumbers">86</td><td class="unchanged"><span> 	'MAG_RAWSUFFIX',</span></td></tr>
<tr id="58"><td class="linenumbers">87</td><td class="linenumbers">87</td><td class="unchanged"><span> 	'MAG_NEWSECTIONLINK',</span></td></tr>
<tr id="59"><td class="linenumbers">Â </td><td class="linenumbers">88</td><td class="ins"><ins>+	'MAG_NUMBEROFPAGES',</ins></td></tr>
<tr id="60"><td class="linenumbers">Â </td><td class="linenumbers">89</td><td class="ins"><ins>+	'MAG_CURRENTVERSION',</ins></td></tr>
<tr id="61"><td class="linenumbers">88</td><td class="linenumbers">90</td><td class="unchanged"><span> );</span></td></tr>
<tr id="62"><td class="linenumbers">89</td><td class="linenumbers">91</td><td class="unchanged"><span> if ( ! defined( 'MEDIAWIKI_INSTALL' ) )</span></td></tr>
<tr id="63"><td class="linenumbers">90</td><td class="linenumbers">92</td><td class="unchanged"><span> 	wfRunHooks( 'MagicWordMagicWords', array( &amp;$magicWords ) );</span></td></tr>
<tr id="64"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -130,6 +132,8 @@</span></td></tr>
<tr id="65"><td class="linenumbers">131</td><td class="linenumbers">133</td><td class="unchanged"><span> 	MAG_NUMBEROFUSERS,</span></td></tr>
<tr id="66"><td class="linenumbers">132</td><td class="linenumbers">134</td><td class="unchanged"><span> 	MAG_RAWSUFFIX,</span></td></tr>
<tr id="67"><td class="linenumbers">133</td><td class="linenumbers">135</td><td class="unchanged"><span> 	MAG_NEWSECTIONLINK,</span></td></tr>
<tr id="68"><td class="linenumbers">Â </td><td class="linenumbers">136</td><td class="ins"><ins>+	MAG_NUMBEROFPAGES,</ins></td></tr>
<tr id="69"><td class="linenumbers">Â </td><td class="linenumbers">137</td><td class="ins"><ins>+	MAG_CURRENTVERSION,</ins></td></tr>
<tr id="70"><td class="linenumbers">134</td><td class="linenumbers">138</td><td class="unchanged"><span> );</span></td></tr>
<tr id="71"><td class="linenumbers">135</td><td class="linenumbers">139</td><td class="unchanged"><span> if ( ! defined( 'MEDIAWIKI_INSTALL' ) )</span></td></tr>
<tr id="72"><td class="linenumbers">136</td><td class="linenumbers">140</td><td class="unchanged"><span> 	wfRunHooks( 'MagicWordwgVariableIDs', array( &amp;$wgVariableIDs ) );</span></td></tr>
<tr id="73" class="patchedfile"><td colspan="3">Index: trunk/phase3/RELEASE-NOTES</td></tr>



<tr id="77"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -253,6 +253,8 @@</span></td></tr>
<tr id="78"><td class="linenumbers">254</td><td class="linenumbers">254</td><td class="unchanged"><span> * (bug 5806) {{plural:}} support instead of "twin" MediaWiki messages</span></td></tr>
<tr id="79"><td class="linenumbers">255</td><td class="linenumbers">255</td><td class="unchanged"><span> * (bug 5931) Update for Polish language (pl)</span></td></tr>
<tr id="80"><td class="linenumbers">256</td><td class="linenumbers">256</td><td class="unchanged"><span> * Ignore the user and user talk namespaces on Special:Wantedpages</span></td></tr>
<tr id="81"><td class="linenumbers">Â </td><td class="linenumbers">257</td><td class="ins"><ins>+* Introduce NUMBEROFPAGES magic word</ins></td></tr>
<tr id="82"><td class="linenumbers">Â </td><td class="linenumbers">258</td><td class="ins"><ins>+* (bug 5833) Introduce CURRENTVERSION magic word</ins></td></tr>
<tr id="83"><td class="linenumbers">257</td><td class="linenumbers">259</td><td class="unchanged"><span> </span></td></tr>
<tr id="84"><td class="linenumbers">258</td><td class="linenumbers">260</td><td class="unchanged"><span> == Compatibility ==</span></td></tr>
<tr id="85"><td class="linenumbers">259</td><td class="linenumbers">261</td><td class="unchanged"><span> </span></td></tr>
<tr id="86" class="patchedfile"><td colspan="3">Index: trunk/phase3/languages/Language.php</td></tr>



<tr id="90"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -226,6 +226,7 @@</span></td></tr>
<tr id="91"><td class="linenumbers">227</td><td class="linenumbers">227</td><td class="unchanged"><span> 	MAG_CURRENTDAYNAME       => array( 1,    'CURRENTDAYNAME'         ),</span></td></tr>
<tr id="92"><td class="linenumbers">228</td><td class="linenumbers">228</td><td class="unchanged"><span> 	MAG_CURRENTYEAR          => array( 1,    'CURRENTYEAR'            ),</span></td></tr>
<tr id="93"><td class="linenumbers">229</td><td class="linenumbers">229</td><td class="unchanged"><span> 	MAG_CURRENTTIME          => array( 1,    'CURRENTTIME'            ),</span></td></tr>
<tr id="94"><td class="linenumbers">Â </td><td class="linenumbers">230</td><td class="ins"><ins>+	MAG_NUMBEROFPAGES		 => array( 1,	 'NUMBEROFPAGES'		  ),</ins></td></tr>
<tr id="95"><td class="linenumbers">230</td><td class="linenumbers">231</td><td class="unchanged"><span> 	MAG_NUMBEROFARTICLES     => array( 1,    'NUMBEROFARTICLES'       ),</span></td></tr>
<tr id="96"><td class="linenumbers">231</td><td class="linenumbers">232</td><td class="unchanged"><span> 	MAG_NUMBEROFFILES        => array( 1,    'NUMBEROFFILES'          ),</span></td></tr>
<tr id="97"><td class="linenumbers">232</td><td class="linenumbers">233</td><td class="unchanged"><span> 	MAG_NUMBEROFUSERS		 => array( 1, 	 'NUMBEROFUSERS'		  ),</span></td></tr>
<tr id="98"><td class="linenumbers">â€”</td><td class="linenumbers">â€”</td><td class="chunkdelimiter"><span>@@ -282,6 +283,7 @@</span></td></tr>
<tr id="99"><td class="linenumbers">283</td><td class="linenumbers">284</td><td class="unchanged"><span> 	MAG_DISPLAYTITLE         => array( 1,    'DISPLAYTITLE'           ),</span></td></tr>
<tr id="100"><td class="linenumbers">284</td><td class="linenumbers">285</td><td class="unchanged"><span> 	MAG_RAWSUFFIX			 => array( 1,	 'R'					  ),</span></td></tr>
<tr id="101"><td class="linenumbers">285</td><td class="linenumbers">286</td><td class="unchanged"><span> 	MAG_NEWSECTIONLINK		 => array( 1,	 '__NEWSECTIONLINK__'	  ),</span></td></tr>
<tr id="102"><td class="linenumbers">Â </td><td class="linenumbers">287</td><td class="ins"><ins>+	MAG_CURRENTVERSION		 => array( 1, 	 'CURRENTVERSION'		  ),</ins></td></tr>
<tr id="103"><td class="linenumbers">286</td><td class="linenumbers">288</td><td class="unchanged"><span> );</span></td></tr>
<tr id="104"><td class="linenumbers">287</td><td class="linenumbers">289</td><td class="unchanged"><span> </span></td></tr>
<tr id="105"><td class="linenumbers">288</td><td class="linenumbers">290</td><td class="unchanged"><span> if (!$wgCachedMessageArrays) {</span></td></tr>
</table>
</div>
<h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>01:58, 13 October 2010&#160;<a href="https://www.mediawiki.org/wiki/User:%F0%9F%98%82" class="mw-userlink" title="User:ðŸ˜‚"><bdi>ðŸ˜‚</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:%F0%9F%98%82" class="mw-usertoollinks-talk" title="User talk:ðŸ˜‚">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/%F0%9F%98%82" class="mw-usertoollinks-contribs" title="Special:Contributions/ðŸ˜‚">contribs</a>)</span>&#160;changed the <b>status</b> of r14199 <i>[<b>removed:</b> new&#160;<b>added:</b> old]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/14199.html responseCode 3 200 