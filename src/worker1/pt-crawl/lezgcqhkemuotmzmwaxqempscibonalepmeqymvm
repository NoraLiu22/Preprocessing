lezgcqhkemuotmzmwaxqempscibonalepmeqymvm length 5 28822 page 28822 
<html>
<head>
<title>r20410 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r20410 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/20410" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./20409.html" title="Special:Code/MediaWiki/20409">r20409</a>‎ | <b>r20410</b> | <a href="./20411.html" title="Special:Code/MediaWiki/20411">r20411</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>22:24, 13 March 2007</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/sanbeg" title="Special:Code/MediaWiki/author/sanbeg">sanbeg</a></td></tr>
<tr><td>Status:</td><td>old</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">Add depth argument to allow auto-expanding tree (to small, configurable limit)</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/extensions/CategoryTree/CategoryTree.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FCategoryTree%2FCategoryTree.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/extensions/CategoryTree/CategoryTreeFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FCategoryTree%2FCategoryTreeFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/extensions/CategoryTree/README</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FCategoryTree%2FREADME" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/20410&amp;action=purge" title="Special:Code/MediaWiki/20410">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/extensions/CategoryTree/CategoryTreeFunctions.php</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -113,7 +113,7 @@</span></td></tr>
<tr id="6"><td class="linenumbers">114</td><td class="linenumbers">114</td><td class="unchanged"><span> 	* Custom tag implementation. This is called by efCategoryTreeParserHook, which is used to </span></td></tr>
<tr id="7"><td class="linenumbers">115</td><td class="linenumbers">115</td><td class="unchanged"><span> 	* load CategoryTreeFunctions.php on demand.</span></td></tr>
<tr id="8"><td class="linenumbers">116</td><td class="linenumbers">116</td><td class="unchanged"><span> 	*/</span></td></tr>
<tr id="9"><td class="linenumbers">117</td><td class="linenumbers"> </td><td class="del"><del>-	function getTag( &amp;$parser, $category, $mode, $display = 'expandroot', $style = '' ) {</del></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">117</td><td class="ins"><ins>+	function getTag( &amp;$parser, $category, $mode, $display = 'expandroot', $style = '', $depth=1 ) {</ins></td></tr>
<tr id="11"><td class="linenumbers">118</td><td class="linenumbers">118</td><td class="unchanged"><span> 		global $wgCategoryTreeDisableCache, $wgCategoryTreeDynamicTag;</span></td></tr>
<tr id="12"><td class="linenumbers">119</td><td class="linenumbers">119</td><td class="unchanged"><span> 		static $uniq = 0;</span></td></tr>
<tr id="13"><td class="linenumbers">120</td><td class="linenumbers">120</td><td class="unchanged"><span> </span></td></tr>
<tr id="14"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -138,8 +138,8 @@</span></td></tr>
<tr id="15"><td class="linenumbers">139</td><td class="linenumbers">139</td><td class="unchanged"><span> 			$html .= wfCloseElement( 'span' );</span></td></tr>
<tr id="16"><td class="linenumbers">140</td><td class="linenumbers">140</td><td class="unchanged"><span> 			}</span></td></tr>
<tr id="17"><td class="linenumbers">141</td><td class="linenumbers">141</td><td class="unchanged"><span> 		else {</span></td></tr>
<tr id="18"><td class="linenumbers">142</td><td class="linenumbers"> </td><td class="del"><del>-			if ( $display != 'hideroot' ) $html .= CategoryTree::renderNode( $title, $mode, $display != 'onlyroot', $wgCategoryTreeDynamicTag );</del></td></tr>
<tr id="19"><td class="linenumbers">143</td><td class="linenumbers"> </td><td class="del"><del>-			else if ( !$wgCategoryTreeDynamicTag ) $html .= $this->renderChildren( $title, $mode );</del></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">142</td><td class="ins"><ins>+			if ( $display != 'hideroot' ) $html .= CategoryTree::renderNode( $title, $mode, $depth>0, $wgCategoryTreeDynamicTag, $depth-1 );</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">143</td><td class="ins"><ins>+			else if ( !$wgCategoryTreeDynamicTag ) $html .= $this->renderChildren( $title, $mode, $depth-1 );</ins></td></tr>
<tr id="22"><td class="linenumbers">144</td><td class="linenumbers">144</td><td class="unchanged"><span> 			else {</span></td></tr>
<tr id="23"><td class="linenumbers">145</td><td class="linenumbers">145</td><td class="unchanged"><span> 				$uniq += 1;</span></td></tr>
<tr id="24"><td class="linenumbers">146</td><td class="linenumbers">146</td><td class="unchanged"><span> 				$load = 'ct-' . $uniq . '-' . mt_rand( 1, 100000 );</span></td></tr>
<tr id="25"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -160,7 +160,7 @@</span></td></tr>
<tr id="26"><td class="linenumbers">161</td><td class="linenumbers">161</td><td class="unchanged"><span> 	* Returns a string with an HTML representation of the children of the given category.</span></td></tr>
<tr id="27"><td class="linenumbers">162</td><td class="linenumbers">162</td><td class="unchanged"><span> 	* $title must be a Title object</span></td></tr>
<tr id="28"><td class="linenumbers">163</td><td class="linenumbers">163</td><td class="unchanged"><span> 	*/</span></td></tr>
<tr id="29"><td class="linenumbers">164</td><td class="linenumbers"> </td><td class="del"><del>-	function renderChildren( &amp;$title, $mode = CT_MODE_CATEGORIES ) {</del></td></tr>
<tr id="30"><td class="linenumbers"> </td><td class="linenumbers">164</td><td class="ins"><ins>+	function renderChildren( &amp;$title, $mode = CT_MODE_CATEGORIES, $depth=0 ) {</ins></td></tr>
<tr id="31"><td class="linenumbers">165</td><td class="linenumbers">165</td><td class="unchanged"><span> 		global $wgCategoryTreeMaxChildren;</span></td></tr>
<tr id="32"><td class="linenumbers">166</td><td class="linenumbers">166</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="33"><td class="linenumbers">167</td><td class="linenumbers">167</td><td class="unchanged"><span> 		$dbr =&amp; wfGetDB( DB_SLAVE );</span></td></tr>
<tr id="34"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -198,7 +198,7 @@</span></td></tr>
<tr id="35"><td class="linenumbers">199</td><td class="linenumbers">199</td><td class="unchanged"><span> 		while ( $row = $dbr->fetchRow( $res ) ) {</span></td></tr>
<tr id="36"><td class="linenumbers">200</td><td class="linenumbers">200</td><td class="unchanged"><span> 				#TODO: translation support; ideally added to Title object</span></td></tr>
<tr id="37"><td class="linenumbers">201</td><td class="linenumbers">201</td><td class="unchanged"><span> 				$t = Title::makeTitle( $row['page_namespace'], $row['page_title'] );</span></td></tr>
<tr id="38"><td class="linenumbers">202</td><td class="linenumbers"> </td><td class="del"><del>-				$s .= $this->renderNode( $t, $mode, false );</del></td></tr>
<tr id="39"><td class="linenumbers"> </td><td class="linenumbers">202</td><td class="ins"><ins>+				$s .= $this->renderNode( $t, $mode, $depth>0, false, $depth-1 );</ins></td></tr>
<tr id="40"><td class="linenumbers">203</td><td class="linenumbers">203</td><td class="unchanged"><span> 				$s .= "\n\t\t";</span></td></tr>
<tr id="41"><td class="linenumbers">204</td><td class="linenumbers">204</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="42"><td class="linenumbers">205</td><td class="linenumbers">205</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="43"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -267,7 +267,7 @@</span></td></tr>
<tr id="44"><td class="linenumbers">268</td><td class="linenumbers">268</td><td class="unchanged"><span> 	* Returns a string with a HTML represenation of the given page.</span></td></tr>
<tr id="45"><td class="linenumbers">269</td><td class="linenumbers">269</td><td class="unchanged"><span> 	* $title must be a Title object</span></td></tr>
<tr id="46"><td class="linenumbers">270</td><td class="linenumbers">270</td><td class="unchanged"><span> 	*/</span></td></tr>
<tr id="47"><td class="linenumbers">271</td><td class="linenumbers"> </td><td class="del"><del>-	function renderNode( &amp;$title, $mode = CT_MODE_CATEGORIES, $children = false, $loadchildren = false ) {</del></td></tr>
<tr id="48"><td class="linenumbers"> </td><td class="linenumbers">271</td><td class="ins"><ins>+	function renderNode( &amp;$title, $mode = CT_MODE_CATEGORIES, $children = false, $loadchildren = false, $depth = 1 ) {</ins></td></tr>
<tr id="49"><td class="linenumbers">272</td><td class="linenumbers">272</td><td class="unchanged"><span> 		global $wgCategoryTreeOmitNamespace;</span></td></tr>
<tr id="50"><td class="linenumbers">273</td><td class="linenumbers">273</td><td class="unchanged"><span> 		static $uniq = 0;</span></td></tr>
<tr id="51"><td class="linenumbers">274</td><td class="linenumbers">274</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="52"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -323,7 +323,7 @@</span></td></tr>
<tr id="53"><td class="linenumbers">324</td><td class="linenumbers">324</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="54"><td class="linenumbers">325</td><td class="linenumbers">325</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="55"><td class="linenumbers">326</td><td class="linenumbers">326</td><td class="unchanged"><span> 		$s = '';</span></td></tr>
<tr id="56"><td class="linenumbers">327</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="57"><td class="linenumbers"> </td><td class="linenumbers">327</td><td class="ins"><ins>+		</ins></td></tr>
<tr id="58"><td class="linenumbers">328</td><td class="linenumbers">328</td><td class="unchanged"><span> 		#NOTE: things in CategoryTree.js rely on the exact order of tags!</span></td></tr>
<tr id="59"><td class="linenumbers">329</td><td class="linenumbers">329</td><td class="unchanged"><span> 		#      Specifically, the CategoryTreeChildren div must be the first</span></td></tr>
<tr id="60"><td class="linenumbers">330</td><td class="linenumbers">330</td><td class="unchanged"><span> 		#      sibling with nodeName = DIV of the grandparent of the expland link.</span></td></tr>
<tr id="61"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -343,7 +343,8 @@</span></td></tr>
<tr id="62"><td class="linenumbers">344</td><td class="linenumbers">344</td><td class="unchanged"><span> 		$s .= wfCloseElement( 'div' );</span></td></tr>
<tr id="63"><td class="linenumbers">345</td><td class="linenumbers">345</td><td class="unchanged"><span> 		$s .= "\n\t\t";</span></td></tr>
<tr id="64"><td class="linenumbers">346</td><td class="linenumbers">346</td><td class="unchanged"><span> 		$s .= wfOpenElement( 'div', array( 'class' => 'CategoryTreeChildren', 'style' => $children ? "display:block" : "display:none" ) );</span></td></tr>
<tr id="65"><td class="linenumbers">347</td><td class="linenumbers"> </td><td class="del"><del>-		if ( $children ) $s .= $this->renderChildren( $title, $mode ); </del></td></tr>
<tr id="66"><td class="linenumbers"> </td><td class="linenumbers">347</td><td class="ins"><ins>+		//HACK here?</ins></td></tr>
<tr id="67"><td class="linenumbers"> </td><td class="linenumbers">348</td><td class="ins"><ins>+		if ( $children ) $s .= $this->renderChildren( $title, $mode, $depth ); </ins></td></tr>
<tr id="68"><td class="linenumbers">348</td><td class="linenumbers">349</td><td class="unchanged"><span> 		$s .= wfCloseElement( 'div' );</span></td></tr>
<tr id="69"><td class="linenumbers">349</td><td class="linenumbers">350</td><td class="unchanged"><span> 		$s .= wfCloseElement( 'div' );</span></td></tr>
<tr id="70"><td class="linenumbers">350</td><td class="linenumbers">351</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="71" class="patchedfile"><td colspan="3">Index: trunk/extensions/CategoryTree/CategoryTree.php</td></tr>



<tr id="75"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -33,8 +33,14 @@</span></td></tr>
<tr id="76"><td class="linenumbers">34</td><td class="linenumbers">34</td><td class="unchanged"><span>  * $wgCategoryTreeDisableCache - disabled the parser cache for pages with a &lt;categorytree> tag. Default is true.</span></td></tr>
<tr id="77"><td class="linenumbers">35</td><td class="linenumbers">35</td><td class="unchanged"><span>  * $wgCategoryTreeUseCache - enable HTTP cache for anon users. Default is false.</span></td></tr>
<tr id="78"><td class="linenumbers">36</td><td class="linenumbers">36</td><td class="unchanged"><span>  * $wgCategoryTreeUnifiedView - use unified view on category pages, instead of "tree" or "traditional list". Default is true.</span></td></tr>
<tr id="79"><td class="linenumbers">37</td><td class="linenumbers"> </td><td class="del"><del>- * $wgCategoryTreeOmitNamespace - never show namespace prefix. Default is false </del></td></tr>
<tr id="80"><td class="linenumbers"> </td><td class="linenumbers">37</td><td class="ins"><ins>+ * $wgCategoryTreeOmitNamespace - never show namespace prefix. Default is false</ins></td></tr>
<tr id="81"><td class="linenumbers"> </td><td class="linenumbers">38</td><td class="ins"><ins>+</ins></td></tr>
<tr id="82"><td class="linenumbers"> </td><td class="linenumbers">39</td><td class="ins"><ins>+ * $wgCategoryMaxDepth - maximum value for depth argument; can be an</ins></td></tr>
<tr id="83"><td class="linenumbers"> </td><td class="linenumbers">40</td><td class="ins"><ins>+ *                       integer, or an array of two integers.  The first element is the maximum</ins></td></tr>
<tr id="84"><td class="linenumbers"> </td><td class="linenumbers">41</td><td class="ins"><ins>+ *                       depth for the "pages" and "all" modes; the second is for the categories</ins></td></tr>
<tr id="85"><td class="linenumbers"> </td><td class="linenumbers">42</td><td class="ins"><ins>+ *                       mode.  Ignored if $wgCategoryTreeDynamicTag is true.</ins></td></tr>
<tr id="86"><td class="linenumbers">38</td><td class="linenumbers">43</td><td class="unchanged"><span>  */  </span></td></tr>
<tr id="87"><td class="linenumbers"> </td><td class="linenumbers">44</td><td class="ins"><ins>+</ins></td></tr>
<tr id="88"><td class="linenumbers">39</td><td class="linenumbers">45</td><td class="unchanged"><span> $wgCategoryTreeMaxChildren = 200;</span></td></tr>
<tr id="89"><td class="linenumbers">40</td><td class="linenumbers">46</td><td class="unchanged"><span> $wgCategoryTreeAllowTag = true;</span></td></tr>
<tr id="90"><td class="linenumbers">41</td><td class="linenumbers">47</td><td class="unchanged"><span> $wgCategoryTreeDisableCache = true;</span></td></tr>
<tr id="91"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -42,6 +48,7 @@</span></td></tr>
<tr id="92"><td class="linenumbers">43</td><td class="linenumbers">49</td><td class="unchanged"><span> $wgCategoryTreeHTTPCache = false;</span></td></tr>
<tr id="93"><td class="linenumbers">44</td><td class="linenumbers">50</td><td class="unchanged"><span> $wgCategoryTreeUnifiedView = true;</span></td></tr>
<tr id="94"><td class="linenumbers">45</td><td class="linenumbers">51</td><td class="unchanged"><span> $wgCategoryTreeOmitNamespace = false;</span></td></tr>
<tr id="95"><td class="linenumbers"> </td><td class="linenumbers">52</td><td class="ins"><ins>+$wgCategoryMaxDepth = array(1,2);</ins></td></tr>
<tr id="96"><td class="linenumbers">46</td><td class="linenumbers">53</td><td class="unchanged"><span> </span></td></tr>
<tr id="97"><td class="linenumbers">47</td><td class="linenumbers">54</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="98"><td class="linenumbers">48</td><td class="linenumbers">55</td><td class="unchanged"><span>  * Register extension setup hook and credits</span></td></tr>
<tr id="99"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -112,6 +119,45 @@</span></td></tr>
<tr id="100"><td class="linenumbers">113</td><td class="linenumbers">120</td><td class="unchanged"><span> }</span></td></tr>
<tr id="101"><td class="linenumbers">114</td><td class="linenumbers">121</td><td class="unchanged"><span> </span></td></tr>
<tr id="102"><td class="linenumbers">115</td><td class="linenumbers">122</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="103"><td class="linenumbers"> </td><td class="linenumbers">123</td><td class="ins"><ins>+ * Internal function to cap depth</ins></td></tr>
<tr id="104"><td class="linenumbers"> </td><td class="linenumbers">124</td><td class="ins"><ins>+ */</ins></td></tr>
<tr id="105"><td class="linenumbers"> </td><td class="linenumbers">125</td><td class="ins"><ins>+</ins></td></tr>
<tr id="106"><td class="linenumbers"> </td><td class="linenumbers">126</td><td class="ins"><ins>+function efCategoryTreeCapDepth( $mode, $depth ) </ins></td></tr>
<tr id="107"><td class="linenumbers"> </td><td class="linenumbers">127</td><td class="ins"><ins>+{</ins></td></tr>
<tr id="108"><td class="linenumbers"> </td><td class="linenumbers">128</td><td class="ins"><ins>+</ins></td></tr>
<tr id="109"><td class="linenumbers"> </td><td class="linenumbers">129</td><td class="ins"><ins>+  if (is_numeric($depth))</ins></td></tr>
<tr id="110"><td class="linenumbers"> </td><td class="linenumbers">130</td><td class="ins"><ins>+    $depth = intval($depth);</ins></td></tr>
<tr id="111"><td class="linenumbers"> </td><td class="linenumbers">131</td><td class="ins"><ins>+  else</ins></td></tr>
<tr id="112"><td class="linenumbers"> </td><td class="linenumbers">132</td><td class="ins"><ins>+    $depth = 1;</ins></td></tr>
<tr id="113"><td class="linenumbers"> </td><td class="linenumbers">133</td><td class="ins"><ins>+  </ins></td></tr>
<tr id="114"><td class="linenumbers"> </td><td class="linenumbers">134</td><td class="ins"><ins>+</ins></td></tr>
<tr id="115"><td class="linenumbers"> </td><td class="linenumbers">135</td><td class="ins"><ins>+  global $wgCategoryMaxDepth;</ins></td></tr>
<tr id="116"><td class="linenumbers"> </td><td class="linenumbers">136</td><td class="ins"><ins>+  if (is_array($wgCategoryMaxDepth)) {</ins></td></tr>
<tr id="117"><td class="linenumbers"> </td><td class="linenumbers">137</td><td class="ins"><ins>+    switch($mode) {</ins></td></tr>
<tr id="118"><td class="linenumbers"> </td><td class="linenumbers">138</td><td class="ins"><ins>+    case CT_MODE_PAGES:</ins></td></tr>
<tr id="119"><td class="linenumbers"> </td><td class="linenumbers">139</td><td class="ins"><ins>+    case CT_MODE_ALL:</ins></td></tr>
<tr id="120"><td class="linenumbers"> </td><td class="linenumbers">140</td><td class="ins"><ins>+      $max = isset($wgCategoryMaxDepth[0])?$wgCategoryMaxDepth[0]:1;</ins></td></tr>
<tr id="121"><td class="linenumbers"> </td><td class="linenumbers">141</td><td class="ins"><ins>+      break;</ins></td></tr>
<tr id="122"><td class="linenumbers"> </td><td class="linenumbers">142</td><td class="ins"><ins>+    case CT_MODE_CATEGORIES:</ins></td></tr>
<tr id="123"><td class="linenumbers"> </td><td class="linenumbers">143</td><td class="ins"><ins>+    default:</ins></td></tr>
<tr id="124"><td class="linenumbers"> </td><td class="linenumbers">144</td><td class="ins"><ins>+      $max = isset($wgCategoryMaxDepth[1])?$wgCategoryMaxDepth[1]:1;</ins></td></tr>
<tr id="125"><td class="linenumbers"> </td><td class="linenumbers">145</td><td class="ins"><ins>+      break;</ins></td></tr>
<tr id="126"><td class="linenumbers"> </td><td class="linenumbers">146</td><td class="ins"><ins>+    }</ins></td></tr>
<tr id="127"><td class="linenumbers"> </td><td class="linenumbers">147</td><td class="ins"><ins>+  } elseif (is_numeric($wgCategoryMaxDepth)) {</ins></td></tr>
<tr id="128"><td class="linenumbers"> </td><td class="linenumbers">148</td><td class="ins"><ins>+    $max = $wgCategoryMaxDepth;</ins></td></tr>
<tr id="129"><td class="linenumbers"> </td><td class="linenumbers">149</td><td class="ins"><ins>+  } else {</ins></td></tr>
<tr id="130"><td class="linenumbers"> </td><td class="linenumbers">150</td><td class="ins"><ins>+    wfDebug( 'efCategoryTreeCapDepth: $wgCategoryMaxDepth is invalid.' );</ins></td></tr>
<tr id="131"><td class="linenumbers"> </td><td class="linenumbers">151</td><td class="ins"><ins>+    $max = 1;</ins></td></tr>
<tr id="132"><td class="linenumbers"> </td><td class="linenumbers">152</td><td class="ins"><ins>+  }</ins></td></tr>
<tr id="133"><td class="linenumbers"> </td><td class="linenumbers">153</td><td class="ins"><ins>+  </ins></td></tr>
<tr id="134"><td class="linenumbers"> </td><td class="linenumbers">154</td><td class="ins"><ins>+  //echo "mode $mode:max is $max\n";</ins></td></tr>
<tr id="135"><td class="linenumbers"> </td><td class="linenumbers">155</td><td class="ins"><ins>+  if ($depth>$max)</ins></td></tr>
<tr id="136"><td class="linenumbers"> </td><td class="linenumbers">156</td><td class="ins"><ins>+    $depth = $max;</ins></td></tr>
<tr id="137"><td class="linenumbers"> </td><td class="linenumbers">157</td><td class="ins"><ins>+  </ins></td></tr>
<tr id="138"><td class="linenumbers"> </td><td class="linenumbers">158</td><td class="ins"><ins>+  return $depth;</ins></td></tr>
<tr id="139"><td class="linenumbers"> </td><td class="linenumbers">159</td><td class="ins"><ins>+}</ins></td></tr>
<tr id="140"><td class="linenumbers"> </td><td class="linenumbers">160</td><td class="ins"><ins>+</ins></td></tr>
<tr id="141"><td class="linenumbers"> </td><td class="linenumbers">161</td><td class="ins"><ins>+/**</ins></td></tr>
<tr id="142"><td class="linenumbers">116</td><td class="linenumbers">162</td><td class="unchanged"><span> * Helper function to convert a string to a boolean value.</span></td></tr>
<tr id="143"><td class="linenumbers">117</td><td class="linenumbers">163</td><td class="unchanged"><span> * Perhaps make this a global function in MediaWiki proper</span></td></tr>
<tr id="144"><td class="linenumbers">118</td><td class="linenumbers">164</td><td class="unchanged"><span> */</span></td></tr>
<tr id="145"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -157,12 +203,15 @@</span></td></tr>
<tr id="146"><td class="linenumbers">158</td><td class="linenumbers">204</td><td class="unchanged"><span> 	$hideroot = isset( $argv[ 'hideroot' ] ) ? efCategoryTreeAsBool( $argv[ 'hideroot' ] ) : null;</span></td></tr>
<tr id="147"><td class="linenumbers">159</td><td class="linenumbers">205</td><td class="unchanged"><span> 	$onlyroot = isset( $argv[ 'onlyroot' ] ) ? efCategoryTreeAsBool( $argv[ 'onlyroot' ] ) : null;</span></td></tr>
<tr id="148"><td class="linenumbers">160</td><td class="linenumbers">206</td><td class="unchanged"><span> </span></td></tr>
<tr id="149"><td class="linenumbers"> </td><td class="linenumbers">207</td><td class="ins"><ins>+	$depth = efCategoryTreeCapDepth($mode,@$argv[ 'depth' ]);</ins></td></tr>
<tr id="150"><td class="linenumbers"> </td><td class="linenumbers">208</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="151"><td class="linenumbers">161</td><td class="linenumbers">209</td><td class="unchanged"><span> 	if ( $onlyroot ) $display = 'onlyroot';</span></td></tr>
<tr id="152"><td class="linenumbers">162</td><td class="linenumbers">210</td><td class="unchanged"><span> 	else if ( $hideroot ) $display = 'hideroot';</span></td></tr>
<tr id="153"><td class="linenumbers">163</td><td class="linenumbers">211</td><td class="unchanged"><span> 	else $display = 'expandroot';</span></td></tr>
<tr id="154"><td class="linenumbers">164</td><td class="linenumbers">212</td><td class="unchanged"><span> </span></td></tr>
<tr id="155"><td class="linenumbers">165</td><td class="linenumbers">213</td><td class="unchanged"><span> 	$ct = new CategoryTree;</span></td></tr>
<tr id="156"><td class="linenumbers">166</td><td class="linenumbers"> </td><td class="del"><del>-	return $ct->getTag( $parser, $cat, $mode, $display, $style );</del></td></tr>
<tr id="157"><td class="linenumbers"> </td><td class="linenumbers">214</td><td class="ins"><ins>+	return $ct->getTag( $parser, $cat, $mode, $hideroot, $style, $depth );</ins></td></tr>
<tr id="158"><td class="linenumbers"> </td><td class="linenumbers">215</td><td class="ins"><ins>+	return $ct->getTag( $parser, $cat, $mode, $display, $style, $depth );</ins></td></tr>
<tr id="159"><td class="linenumbers">167</td><td class="linenumbers">216</td><td class="unchanged"><span> }</span></td></tr>
<tr id="160"><td class="linenumbers">168</td><td class="linenumbers">217</td><td class="unchanged"><span> </span></td></tr>
<tr id="161"><td class="linenumbers">169</td><td class="linenumbers">218</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="162" class="patchedfile"><td colspan="3">Index: trunk/extensions/CategoryTree/README</td></tr>



<tr id="166"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -93,5 +93,12 @@</span></td></tr>
<tr id="167"><td class="linenumbers">94</td><td class="linenumbers">94</td><td class="unchanged"><span>                                false. Patch contributed by Manuel Schneider</span></td></tr>
<tr id="168"><td class="linenumbers">95</td><td class="linenumbers">95</td><td class="unchanged"><span>                                &lt;manuel.schneider@wikimedia.ch>, Bug 8011</span></td></tr>
<tr id="169"><td class="linenumbers">96</td><td class="linenumbers">96</td><td class="unchanged"><span> </span></td></tr>
<tr id="170"><td class="linenumbers"> </td><td class="linenumbers">97</td><td class="ins"><ins>+$wgCategoryMaxDepth - maximum value for depth argument; can be an integer,</ins></td></tr>
<tr id="171"><td class="linenumbers"> </td><td class="linenumbers">98</td><td class="ins"><ins>+		      or an array of two integers.  The first element is the</ins></td></tr>
<tr id="172"><td class="linenumbers"> </td><td class="linenumbers">99</td><td class="ins"><ins>+                      maximum depth for the "pages" and "all" modes; the</ins></td></tr>
<tr id="173"><td class="linenumbers"> </td><td class="linenumbers">100</td><td class="ins"><ins>+                      second is for the categories mode.  Ignored if</ins></td></tr>
<tr id="174"><td class="linenumbers"> </td><td class="linenumbers">101</td><td class="ins"><ins>+                      $wgCategoryTreeDynamicTag is true. Patch contributed by</ins></td></tr>
<tr id="175"><td class="linenumbers"> </td><td class="linenumbers">102</td><td class="ins"><ins>+                      Steve Sanbeg.</ins></td></tr>
<tr id="176"><td class="linenumbers"> </td><td class="linenumbers">103</td><td class="ins"><ins>+</ins></td></tr>
<tr id="177"><td class="linenumbers">97</td><td class="linenumbers">104</td><td class="unchanged"><span> --------------------------------------------------------------------------</span></td></tr>
<tr id="178"><td class="linenumbers">98</td><td class="linenumbers"> </td><td class="del"><del>-EOF</del></td></tr>
<tr id="179" class="patchedfile"><td colspan="3">\ No newline at end of file</td></tr>
<tr id="180"><td class="linenumbers"> </td><td class="linenumbers">105</td><td class="ins"><ins>+EOF</ins></td></tr>
</table>
</div>
</form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/20410.html responseCode 3 200 