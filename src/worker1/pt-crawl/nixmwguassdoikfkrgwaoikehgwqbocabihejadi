nixmwguassdoikfkrgwaoikehgwqbocabihejadi length 5 17760 page 17760 
<html>
<head>
<title>r1610 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r1610 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/1610" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./1609.html" title="Special:Code/MediaWiki/1609">r1609</a>‎ | <b>r1610</b> | <a href="./1611.html" title="Special:Code/MediaWiki/1611">r1611</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>07:12, 30 August 2003</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/timstarling" title="Special:Code/MediaWiki/author/timstarling">timstarling</a></td></tr>
<tr><td>Status:</td><td>old</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">enhanced wfMsg: minor improvements</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/includes/GlobalFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FGlobalFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/SpecialRecentchanges.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FSpecialRecentchanges.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/languages/Language.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Flanguages%2FLanguage.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/1610&amp;action=purge" title="Special:Code/MediaWiki/1610">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/GlobalFunctions.php</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -176,19 +176,41 @@</span></td></tr>
<tr id="6"><td class="linenumbers">177</td><td class="linenumbers">177</td><td class="unchanged"><span> function wfMsg( $key )</span></td></tr>
<tr id="7"><td class="linenumbers">178</td><td class="linenumbers">178</td><td class="unchanged"><span> {</span></td></tr>
<tr id="8"><td class="linenumbers">179</td><td class="linenumbers">179</td><td class="unchanged"><span> 	global $wgLang, $wgReplacementKeys;</span></td></tr>
<tr id="9"><td class="linenumbers">180</td><td class="linenumbers"> </td><td class="del"><del>-	$ret = $wgLang->getMessage( $key );</del></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">180</td><td class="ins"><ins>+	$message = $wgLang->getMessage( $key );</ins></td></tr>
<tr id="11"><td class="linenumbers">181</td><td class="linenumbers">181</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="12"><td class="linenumbers"> </td><td class="linenumbers">182</td><td class="ins"><ins>+	if ( $message{0} == ":" ) {</ins></td></tr>
<tr id="13"><td class="linenumbers"> </td><td class="linenumbers">183</td><td class="ins"><ins>+		# Get message from the database</ins></td></tr>
<tr id="14"><td class="linenumbers"> </td><td class="linenumbers">184</td><td class="ins"><ins>+		$message = substr( $message, 1 );</ins></td></tr>
<tr id="15"><td class="linenumbers"> </td><td class="linenumbers">185</td><td class="ins"><ins>+		$title = Title::newFromText( $message );</ins></td></tr>
<tr id="16"><td class="linenumbers"> </td><td class="linenumbers">186</td><td class="ins"><ins>+		$dbKey = $title->getDBkey();</ins></td></tr>
<tr id="17"><td class="linenumbers"> </td><td class="linenumbers">187</td><td class="ins"><ins>+		$ns = $title->getNamespace();</ins></td></tr>
<tr id="18"><td class="linenumbers"> </td><td class="linenumbers">188</td><td class="ins"><ins>+		$sql = "SELECT cur_text FROM cur WHERE cur_namespace=$ns AND cur_title='$dbKey'";</ins></td></tr>
<tr id="19"><td class="linenumbers"> </td><td class="linenumbers">189</td><td class="ins"><ins>+		$res = wfQuery( $sql, $fname );</ins></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">190</td><td class="ins"><ins>+		if( ( $s = wfFetchObject( $res ) ) and ( $s->cur_text != "" ) ) {</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">191</td><td class="ins"><ins>+			$message = $s->cur_text;</ins></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">192</td><td class="ins"><ins>+			# filter out a comment at the top if there is one</ins></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">193</td><td class="ins"><ins>+			$commentPos = strpos( $message, "__START__" );</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">194</td><td class="ins"><ins>+			if ( $commentPos !== false ) {</ins></td></tr>
<tr id="25"><td class="linenumbers"> </td><td class="linenumbers">195</td><td class="ins"><ins>+				$message = substr( $message, $commentPos + strlen( "__START__" ) );</ins></td></tr>
<tr id="26"><td class="linenumbers"> </td><td class="linenumbers">196</td><td class="ins"><ins>+				wfDebug( "Comment filtered at pos $commentPos, \"$message\"\n" );</ins></td></tr>
<tr id="27"><td class="linenumbers"> </td><td class="linenumbers">197</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="28"><td class="linenumbers"> </td><td class="linenumbers">198</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="29"><td class="linenumbers"> </td><td class="linenumbers">199</td><td class="ins"><ins>+			# if the page doesn't exist, just make a link to where it should be</ins></td></tr>
<tr id="30"><td class="linenumbers"> </td><td class="linenumbers">200</td><td class="ins"><ins>+			$message = "[[$message]]";</ins></td></tr>
<tr id="31"><td class="linenumbers"> </td><td class="linenumbers">201</td><td class="ins"><ins>+		}	</ins></td></tr>
<tr id="32"><td class="linenumbers"> </td><td class="linenumbers">202</td><td class="ins"><ins>+		wfFreeResult( $res );</ins></td></tr>
<tr id="33"><td class="linenumbers"> </td><td class="linenumbers">203</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="34"><td class="linenumbers">182</td><td class="linenumbers">204</td><td class="unchanged"><span> 	if( func_num_args() > 1 ) {</span></td></tr>
<tr id="35"><td class="linenumbers">183</td><td class="linenumbers">205</td><td class="unchanged"><span> 		$reps = func_get_args();</span></td></tr>
<tr id="36"><td class="linenumbers">184</td><td class="linenumbers">206</td><td class="unchanged"><span> 		array_shift( $reps );</span></td></tr>
<tr id="37"><td class="linenumbers">185</td><td class="linenumbers"> </td><td class="del"><del>-		$ret = str_replace( $wgReplacementKeys, $reps, $ret );</del></td></tr>
<tr id="38"><td class="linenumbers"> </td><td class="linenumbers">207</td><td class="ins"><ins>+		$message = str_replace( $wgReplacementKeys, $reps, $message );</ins></td></tr>
<tr id="39"><td class="linenumbers">186</td><td class="linenumbers">208</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="40"><td class="linenumbers">187</td><td class="linenumbers">209</td><td class="unchanged"><span> </span></td></tr>
<tr id="41"><td class="linenumbers">188</td><td class="linenumbers"> </td><td class="del"><del>-	if ( "" == $ret ) {</del></td></tr>
<tr id="42"><td class="linenumbers"> </td><td class="linenumbers">210</td><td class="ins"><ins>+	if ( "" == $message ) {</ins></td></tr>
<tr id="43"><td class="linenumbers">189</td><td class="linenumbers">211</td><td class="unchanged"><span> 		# Let's at least _try_ to be graceful about this.</span></td></tr>
<tr id="44"><td class="linenumbers">190</td><td class="linenumbers">212</td><td class="unchanged"><span> 		return "&amp;lt;$key&amp;gt;";</span></td></tr>
<tr id="45"><td class="linenumbers">191</td><td class="linenumbers">213</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="46"><td class="linenumbers">192</td><td class="linenumbers"> </td><td class="del"><del>-	return $ret;</del></td></tr>
<tr id="47"><td class="linenumbers"> </td><td class="linenumbers">214</td><td class="ins"><ins>+	return $message;</ins></td></tr>
<tr id="48"><td class="linenumbers">193</td><td class="linenumbers">215</td><td class="unchanged"><span> }</span></td></tr>
<tr id="49"><td class="linenumbers">194</td><td class="linenumbers">216</td><td class="unchanged"><span> </span></td></tr>
<tr id="50"><td class="linenumbers">195</td><td class="linenumbers">217</td><td class="unchanged"><span> function wfCleanFormFields( $fields )</span></td></tr>
<tr id="51" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/SpecialRecentchanges.php</td></tr>



<tr id="55"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -20,11 +20,14 @@</span></td></tr>
<tr id="56"><td class="linenumbers">21</td><td class="linenumbers">21</td><td class="unchanged"><span> 	$wgOut->checkLastModified( $s->lastmod );</span></td></tr>
<tr id="57"><td class="linenumbers">22</td><td class="linenumbers">22</td><td class="unchanged"><span> </span></td></tr>
<tr id="58"><td class="linenumbers">23</td><td class="linenumbers">23</td><td class="unchanged"><span> 	$rctext = wfMsg( "recentchangestext" );</span></td></tr>
<tr id="59"><td class="linenumbers"> </td><td class="linenumbers">24</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="60"><td class="linenumbers"> </td><td class="linenumbers">25</td><td class="ins"><ins>+	# The next few lines can probably be commented out now that wfMsg can get text from the DB</ins></td></tr>
<tr id="61"><td class="linenumbers">24</td><td class="linenumbers">26</td><td class="unchanged"><span> 	$sql = "SELECT cur_text FROM cur WHERE cur_namespace=4 AND cur_title='Recentchanges'";</span></td></tr>
<tr id="62"><td class="linenumbers">25</td><td class="linenumbers">27</td><td class="unchanged"><span> 	$res = wfQuery( $sql, $fname );</span></td></tr>
<tr id="63"><td class="linenumbers">26</td><td class="linenumbers">28</td><td class="unchanged"><span> 	if( ( $s = wfFetchObject( $res ) ) and ( $s->cur_text != "" ) ) {</span></td></tr>
<tr id="64"><td class="linenumbers">27</td><td class="linenumbers">29</td><td class="unchanged"><span> 		$rctext = $s->cur_text;</span></td></tr>
<tr id="65"><td class="linenumbers">28</td><td class="linenumbers">30</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="66"><td class="linenumbers"> </td><td class="linenumbers">31</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="67"><td class="linenumbers">29</td><td class="linenumbers">32</td><td class="unchanged"><span> 	$wgOut->addWikiText( $rctext );</span></td></tr>
<tr id="68"><td class="linenumbers">30</td><td class="linenumbers">33</td><td class="unchanged"><span> </span></td></tr>
<tr id="69"><td class="linenumbers">31</td><td class="linenumbers">34</td><td class="unchanged"><span> 	if ( ! $days ) {</span></td></tr>
<tr id="70" class="patchedfile"><td colspan="3">Index: trunk/phase3/languages/Language.php</td></tr>



<tr id="74"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -677,7 +677,8 @@</span></td></tr>
<tr id="75"><td class="linenumbers">678</td><td class="linenumbers">678</td><td class="unchanged"><span> #</span></td></tr>
<tr id="76"><td class="linenumbers">679</td><td class="linenumbers">679</td><td class="unchanged"><span> "changes" => "changes",</span></td></tr>
<tr id="77"><td class="linenumbers">680</td><td class="linenumbers">680</td><td class="unchanged"><span> "recentchanges" => "Recent changes",</span></td></tr>
<tr id="78"><td class="linenumbers">681</td><td class="linenumbers"> </td><td class="del"><del>-"recentchangestext" => "Track the most recent changes to Wikipedia on this page.</del></td></tr>
<tr id="79"><td class="linenumbers"> </td><td class="linenumbers">681</td><td class="ins"><ins>+"recentchangestext" => </ins></td></tr>
<tr id="80"><td class="linenumbers"> </td><td class="linenumbers">682</td><td class="ins"><ins>+"Track the most recent changes to Wikipedia on this page.</ins></td></tr>
<tr id="81"><td class="linenumbers">682</td><td class="linenumbers">683</td><td class="unchanged"><span> [[Wikipedia:Welcome,_newcomers|Welcome, newcomers]]!</span></td></tr>
<tr id="82"><td class="linenumbers">683</td><td class="linenumbers">684</td><td class="unchanged"><span> Please have a look at these pages: [[wikipedia:FAQ|Wikipedia FAQ]],</span></td></tr>
<tr id="83"><td class="linenumbers">684</td><td class="linenumbers">685</td><td class="unchanged"><span> [[Wikipedia:Policies and guidelines|Wikipedia policy]]</span></td></tr>
<tr id="84"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -1337,24 +1338,7 @@</span></td></tr>
<tr id="85"><td class="linenumbers">1338</td><td class="linenumbers">1339</td><td class="unchanged"><span> 	function getMessage( $key )</span></td></tr>
<tr id="86"><td class="linenumbers">1339</td><td class="linenumbers">1340</td><td class="unchanged"><span> 	{</span></td></tr>
<tr id="87"><td class="linenumbers">1340</td><td class="linenumbers">1341</td><td class="unchanged"><span> 		global $wgAllMessagesEn;</span></td></tr>
<tr id="88"><td class="linenumbers">1341</td><td class="linenumbers"> </td><td class="del"><del>-		$message = $wgAllMessagesEn[$key];</del></td></tr>
<tr id="89"><td class="linenumbers">1342</td><td class="linenumbers"> </td><td class="del"><del>-		if ( $message{0} == ":" ) {</del></td></tr>
<tr id="90"><td class="linenumbers">1343</td><td class="linenumbers"> </td><td class="del"><del>-			# Get message from the database</del></td></tr>
<tr id="91"><td class="linenumbers">1344</td><td class="linenumbers"> </td><td class="del"><del>-			$message = substr( $message, 1 );</del></td></tr>
<tr id="92"><td class="linenumbers">1345</td><td class="linenumbers"> </td><td class="del"><del>-			$title = Title::newFromText( $message );</del></td></tr>
<tr id="93"><td class="linenumbers">1346</td><td class="linenumbers"> </td><td class="del"><del>-			$dbKey = $title->getDBkey();</del></td></tr>
<tr id="94"><td class="linenumbers">1347</td><td class="linenumbers"> </td><td class="del"><del>-			$ns = $title->getNamespace();</del></td></tr>
<tr id="95"><td class="linenumbers">1348</td><td class="linenumbers"> </td><td class="del"><del>-			$sql = "SELECT cur_text FROM cur WHERE cur_namespace=$ns AND cur_title='$dbKey'";</del></td></tr>
<tr id="96"><td class="linenumbers">1349</td><td class="linenumbers"> </td><td class="del"><del>-			$res = wfQuery( $sql, $fname );</del></td></tr>
<tr id="97"><td class="linenumbers">1350</td><td class="linenumbers"> </td><td class="del"><del>-			if( ( $s = wfFetchObject( $res ) ) and ( $s->cur_text != "" ) ) {</del></td></tr>
<tr id="98"><td class="linenumbers">1351</td><td class="linenumbers"> </td><td class="del"><del>-				$message = $s->cur_text;</del></td></tr>
<tr id="99"><td class="linenumbers">1352</td><td class="linenumbers"> </td><td class="del"><del>-			} else {</del></td></tr>
<tr id="100"><td class="linenumbers">1353</td><td class="linenumbers"> </td><td class="del"><del>-				# Similar behaviour on fail to ordinary missing messages</del></td></tr>
<tr id="101"><td class="linenumbers">1354</td><td class="linenumbers"> </td><td class="del"><del>-				$message = "&lt;$message>";</del></td></tr>
<tr id="102"><td class="linenumbers">1355</td><td class="linenumbers"> </td><td class="del"><del>-			}</del></td></tr>
<tr id="103"><td class="linenumbers">1356</td><td class="linenumbers"> </td><td class="del"><del>-			wfFreeResult( $res );</del></td></tr>
<tr id="104"><td class="linenumbers">1357</td><td class="linenumbers"> </td><td class="del"><del>-		}</del></td></tr>
<tr id="105"><td class="linenumbers">1358</td><td class="linenumbers"> </td><td class="del"><del>-		return $message;</del></td></tr>
<tr id="106"><td class="linenumbers"> </td><td class="linenumbers">1342</td><td class="ins"><ins>+		return $wgAllMessagesEn[$key];</ins></td></tr>
<tr id="107"><td class="linenumbers">1359</td><td class="linenumbers">1343</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="108"><td class="linenumbers">1360</td><td class="linenumbers">1344</td><td class="unchanged"><span> 	</span></td></tr>
<tr id="109"><td class="linenumbers">1361</td><td class="linenumbers">1345</td><td class="unchanged"><span> 	function iconv( $in, $out, $string ) {</span></td></tr>
</table>
</div>
<h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>21:57, 11 October 2010&#160;<a href="https://www.mediawiki.org/wiki/User:Reedy" class="mw-userlink" title="User:Reedy"><bdi>Reedy</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Reedy" class="mw-usertoollinks-talk" title="User talk:Reedy">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Reedy" class="mw-usertoollinks-contribs" title="Special:Contributions/Reedy">contribs</a>)</span>&#160;changed the <b>status</b> of r1610 <i>[<b>removed:</b> new&#160;<b>added:</b> old]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 63 https://static-codereview.wikimedia.org:443/MediaWiki/1610.html responseCode 3 200 