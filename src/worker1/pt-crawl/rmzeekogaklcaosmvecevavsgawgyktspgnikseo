rmzeekogaklcaosmvecevavsgawgyktspgnikseo length 5 41082 page 41082 
<html>
<head>
<title>r36864 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r36864 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/36864" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./36863.html" title="Special:Code/MediaWiki/36863">r36863</a>‎ | <b>r36864</b> | <a href="./36865.html" title="Special:Code/MediaWiki/36865">r36865</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>21:40, 1 July 2008</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/daniel" title="Special:Code/MediaWiki/author/daniel">daniel</a></td></tr>
<tr><td>Status:</td><td>old (<a href="#code-comments">Comments</a>)
</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">introduced configurable namespace filtering (and fixed some glitches)</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/extensions/CategoryTree/CategoryTree.js</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FCategoryTree%2FCategoryTree.js" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/extensions/CategoryTree/CategoryTree.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FCategoryTree%2FCategoryTree.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/extensions/CategoryTree/CategoryTreeFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fextensions%2FCategoryTree%2FCategoryTreeFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/36864&amp;action=purge" title="Special:Code/MediaWiki/36864">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/extensions/CategoryTree/CategoryTree.js</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -34,7 +34,7 @@</span></td></tr>
<tr id="6"><td class="linenumbers">35</td><td class="linenumbers">35</td><td class="unchanged"><span>       lnk.title= categoryTreeCollapseMsg;</span></td></tr>
<tr id="7"><td class="linenumbers">36</td><td class="linenumbers">36</td><td class="unchanged"><span>       lnk.onclick= function() { categoryTreeCollapseNode(cat, options, lnk) }</span></td></tr>
<tr id="8"><td class="linenumbers">37</td><td class="linenumbers">37</td><td class="unchanged"><span> </span></td></tr>
<tr id="9"><td class="linenumbers">38</td><td class="linenumbers"> </td><td class="del"><del>-      if (lnk.className != "CategoryTreeLoaded") {</del></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">38</td><td class="ins"><ins>+      if (!lnk.className.match(/(^| )CategoryTreeLoaded($| )/)) {</ins></td></tr>
<tr id="11"><td class="linenumbers">39</td><td class="linenumbers">39</td><td class="unchanged"><span>         categoryTreeLoadNode(cat, options, lnk, div);</span></td></tr>
<tr id="12"><td class="linenumbers">40</td><td class="linenumbers">40</td><td class="unchanged"><span>       }</span></td></tr>
<tr id="13"><td class="linenumbers">41</td><td class="linenumbers">41</td><td class="unchanged"><span>     }</span></td></tr>
<tr id="14"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -58,40 +58,52 @@</span></td></tr>
<tr id="15"><td class="linenumbers">59</td><td class="linenumbers">59</td><td class="unchanged"><span>       categoryTreeLoadChildren(cat, options, div)</span></td></tr>
<tr id="16"><td class="linenumbers">60</td><td class="linenumbers">60</td><td class="unchanged"><span>     }</span></td></tr>
<tr id="17"><td class="linenumbers">61</td><td class="linenumbers">61</td><td class="unchanged"><span> </span></td></tr>
<tr id="18"><td class="linenumbers">62</td><td class="linenumbers"> </td><td class="del"><del>-    function categoryTreeEncodeOptions(options) {</del></td></tr>
<tr id="19"><td class="linenumbers">63</td><td class="linenumbers"> </td><td class="del"><del>-      var opt = "";</del></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">62</td><td class="ins"><ins>+    function categoryTreeEncodeValue(value) {</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">63</td><td class="ins"><ins>+          switch (typeof value) {</ins></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">64</td><td class="ins"><ins>+              case 'function': </ins></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">65</td><td class="ins"><ins>+                  throw new Error("categoryTreeEncodeValue encountered a function");</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">66</td><td class="ins"><ins>+                  break;</ins></td></tr>
<tr id="25"><td class="linenumbers">64</td><td class="linenumbers">67</td><td class="unchanged"><span> </span></td></tr>
<tr id="26"><td class="linenumbers">65</td><td class="linenumbers"> </td><td class="del"><del>-      for (k in options) {</del></td></tr>
<tr id="27"><td class="linenumbers">66</td><td class="linenumbers"> </td><td class="del"><del>-          v = options[k];</del></td></tr>
<tr id="28"><td class="linenumbers">67</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="29"><td class="linenumbers">68</td><td class="linenumbers"> </td><td class="del"><del>-          switch (typeof v) {</del></td></tr>
<tr id="30"><td class="linenumbers">69</td><td class="linenumbers">68</td><td class="unchanged"><span>               case 'string': </span></td></tr>
<tr id="31"><td class="linenumbers">70</td><td class="linenumbers"> </td><td class="del"><del>-                  v = '"' + v.replace(/([\\"'])/g, "\\$1") + '"';</del></td></tr>
<tr id="32"><td class="linenumbers"> </td><td class="linenumbers">69</td><td class="ins"><ins>+                  s = '"' + value.replace(/([\\"'])/g, "\\$1") + '"';</ins></td></tr>
<tr id="33"><td class="linenumbers">71</td><td class="linenumbers">70</td><td class="unchanged"><span>                   break;</span></td></tr>
<tr id="34"><td class="linenumbers">72</td><td class="linenumbers">71</td><td class="unchanged"><span> </span></td></tr>
<tr id="35"><td class="linenumbers">73</td><td class="linenumbers">72</td><td class="unchanged"><span>               case 'number':</span></td></tr>
<tr id="36"><td class="linenumbers">74</td><td class="linenumbers">73</td><td class="unchanged"><span>               case 'boolean':</span></td></tr>
<tr id="37"><td class="linenumbers">75</td><td class="linenumbers">74</td><td class="unchanged"><span>               case 'null':</span></td></tr>
<tr id="38"><td class="linenumbers">76</td><td class="linenumbers"> </td><td class="del"><del>-                  v = String(v);</del></td></tr>
<tr id="39"><td class="linenumbers"> </td><td class="linenumbers">75</td><td class="ins"><ins>+                  s = String(value);</ins></td></tr>
<tr id="40"><td class="linenumbers">77</td><td class="linenumbers">76</td><td class="unchanged"><span>                   break;</span></td></tr>
<tr id="41"><td class="linenumbers">78</td><td class="linenumbers">77</td><td class="unchanged"><span> </span></td></tr>
<tr id="42"><td class="linenumbers">79</td><td class="linenumbers">78</td><td class="unchanged"><span>               case 'object':</span></td></tr>
<tr id="43"><td class="linenumbers">80</td><td class="linenumbers"> </td><td class="del"><del>-                  if ( !v ) v = 'null';</del></td></tr>
<tr id="44"><td class="linenumbers">81</td><td class="linenumbers"> </td><td class="del"><del>-                  else throw new Error("categoryTreeLoadChildren can not encode complex types");</del></td></tr>
<tr id="45"><td class="linenumbers"> </td><td class="linenumbers">79</td><td class="ins"><ins>+                  if ( !value ) {</ins></td></tr>
<tr id="46"><td class="linenumbers"> </td><td class="linenumbers">80</td><td class="ins"><ins>+                      s = 'null';</ins></td></tr>
<tr id="47"><td class="linenumbers"> </td><td class="linenumbers">81</td><td class="ins"><ins>+                  }</ins></td></tr>
<tr id="48"><td class="linenumbers"> </td><td class="linenumbers">82</td><td class="ins"><ins>+                  else if (typeof value.length === 'number' &amp;&amp; !(value.propertyIsEnumerable('length'))) {</ins></td></tr>
<tr id="49"><td class="linenumbers"> </td><td class="linenumbers">83</td><td class="ins"><ins>+                      s = '';</ins></td></tr>
<tr id="50"><td class="linenumbers"> </td><td class="linenumbers">84</td><td class="ins"><ins>+                      for (i = 0; i&lt;value.length; i++) {</ins></td></tr>
<tr id="51"><td class="linenumbers"> </td><td class="linenumbers">85</td><td class="ins"><ins>+                          v = value[i];</ins></td></tr>
<tr id="52"><td class="linenumbers"> </td><td class="linenumbers">86</td><td class="ins"><ins>+                          if ( s!='' ) s += ', ';</ins></td></tr>
<tr id="53"><td class="linenumbers"> </td><td class="linenumbers">87</td><td class="ins"><ins>+                          s += categoryTreeEncodeValue( v );</ins></td></tr>
<tr id="54"><td class="linenumbers"> </td><td class="linenumbers">88</td><td class="ins"><ins>+                      }</ins></td></tr>
<tr id="55"><td class="linenumbers"> </td><td class="linenumbers">89</td><td class="ins"><ins>+                      s = '[' + s + ']';</ins></td></tr>
<tr id="56"><td class="linenumbers"> </td><td class="linenumbers">90</td><td class="ins"><ins>+                  }</ins></td></tr>
<tr id="57"><td class="linenumbers"> </td><td class="linenumbers">91</td><td class="ins"><ins>+                  else {</ins></td></tr>
<tr id="58"><td class="linenumbers"> </td><td class="linenumbers">92</td><td class="ins"><ins>+                      s = '';</ins></td></tr>
<tr id="59"><td class="linenumbers"> </td><td class="linenumbers">93</td><td class="ins"><ins>+                      for (k in value) {</ins></td></tr>
<tr id="60"><td class="linenumbers"> </td><td class="linenumbers">94</td><td class="ins"><ins>+                          v = value[k];</ins></td></tr>
<tr id="61"><td class="linenumbers"> </td><td class="linenumbers">95</td><td class="ins"><ins>+                          if ( s!='' ) s += ', ';</ins></td></tr>
<tr id="62"><td class="linenumbers"> </td><td class="linenumbers">96</td><td class="ins"><ins>+                          s += categoryTreeEncodeValue( k );</ins></td></tr>
<tr id="63"><td class="linenumbers"> </td><td class="linenumbers">97</td><td class="ins"><ins>+                          s += ': ';</ins></td></tr>
<tr id="64"><td class="linenumbers"> </td><td class="linenumbers">98</td><td class="ins"><ins>+                          s += categoryTreeEncodeValue( v );</ins></td></tr>
<tr id="65"><td class="linenumbers"> </td><td class="linenumbers">99</td><td class="ins"><ins>+                      }</ins></td></tr>
<tr id="66"><td class="linenumbers"> </td><td class="linenumbers">100</td><td class="ins"><ins>+                      s = '{' + s + '}';</ins></td></tr>
<tr id="67"><td class="linenumbers"> </td><td class="linenumbers">101</td><td class="ins"><ins>+                  }</ins></td></tr>
<tr id="68"><td class="linenumbers">82</td><td class="linenumbers">102</td><td class="unchanged"><span>                   break;</span></td></tr>
<tr id="69"><td class="linenumbers">83</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="70"><td class="linenumbers">84</td><td class="linenumbers">103</td><td class="unchanged"><span>               default:</span></td></tr>
<tr id="71"><td class="linenumbers">85</td><td class="linenumbers"> </td><td class="del"><del>-                  throw new Error("categoryTreeLoadChildren encountered strange variable type " + (typeof v));</del></td></tr>
<tr id="72"><td class="linenumbers"> </td><td class="linenumbers">104</td><td class="ins"><ins>+                  throw new Error("categoryTreeEncodeValue encountered strange variable type " + (typeof value));</ins></td></tr>
<tr id="73"><td class="linenumbers">86</td><td class="linenumbers">105</td><td class="unchanged"><span>           }</span></td></tr>
<tr id="74"><td class="linenumbers">87</td><td class="linenumbers">106</td><td class="unchanged"><span> </span></td></tr>
<tr id="75"><td class="linenumbers">88</td><td class="linenumbers"> </td><td class="del"><del>-          if ( opt != "" ) opt += ", ";</del></td></tr>
<tr id="76"><td class="linenumbers">89</td><td class="linenumbers"> </td><td class="del"><del>-          opt += k;</del></td></tr>
<tr id="77"><td class="linenumbers">90</td><td class="linenumbers"> </td><td class="del"><del>-          opt += ":";</del></td></tr>
<tr id="78"><td class="linenumbers">91</td><td class="linenumbers"> </td><td class="del"><del>-          opt += v;</del></td></tr>
<tr id="79"><td class="linenumbers">92</td><td class="linenumbers"> </td><td class="del"><del>-      }</del></td></tr>
<tr id="80"><td class="linenumbers">93</td><td class="linenumbers"> </td><td class="del"><del>-      </del></td></tr>
<tr id="81"><td class="linenumbers">94</td><td class="linenumbers"> </td><td class="del"><del>-      opt = "{"+opt+"}";</del></td></tr>
<tr id="82"><td class="linenumbers">95</td><td class="linenumbers"> </td><td class="del"><del>-      return opt;</del></td></tr>
<tr id="83"><td class="linenumbers"> </td><td class="linenumbers">107</td><td class="ins"><ins>+      return s;</ins></td></tr>
<tr id="84"><td class="linenumbers">96</td><td class="linenumbers">108</td><td class="unchanged"><span>     }</span></td></tr>
<tr id="85"><td class="linenumbers">97</td><td class="linenumbers">109</td><td class="unchanged"><span> </span></td></tr>
<tr id="86"><td class="linenumbers">98</td><td class="linenumbers">110</td><td class="unchanged"><span>     function categoryTreeLoadChildren(cat, options, div) {</span></td></tr>
<tr id="87"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -130,6 +142,6 @@</span></td></tr>
<tr id="88"><td class="linenumbers">131</td><td class="linenumbers">143</td><td class="unchanged"><span>           div.innerHTML= result;</span></td></tr>
<tr id="89"><td class="linenumbers">132</td><td class="linenumbers">144</td><td class="unchanged"><span>       }</span></td></tr>
<tr id="90"><td class="linenumbers">133</td><td class="linenumbers">145</td><td class="unchanged"><span> </span></td></tr>
<tr id="91"><td class="linenumbers">134</td><td class="linenumbers"> </td><td class="del"><del>-      var opt = categoryTreeEncodeOptions(options);</del></td></tr>
<tr id="92"><td class="linenumbers"> </td><td class="linenumbers">146</td><td class="ins"><ins>+      var opt = categoryTreeEncodeValue(options);</ins></td></tr>
<tr id="93"><td class="linenumbers">135</td><td class="linenumbers">147</td><td class="unchanged"><span>       sajax_do_call( "efCategoryTreeAjaxWrapper", [cat, opt, 'json'] , f );</span></td></tr>
<tr id="94"><td class="linenumbers">136</td><td class="linenumbers">148</td><td class="unchanged"><span>     }</span></td></tr>
<tr id="95" class="patchedfile"><td colspan="3">Index: trunk/extensions/CategoryTree/CategoryTreeFunctions.php</td></tr>



<tr id="99"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -33,12 +33,60 @@</span></td></tr>
<tr id="100"><td class="linenumbers">34</td><td class="linenumbers">34</td><td class="unchanged"><span> 		$this->mOptions['mode'] = self::decodeMode( $this->mOptions['mode'] );</span></td></tr>
<tr id="101"><td class="linenumbers">35</td><td class="linenumbers">35</td><td class="unchanged"><span> 		$this->mOptions['hideprefix'] = self::decodeHidePrefix( $this->mOptions['hideprefix'] );</span></td></tr>
<tr id="102"><td class="linenumbers">36</td><td class="linenumbers">36</td><td class="unchanged"><span> 		$this->mOptions['showcount']  = self::decodeBoolean( $this->mOptions['showcount'] );</span></td></tr>
<tr id="103"><td class="linenumbers"> </td><td class="linenumbers">37</td><td class="ins"><ins>+		$this->mOptions['namespaces']  = self::decodeNamespaces( $this->mOptions['namespaces'] );</ins></td></tr>
<tr id="104"><td class="linenumbers"> </td><td class="linenumbers">38</td><td class="ins"><ins>+</ins></td></tr>
<tr id="105"><td class="linenumbers"> </td><td class="linenumbers">39</td><td class="ins"><ins>+		if ( $this->mOptions['namespaces'] ) {</ins></td></tr>
<tr id="106"><td class="linenumbers"> </td><td class="linenumbers">40</td><td class="ins"><ins>+			# automatically adjust mode to match namespace filter</ins></td></tr>
<tr id="107"><td class="linenumbers"> </td><td class="linenumbers">41</td><td class="ins"><ins>+			if ( sizeof( $this->mOptions['namespaces'] ) === 1  </ins></td></tr>
<tr id="108"><td class="linenumbers"> </td><td class="linenumbers">42</td><td class="ins"><ins>+				&amp;&amp; $this->mOptions['namespaces'][0] == NS_CATEGORY ) {</ins></td></tr>
<tr id="109"><td class="linenumbers"> </td><td class="linenumbers">43</td><td class="ins"><ins>+				$this->mOptions['mode'] = CT_MODE_CATEGORIES;</ins></td></tr>
<tr id="110"><td class="linenumbers"> </td><td class="linenumbers">44</td><td class="ins"><ins>+			} else if ( !in_array( NS_IMAGE, $this->mOptions['namespaces'] ) ) {</ins></td></tr>
<tr id="111"><td class="linenumbers"> </td><td class="linenumbers">45</td><td class="ins"><ins>+				$this->mOptions['mode'] = CT_MODE_PAGES;</ins></td></tr>
<tr id="112"><td class="linenumbers"> </td><td class="linenumbers">46</td><td class="ins"><ins>+			} else {</ins></td></tr>
<tr id="113"><td class="linenumbers"> </td><td class="linenumbers">47</td><td class="ins"><ins>+				$this->mOptions['mode'] = CT_MODE_ALL;</ins></td></tr>
<tr id="114"><td class="linenumbers"> </td><td class="linenumbers">48</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="115"><td class="linenumbers"> </td><td class="linenumbers">49</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="116"><td class="linenumbers">37</td><td class="linenumbers">50</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="117"><td class="linenumbers">38</td><td class="linenumbers">51</td><td class="unchanged"><span> </span></td></tr>
<tr id="118"><td class="linenumbers">39</td><td class="linenumbers">52</td><td class="unchanged"><span> 	function getOption( $name ) {</span></td></tr>
<tr id="119"><td class="linenumbers">40</td><td class="linenumbers">53</td><td class="unchanged"><span> 		return $this->mOptions[$name];</span></td></tr>
<tr id="120"><td class="linenumbers">41</td><td class="linenumbers">54</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="121"><td class="linenumbers">42</td><td class="linenumbers">55</td><td class="unchanged"><span> </span></td></tr>
<tr id="122"><td class="linenumbers"> </td><td class="linenumbers">56</td><td class="ins"><ins>+	static function decodeNamespaces( $nn ) {</ins></td></tr>
<tr id="123"><td class="linenumbers"> </td><td class="linenumbers">57</td><td class="ins"><ins>+		global $wgContLang;</ins></td></tr>
<tr id="124"><td class="linenumbers"> </td><td class="linenumbers">58</td><td class="ins"><ins>+</ins></td></tr>
<tr id="125"><td class="linenumbers"> </td><td class="linenumbers">59</td><td class="ins"><ins>+		if ( !$nn )</ins></td></tr>
<tr id="126"><td class="linenumbers"> </td><td class="linenumbers">60</td><td class="ins"><ins>+			return false;</ins></td></tr>
<tr id="127"><td class="linenumbers"> </td><td class="linenumbers">61</td><td class="ins"><ins>+</ins></td></tr>
<tr id="128"><td class="linenumbers"> </td><td class="linenumbers">62</td><td class="ins"><ins>+		if ( !is_array($nn) ) </ins></td></tr>
<tr id="129"><td class="linenumbers"> </td><td class="linenumbers">63</td><td class="ins"><ins>+			$nn = preg_split( '![\s#:|]+!', $nn );</ins></td></tr>
<tr id="130"><td class="linenumbers"> </td><td class="linenumbers">64</td><td class="ins"><ins>+</ins></td></tr>
<tr id="131"><td class="linenumbers"> </td><td class="linenumbers">65</td><td class="ins"><ins>+		$namespaces = array();</ins></td></tr>
<tr id="132"><td class="linenumbers"> </td><td class="linenumbers">66</td><td class="ins"><ins>+</ins></td></tr>
<tr id="133"><td class="linenumbers"> </td><td class="linenumbers">67</td><td class="ins"><ins>+		foreach ( $nn as $n ) {</ins></td></tr>
<tr id="134"><td class="linenumbers"> </td><td class="linenumbers">68</td><td class="ins"><ins>+			if ( is_int( $n ) ) {</ins></td></tr>
<tr id="135"><td class="linenumbers"> </td><td class="linenumbers">69</td><td class="ins"><ins>+				$ns = $n;</ins></td></tr>
<tr id="136"><td class="linenumbers"> </td><td class="linenumbers">70</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="137"><td class="linenumbers"> </td><td class="linenumbers">71</td><td class="ins"><ins>+			else {</ins></td></tr>
<tr id="138"><td class="linenumbers"> </td><td class="linenumbers">72</td><td class="ins"><ins>+				$n = trim( $n );</ins></td></tr>
<tr id="139"><td class="linenumbers"> </td><td class="linenumbers">73</td><td class="ins"><ins>+				if ( $n === '' ) continue;</ins></td></tr>
<tr id="140"><td class="linenumbers"> </td><td class="linenumbers">74</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="141"><td class="linenumbers"> </td><td class="linenumbers">75</td><td class="ins"><ins>+				$lower = strtolower( $n );</ins></td></tr>
<tr id="142"><td class="linenumbers"> </td><td class="linenumbers">76</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="143"><td class="linenumbers"> </td><td class="linenumbers">77</td><td class="ins"><ins>+				if ( is_numeric($n) )  $ns = (int)$n;</ins></td></tr>
<tr id="144"><td class="linenumbers"> </td><td class="linenumbers">78</td><td class="ins"><ins>+				elseif ( $n == '-' || $n == '_' || $n == '*' || $lower == 'main' ) $ns = NS_MAIN;</ins></td></tr>
<tr id="145"><td class="linenumbers"> </td><td class="linenumbers">79</td><td class="ins"><ins>+				else $ns = $wgContLang->getNsIndex( $n );</ins></td></tr>
<tr id="146"><td class="linenumbers"> </td><td class="linenumbers">80</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="147"><td class="linenumbers"> </td><td class="linenumbers">81</td><td class="ins"><ins>+</ins></td></tr>
<tr id="148"><td class="linenumbers"> </td><td class="linenumbers">82</td><td class="ins"><ins>+			if ( is_int( $ns ) ) {</ins></td></tr>
<tr id="149"><td class="linenumbers"> </td><td class="linenumbers">83</td><td class="ins"><ins>+				$namespaces[] = $ns;</ins></td></tr>
<tr id="150"><td class="linenumbers"> </td><td class="linenumbers">84</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="151"><td class="linenumbers"> </td><td class="linenumbers">85</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="152"><td class="linenumbers"> </td><td class="linenumbers">86</td><td class="ins"><ins>+</ins></td></tr>
<tr id="153"><td class="linenumbers"> </td><td class="linenumbers">87</td><td class="ins"><ins>+		sort( $namespaces ); # get elements into canonical order</ins></td></tr>
<tr id="154"><td class="linenumbers"> </td><td class="linenumbers">88</td><td class="ins"><ins>+		return $namespaces;</ins></td></tr>
<tr id="155"><td class="linenumbers"> </td><td class="linenumbers">89</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="156"><td class="linenumbers"> </td><td class="linenumbers">90</td><td class="ins"><ins>+</ins></td></tr>
<tr id="157"><td class="linenumbers">43</td><td class="linenumbers">91</td><td class="unchanged"><span> 	static function decodeMode( $mode ) {</span></td></tr>
<tr id="158"><td class="linenumbers">44</td><td class="linenumbers">92</td><td class="unchanged"><span> 		global $wgCategoryTreeDefaultOptions;</span></td></tr>
<tr id="159"><td class="linenumbers">45</td><td class="linenumbers">93</td><td class="unchanged"><span> </span></td></tr>
<tr id="160"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -199,6 +247,7 @@</span></td></tr>
<tr id="161"><td class="linenumbers">200</td><td class="linenumbers">248</td><td class="unchanged"><span> 		$key = "";</span></td></tr>
<tr id="162"><td class="linenumbers">201</td><td class="linenumbers">249</td><td class="unchanged"><span> </span></td></tr>
<tr id="163"><td class="linenumbers">202</td><td class="linenumbers">250</td><td class="unchanged"><span> 		foreach ( $this->mOptions as $k => $v ) {</span></td></tr>
<tr id="164"><td class="linenumbers"> </td><td class="linenumbers">251</td><td class="ins"><ins>+			if ( is_array( $v ) ) $v = implode( '|', $v );</ins></td></tr>
<tr id="165"><td class="linenumbers">203</td><td class="linenumbers">252</td><td class="unchanged"><span> 			$key .= $k . ':' . $v . ';';</span></td></tr>
<tr id="166"><td class="linenumbers">204</td><td class="linenumbers">253</td><td class="unchanged"><span> 		}</span></td></tr>
<tr id="167"><td class="linenumbers">205</td><td class="linenumbers">254</td><td class="unchanged"><span> </span></td></tr>
<tr id="168"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -341,11 +390,19 @@</span></td></tr>
<tr id="169"><td class="linenumbers">342</td><td class="linenumbers">391</td><td class="unchanged"><span> </span></td></tr>
<tr id="170"><td class="linenumbers">343</td><td class="linenumbers">392</td><td class="unchanged"><span> </span></td></tr>
<tr id="171"><td class="linenumbers">344</td><td class="linenumbers">393</td><td class="unchanged"><span> 		$mode = $this->getOption('mode');</span></td></tr>
<tr id="172"><td class="linenumbers"> </td><td class="linenumbers">394</td><td class="ins"><ins>+		$namespaces = $this->getOption('namespaces');</ins></td></tr>
<tr id="173"><td class="linenumbers">345</td><td class="linenumbers">395</td><td class="unchanged"><span> </span></td></tr>
<tr id="174"><td class="linenumbers">346</td><td class="linenumbers"> </td><td class="del"><del>-		#namespace filter. Should be configurable</del></td></tr>
<tr id="175"><td class="linenumbers">347</td><td class="linenumbers"> </td><td class="del"><del>-		if ( $mode == CT_MODE_ALL ) $nsmatch = '';</del></td></tr>
<tr id="176"><td class="linenumbers">348</td><td class="linenumbers"> </td><td class="del"><del>-		else if ( $mode == CT_MODE_PAGES ) $nsmatch = ' AND cat.page_namespace != ' . NS_IMAGE;</del></td></tr>
<tr id="177"><td class="linenumbers">349</td><td class="linenumbers"> </td><td class="del"><del>-		else $nsmatch = ' AND cat.page_namespace = ' . NS_CATEGORY;</del></td></tr>
<tr id="178"><td class="linenumbers"> </td><td class="linenumbers">396</td><td class="ins"><ins>+		#namespace filter. </ins></td></tr>
<tr id="179"><td class="linenumbers"> </td><td class="linenumbers">397</td><td class="ins"><ins>+		if ( $namespaces ) {</ins></td></tr>
<tr id="180"><td class="linenumbers"> </td><td class="linenumbers">398</td><td class="ins"><ins>+			#NOTE: we assume that the $namespaces array contains only integers!</ins></td></tr>
<tr id="181"><td class="linenumbers"> </td><td class="linenumbers">399</td><td class="ins"><ins>+			if ( sizeof( $namespaces ) === 1 ) $nsmatch = ' AND cat.page_namespace = ' . $namespaces[0] . ' ';</ins></td></tr>
<tr id="182"><td class="linenumbers"> </td><td class="linenumbers">400</td><td class="ins"><ins>+			else $nsmatch = ' AND cat.page_namespace IN ( ' . implode( ', ', $namespaces ) . ') ';</ins></td></tr>
<tr id="183"><td class="linenumbers"> </td><td class="linenumbers">401</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="184"><td class="linenumbers"> </td><td class="linenumbers">402</td><td class="ins"><ins>+		else {</ins></td></tr>
<tr id="185"><td class="linenumbers"> </td><td class="linenumbers">403</td><td class="ins"><ins>+			if ( $mode == CT_MODE_ALL ) $nsmatch = '';</ins></td></tr>
<tr id="186"><td class="linenumbers"> </td><td class="linenumbers">404</td><td class="ins"><ins>+			else if ( $mode == CT_MODE_PAGES ) $nsmatch = ' AND cat.page_namespace != ' . NS_IMAGE;</ins></td></tr>
<tr id="187"><td class="linenumbers"> </td><td class="linenumbers">405</td><td class="ins"><ins>+			else $nsmatch = ' AND cat.page_namespace = ' . NS_CATEGORY;</ins></td></tr>
<tr id="188"><td class="linenumbers"> </td><td class="linenumbers">406</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="189"><td class="linenumbers">350</td><td class="linenumbers">407</td><td class="unchanged"><span> </span></td></tr>
<tr id="190"><td class="linenumbers">351</td><td class="linenumbers">408</td><td class="unchanged"><span> 		#additional stuff to be used if "transaltion" by interwiki-links is desired</span></td></tr>
<tr id="191"><td class="linenumbers">352</td><td class="linenumbers">409</td><td class="unchanged"><span> 		$transFields = '';</span></td></tr>
<tr id="192"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -551,13 +608,15 @@</span></td></tr>
<tr id="193"><td class="linenumbers">552</td><td class="linenumbers">609</td><td class="unchanged"><span> </span></td></tr>
<tr id="194"><td class="linenumbers">553</td><td class="linenumbers">610</td><td class="unchanged"><span> 			$linkattr[ 'class' ] = "CategoryTreeToggle";</span></td></tr>
<tr id="195"><td class="linenumbers">554</td><td class="linenumbers">611</td><td class="unchanged"><span> </span></td></tr>
<tr id="196"><td class="linenumbers">555</td><td class="linenumbers"> </td><td class="del"><del>-			if ( $count === 0 ) {</del></td></tr>
<tr id="197"><td class="linenumbers"> </td><td class="linenumbers">612</td><td class="ins"><ins>+			/*if ( $count === 0 ) {</ins></td></tr>
<tr id="198"><td class="linenumbers">556</td><td class="linenumbers">613</td><td class="unchanged"><span> 				$tag = 'span';</span></td></tr>
<tr id="199"><td class="linenumbers">557</td><td class="linenumbers">614</td><td class="unchanged"><span> 				$txt = wfMsgNoTrans( 'categorytree-empty-bullet' );</span></td></tr>
<tr id="200"><td class="linenumbers">558</td><td class="linenumbers">615</td><td class="unchanged"><span> 			}</span></td></tr>
<tr id="201"><td class="linenumbers">559</td><td class="linenumbers"> </td><td class="del"><del>-			else if ( $children == 0 || $loadchildren ) {</del></td></tr>
<tr id="202"><td class="linenumbers"> </td><td class="linenumbers">616</td><td class="ins"><ins>+			else*/ </ins></td></tr>
<tr id="203"><td class="linenumbers"> </td><td class="linenumbers">617</td><td class="ins"><ins>+			if ( $children == 0 || $loadchildren ) {</ins></td></tr>
<tr id="204"><td class="linenumbers">560</td><td class="linenumbers">618</td><td class="unchanged"><span> 				$tag = 'a';</span></td></tr>
<tr id="205"><td class="linenumbers">561</td><td class="linenumbers"> </td><td class="del"><del>-				$txt = wfMsgNoTrans( 'categorytree-expand-bullet' );</del></td></tr>
<tr id="206"><td class="linenumbers"> </td><td class="linenumbers">619</td><td class="ins"><ins>+				if ( $count === 0 ) $txt = wfMsgNoTrans( 'categorytree-empty-bullet' );</ins></td></tr>
<tr id="207"><td class="linenumbers"> </td><td class="linenumbers">620</td><td class="ins"><ins>+				else $txt = wfMsgNoTrans( 'categorytree-expand-bullet' );</ins></td></tr>
<tr id="208"><td class="linenumbers">562</td><td class="linenumbers">621</td><td class="unchanged"><span> 				$linkattr[ 'onclick' ] = "this.href='javascript:void(0)'; categoryTreeExpandNode('".Xml::escapeJsString($key)."',".$this->getOptionsAsJsStructure().",this);";</span></td></tr>
<tr id="209"><td class="linenumbers">563</td><td class="linenumbers">622</td><td class="unchanged"><span> 				# Don't load this message for ajax requests, so that we don't have to initialise $wgLang</span></td></tr>
<tr id="210"><td class="linenumbers">564</td><td class="linenumbers">623</td><td class="unchanged"><span> 				$linkattr[ 'title' ] = $this->mIsAjaxRequest ? '##LOAD##' : wfMsgNoTrans('categorytree-expand');</span></td></tr>
<tr id="211"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -593,7 +652,19 @@</span></td></tr>
<tr id="212"><td class="linenumbers">594</td><td class="linenumbers">653</td><td class="unchanged"><span> 		$s .= "\n\t\t";</span></td></tr>
<tr id="213"><td class="linenumbers">595</td><td class="linenumbers">654</td><td class="unchanged"><span> 		$s .= Xml::openElement( 'div', array( 'class' => 'CategoryTreeChildren', 'style' => $children > 0 ? "display:block" : "display:none" ) );</span></td></tr>
<tr id="214"><td class="linenumbers">596</td><td class="linenumbers">655</td><td class="unchanged"><span> 		</span></td></tr>
<tr id="215"><td class="linenumbers">597</td><td class="linenumbers"> </td><td class="del"><del>-		if ( $children > 0 &amp;&amp; !$loadchildren) $s .= $this->renderChildren( $title, $children );</del></td></tr>
<tr id="216"><td class="linenumbers"> </td><td class="linenumbers">656</td><td class="ins"><ins>+		if ( $ns == NS_CATEGORY &amp;&amp; $children > 0 &amp;&amp; !$loadchildren) {</ins></td></tr>
<tr id="217"><td class="linenumbers"> </td><td class="linenumbers">657</td><td class="ins"><ins>+			$children = $this->renderChildren( $title, $children );</ins></td></tr>
<tr id="218"><td class="linenumbers"> </td><td class="linenumbers">658</td><td class="ins"><ins>+			if ( $children == '' ) {</ins></td></tr>
<tr id="219"><td class="linenumbers"> </td><td class="linenumbers">659</td><td class="ins"><ins>+				$s .= Xml::openElement( 'i', array( 'class' => 'CategoryTreeNotice' ) );</ins></td></tr>
<tr id="220"><td class="linenumbers"> </td><td class="linenumbers">660</td><td class="ins"><ins>+				if ( $mode == CT_MODE_CATEGORIES ) $s .= wfMsgExt( 'categorytree-no-subcategories', 'parsemag');</ins></td></tr>
<tr id="221"><td class="linenumbers"> </td><td class="linenumbers">661</td><td class="ins"><ins>+				else if ( $mode == CT_MODE_PAGES ) $s .= wfMsgExt( 'categorytree-no-pages', 'parsemag');</ins></td></tr>
<tr id="222"><td class="linenumbers"> </td><td class="linenumbers">662</td><td class="ins"><ins>+				else $s .= wfMsgExt( 'categorytree-nothing-found', 'parsemag');</ins></td></tr>
<tr id="223"><td class="linenumbers"> </td><td class="linenumbers">663</td><td class="ins"><ins>+				$s .= Xml::closeElement( 'i' );</ins></td></tr>
<tr id="224"><td class="linenumbers"> </td><td class="linenumbers">664</td><td class="ins"><ins>+			} else {</ins></td></tr>
<tr id="225"><td class="linenumbers"> </td><td class="linenumbers">665</td><td class="ins"><ins>+				$s .= $children;</ins></td></tr>
<tr id="226"><td class="linenumbers"> </td><td class="linenumbers">666</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="227"><td class="linenumbers"> </td><td class="linenumbers">667</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="228"><td class="linenumbers"> </td><td class="linenumbers">668</td><td class="ins"><ins>+</ins></td></tr>
<tr id="229"><td class="linenumbers">598</td><td class="linenumbers">669</td><td class="unchanged"><span> 		$s .= Xml::closeElement( 'div' );</span></td></tr>
<tr id="230"><td class="linenumbers">599</td><td class="linenumbers">670</td><td class="unchanged"><span> 		$s .= Xml::closeElement( 'div' );</span></td></tr>
<tr id="231"><td class="linenumbers">600</td><td class="linenumbers">671</td><td class="unchanged"><span> </span></td></tr>
<tr id="232" class="patchedfile"><td colspan="3">Index: trunk/extensions/CategoryTree/CategoryTree.php</td></tr>



<tr id="236"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -67,7 +67,7 @@</span></td></tr>
<tr id="237"><td class="linenumbers">68</td><td class="linenumbers">68</td><td class="unchanged"><span> $wgCategoryTreeDefaultOptions['mode'] = NULL; # will be set to $wgCategoryTreeDefaultMode in efCategoryTree(); compatibility quirk</span></td></tr>
<tr id="238"><td class="linenumbers">69</td><td class="linenumbers">69</td><td class="unchanged"><span> $wgCategoryTreeDefaultOptions['hideprefix'] = NULL; # will be set to $wgCategoryTreeDefaultMode in efCategoryTree(); compatibility quirk</span></td></tr>
<tr id="239"><td class="linenumbers">70</td><td class="linenumbers">70</td><td class="unchanged"><span> $wgCategoryTreeDefaultOptions['showcount'] = false;</span></td></tr>
<tr id="240"><td class="linenumbers">71</td><td class="linenumbers"> </td><td class="del"><del>-#TODO: hideprefix: always, never, catonly, catonly_if_onlycat</del></td></tr>
<tr id="241"><td class="linenumbers"> </td><td class="linenumbers">71</td><td class="ins"><ins>+$wgCategoryTreeDefaultOptions['namespaces'] = false; # false means "no filter"</ins></td></tr>
<tr id="242"><td class="linenumbers">72</td><td class="linenumbers">72</td><td class="unchanged"><span> </span></td></tr>
<tr id="243"><td class="linenumbers">73</td><td class="linenumbers">73</td><td class="unchanged"><span> $wgCategoryTreeCategoryPageMode = CT_MODE_CATEGORIES;</span></td></tr>
<tr id="244"><td class="linenumbers">74</td><td class="linenumbers">74</td><td class="unchanged"><span> $wgCategoryTreeCategoryPageOptions = array(); #Options to be used for category pages</span></td></tr>
<tr id="245"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -115,7 +115,6 @@</span></td></tr>
<tr id="246"><td class="linenumbers">116</td><td class="linenumbers">116</td><td class="unchanged"><span> $wgHooks['ArticleFromTitle'][] = 'efCategoryTreeArticleFromTitle';</span></td></tr>
<tr id="247"><td class="linenumbers">117</td><td class="linenumbers">117</td><td class="unchanged"><span> $wgHooks['LanguageGetMagic'][] = 'efCategoryTreeGetMagic';</span></td></tr>
<tr id="248"><td class="linenumbers">118</td><td class="linenumbers">118</td><td class="unchanged"><span> </span></td></tr>
<tr id="249"><td class="linenumbers">119</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="250"><td class="linenumbers">120</td><td class="linenumbers">119</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="251"><td class="linenumbers">121</td><td class="linenumbers">120</td><td class="unchanged"><span>  * register Ajax function</span></td></tr>
<tr id="252"><td class="linenumbers">122</td><td class="linenumbers">121</td><td class="unchanged"><span>  */</span></td></tr>
</table>
</div>
<h2 id='code-comments'>Comments</h2>
<div class='mw-codereview-comments'><div class="mw-codereview-comment" id="c6353" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./36864.html#c6353" title="Special:Code/MediaWiki/36864">#</a>Comment by <a href="https://www.mediawiki.org/w/index.php?title=User:I3utchg&amp;action=edit&amp;redlink=1" class="new mw-userlink" title="User:I3utchg (page does not exist)"><bdi>I3utchg</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/w/index.php?title=User_talk:I3utchg&amp;action=edit&amp;redlink=1" class="new mw-usertoollinks-talk" title="User talk:I3utchg (page does not exist)">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/I3utchg" class="mw-usertoollinks-contribs" title="Special:Contributions/I3utchg">contribs</a>)</span> &#160; 07:19, 27 March 2010 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>2cycle only. Try 2 develop spiral electromagnetic field... Source of E... Solar that is relay/channel by sat (retracting/refracting mirror/.......)then converting it to electric. CODE:UFRE=Sun+E+S.U.N.&gt;Element:deleted
</p><p><br />
idea...c above
</p></div></div></div><h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>15:28, 12 September 2011&#160;<a href="https://www.mediawiki.org/wiki/User:Meno25" class="mw-userlink" title="User:Meno25"><bdi>Meno25</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Meno25" class="mw-usertoollinks-talk" title="User talk:Meno25">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Meno25" class="mw-usertoollinks-contribs" title="Special:Contributions/Meno25">contribs</a>)</span>&#160;changed the <b>status</b> of r36864 <i>[<b>removed:</b> ok&#160;<b>added:</b> old]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/36864.html responseCode 3 200 