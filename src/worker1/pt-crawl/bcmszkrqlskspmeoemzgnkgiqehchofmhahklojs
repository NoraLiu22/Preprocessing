bcmszkrqlskspmeoemzgnkgiqehchofmhahklojs length 5 18419 page 18419 
<html>
<head>
<title>r46247 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r46247 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/46247" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./46246.html" title="Special:Code/MediaWiki/46246">r46246</a>‎ | <b>r46247</b> | <a href="./46248.html" title="Special:Code/MediaWiki/46248">r46248</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>09:48, 26 January 2009</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/nikerabbit" title="Special:Code/MediaWiki/author/nikerabbit">nikerabbit</a></td></tr>
<tr><td>Status:</td><td>ok (<a href="#code-comments">Comments</a>)
</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">* (<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=13040">bug 13040</a>) {{GENDER:}} magic word for interface messages</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/RELEASE-NOTES</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2FRELEASE-NOTES" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/DefaultSettings.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FDefaultSettings.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/parser/CoreParserFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2Fparser%2FCoreParserFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/languages/Language.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Flanguages%2FLanguage.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/46247&amp;action=purge" title="Special:Code/MediaWiki/46247">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/parser/CoreParserFunctions.php</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -27,6 +27,7 @@</span></td></tr>
<tr id="6"><td class="linenumbers">28</td><td class="linenumbers">28</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'fullurle',         array( __CLASS__, 'fullurle'         ), SFH_NO_HASH );</span></td></tr>
<tr id="7"><td class="linenumbers">29</td><td class="linenumbers">29</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'formatnum',        array( __CLASS__, 'formatnum'        ), SFH_NO_HASH );</span></td></tr>
<tr id="8"><td class="linenumbers">30</td><td class="linenumbers">30</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'grammar',          array( __CLASS__, 'grammar'          ), SFH_NO_HASH );</span></td></tr>
<tr id="9"><td class="linenumbers"> </td><td class="linenumbers">31</td><td class="ins"><ins>+		$parser->setFunctionHook( 'gender',           array( __CLASS__, 'gender'           ), SFH_NO_HASH );</ins></td></tr>
<tr id="10"><td class="linenumbers">31</td><td class="linenumbers">32</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'plural',           array( __CLASS__, 'plural'           ), SFH_NO_HASH );</span></td></tr>
<tr id="11"><td class="linenumbers">32</td><td class="linenumbers">33</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'numberofpages',    array( __CLASS__, 'numberofpages'    ), SFH_NO_HASH );</span></td></tr>
<tr id="12"><td class="linenumbers">33</td><td class="linenumbers">34</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'numberofusers',    array( __CLASS__, 'numberofusers'    ), SFH_NO_HASH );</span></td></tr>
<tr id="13"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -155,6 +156,22 @@</span></td></tr>
<tr id="14"><td class="linenumbers">156</td><td class="linenumbers">157</td><td class="unchanged"><span> 		return $parser->getFunctionLang()->convertGrammar( $word, $case );</span></td></tr>
<tr id="15"><td class="linenumbers">157</td><td class="linenumbers">158</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="16"><td class="linenumbers">158</td><td class="linenumbers">159</td><td class="unchanged"><span> </span></td></tr>
<tr id="17"><td class="linenumbers"> </td><td class="linenumbers">160</td><td class="ins"><ins>+	static function gender( $parser, $user ) {</ins></td></tr>
<tr id="18"><td class="linenumbers"> </td><td class="linenumbers">161</td><td class="ins"><ins>+		$forms = array_slice( func_get_args(), 2);</ins></td></tr>
<tr id="19"><td class="linenumbers"> </td><td class="linenumbers">162</td><td class="ins"><ins>+</ins></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">163</td><td class="ins"><ins>+		// default</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">164</td><td class="ins"><ins>+		$gender = User::getDefaultOption( 'gender' );</ins></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">165</td><td class="ins"><ins>+</ins></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">166</td><td class="ins"><ins>+		// check parameter, or use $wgUser if in interface message</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">167</td><td class="ins"><ins>+		$user = User::newFromName( $user );</ins></td></tr>
<tr id="25"><td class="linenumbers"> </td><td class="linenumbers">168</td><td class="ins"><ins>+		if ( $user ) {</ins></td></tr>
<tr id="26"><td class="linenumbers"> </td><td class="linenumbers">169</td><td class="ins"><ins>+			$gender = $user->getOption( 'gender' );</ins></td></tr>
<tr id="27"><td class="linenumbers"> </td><td class="linenumbers">170</td><td class="ins"><ins>+		} elseif ( $parser->mOptions->getInterfaceMessage() ) {</ins></td></tr>
<tr id="28"><td class="linenumbers"> </td><td class="linenumbers">171</td><td class="ins"><ins>+			global $wgUser;</ins></td></tr>
<tr id="29"><td class="linenumbers"> </td><td class="linenumbers">172</td><td class="ins"><ins>+			$gender = $wgUser->getOption( 'gender' );</ins></td></tr>
<tr id="30"><td class="linenumbers"> </td><td class="linenumbers">173</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="31"><td class="linenumbers"> </td><td class="linenumbers">174</td><td class="ins"><ins>+		return $parser->getFunctionLang()->gender( $gender, $forms );</ins></td></tr>
<tr id="32"><td class="linenumbers"> </td><td class="linenumbers">175</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="33"><td class="linenumbers">159</td><td class="linenumbers">176</td><td class="unchanged"><span> 	static function plural( $parser, $text = '') {</span></td></tr>
<tr id="34"><td class="linenumbers">160</td><td class="linenumbers">177</td><td class="unchanged"><span> 		$forms = array_slice( func_get_args(), 2);</span></td></tr>
<tr id="35"><td class="linenumbers">161</td><td class="linenumbers">178</td><td class="unchanged"><span> 		$text = $parser->getFunctionLang()->parseFormattedNumber( $text );</span></td></tr>
<tr id="36" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/DefaultSettings.php</td></tr>



<tr id="40"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -2430,6 +2430,7 @@</span></td></tr>
<tr id="41"><td class="linenumbers">2431</td><td class="linenumbers">2431</td><td class="unchanged"><span> 	'watchmoves'              => 0,</span></td></tr>
<tr id="42"><td class="linenumbers">2432</td><td class="linenumbers">2432</td><td class="unchanged"><span> 	'watchdeletion'           => 0,</span></td></tr>
<tr id="43"><td class="linenumbers">2433</td><td class="linenumbers">2433</td><td class="unchanged"><span> 	'noconvertlink'           => 0,</span></td></tr>
<tr id="44"><td class="linenumbers"> </td><td class="linenumbers">2434</td><td class="ins"><ins>+	'gender'                  => 'unknown',</ins></td></tr>
<tr id="45"><td class="linenumbers">2434</td><td class="linenumbers">2435</td><td class="unchanged"><span> );</span></td></tr>
<tr id="46"><td class="linenumbers">2435</td><td class="linenumbers">2436</td><td class="unchanged"><span> </span></td></tr>
<tr id="47"><td class="linenumbers">2436</td><td class="linenumbers">2437</td><td class="unchanged"><span> /** Whether or not to allow and use real name fields. Defaults to true. */</span></td></tr>
<tr id="48" class="patchedfile"><td colspan="3">Index: trunk/phase3/languages/Language.php</td></tr>



<tr id="52"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -2065,6 +2065,21 @@</span></td></tr>
<tr id="53"><td class="linenumbers">2066</td><td class="linenumbers">2066</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="54"><td class="linenumbers">2067</td><td class="linenumbers">2067</td><td class="unchanged"><span> </span></td></tr>
<tr id="55"><td class="linenumbers">2068</td><td class="linenumbers">2068</td><td class="unchanged"><span> 	/**</span></td></tr>
<tr id="56"><td class="linenumbers"> </td><td class="linenumbers">2069</td><td class="ins"><ins>+	 * Provides an alternative text depending on specified gender.</ins></td></tr>
<tr id="57"><td class="linenumbers"> </td><td class="linenumbers">2070</td><td class="ins"><ins>+	 * Usage {{gender:username|masculine|feminine|neutral}}.</ins></td></tr>
<tr id="58"><td class="linenumbers"> </td><td class="linenumbers">2071</td><td class="ins"><ins>+	 * username is optional, in which case the gender of current user is used,</ins></td></tr>
<tr id="59"><td class="linenumbers"> </td><td class="linenumbers">2072</td><td class="ins"><ins>+	 * but only in (some) interface messages; otherwise default gender is used.</ins></td></tr>
<tr id="60"><td class="linenumbers"> </td><td class="linenumbers">2073</td><td class="ins"><ins>+	 * If second or third parameter are not specified, masculine is used.</ins></td></tr>
<tr id="61"><td class="linenumbers"> </td><td class="linenumbers">2074</td><td class="ins"><ins>+	 * These details may be overriden per language.</ins></td></tr>
<tr id="62"><td class="linenumbers"> </td><td class="linenumbers">2075</td><td class="ins"><ins>+	 */</ins></td></tr>
<tr id="63"><td class="linenumbers"> </td><td class="linenumbers">2076</td><td class="ins"><ins>+	function gender( $gender, $forms ) {</ins></td></tr>
<tr id="64"><td class="linenumbers"> </td><td class="linenumbers">2077</td><td class="ins"><ins>+		$forms = $this->preConvertPlural( $forms, 2 );</ins></td></tr>
<tr id="65"><td class="linenumbers"> </td><td class="linenumbers">2078</td><td class="ins"><ins>+		if ( $gender === 'male' ) return $forms[0];</ins></td></tr>
<tr id="66"><td class="linenumbers"> </td><td class="linenumbers">2079</td><td class="ins"><ins>+		if ( $gender === 'female' ) return $forms[1];</ins></td></tr>
<tr id="67"><td class="linenumbers"> </td><td class="linenumbers">2080</td><td class="ins"><ins>+		return isset($forms[2]) ? $forms[2] : $forms[0];</ins></td></tr>
<tr id="68"><td class="linenumbers"> </td><td class="linenumbers">2081</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="69"><td class="linenumbers"> </td><td class="linenumbers">2082</td><td class="ins"><ins>+</ins></td></tr>
<tr id="70"><td class="linenumbers"> </td><td class="linenumbers">2083</td><td class="ins"><ins>+	/**</ins></td></tr>
<tr id="71"><td class="linenumbers">2069</td><td class="linenumbers">2084</td><td class="unchanged"><span> 	 * Plural form transformations, needed for some languages.</span></td></tr>
<tr id="72"><td class="linenumbers">2070</td><td class="linenumbers">2085</td><td class="unchanged"><span> 	 * For example, there are 3 form of plural in Russian and Polish,</span></td></tr>
<tr id="73"><td class="linenumbers">2071</td><td class="linenumbers">2086</td><td class="unchanged"><span> 	 * depending on "count mod 10". See [[w:Plural]]</span></td></tr>
<tr id="74" class="patchedfile"><td colspan="3">Index: trunk/phase3/RELEASE-NOTES</td></tr>



<tr id="78"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -63,6 +63,7 @@</span></td></tr>
<tr id="79"><td class="linenumbers">64</td><td class="linenumbers">64</td><td class="unchanged"><span> * (bug 17145) Specific categories can be excluded from Special:UnusedCategories</span></td></tr>
<tr id="80"><td class="linenumbers">65</td><td class="linenumbers">65</td><td class="unchanged"><span>   with __IGNOREUNUSED__</span></td></tr>
<tr id="81"><td class="linenumbers">66</td><td class="linenumbers">66</td><td class="unchanged"><span> * (bug 13040) Gender switch in user preferences</span></td></tr>
<tr id="82"><td class="linenumbers"> </td><td class="linenumbers">67</td><td class="ins"><ins>+* (bug 13040) {{GENDER:}} magic word for interface messages</ins></td></tr>
<tr id="83"><td class="linenumbers">67</td><td class="linenumbers">68</td><td class="unchanged"><span> </span></td></tr>
<tr id="84"><td class="linenumbers">68</td><td class="linenumbers">69</td><td class="unchanged"><span> === Bug fixes in 1.15 ===</span></td></tr>
<tr id="85"><td class="linenumbers">69</td><td class="linenumbers">70</td><td class="unchanged"><span> * (bug 16968) Special:Upload no longer throws useless warnings.</span></td></tr>
</table>
</div>
<h2 id='code-signoffs'>Sign-offs</h2>
<table border='1' class='wikitable'><tr><th>User</th><th>Flag</th><th>Date</th></tr><tr class='mw-codereview-signoff-flag-inspected'><td><a href="https://www.mediawiki.org/w/index.php?title=User:Claupopoka&amp;action=edit&amp;redlink=1" class="new mw-userlink" title="User:Claupopoka (page does not exist)"><bdi>Claupopoka</bdi></a></td><td>inspected</td><td>07:42, 8 September 2012</td></tr>
<tr class='mw-codereview-signoff-flag-tested'><td><a href="https://www.mediawiki.org/w/index.php?title=User:Claupopoka&amp;action=edit&amp;redlink=1" class="new mw-userlink" title="User:Claupopoka (page does not exist)"><bdi>Claupopoka</bdi></a></td><td>tested</td><td>07:42, 8 September 2012</td></tr></table><h2 id='code-references'>Follow-up revisions</h2>
<table border='1' class='wikitable'><tr><th>Revision</th><th>Commit summary</th><th>Author</th><th>Date</th></tr><tr class='mw-codereview-status-reverted'><td><a href="./47196.html" title="Special:Code/MediaWiki/47196">r47196</a></td><td>* (<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=13040">bug 13040</a>) Gender-aware user namespace aliases...</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/nikerabbit" title="Special:Code/MediaWiki/author/nikerabbit">nikerabbit</a></td><td>19:54, 12 February 2009</td></tr>
<tr class='mw-codereview-status-ok'><td><a href="./47391.html" title="Special:Code/MediaWiki/47391">r47391</a></td><td>Revert <a href="./47196.html" title="Special:Code/MediaWiki/47196">r47196</a>, <a href="./47219.html" title="Special:Code/MediaWiki/47219">r47219</a> &quot;* (<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=13040">bug 13040</a>) Gender-aware user namespace aliases&quot; and...</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/brion" title="Special:Code/MediaWiki/author/brion">brion</a></td><td>23:00, 17 February 2009</td></tr></table><h2 id='code-referenced'>Past revisions this follows-up on</h2>
<table border='1' class='wikitable'><tr><th>Revision</th><th>Commit summary</th><th>Author</th><th>Date</th></tr><tr class='mw-codereview-status-ok'><td><a href="./46246.html" title="Special:Code/MediaWiki/46246">r46246</a></td><td>* (<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=13040">bug 13040</a>) Gender switch in user preferences</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/nikerabbit" title="Special:Code/MediaWiki/author/nikerabbit">nikerabbit</a></td><td>09:41, 26 January 2009</td></tr></table><h2 id='code-comments'>Comments</h2>
<div class='mw-codereview-comments'><div class="mw-codereview-comment" id="c1462" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./46247.html#c1462" title="Special:Code/MediaWiki/46247">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Siebrand" class="mw-userlink" title="User:Siebrand"><bdi>Siebrand</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Siebrand" class="mw-usertoollinks-talk" title="User talk:Siebrand">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Siebrand" class="mw-usertoollinks-contribs" title="Special:Contributions/Siebrand">contribs</a>)</span> &#160; 00:01, 27 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>Notice in gender() fixed in <a href="./46249.html" title="Special:Code/MediaWiki/46249">r46249</a>
</p></div></div></div><h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>21:10, 27 January 2009&#160;<a href="https://www.mediawiki.org/wiki/User:Brion_VIBBER" class="mw-userlink" title="User:Brion VIBBER"><bdi>Brion VIBBER</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Brion_VIBBER" class="mw-usertoollinks-talk" title="User talk:Brion VIBBER">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Brion_VIBBER" class="mw-usertoollinks-contribs" title="Special:Contributions/Brion VIBBER">contribs</a>)</span>&#160;changed the <b>status</b> of r46247 <i>[<b>removed:</b> new&#160;<b>added:</b> ok]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/46247.html responseCode 3 200 