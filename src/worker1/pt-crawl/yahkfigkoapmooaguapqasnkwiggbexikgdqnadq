yahkfigkoapmooaguapqasnkwiggbexikgdqnadq length 5 21100 page 21100 
<html>
<head>
<title>r80813 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r80813 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/80813" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./80812.html" title="Special:Code/MediaWiki/80812">r80812</a>‎ | <b>r80813</b> | <a href="./80814.html" title="Special:Code/MediaWiki/80814">r80814</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>13:09, 23 January 2011</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/krinkle" title="Special:Code/MediaWiki/author/krinkle">krinkle</a></td></tr>
<tr><td>Status:</td><td>ok (<a href="#code-comments">Comments</a>)
</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message"><a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=26870">Bug 26870</a> - add width/height param to {{filepath:}}<br />
* In addition to <a href="./80381.html" title="Special:Code/MediaWiki/80381">r80381</a><br />
* Expanded comments in SpecialFilePath a little bit</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/includes/parser/CoreParserFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2Fparser%2FCoreParserFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/specials/SpecialFilepath.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2Fspecials%2FSpecialFilepath.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/80813&amp;action=purge" title="Special:Code/MediaWiki/80813">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/parser/CoreParserFunctions.php</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -615,11 +615,39 @@</span></td></tr>
<tr id="6"><td class="linenumbers">616</td><td class="linenumbers">616</td><td class="unchanged"><span> 				'&lt;/span>' );</span></td></tr>
<tr id="7"><td class="linenumbers">617</td><td class="linenumbers">617</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="8"><td class="linenumbers">618</td><td class="linenumbers">618</td><td class="unchanged"><span> </span></td></tr>
<tr id="9"><td class="linenumbers">619</td><td class="linenumbers"> </td><td class="del"><del>-	public static function filepath( $parser, $name='', $option='' ) {</del></td></tr>
<tr id="10"><td class="linenumbers"> </td><td class="linenumbers">619</td><td class="ins"><ins>+	// Usage {{filepath|300}}, {{filepath|nowiki}}, {{filepath|nowiki|300}} or {{filepath|300|nowiki}}</ins></td></tr>
<tr id="11"><td class="linenumbers"> </td><td class="linenumbers">620</td><td class="ins"><ins>+	public static function filepath( $parser, $name='', $argA='', $argB='' ) {</ins></td></tr>
<tr id="12"><td class="linenumbers">620</td><td class="linenumbers">621</td><td class="unchanged"><span> 		$file = wfFindFile( $name );</span></td></tr>
<tr id="13"><td class="linenumbers">621</td><td class="linenumbers"> </td><td class="del"><del>-		if( $file ) {</del></td></tr>
<tr id="14"><td class="linenumbers">622</td><td class="linenumbers"> </td><td class="del"><del>-			$url = $file->getFullUrl();</del></td></tr>
<tr id="15"><td class="linenumbers">623</td><td class="linenumbers"> </td><td class="del"><del>-			if( $option == 'nowiki' ) {</del></td></tr>
<tr id="16"><td class="linenumbers"> </td><td class="linenumbers">622</td><td class="ins"><ins>+		$size = '';</ins></td></tr>
<tr id="17"><td class="linenumbers"> </td><td class="linenumbers">623</td><td class="ins"><ins>+</ins></td></tr>
<tr id="18"><td class="linenumbers"> </td><td class="linenumbers">624</td><td class="ins"><ins>+		if ( intval( $argB ) > 0 ) {</ins></td></tr>
<tr id="19"><td class="linenumbers"> </td><td class="linenumbers">625</td><td class="ins"><ins>+			// {{filepath: | option | size }}</ins></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">626</td><td class="ins"><ins>+			$size = intval( $argB );</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">627</td><td class="ins"><ins>+			$option = $argA;</ins></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">628</td><td class="ins"><ins>+</ins></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">629</td><td class="ins"><ins>+		} elseif ( intval( $argA ) > 0 ) {</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">630</td><td class="ins"><ins>+			// {{filepath: | size [|option] }}</ins></td></tr>
<tr id="25"><td class="linenumbers"> </td><td class="linenumbers">631</td><td class="ins"><ins>+			$size = intval( $argA );</ins></td></tr>
<tr id="26"><td class="linenumbers"> </td><td class="linenumbers">632</td><td class="ins"><ins>+			$option = $argB;</ins></td></tr>
<tr id="27"><td class="linenumbers"> </td><td class="linenumbers">633</td><td class="ins"><ins>+</ins></td></tr>
<tr id="28"><td class="linenumbers"> </td><td class="linenumbers">634</td><td class="ins"><ins>+		} else {</ins></td></tr>
<tr id="29"><td class="linenumbers"> </td><td class="linenumbers">635</td><td class="ins"><ins>+			// {{filepath: [|option] }}</ins></td></tr>
<tr id="30"><td class="linenumbers"> </td><td class="linenumbers">636</td><td class="ins"><ins>+			$option = $argA;</ins></td></tr>
<tr id="31"><td class="linenumbers"> </td><td class="linenumbers">637</td><td class="ins"><ins>+		}</ins></td></tr>
<tr id="32"><td class="linenumbers"> </td><td class="linenumbers">638</td><td class="ins"><ins>+</ins></td></tr>
<tr id="33"><td class="linenumbers"> </td><td class="linenumbers">639</td><td class="ins"><ins>+		if ( $file ) {</ins></td></tr>
<tr id="34"><td class="linenumbers"> </td><td class="linenumbers">640</td><td class="ins"><ins>+			$url = $file->getUrl();</ins></td></tr>
<tr id="35"><td class="linenumbers"> </td><td class="linenumbers">641</td><td class="ins"><ins>+</ins></td></tr>
<tr id="36"><td class="linenumbers"> </td><td class="linenumbers">642</td><td class="ins"><ins>+			// If a size is requested...			</ins></td></tr>
<tr id="37"><td class="linenumbers"> </td><td class="linenumbers">643</td><td class="ins"><ins>+			if ( is_integer( $size ) ) {</ins></td></tr>
<tr id="38"><td class="linenumbers"> </td><td class="linenumbers">644</td><td class="ins"><ins>+				$mto = $file->transform( array( 'width' => $size ) );</ins></td></tr>
<tr id="39"><td class="linenumbers"> </td><td class="linenumbers">645</td><td class="ins"><ins>+				// ... and we can</ins></td></tr>
<tr id="40"><td class="linenumbers"> </td><td class="linenumbers">646</td><td class="ins"><ins>+				if ( $mto &amp;&amp; !$mto->isError() ) {</ins></td></tr>
<tr id="41"><td class="linenumbers"> </td><td class="linenumbers">647</td><td class="ins"><ins>+					// ... change the URL to point to a thumbnail.</ins></td></tr>
<tr id="42"><td class="linenumbers"> </td><td class="linenumbers">648</td><td class="ins"><ins>+					$url = wfExpandUrl( $mto->getUrl() );</ins></td></tr>
<tr id="43"><td class="linenumbers"> </td><td class="linenumbers">649</td><td class="ins"><ins>+				}</ins></td></tr>
<tr id="44"><td class="linenumbers"> </td><td class="linenumbers">650</td><td class="ins"><ins>+			}</ins></td></tr>
<tr id="45"><td class="linenumbers"> </td><td class="linenumbers">651</td><td class="ins"><ins>+			if ( $option == 'nowiki' ) {</ins></td></tr>
<tr id="46"><td class="linenumbers">624</td><td class="linenumbers">652</td><td class="unchanged"><span> 				return array( $url, 'nowiki' => true );</span></td></tr>
<tr id="47"><td class="linenumbers">625</td><td class="linenumbers">653</td><td class="unchanged"><span> 			}</span></td></tr>
<tr id="48"><td class="linenumbers">626</td><td class="linenumbers">654</td><td class="unchanged"><span> 			return $url;</span></td></tr>
<tr id="49" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/specials/SpecialFilepath.php</td></tr>



<tr id="53"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -52,12 +52,13 @@</span></td></tr>
<tr id="54"><td class="linenumbers">53</td><td class="linenumbers">53</td><td class="unchanged"><span> 				$url = $file->getURL();</span></td></tr>
<tr id="55"><td class="linenumbers">54</td><td class="linenumbers">54</td><td class="unchanged"><span> 				$width = $wgRequest->getInt( 'width', -1 );</span></td></tr>
<tr id="56"><td class="linenumbers">55</td><td class="linenumbers">55</td><td class="unchanged"><span> 				$height = $wgRequest->getInt( 'height', -1 );</span></td></tr>
<tr id="57"><td class="linenumbers">56</td><td class="linenumbers"> </td><td class="del"><del>-				</del></td></tr>
<tr id="58"><td class="linenumbers"> </td><td class="linenumbers">56</td><td class="ins"><ins>+</ins></td></tr>
<tr id="59"><td class="linenumbers"> </td><td class="linenumbers">57</td><td class="ins"><ins>+				// If a width is requested...			</ins></td></tr>
<tr id="60"><td class="linenumbers">57</td><td class="linenumbers">58</td><td class="unchanged"><span> 				if ( $width != -1 ) {</span></td></tr>
<tr id="61"><td class="linenumbers">58</td><td class="linenumbers"> </td><td class="del"><del>-					// If we can, and it's requested,</del></td></tr>
<tr id="62"><td class="linenumbers">59</td><td class="linenumbers"> </td><td class="del"><del>-					// change the URL to point to a thumbnail.</del></td></tr>
<tr id="63"><td class="linenumbers">60</td><td class="linenumbers">59</td><td class="unchanged"><span> 					$mto = $file->transform( array( 'width' => $width, 'height' => $height ) );</span></td></tr>
<tr id="64"><td class="linenumbers"> </td><td class="linenumbers">60</td><td class="ins"><ins>+					// ... and we can</ins></td></tr>
<tr id="65"><td class="linenumbers">61</td><td class="linenumbers">61</td><td class="unchanged"><span> 					if ( $mto &amp;&amp; !$mto->isError() ) {</span></td></tr>
<tr id="66"><td class="linenumbers"> </td><td class="linenumbers">62</td><td class="ins"><ins>+						// ... change the URL to point to a thumbnail.</ins></td></tr>
<tr id="67"><td class="linenumbers">62</td><td class="linenumbers">63</td><td class="unchanged"><span> 						$url = $mto->getURL();</span></td></tr>
<tr id="68"><td class="linenumbers">63</td><td class="linenumbers">64</td><td class="unchanged"><span> 					}</span></td></tr>
<tr id="69"><td class="linenumbers">64</td><td class="linenumbers">65</td><td class="unchanged"><span> 				}</span></td></tr>
</table>
</div>
<h2 id='code-references'>Follow-up revisions</h2>
<table border='1' class='wikitable'><tr><th>Revision</th><th>Commit summary</th><th>Author</th><th>Date</th></tr><tr class='mw-codereview-status-ok'><td><a href="./80814.html" title="Special:Code/MediaWiki/80814">r80814</a></td><td>update RELEASE-NOTES for <a href="./80813.html" title="Special:Code/MediaWiki/80813">r80813</a> and <a href="./80381.html" title="Special:Code/MediaWiki/80381">r80381</a></td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/krinkle" title="Special:Code/MediaWiki/author/krinkle">krinkle</a></td><td>13:15, 23 January 2011</td></tr>
<tr class='mw-codereview-status-ok'><td><a href="./80815.html" title="Special:Code/MediaWiki/80815">r80815</a></td><td>Follow-up per <a href="./80813.html" title="Special:Code/MediaWiki/80813">r80813</a> CR</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/krinkle" title="Special:Code/MediaWiki/author/krinkle">krinkle</a></td><td>14:34, 23 January 2011</td></tr>
<tr class='mw-codereview-status-resolved'><td><a href="./85256.html" title="Special:Code/MediaWiki/85256">r85256</a></td><td>1.17wmf1: MFT <a href="./80813.html" title="Special:Code/MediaWiki/80813">r80813</a>, <a href="./80815.html" title="Special:Code/MediaWiki/80815">r80815</a>, <a href="./83798.html" title="Special:Code/MediaWiki/83798">r83798</a>, <a href="./84459.html" title="Special:Code/MediaWiki/84459">r84459</a>, <a href="./84729.html" title="Special:Code/MediaWiki/84729">r84729</a>, <a href="./84820.html" title="Special:Code/MediaWiki/84820">r84820</a>, <a href="./84921.html" title="Special:Code/MediaWiki/84921">r84921</a>, <a href="./84985.html" title="Special:Code/MediaWiki/84985">r84985</a>,...</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/catrope" title="Special:Code/MediaWiki/author/catrope">catrope</a></td><td>14:13, 3 April 2011</td></tr></table><h2 id='code-referenced'>Past revisions this follows-up on</h2>
<table border='1' class='wikitable'><tr><th>Revision</th><th>Commit summary</th><th>Author</th><th>Date</th></tr><tr class='mw-codereview-status-ok'><td><a href="./80381.html" title="Special:Code/MediaWiki/80381">r80381</a></td><td>Add width parameter to Special:Filepath to allow getting the file path of a t...</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/catrope" title="Special:Code/MediaWiki/author/catrope">catrope</a></td><td>11:20, 15 January 2011</td></tr></table><h2 id='code-comments'>Comments</h2>
<div class='mw-codereview-comments'><div class="mw-codereview-comment" id="c13351" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./80813.html#c13351" title="Special:Code/MediaWiki/80813">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Reedy" class="mw-userlink" title="User:Reedy"><bdi>Reedy</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Reedy" class="mw-usertoollinks-talk" title="User talk:Reedy">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Reedy" class="mw-usertoollinks-contribs" title="Special:Contributions/Reedy">contribs</a>)</span> &#160; 13:32, 23 January 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>Minor comment, when you're doing like intval casts/transformations, and doing them potentially twice on the same variable, it's saner to do it to a temp variable&#160;:)
</p></div></div>
<div class="mw-codereview-comment" id="c13353" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./80813.html#c13353" title="Special:Code/MediaWiki/80813">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Krinkle" class="mw-userlink" title="User:Krinkle"><bdi>Krinkle</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Krinkle" class="mw-usertoollinks-talk" title="User talk:Krinkle">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Krinkle" class="mw-usertoollinks-contribs" title="Special:Contributions/Krinkle">contribs</a>)</span> &#160; 14:34, 23 January 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>Thanks, I wasn't sure whether to introduce two additional variables or not, but I performance wise the difference is small although a temp variable does sound faster.
Done in <a href="./80815.html" title="Special:Code/MediaWiki/80815">r80815</a>.
</p></div></div>
<div class="mw-codereview-comment" id="c13369" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./80813.html#c13369" title="Special:Code/MediaWiki/80813">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Bawolff" class="mw-userlink" title="User:Bawolff"><bdi>Bawolff</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Bawolff" class="mw-usertoollinks-talk" title="User talk:Bawolff">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Bawolff" class="mw-usertoollinks-contribs" title="Special:Contributions/Bawolff">contribs</a>)</span> &#160; 23:47, 23 January 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>Might want to consider supporting <a href="https://www.mediawiki.org/wiki/Special:FilePath" title="Special:FilePath">Special:Filepath</a> (200 wide 300 high) and <a href="https://www.mediawiki.org/wiki/Special:FilePath" title="Special:FilePath">Special:Filepath</a> (height of 300), to be consistent with how image links work.
</p></div></div>
<div class="mw-codereview-comment" id="c13370" style="margin-left: 48px"><div class="mw-codereview-comment-meta"><a href="./80813.html#c13370" title="Special:Code/MediaWiki/80813">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Bawolff" class="mw-userlink" title="User:Bawolff"><bdi>Bawolff</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Bawolff" class="mw-usertoollinks-talk" title="User talk:Bawolff">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Bawolff" class="mw-usertoollinks-contribs" title="Special:Contributions/Bawolff">contribs</a>)</span> &#160; 23:49, 23 January 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p><b>*Sigh*</b> Lets try that again with nowiki&#160;;)
</p><p>Might want to consider supporting {{Filepath:foo|200x300}} (200 wide 300 high) and {{Filepath:foo|x300}} (height of 300), to be consistent with how image links work. 
</p></div></div>
<div class="mw-codereview-comment" id="c15511" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./80813.html#c15511" title="Special:Code/MediaWiki/80813">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Krinkle" class="mw-userlink" title="User:Krinkle"><bdi>Krinkle</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Krinkle" class="mw-usertoollinks-talk" title="User talk:Krinkle">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Krinkle" class="mw-usertoollinks-contribs" title="Special:Contributions/Krinkle">contribs</a>)</span> &#160; 17:04, 28 March 2011 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>See also <a href="./80815.html" title="Special:Code/MediaWiki/80815">r80815</a>. Wikipedia is currently using a funny way with <code>{{#titleparts:}}</code> and <code>{{filepath:}}</code> <sup id="cite_ref-1" class="reference"><a href="#cite_note-1">&#91;1&#93;</a></sup>
</p><p>We might as well deploy this one&#160;? Tagging 1.17wmf1
</p><p><br />
</p>
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1">↑</a></span> <span class="reference-text"><a class="external text" href="https://en.wikipedia.org/wiki/Template:Thumbpath">http://en.wikipedia.org/wiki/Template:Thumbpath</a></span>
</li>
</ol></div></div></div></div><h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>14:27, 3 April 2011&#160;<a href="https://www.mediawiki.org/wiki/User:Catrope" class="mw-userlink" title="User:Catrope"><bdi>Catrope</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Catrope" class="mw-usertoollinks-talk" title="User talk:Catrope">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Catrope" class="mw-usertoollinks-contribs" title="Special:Contributions/Catrope">contribs</a>)</span>&#160;changed the <b>tags</b> for r80813 <i>[<b>removed:</b> 1.17wmf1]</i></li>
<li>13:15, 3 April 2011&#160;<a href="https://www.mediawiki.org/wiki/User:Catrope" class="mw-userlink" title="User:Catrope"><bdi>Catrope</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Catrope" class="mw-usertoollinks-talk" title="User talk:Catrope">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Catrope" class="mw-usertoollinks-contribs" title="Special:Contributions/Catrope">contribs</a>)</span>&#160;changed the <b>status</b> of r80813 <i>[<b>removed:</b> new&#160;<b>added:</b> ok]</i></li>
<li>17:04, 28 March 2011&#160;<a href="https://www.mediawiki.org/wiki/User:Krinkle" class="mw-userlink" title="User:Krinkle"><bdi>Krinkle</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Krinkle" class="mw-usertoollinks-talk" title="User talk:Krinkle">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Krinkle" class="mw-usertoollinks-contribs" title="Special:Contributions/Krinkle">contribs</a>)</span>&#160;changed the <b>tags</b> for r80813 <i>[<b>added:</b> 1.17wmf1]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/80813.html responseCode 3 200 