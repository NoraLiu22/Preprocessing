ocdqbmbgrsogxilmkgymhqakokpsfmdsgkpkkksm length 5 18792 page 18792 
<html>
<head>
<title>r45587 MediaWiki - Code Review archive</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../ext.codereview.styles.css"/>
</head>
<body>
<h1>r45587 MediaWiki - Code Review archive</h1>
<div id="mw-content-text" class="mw-body-content"><form action="/wiki/Special:Code/MediaWiki/45587" method="post"><table class="mw-codereview-meta"><tr><td>Repository:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki" title="Special:Code/MediaWiki">MediaWiki</a></td></tr>
<tr><td>Revision:</td><td>&lt;&#160;<a href="./45586.html" title="Special:Code/MediaWiki/45586">r45586</a>‎ | <b>r45587</b> | <a href="./45588.html" title="Special:Code/MediaWiki/45588">r45588</a>&#160;&gt;</td></tr>
<tr><td>Date:</td><td>23:21, 8 January 2009</td></tr>
<tr><td>Author:</td><td><a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/author/mrzman" title="Special:Code/MediaWiki/author/mrzman">mrzman</a></td></tr>
<tr><td>Status:</td><td>ok (<a href="#code-comments">Comments</a>)
</td></tr>
<tr><td>Tags:</td><td></td></tr>
<tr><td>Comment:</td><td><div class="mw-codereview-message">(<a class="external" href="https://bugzilla.wikimedia.org/show_bug.cgi?id=9947">bug 9947</a>) Add PROTECTIONLEVEL parser function to return the protection level for a given action (e.g. edit, move) for the current page.</div></td></tr>
<tr><td>Modified paths:</td><td><div class='mw-codereview-paths mw-content-ltr'><ul>
<li><b>/trunk/phase3/RELEASE-NOTES</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2FRELEASE-NOTES" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/MagicWord.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2FMagicWord.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/includes/parser/CoreParserFunctions.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Fincludes%2Fparser%2FCoreParserFunctions.php" title="Special:Code/MediaWiki">history</a>)</li>
<li><b>/trunk/phase3/languages/messages/MessagesEn.php</b> (modified) (<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki&amp;path=%2Ftrunk%2Fphase3%2Flanguages%2Fmessages%2FMessagesEn.php" title="Special:Code/MediaWiki">history</a>)</li>
</ul></div>
</td></tr>
</table>
<h2>Diff <small>[<a href="https://www.mediawiki.org/w/index.php?title=Special:Code/MediaWiki/45587&amp;action=purge" title="Special:Code/MediaWiki/45587">purge</a>]</small></h2><div class='mw-codereview-diff' id='mw-codereview-diff'><table class="mw-codereview-diff"><tr id="1" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/parser/CoreParserFunctions.php</td></tr>



<tr id="5"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -45,6 +45,7 @@</span></td></tr>
<tr id="6"><td class="linenumbers">46</td><td class="linenumbers">46</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'filepath',         array( __CLASS__, 'filepath'         ), SFH_NO_HASH );</span></td></tr>
<tr id="7"><td class="linenumbers">47</td><td class="linenumbers">47</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'pagesincategory',  array( __CLASS__, 'pagesincategory'  ), SFH_NO_HASH );</span></td></tr>
<tr id="8"><td class="linenumbers">48</td><td class="linenumbers">48</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'pagesize',         array( __CLASS__, 'pagesize'         ), SFH_NO_HASH );</span></td></tr>
<tr id="9"><td class="linenumbers"> </td><td class="linenumbers">49</td><td class="ins"><ins>+		$parser->setFunctionHook( 'protectionlevel',  array( __CLASS__, 'protectionlevel'  ), SFH_NO_HASH );</ins></td></tr>
<tr id="10"><td class="linenumbers">49</td><td class="linenumbers">50</td><td class="unchanged"><span> 		$parser->setFunctionHook( 'tag',              array( __CLASS__, 'tagObj'           ), SFH_OBJECT_ARGS );</span></td></tr>
<tr id="11"><td class="linenumbers">50</td><td class="linenumbers">51</td><td class="unchanged"><span> </span></td></tr>
<tr id="12"><td class="linenumbers">51</td><td class="linenumbers">52</td><td class="unchanged"><span> 		if ( $wgAllowDisplayTitle ) {</span></td></tr>
<tr id="13"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -292,6 +293,16 @@</span></td></tr>
<tr id="14"><td class="linenumbers">293</td><td class="linenumbers">294</td><td class="unchanged"><span> 		}	</span></td></tr>
<tr id="15"><td class="linenumbers">294</td><td class="linenumbers">295</td><td class="unchanged"><span> 		return self::formatRaw( $length, $raw );</span></td></tr>
<tr id="16"><td class="linenumbers">295</td><td class="linenumbers">296</td><td class="unchanged"><span> 	}</span></td></tr>
<tr id="17"><td class="linenumbers"> </td><td class="linenumbers">297</td><td class="ins"><ins>+	</ins></td></tr>
<tr id="18"><td class="linenumbers"> </td><td class="linenumbers">298</td><td class="ins"><ins>+	/**</ins></td></tr>
<tr id="19"><td class="linenumbers"> </td><td class="linenumbers">299</td><td class="ins"><ins>+	* Returns the requested protection level for the current page</ins></td></tr>
<tr id="20"><td class="linenumbers"> </td><td class="linenumbers">300</td><td class="ins"><ins>+	*/</ins></td></tr>
<tr id="21"><td class="linenumbers"> </td><td class="linenumbers">301</td><td class="ins"><ins>+	static function protectionlevel( $parser, $type = '' ) {</ins></td></tr>
<tr id="22"><td class="linenumbers"> </td><td class="linenumbers">302</td><td class="ins"><ins>+		$restrictions = $parser->mTitle->getRestrictions( strtolower( $type ) );</ins></td></tr>
<tr id="23"><td class="linenumbers"> </td><td class="linenumbers">303</td><td class="ins"><ins>+		# Title::getRestrictions returns an array, its possible it may have</ins></td></tr>
<tr id="24"><td class="linenumbers"> </td><td class="linenumbers">304</td><td class="ins"><ins>+		# multiple values in the future</ins></td></tr>
<tr id="25"><td class="linenumbers"> </td><td class="linenumbers">305</td><td class="ins"><ins>+		return implode( $restrictions, ',' );</ins></td></tr>
<tr id="26"><td class="linenumbers"> </td><td class="linenumbers">306</td><td class="ins"><ins>+	}</ins></td></tr>
<tr id="27"><td class="linenumbers">296</td><td class="linenumbers">307</td><td class="unchanged"><span> </span></td></tr>
<tr id="28"><td class="linenumbers">297</td><td class="linenumbers">308</td><td class="unchanged"><span> 	static function language( $parser, $arg = '' ) {</span></td></tr>
<tr id="29"><td class="linenumbers">298</td><td class="linenumbers">309</td><td class="unchanged"><span> 		global $wgContLang;</span></td></tr>
<tr id="30" class="patchedfile"><td colspan="3">Index: trunk/phase3/includes/MagicWord.php</td></tr>



<tr id="34"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -109,6 +109,7 @@</span></td></tr>
<tr id="35"><td class="linenumbers">110</td><td class="linenumbers">110</td><td class="unchanged"><span> 		'index',</span></td></tr>
<tr id="36"><td class="linenumbers">111</td><td class="linenumbers">111</td><td class="unchanged"><span> 		'noindex',</span></td></tr>
<tr id="37"><td class="linenumbers">112</td><td class="linenumbers">112</td><td class="unchanged"><span> 		'numberingroup',</span></td></tr>
<tr id="38"><td class="linenumbers"> </td><td class="linenumbers">113</td><td class="ins"><ins>+		'protectionlevel',</ins></td></tr>
<tr id="39"><td class="linenumbers">113</td><td class="linenumbers">114</td><td class="unchanged"><span> 	);</span></td></tr>
<tr id="40"><td class="linenumbers">114</td><td class="linenumbers">115</td><td class="unchanged"><span> </span></td></tr>
<tr id="41"><td class="linenumbers">115</td><td class="linenumbers">116</td><td class="unchanged"><span> 	/* Array of caching hints for ParserCache */</span></td></tr>
<tr id="42" class="patchedfile"><td colspan="3">Index: trunk/phase3/languages/messages/MessagesEn.php</td></tr>



<tr id="46"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -333,6 +333,7 @@</span></td></tr>
<tr id="47"><td class="linenumbers">334</td><td class="linenumbers">334</td><td class="unchanged"><span> 	'noindex'                => array( 1,    '__NOINDEX__'            ),</span></td></tr>
<tr id="48"><td class="linenumbers">335</td><td class="linenumbers">335</td><td class="unchanged"><span> 	'numberingroup'          => array( 1,    'NUMBERINGROUP', 'NUMINGROUP' ),</span></td></tr>
<tr id="49"><td class="linenumbers">336</td><td class="linenumbers">336</td><td class="unchanged"><span> 	'staticredirect'         => array( 1,    '__STATICREDIRECT__'     ),</span></td></tr>
<tr id="50"><td class="linenumbers"> </td><td class="linenumbers">337</td><td class="ins"><ins>+	'protectionlevel'        => array( 1,    'PROTECTIONLEVEL'        ),</ins></td></tr>
<tr id="51"><td class="linenumbers">337</td><td class="linenumbers">338</td><td class="unchanged"><span> );</span></td></tr>
<tr id="52"><td class="linenumbers">338</td><td class="linenumbers">339</td><td class="unchanged"><span> </span></td></tr>
<tr id="53"><td class="linenumbers">339</td><td class="linenumbers">340</td><td class="unchanged"><span> /**</span></td></tr>
<tr id="54" class="patchedfile"><td colspan="3">Index: trunk/phase3/RELEASE-NOTES</td></tr>



<tr id="58"><td class="linenumbers">—</td><td class="linenumbers">—</td><td class="chunkdelimiter"><span>@@ -29,7 +29,9 @@</span></td></tr>
<tr id="59"><td class="linenumbers">30</td><td class="linenumbers">30</td><td class="unchanged"><span> * Added "Advanced search" link to the search form</span></td></tr>
<tr id="60"><td class="linenumbers">31</td><td class="linenumbers">31</td><td class="unchanged"><span> * Special:Upload can now have a custom upload message instead of uploadtext by</span></td></tr>
<tr id="61"><td class="linenumbers">32</td><td class="linenumbers">32</td><td class="unchanged"><span>   passing "uploadmsg" parameter in the url</span></td></tr>
<tr id="62"><td class="linenumbers">33</td><td class="linenumbers"> </td><td class="del"><del>-</del></td></tr>
<tr id="63"><td class="linenumbers"> </td><td class="linenumbers">33</td><td class="ins"><ins>+* (bug 9947) Add PROTECTIONLEVEL parser funtion to return the protection level</ins></td></tr>
<tr id="64"><td class="linenumbers"> </td><td class="linenumbers">34</td><td class="ins"><ins>+  for the current page for a given action</ins></td></tr>
<tr id="65"><td class="linenumbers"> </td><td class="linenumbers">35</td><td class="ins"><ins>+  </ins></td></tr>
<tr id="66"><td class="linenumbers">34</td><td class="linenumbers">36</td><td class="unchanged"><span> === Bug fixes in 1.15 ===</span></td></tr>
<tr id="67"><td class="linenumbers">35</td><td class="linenumbers">37</td><td class="unchanged"><span> </span></td></tr>
<tr id="68"><td class="linenumbers">36</td><td class="linenumbers">38</td><td class="unchanged"><span> </span></td></tr>
</table>
</div>
<h2 id='code-comments'>Comments</h2>
<div class='mw-codereview-comments'><div class="mw-codereview-comment" id="c1199" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1199" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:IAlex" class="mw-userlink" title="User:IAlex"><bdi>IAlex</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:IAlex" class="mw-usertoollinks-talk" title="User talk:IAlex">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/IAlex" class="mw-usertoollinks-contribs" title="Special:Contributions/IAlex">contribs</a>)</span> &#160; 10:00, 9 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>One little thing: adding a variable ID to MagicWords::$mVariableIDs means that you'll handle it in Parser::getVariableValue(), which is not the case here. You don't need to add a magic word ID there if it'll be used for parser function. The problem is now that you can add "{{PROTECTIONLEVEL}}" in wikitext, but the result will always be an empty string, even if the page is a protected page.
</p></div></div>
<div class="mw-codereview-comment" id="c1206" style="margin-left: 48px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1206" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Mr.Z-man" class="mw-userlink" title="User:Mr.Z-man"><bdi>Mr.Z-man</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Mr.Z-man" class="mw-usertoollinks-talk" title="User talk:Mr.Z-man">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Mr.Z-man" class="mw-usertoollinks-contribs" title="Special:Contributions/Mr.Z-man">contribs</a>)</span> &#160; 18:29, 9 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>removed in <a href="./45609.html" title="Special:Code/MediaWiki/45609">r45609</a>. Some others can probably be removed from there too...
</p></div></div>
<div class="mw-codereview-comment" id="c1251" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1251" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Brion_VIBBER" class="mw-userlink" title="User:Brion VIBBER"><bdi>Brion VIBBER</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Brion_VIBBER" class="mw-usertoollinks-talk" title="User talk:Brion VIBBER">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Brion_VIBBER" class="mw-usertoollinks-contribs" title="Special:Contributions/Brion VIBBER">contribs</a>)</span> &#160; 00:05, 14 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>We're a bit leery of this.
</p></div></div>
<div class="mw-codereview-comment" id="c1252" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1252" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Brion_VIBBER" class="mw-userlink" title="User:Brion VIBBER"><bdi>Brion VIBBER</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Brion_VIBBER" class="mw-usertoollinks-talk" title="User talk:Brion VIBBER">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Brion_VIBBER" class="mw-usertoollinks-contribs" title="Special:Contributions/Brion VIBBER">contribs</a>)</span> &#160; 00:06, 14 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>[4:05pm] TimStarling: brion: I would say leave it in, and make sure protection changes do indeed invalidate the parser cache
</p></div></div>
<div class="mw-codereview-comment" id="c1255" style="margin-left: 48px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1255" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Mr.Z-man" class="mw-userlink" title="User:Mr.Z-man"><bdi>Mr.Z-man</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Mr.Z-man" class="mw-usertoollinks-talk" title="User talk:Mr.Z-man">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Mr.Z-man" class="mw-usertoollinks-contribs" title="Special:Contributions/Mr.Z-man">contribs</a>)</span> &#160; 00:36, 14 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>Article::updateRestrictions() updates page_touched, which should invalidate the parser cache.
</p></div></div>
<div class="mw-codereview-comment" id="c1258" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1258" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Brion_VIBBER" class="mw-userlink" title="User:Brion VIBBER"><bdi>Brion VIBBER</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Brion_VIBBER" class="mw-usertoollinks-talk" title="User talk:Brion VIBBER">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Brion_VIBBER" class="mw-usertoollinks-contribs" title="Special:Contributions/Brion VIBBER">contribs</a>)</span> &#160; 00:45, 14 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>w00t
</p></div></div>
<div class="mw-codereview-comment" id="c1350" style="margin-left: 0px"><div class="mw-codereview-comment-meta"><a href="./45587.html#c1350" title="Special:Code/MediaWiki/45587">#</a>Comment by <a href="https://www.mediawiki.org/wiki/User:Aaron_Schulz" class="mw-userlink" title="User:Aaron Schulz"><bdi>Aaron Schulz</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Aaron_Schulz" class="mw-usertoollinks-talk" title="User talk:Aaron Schulz">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Aaron_Schulz" class="mw-usertoollinks-contribs" title="Special:Contributions/Aaron Schulz">contribs</a>)</span> &#160; 23:06, 20 January 2009 </div><div class="mw-codereview-comment-text mw-content-ltr"><p>So this is OK, right?
</p></div></div></div><h2 id='code-changes'>Status &amp; tagging log</h2>
<ul class='mw-codereview-changes'><li>17:56, 24 January 2009&#160;<a href="https://www.mediawiki.org/wiki/User:Aaron_Schulz" class="mw-userlink" title="User:Aaron Schulz"><bdi>Aaron Schulz</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Aaron_Schulz" class="mw-usertoollinks-talk" title="User talk:Aaron Schulz">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Aaron_Schulz" class="mw-usertoollinks-contribs" title="Special:Contributions/Aaron Schulz">contribs</a>)</span>&#160;changed the <b>status</b> of r45587 <i>[<b>removed:</b> fixme&#160;<b>added:</b> ok]</i></li>
<li>00:05, 14 January 2009&#160;<a href="https://www.mediawiki.org/wiki/User:Brion_VIBBER" class="mw-userlink" title="User:Brion VIBBER"><bdi>Brion VIBBER</bdi></a> <span class="mw-usertoollinks">(<a href="https://www.mediawiki.org/wiki/User_talk:Brion_VIBBER" class="mw-usertoollinks-talk" title="User talk:Brion VIBBER">talk</a> | <a href="https://www.mediawiki.org/wiki/Special:Contributions/Brion_VIBBER" class="mw-usertoollinks-contribs" title="Special:Contributions/Brion VIBBER">contribs</a>)</span>&#160;changed the <b>status</b> of r45587 <i>[<b>removed:</b> new&#160;<b>added:</b> fixme]</i></li></ul></form></div>
</body>
</html>
 contentType 9 text/html url 64 https://static-codereview.wikimedia.org:443/MediaWiki/45587.html responseCode 3 200 